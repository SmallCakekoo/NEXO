/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={45:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(825));t.default=class{constructor(e,{headers:t={},schema:n,fetch:s}){this.url=e,this.headers=t,this.schema=n,this.fetch=s}select(e,{head:t=!1,count:n}={}){const s=t?"HEAD":"GET";let r=!1;const o=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!r?"":('"'===e&&(r=!r),e))).join("");return this.url.searchParams.set("select",o),n&&(this.headers.Prefer=`count=${n}`),new i.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:n=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),n||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){const o=[`resolution=${n?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new i.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new i.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},261:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(660));class r extends i.default{select(e){let t=!1;const n=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:s,referencedTable:i=s}={}){const r=i?`${i}.order`:"order",o=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===n?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const s=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:s=n}={}){const i=void 0===s?"offset":`${s}.offset`,r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(r,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:s=!1,wal:i=!1,format:r="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,n?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${r}; for="${c}"; options=${a};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}t.default=r},279:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const i=s(n(961));t.PostgrestClient=i.default;const r=s(n(45));t.PostgrestQueryBuilder=r.default;const o=s(n(825));t.PostgrestFilterBuilder=o.default;const a=s(n(261));t.PostgrestTransformBuilder=a.default;const c=s(n(660));t.PostgrestBuilder=c.default;const l=s(n(818));t.PostgrestError=l.default,t.default={PostgrestClient:i.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:c.default,PostgrestError:l.default}},519:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.version=void 0,t.version="0.0.0-automated"},530:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_HEADERS=void 0;const s=n(519);t.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${s.version}`}},591:e=>{e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},660:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(907)),r=s(n(818));t.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=i.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,n,s;let i=null,o=null,a=null,c=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(o="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),r=null===(n=e.headers.get("content-range"))||void 0===n?void 0:n.split("/");s&&r&&r.length>1&&(a=parseInt(r[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,c=406,l="Not Acceptable"):o=1===o.length?o[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(o=[],i=null,c=200,l="OK")}catch(n){404===e.status&&""===t?(c=204,l="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(s=null==i?void 0:i.details)||void 0===s?void 0:s.includes("0 rows"))&&(i=null,c=200,l="OK"),i&&this.shouldThrowOnError)throw new r.default(i)}return{error:i,data:o,count:a,status:c,statusText:l}}));return this.shouldThrowOnError||(n=n.catch((e=>{var t,n,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(n=null==e?void 0:e.stack)&&void 0!==n?n:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}}))),n.then(e,t)}returns(){return this}overrideTypes(){return this}}},818:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=n},825:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(261));class r extends i.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:s}={}){let i="";"plain"===s?i="pl":"phrase"===s?i="ph":"websearch"===s&&(i="w");const r=void 0===n?"":`(${n})`;return this.url.searchParams.append(e,`${i}fts${r}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}}t.default=r},907:(e,t,n)=>{n.r(t),n.d(t,{Headers:()=>o,Request:()=>a,Response:()=>c,default:()=>r,fetch:()=>i});var s=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("unable to locate global object")}();const i=s.fetch,r=s.fetch.bind(s),o=s.Headers,a=s.Request,c=s.Response},961:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(45)),r=s(n(825)),o=n(530);class a{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},o.DEFAULT_HEADERS),t),this.schemaName=n,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new i.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new a(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:s=!1,count:i}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let c;n||s?(o=n?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{a.searchParams.append(e,t)}))):(o="POST",c=t);const l=Object.assign({},this.headers);return i&&(l.Prefer=`count=${i}`),new r.default({method:o,url:a,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}}t.default=a}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,n),r.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};class s extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.addBootstrapFunctionality(),this.setupNavigation()}render(){this.shadowRoot.innerHTML='\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">\n      <style>\n  nav {\n    background: #ddddfb;\n    padding: 10px 20px;\n    box-shadow: 1px 2px 14px -3px rgba(112, 112, 112, 0.39);\n  border-bottom: 1px solid #5354ed;\n  position: relative;\n  z-index: 1000;\n}\nimg {\n  width: 150px;\n  margin-left: 20px;\n}\n.navbar-toggler {\n  border: 1px solid #5354ed;\n  border-radius: 8px;\n  color: #5354ed;\n  background-color: transparent;\n  transition: all 0.3s ease;\n}\n.navbar-toggler-icon {\n  background-image: url("data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 30 30\'%3e%3cpath stroke=\'%235354ED\' stroke-linecap=\'round\' stroke-miterlimit=\'10\' stroke-width=\'2\' d=\'M4 7h22M4 15h22M4 23h22\'/%3e%3c/svg%3e");\n}\n.navbar-toggler:focus {\n  box-shadow: none;\n}\n.buttons {\n  display: flex;\n  align-items: center;\n  gap: 90px;\n  justify-content: flex-end;\n}\n.desktop-buttons {\n  padding-right: 50px;\n}\n.overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.16);\n  opacity: 0;\n  visibility: hidden;\n  z-index: 998;\n  transition:\n    opacity 0.3s ease,\n    visibility 0.3s ease;\n}\n.overlay.show {\n  opacity: 1;\n  visibility: visible;\n}\n.mobile-menu {\n  position: fixed;\n  top: 80px;\n  right: 1px;\n  transform: translateX(100%);\n  background: #ddddfb;\n  padding: 20px;\n  border-radius: 0px 0px 0px 15px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n  width: auto;\n  min-width: 10px;\n  max-width: 90vw;\n  opacity: 0;\n  transition: all 0.3s ease;\n  z-index: 999;\n}\n.mobile-menu.show {\n  opacity: 1;\n  transform: translateX(0);\n}\n@media (max-width: 576px) {\n  .navbar-collapse {\n    display: none;\n  }\n  .mobile-menu .buttons {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .buttons {\n    flex-direction: column;\n    align-items: center;\n    gap: 15px;\n    width: 100%;\n  }\n  .buttons > * {\n    width: 100%;\n    min-width: 0;\n    max-width: 100%;\n  }\n  .mobile-menu {\n    max-width: calc(100vw - 40px);\n  }\n}\n\n        </style>\n            <nav class="navbar navbar-expand-lg">\n                <div class="container-fluid">\n                    <a class="navbar-brand" href="#">\n                        <img src="/assets/images/logonexobig.webp" alt="Logo">\n                    </a>\n                    <button class="navbar-toggler" type="button" id="toggleBtn">\n                        <span class="navbar-toggler-icon"></span>\n                    </button>\n                    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">\n                        <div class="buttons d-flex desktop-buttons">\n                            <btn-feed></btn-feed>\n                            <btn-academic></btn-academic>\n                            <btn-profile></btn-profile>\n                        </div>\n                    </div>\n                </div>\n            </nav>\n            <div class="overlay" id="overlay"></div>\n            <div class="mobile-menu" id="mobileMenu">\n                <div class="buttons">\n                    <btn-feed></btn-feed>\n                    <btn-academic></btn-academic>\n                    <btn-profile></btn-profile>\n                    \n                </div>\n            </div>\n        '}addBootstrapFunctionality(){const e=this.shadowRoot.querySelector("#toggleBtn"),t=this.shadowRoot.querySelector("#overlay"),n=this.shadowRoot.querySelector("#mobileMenu");e&&t&&n&&(e.addEventListener("click",(()=>{const e=n.classList.contains("show");n.classList.toggle("show",!e),t.classList.toggle("show",!e)})),t.addEventListener("click",(()=>{n.classList.remove("show"),t.classList.remove("show")})))}setupNavigation(){this.shadowRoot.querySelectorAll("btn-feed, btn-academic, btn-profile").forEach((e=>{e.addEventListener("click",(()=>{let t="";"btn-feed"===e.tagName.toLowerCase()&&(t="/feed"),"btn-academic"===e.tagName.toLowerCase()&&(t="/academic"),"btn-profile"===e.tagName.toLowerCase()&&(t="/profile"),this.navigate(t)}))}))}navigate(e){const t=new CustomEvent("navigate",{detail:e});document.dispatchEvent(t)}}const i=s,r=new class{constructor(){this._listeners=[]}register(e){this._listeners.push(e)}dispatch(e){for(const t of this._listeners)t(e)}},o="NAVIGATE",a="UPDATE_ROUTE",c="SET_RETURN_TO_FEED",l="SET_RETURN_TO_PROFILE",h="SET_ACTIVE_ACADEMIC_TAB",u=(e,t,n=!1)=>{r.dispatch({type:n?a:o,payload:{path:e,params:t}})},d=e=>{r.dispatch({type:a,payload:{path:e}})},p=e=>{r.dispatch({type:h,payload:{tab:e}})};class g extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.addBootstrapFunctionality(),this.setupNavigation()}setupNavigation(){this.shadowRoot?.querySelector(".desktop-buttons"),this.shadowRoot?.querySelector(".mobile-menu .buttons");const e=this.shadowRoot?.querySelectorAll("btn-login");e?.forEach((e=>{e.addEventListener("click",(()=>{u("/login")}))}));const t=this.shadowRoot?.querySelectorAll("btn-signup");t?.forEach((e=>{e.addEventListener("click",(()=>{u("/signup")}))}));const n=this.shadowRoot?.querySelector(".back-arrow");n?.addEventListener("click",(()=>{window.history.length>1?window.history.back():u("/")}))}render(){this.shadowRoot.innerHTML='\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">\n      <style>\n  nav {\n    background: #ddddfb;\n    padding: 10px 20px;\n    box-shadow: 1px 2px 14px -3px rgba(112, 112, 112, 0.39);\n    border-bottom: 1px solid #5354ed;\n    position: relative;\n    z-index: 1000;\n  }\n  img {\n    width: 150px;\n    margin-left: 20px;\n    cursor: pointer;\n  }\n  .navbar-toggler {\n    border: 1px solid #5354ed;\n    border-radius: 8px;\n    color: #5354ed;\n    background-color: transparent;\n    transition: all 0.3s ease;\n  }\n  .navbar-toggler-icon {\n    background-image: url("data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 30 30\'%3e%3cpath stroke=\'%235354ED\' stroke-linecap=\'round\' stroke-miterlimit=\'10\' stroke-width=\'2\' d=\'M4 7h22M4 15h22M4 23h22\'/%3e%3c/svg%3e");\n  }\n  .navbar-toggler:focus {\n    box-shadow: none;\n  }\n  .buttons {\n    display: flex;\n    align-items: center;\n    gap: 90px;\n    justify-content: flex-end;\n  }\n  .desktop-buttons {\n    padding-right: 50px;\n  }\n  .overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.16);\n    opacity: 0;\n    visibility: hidden;\n    z-index: 998;\n    transition: opacity 0.3s ease, visibility 0.3s ease;\n  }\n  .overlay.show {\n    opacity: 1;\n    visibility: visible;\n  }\n  .mobile-menu {\n    position: fixed;\n    top: 80px;\n    right: 1px;\n    transform: translateX(100%);\n    background: #ddddfb;\n    padding: 20px;\n    border-radius: 0px 0px 0px 15px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n    width: auto;\n    min-width: 10px;\n    max-width: 90vw;\n    opacity: 0;\n    transition: all 0.3s ease;\n    z-index: 999;\n  }\n  .mobile-menu.show {\n    opacity: 1;\n    transform: translateX(0);\n  }\n  @media (max-width: 576px) {\n    .navbar-collapse {\n      display: none;\n    }\n    .mobile-menu .buttons {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .buttons {\n      flex-direction: column;\n      align-items: center;\n      gap: 15px;\n      width: 100%;\n    }\n    .buttons > * {\n      width: 100%;\n      min-width: 0;\n      max-width: 100%;\n    }\n    .mobile-menu {\n      max-width: calc(100vw - 40px);\n    }\n  }\n\n  /* NUEVO: estilo para flechita en pantallas peque√±as */\n  .back-arrow {\n    display: none;\n    font-size: 32px;\n    color: #5354ed;\n    font-weight: bold;\n    margin-left: 20px;\n    margin-top: 10px;\n    cursor: pointer;\n    position: absolute;\n    left: 20px;\n    top: 50%;\n    transform: translateY(-50%);\n    z-index: 1001;\n  }\n\n  @media (max-width: 430px) {\n    .navbar-brand,\n    .navbar-toggler,\n    .desktop-buttons {\n      display: none !important;\n    }\n\n    .back-arrow {\n      display: block;\n    }\n\n    .container-fluid {\n      justify-content: center;\n    }\n  }\n\n      </style>\n      <nav class="navbar navbar-expand-lg">\n        <div class="container-fluid">\n          <a class="navbar-brand" id="logo">\n            <img src="/assets/images/logonexobig.webp" alt="Logo">\n          </a>\n          <span class="back-arrow">&lt;</span> \x3c!-- NUEVO: flechita --\x3e\n          <button class="navbar-toggler" type="button" id="toggleBtn">\n            <span class="navbar-toggler-icon"></span>\n          </button>\n          <div class="collapse navbar-collapse justify-content-end" id="navbarNav">\n            <div class="buttons d-flex desktop-buttons">\n              <btn-login></btn-login>\n              <btn-signup></btn-signup>\n            </div>\n          </div>\n        </div>\n      </nav>\n      <div class="overlay" id="overlay"></div>\n      <div class="mobile-menu" id="mobileMenu">\n        <div class="buttons">\n          <btn-login></btn-login>\n          <btn-signup></btn-signup>\n        </div>\n      </div>\n    '}addBootstrapFunctionality(){const e=this.shadowRoot.querySelector("#toggleBtn"),t=this.shadowRoot.querySelector("#overlay"),n=this.shadowRoot.querySelector("#mobileMenu"),s=this.shadowRoot.querySelector("#logo");e&&t&&n&&(e.addEventListener("click",(()=>{const e=n.classList.contains("show");n.classList.toggle("show",!e),t.classList.toggle("show",!e)})),t.addEventListener("click",(()=>{n.classList.remove("show"),t.classList.remove("show")}))),s?.addEventListener("click",(()=>{u("/")}))}}const f=g;class m extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return["text","target"]}connectedCallback(){this.render(),this.addEventListeners()}addEventListeners(){const e=this.shadowRoot?.querySelector(".back-button");e?.addEventListener("click",(()=>{const e=this.getAttribute("target")||"/feed",t=window.location.pathname;"/feed"===e?r.dispatch({type:c}):"/profile"===e?r.dispatch({type:l}):"/academic"===e&&("/subject-detail"===t?p("subjects"):"/teacher-detail"===t&&p("teacher")),u(e)}))}attributeChangedCallback(e,t,n){t!==n&&(this.render(),this.addEventListeners())}render(){const e=this.getAttribute("text")||"Back";this.shadowRoot.innerHTML=`\n    <style> \n      .back-button {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        background: none;\n        border: none;\n        cursor: pointer;\n        font-size: 16px;\n        color: var(--nexopurple);\n        font-weight: 500;\n        padding: 8px 0;\n        transition: all 0.2s ease;\n      }\n\n      .back-button:hover {\n        opacity: 0.8;\n        transform: translateX(-3px);\n      }\n\n      .back-icon {\n        fill: var(--nexopurple);\n      }\n    </style>        \n    <button class="back-button">\n      <svg class="back-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>\n      </svg>\n      ${e}\n    </button>\n    `}}const v=m;class b extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML='\n     <style>\n     button {\n  background-color: #5354ed;\n  color: white;\n  font-size: 14px;\n  border: 2px solid black;\n  padding: 7px 47px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  \n  transition: all 0.3s ease;\n}\n\nbutton:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\nbutton:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n}\n\n     </style>\n      <button id="feed-button">Feed</button>\n    ',this.shadowRoot.querySelector("#feed-button")?.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("navigate",{detail:"feed"}))}))}}const y=b;class w extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML='\n     <style>\n     button {\n  background-color: #5354ed;\n  color: white;\n  font-size: 14px;\n  border: 2px solid black;\n  padding: 7px 30px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  \n  transition: all 0.3s ease;\n}\n\nbutton:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\nbutton:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n}\n\n     </style>\n      <button id="academic-button">Academics</button>\n    ',this.shadowRoot.querySelector("#academic-button")?.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("navigate",{detail:"academic"}))}))}}const x=w;class _ extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML='\n      <style>\n      button {\n    background-color: #5354ED;\n    color: white;\n    font-size: 14px;\n    border: 2px solid black;\n    padding: 7px 47px;\n    border-radius: 50px;\n    cursor: pointer;\n    outline: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  transition: all 0.3s ease;\n  }\n\n  button:hover {\n    filter: brightness(1.2);\n    transform: scale(1.05);\n    -webkit-box-shadow: 0px 6px 0px -4px rgba(0,0,0,1);\n    -moz-box-shadow: 0px 6px 0px -4px rgba(0,0,0,1);\n    box-shadow: 0px 6px 0px -4px rgba(0,0,0,1);\n  }\n\n  button:active {\n    transform: scale(0.95);\n    -webkit-box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);\n    -moz-box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);\n    box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);\n    filter: brightness(0.8);\n  }\n      </style>\n      <button id="profile-button">Profile</button>\n    ',this.shadowRoot.querySelector("#profile-button")?.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("navigate",{detail:"profile"}))}))}}const S=_;class E extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML='\n     <style>\n     button {\n  background-color: #5354ed;\n  color: white;\n  font-size: 14px;\n  border: 2px solid black;\n  padding: 7px 52px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  \n  transition: all 0.3s ease;\n}\n\nbutton:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\nbutton:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n}\n\n     </style>\n      <button id="login-button">Login</button>\n    '}}const k=E;class T extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML='\n     <style>\n     button {\n  background-color: #5354ed;\n  color: white;\n  font-size: 14px;\n  border: 2px solid black;\n  padding: 7px 47px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  \n  transition: all 0.3s ease;\n}\n\nbutton:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\nbutton:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n}\n\n     </style>\n      <button id="signup-button">Sign Up</button>\n    ',this.shadowRoot.querySelector("#signup-button")?.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("navigate",{detail:"/signup"}))}))}}const I=T,C="SIGN_UP",A="SIGN_UP_SUCCESS",R="SIGN_UP_ERROR",P="SELECT_TEACHER",L="SELECT_SUBJECT";var D;!function(e){e.LIKE_POST="LIKE_POST",e.UNLIKE_POST="UNLIKE_POST",e.ADD_TEACHER_RATING="ADD_TEACHER_RATING",e.ADD_SUBJECT_RATING="ADD_SUBJECT_RATING",e.UPDATE_TEACHER_RATING="UPDATE_TEACHER_RATING",e.UPDATE_SUBJECT_RATING="UPDATE_SUBJECT_RATING",e.LOAD_POSTS="LOAD_POSTS",e.ADD_POST="ADD_POST"}(D||(D={}));const O="CHECK_AUTH",N="LOGIN_SUCCESS",j="LOGOUT",M=e=>{r.dispatch({type:N,payload:e})},U="SEARCH_SUBJECTS",F="SEARCH_TEACHERS",$=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let i=e.charCodeAt(s);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&s+1<e.length&&56320==(64512&e.charCodeAt(s+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++s)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},V={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let t=0;t<e.length;t+=3){const i=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=i>>2,h=(3&i)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(u=64)),s.push(n[l],n[h],n[u],n[d])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray($(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const i=e[n++];if(i<128)t[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=e[n++];t[s++]=String.fromCharCode((31&i)<<6|63&r)}else if(i>239&&i<365){const r=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(r>>10)),t[s++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[s++]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],r=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==r||null==o||null==a)throw new z;const c=i<<2|r>>4;if(s.push(c),64!==o){const e=r<<4&240|o>>2;if(s.push(e),64!==a){const e=o<<6&192|a;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class z extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const B=function(e){return function(e){const t=$(e);return V.encodeByteArray(t,!0)}(e).replace(/\./g,"")},q=function(e){try{return V.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const H=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&q(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},K=e=>{var t,n;return null===(n=null===(t=H())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},G=()=>{var e;return null===(e=H())||void 0===e?void 0:e.config},W=e=>{var t;return null===(t=H())||void 0===t?void 0:t[`_${e}`]};class J{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function Q(e){return e.endsWith(".cloudworkstations.dev")}async function Y(e){return(await fetch(e,{credentials:"include"})).ok}const X={};let Z=!1;function ee(e,t){if("undefined"==typeof window||"undefined"==typeof document||!Q(window.location.host)||X[e]===t||X[e]||Z)return;function n(e){return`__firebase__banner__${e}`}X[e]=t;const s="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(X))X[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function r(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(s),t=n("text"),r=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),l=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{Z=!0,function(){const e=document.getElementById(s);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(l,c),t.append(l,r,a,n),document.body.appendChild(t)}i?(r.innerText="Preview backend disconnected.",l.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(l.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',r.innerText="Preview backend running in this workspace."),r.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",r):r()}function te(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ne(){return!function(){var e;const t=null===(e=H())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class se extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,se.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ie.prototype.create)}}class ie{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],r=i?function(e,t){return e.replace(re,((e,n)=>{const s=t[n];return null!=s?String(s):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${r} (${s}).`;return new se(s,o,n)}}const re=/\{\$([^}]+)}/g;function oe(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const i of n){if(!s.includes(i))return!1;const n=e[i],r=t[i];if(ae(n)&&ae(r)){if(!oe(n,r))return!1}else if(n!==r)return!1}for(const e of s)if(!n.includes(e))return!1;return!0}function ae(e){return null!==e&&"object"==typeof e}function ce(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function le(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,s]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(s)}})),t}function he(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ue{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let s;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");s=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===s.next&&(s.next=de),void 0===s.error&&(s.error=de),void 0===s.complete&&(s.complete=de);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(e){}})),this.observers.push(s),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function de(){}function pe(e){return e&&e._delegate?e._delegate:e}class ge{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const fe="[DEFAULT]";class me{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new J;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),s=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(s)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:fe})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=fe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=fe){return this.instances.has(e)}getOptions(e=fe){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(s);return s}onInit(e,t){var n;const s=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===fe?void 0:s),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var s;return n||null}normalizeInstanceIdentifier(e=fe){return this.component?this.component.multipleInstances?e:fe:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ve{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new me(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const be=[];var ye;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ye||(ye={}));const we={debug:ye.DEBUG,verbose:ye.VERBOSE,info:ye.INFO,warn:ye.WARN,error:ye.ERROR,silent:ye.SILENT},xe=ye.INFO,_e={[ye.DEBUG]:"log",[ye.VERBOSE]:"log",[ye.INFO]:"info",[ye.WARN]:"warn",[ye.ERROR]:"error"},Se=(e,t,...n)=>{if(t<e.logLevel)return;const s=(new Date).toISOString(),i=_e[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${s}]  ${e.name}:`,...n)};class Ee{constructor(e){this.name=e,this._logLevel=xe,this._logHandler=Se,this._userLogHandler=null,be.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ye))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?we[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ye.DEBUG,...e),this._logHandler(this,ye.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ye.VERBOSE,...e),this._logHandler(this,ye.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ye.INFO,...e),this._logHandler(this,ye.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ye.WARN,...e),this._logHandler(this,ye.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ye.ERROR,...e),this._logHandler(this,ye.ERROR,...e)}}let ke,Te;const Ie=new WeakMap,Ce=new WeakMap,Ae=new WeakMap,Re=new WeakMap,Pe=new WeakMap;let Le={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Ce.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ae.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Oe(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function De(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Te||(Te=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Ne(this),e),Oe(Ie.get(this))}:function(...e){return Oe(t.apply(Ne(this),e))}:function(e,...n){const s=t.call(Ne(this),e,...n);return Ae.set(s,e.sort?e.sort():[e]),Oe(s)}:(e instanceof IDBTransaction&&function(e){if(Ce.has(e))return;const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{t(),s()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)}));Ce.set(e,t)}(e),n=e,(ke||(ke=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,Le):e);var t,n}function Oe(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{t(Oe(e.result)),s()},r=()=>{n(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&Ie.set(t,e)})).catch((()=>{})),Pe.set(t,e),t}(e);if(Re.has(e))return Re.get(e);const t=De(e);return t!==e&&(Re.set(e,t),Pe.set(t,e)),t}const Ne=e=>Pe.get(e),je=["get","getKey","getAll","getAllKeys","count"],Me=["put","add","delete","clear"],Ue=new Map;function Fe(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Ue.get(t))return Ue.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,i=Me.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!i&&!je.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,i?"readwrite":"readonly");let o=r.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&r.done]))[0]};return Ue.set(t,r),r}var $e;$e=Le,Le={...$e,get:(e,t,n)=>Fe(e,t)||$e.get(e,t,n),has:(e,t)=>!!Fe(e,t)||$e.has(e,t)};class Ve{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ze="@firebase/app",Be="0.13.1",qe=new Ee("@firebase/app"),He="@firebase/app-compat",Ke="@firebase/analytics-compat",Ge="@firebase/analytics",We="@firebase/app-check-compat",Je="@firebase/app-check",Qe="@firebase/auth",Ye="@firebase/auth-compat",Xe="@firebase/database",Ze="@firebase/data-connect",et="@firebase/database-compat",tt="@firebase/functions",nt="@firebase/functions-compat",st="@firebase/installations",it="@firebase/installations-compat",rt="@firebase/messaging",ot="@firebase/messaging-compat",at="@firebase/performance",ct="@firebase/performance-compat",lt="@firebase/remote-config",ht="@firebase/remote-config-compat",ut="@firebase/storage",dt="@firebase/storage-compat",pt="@firebase/firestore",gt="@firebase/ai",ft="@firebase/firestore-compat",mt="firebase",vt="[DEFAULT]",bt={[ze]:"fire-core",[He]:"fire-core-compat",[Ge]:"fire-analytics",[Ke]:"fire-analytics-compat",[Je]:"fire-app-check",[We]:"fire-app-check-compat",[Qe]:"fire-auth",[Ye]:"fire-auth-compat",[Xe]:"fire-rtdb",[Ze]:"fire-data-connect",[et]:"fire-rtdb-compat",[tt]:"fire-fn",[nt]:"fire-fn-compat",[st]:"fire-iid",[it]:"fire-iid-compat",[rt]:"fire-fcm",[ot]:"fire-fcm-compat",[at]:"fire-perf",[ct]:"fire-perf-compat",[lt]:"fire-rc",[ht]:"fire-rc-compat",[ut]:"fire-gcs",[dt]:"fire-gcs-compat",[pt]:"fire-fst",[ft]:"fire-fst-compat",[gt]:"fire-vertex","fire-js":"fire-js",[mt]:"fire-js-all"},yt=new Map,wt=new Map,xt=new Map;function _t(e,t){try{e.container.addComponent(t)}catch(n){qe.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function St(e){const t=e.name;if(xt.has(t))return qe.debug(`There were multiple attempts to register component ${t}.`),!1;xt.set(t,e);for(const t of yt.values())_t(t,e);for(const t of wt.values())_t(t,e);return!0}function Et(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function kt(e){return null!=e&&void 0!==e.settings}const Tt=new ie("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class It{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ge("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Tt.create("app-deleted",{appName:this._name})}}const Ct="11.9.0";function At(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const s=Object.assign({name:vt,automaticDataCollectionEnabled:!0},t),i=s.name;if("string"!=typeof i||!i)throw Tt.create("bad-app-name",{appName:String(i)});if(n||(n=G()),!n)throw Tt.create("no-options");const r=yt.get(i);if(r){if(oe(n,r.options)&&oe(s,r.config))return r;throw Tt.create("duplicate-app",{appName:i})}const o=new ve(i);for(const e of xt.values())o.addComponent(e);const a=new It(n,s,o);return yt.set(i,a),a}function Rt(e=vt){const t=yt.get(e);if(!t&&e===vt&&G())return At();if(!t)throw Tt.create("no-app",{appName:e});return t}function Pt(e,t,n){var s;let i=null!==(s=bt[e])&&void 0!==s?s:e;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${i}" with version "${t}":`];return r&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void qe.warn(e.join(" "))}St(new ge(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Lt="firebase-heartbeat-store";let Dt=null;function Ot(){return Dt||(Dt=function(e,t,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(e,t),a=Oe(o);return s&&o.addEventListener("upgradeneeded",(e=>{s(Oe(o.result),e.oldVersion,e.newVersion,Oe(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{r&&e.addEventListener("close",(()=>r())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Lt)}catch(e){console.warn(e)}}}).catch((e=>{throw Tt.create("idb-open",{originalErrorMessage:e.message})}))),Dt}async function Nt(e,t){try{const n=(await Ot()).transaction(Lt,"readwrite"),s=n.objectStore(Lt);await s.put(t,jt(e)),await n.done}catch(e){if(e instanceof se)qe.warn(e.message);else{const t=Tt.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});qe.warn(t.message)}}}function jt(e){return`${e.name}!${e.options.appId}`}class Mt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ft(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ut();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some((e=>e.date===s)))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let s=1;s<e.length;s++)e[s].date<n&&(n=e[s].date,t=s);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){qe.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ut(),{heartbeatsToSend:n,unsentEntries:s}=function(e,t=1024){const n=[];let s=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),$t(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),$t(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),i=B(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return qe.warn(e),""}}}function Ut(){return(new Date).toISOString().substring(0,10)}class Ft{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Ot()).transaction(Lt),n=await t.objectStore(Lt).get(jt(e));return await t.done,n}catch(e){if(e instanceof se)qe.warn(e.message);else{const t=Tt.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});qe.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Nt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Nt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function $t(e){return B(JSON.stringify({version:2,heartbeats:e})).length}St(new ge("platform-logger",(e=>new Ve(e)),"PRIVATE")),St(new ge("heartbeat",(e=>new Mt(e)),"PRIVATE")),Pt(ze,Be,""),Pt(ze,Be,"esm2017"),Pt("fire-js",""),Pt("firebase","11.9.1","app");var Vt,zt,Bt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},qt={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var s=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)s[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)s[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var r=e.g[3],o=t+(r^n&(i^r))+s[0]+3614090360&4294967295;o=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=(n=(i=(r=(t=n+(o<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(i^r))+s[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(i^r))+s[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(i^r))+s[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(i^t&(n^i))+s[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^r&(t^n))+s[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(r^t))+s[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^r&(n^i))+s[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^r&(n^i))+s[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^r&(n^i))+s[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^r&(n^i))+s[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^i&(t^n))+s[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(r^t))+s[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(i^r))+s[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^r)+s[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^r)+s[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^r)+s[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^r)+s[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^i)+s[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(r^t^n)+s[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^r^t)+s[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~r))+s[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(r|~n))+s[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~t))+s[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~r))+s[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(r|~n))+s[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~t))+s[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~r))+s[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(r|~n))+s[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(i|~t))+s[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(t=n+((o=t+(i^(n|~r))+s[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~i))+s[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=r+((o=i+(t^(r|~n))+s[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+r&4294967295}function s(e,t){this.h=t;for(var n=[],s=!0,i=e.length-1;0<=i;i--){var r=0|e[i];s&&r==t||(n[i]=r,s=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var s=t-this.blockSize,i=this.B,r=this.h,o=0;o<t;){if(0==r)for(;o<=s;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[r++]=e.charCodeAt(o++),r==this.blockSize){n(this,i),r=0;break}}else for(;o<t;)if(i[r++]=e[o++],r==this.blockSize){n(this,i),r=0;break}}this.h=r,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var s=0;32>s;s+=8)e[n++]=this.g[t]>>>s&255;return e};var i={};function r(e){return-128<=e&&128>e?function(e){var t=i;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new s([0|e],0>e?-1:0)}(e)}(e):new s([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new s(t,0)}var a=r(0),c=r(1),l=r(16777216);function h(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new s(n,~e.h).add(c)}function p(e,t){return e.add(d(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function f(e,t){this.g=e,this.h=t}function m(e,t){if(h(t))throw Error("division by zero");if(h(e))return new f(a,a);if(u(e))return t=m(d(e),t),new f(d(t.g),d(t.h));if(u(t))return t=m(e,d(t)),new f(d(t.g),t.h);if(30<e.g.length){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,s=t;0>=s.l(e);)n=v(n),s=v(s);var i=b(n,1),r=b(s,1);for(s=b(s,2),n=b(n,2);!h(s);){var l=r.add(s);0>=l.l(e)&&(i=i.add(n),r=l),s=b(s,1),n=b(n,1)}return t=p(e,i.j(t)),new f(i,t)}for(i=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),s=48>=(s=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,s-48),l=(r=o(n)).j(t);u(l)||0<l.l(e);)l=(r=o(n-=s)).j(t);h(r)&&(r=c),i=i.add(r),e=p(e,l)}return new f(i,e)}function v(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new s(n,e.h)}function b(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,r=[],o=0;o<i;o++)r[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new s(r,e.h)}(e=s.prototype).m=function(){if(u(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var s=this.i(n);e+=(0<=s?s:4294967296+s)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(h(this))return"0";if(u(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,s="";;){var i=m(n,t).g,r=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(h(n=i))return r+s;for(;6>r.length;)r="0"+r;s=r+s}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=p(this,e))?-1:h(e)?0:1},e.abs=function(){return u(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,r=0;r<=t;r++){var o=i+(65535&this.i(r))+(65535&e.i(r)),a=(o>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);i=a>>>16,o&=65535,a&=65535,n[r]=a<<16|o}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(h(this)||h(e))return a;if(u(this))return u(e)?d(this).j(d(e)):d(d(this).j(e));if(u(e))return d(this.j(d(e)));if(0>this.l(l)&&0>e.l(l))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<e.g.length;r++){var c=this.i(i)>>>16,p=65535&this.i(i),f=e.i(r)>>>16,m=65535&e.i(r);n[2*i+2*r]+=p*m,g(n,2*i+2*r),n[2*i+2*r+1]+=c*m,g(n,2*i+2*r+1),n[2*i+2*r+1]+=p*f,g(n,2*i+2*r+1),n[2*i+2*r+2]+=c*f,g(n,2*i+2*r+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new s(n,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new s(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new s(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,zt=qt.Md5=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=o,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var s=o(Math.pow(n,8)),i=a,r=0;r<t.length;r+=8){var c=Math.min(8,t.length-r),l=parseInt(t.substring(r,r+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(l))):i=(i=i.j(s)).add(o(l))}return i},Vt=qt.Integer=s}).apply(void 0!==Bt?Bt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Ht,Kt,Gt,Wt,Jt,Qt,Yt,Xt,Zt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},en={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Zt&&Zt];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,s){if(s)e:{var i=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var o=e[r];if(!(o in i))break e;i=i[o]}(s=s(r=i[e=e[e.length-1]]))!=r&&null!=s&&t(i,e,{configurable:!0,writable:!0,value:s})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,s=!1,i={next:function(){if(!s&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return s=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var s=s||{},i=this||self;function r(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function l(e,t,n){return(l=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function h(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,s){for(var i=Array(arguments.length-2),r=2;r<arguments.length;r++)i[r-2]=arguments[r];return t.prototype[n].apply(e,i)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let s=0;s<t;s++)n[s]=e[s];return n}return[]}function p(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(r(n)){const t=e.length||0,s=n.length||0;e.length=t+s;for(let i=0;i<s;i++)e[t+i]=n[i]}else e.push(n)}}function g(e){return/^[\s\xa0]*$/.test(e)}function f(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var v=!(-1==f().indexOf("Gecko")||-1!=f().toLowerCase().indexOf("webkit")&&-1==f().indexOf("Edge")||-1!=f().indexOf("Trident")||-1!=f().indexOf("MSIE")||-1!=f().indexOf("Edge"));function b(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function y(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function x(e,t){let n,s;for(let t=1;t<arguments.length;t++){for(n in s=arguments[t],s)e[n]=s[n];for(let t=0;t<w.length;t++)n=w[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function _(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function S(e){i.setTimeout((()=>{throw e}),0)}function E(){var e=A;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var k=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new T),(e=>e.reset()));class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let I,C=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){const n=k.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},R=()=>{const e=i.Promise.resolve(void 0);I=()=>{e.then(P)}};var P=()=>{for(var e;e=E();){try{e.h.call(e.g)}catch(e){S(e)}var t=k;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}C=!1};function L(){this.s=this.s,this.C=this.C}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}L.prototype.s=!1,L.prototype.ma=function(){this.s||(this.s=!0,this.N())},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},D.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(e){}return e}();function N(e,t){if(D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(v){e:{try{m(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&N.aa.h.call(this)}}u(N,D);var j={2:"touch",3:"pen",4:"mouse"};N.prototype.h=function(){N.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var M="closure_listenable_"+(1e6*Math.random()|0),U=0;function F(e,t,n,s,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.ha=i,this.key=++U,this.da=this.fa=!1}function $(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e){this.src=e,this.g={},this.h=0}function z(e,t){var n=t.type;if(n in e.g){var s,i=e.g[n],r=Array.prototype.indexOf.call(i,t,void 0);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&($(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function B(e,t,n,s){for(var i=0;i<e.length;++i){var r=e[i];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==s)return i}return-1}V.prototype.add=function(e,t,n,s,i){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var o=B(e,t,s,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new F(t,this.src,r,!!s,i)).fa=n,e.push(t)),t};var q="closure_lm_"+(1e6*Math.random()|0),H={};function K(e,t,n,s,i){if(s&&s.once)return W(e,t,n,s,i);if(Array.isArray(t)){for(var r=0;r<t.length;r++)K(e,t[r],n,s,i);return null}return n=te(n),e&&e[M]?e.K(t,n,o(s)?!!s.capture:!!s,i):G(e,t,n,!1,s,i)}function G(e,t,n,s,i,r){if(!t)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(e);if(c||(e[q]=c=new V(e)),(n=c.add(t,n,s,a,r)).proxy)return n;if(s=function(){const e=X;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)O||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),s,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}function W(e,t,n,s,i){if(Array.isArray(t)){for(var r=0;r<t.length;r++)W(e,t[r],n,s,i);return null}return n=te(n),e&&e[M]?e.L(t,n,o(s)?!!s.capture:!!s,i):G(e,t,n,!0,s,i)}function J(e,t,n,s,i){if(Array.isArray(t))for(var r=0;r<t.length;r++)J(e,t[r],n,s,i);else s=o(s)?!!s.capture:!!s,n=te(n),e&&e[M]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=B(r=e.g[t],n,s,i))&&($(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--))):e&&(e=Z(e))&&(t=e.g[t.toString()],e=-1,t&&(e=B(t,n,s,i)),(n=-1<e?t[e]:null)&&Q(n))}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[M])z(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent(Y(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=Z(t))?(z(n,e),0==n.h&&(n.src=null,t[q]=null)):$(e)}}}function Y(e){return e in H?H[e]:H[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new N(t,this);var n=e.listener,s=e.ha||e.src;e.fa&&Q(e),e=n.call(s,t)}return e}function Z(e){return(e=e[q])instanceof V?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"==typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){L.call(this),this.i=new V(this),this.M=this,this.F=null}function se(e,t){var n,s=e.F;if(s)for(n=[];s;s=s.F)n.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var i=t;x(t=new D(s,e),i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=t.g=n[r];i=ie(o,s,!0,t)&&i}if(i=ie(o=t.g=e,s,!0,t)&&i,i=ie(o,s,!1,t)&&i,n)for(r=0;r<n.length;r++)i=ie(o=t.g=n[r],s,!1,t)&&i}function ie(e,t,n,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&z(e.i,o),i=!1!==a.call(c,s)&&i}}return i&&!s.defaultPrevented}function re(e,t,n){if("function"==typeof e)n&&(e=l(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function oe(e){e.g=re((()=>{e.g=null,e.i&&(e.i=!1,oe(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(ne,L),ne.prototype[M]=!0,ne.prototype.removeEventListener=function(e,t,n,s){J(this,e,t,n,s)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)$(n[s]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,s){return this.i.add(String(e),t,!1,n,s)},ne.prototype.L=function(e,t,n,s){return this.i.add(String(e),t,!0,n,s)};class ae extends L{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:oe(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){L.call(this),this.h=e,this.g={}}u(ce,L);var le=[];function he(e){b(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Q(e)}),e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),he(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ue=i.JSON.stringify,de=i.JSON.parse,pe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function ge(){}function fe(e){return e.h||(e.h=e.i())}function me(){}ge.prototype.h=null;var ve={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function be(){D.call(this,"d")}function ye(){D.call(this,"c")}u(be,D),u(ye,D);var we={},xe=null;function _e(){return xe=xe||new ne}function Se(e){D.call(this,we.La,e)}function Ee(e){const t=_e();se(t,new Se(t))}function ke(e,t){D.call(this,we.STAT_EVENT,e),this.stat=t}function Te(e){const t=_e();se(t,new ke(t,e))}function Ie(e,t){D.call(this,we.Ma,e),this.size=t}function Ce(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ae(){this.g=!0}function Re(e,t,n,s){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var s=n[e];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return ue(n)}catch(e){return t}}(e,n)+(s?" "+s:"")}))}we.La="serverreachability",u(Se,D),we.STAT_EVENT="statevent",u(ke,D),we.Ma="timingevent",u(Ie,D),Ae.prototype.xa=function(){this.g=!1},Ae.prototype.info=function(){};var Pe,Le={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},De={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Oe(){}function Ne(e,t,n,s){this.j=e,this.i=t,this.l=n,this.R=s||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new je}function je(){this.i=null,this.g="",this.h=!1}u(Oe,ge),Oe.prototype.g=function(){return new XMLHttpRequest},Oe.prototype.i=function(){return{}},Pe=new Oe;var Me={},Ue={};function Fe(e,t,n){e.L=1,e.v=ut(ot(t)),e.m=n,e.P=!0,$e(e,null)}function $e(e,t){e.F=Date.now(),Be(e),e.A=ot(e.v);var n=e.A,s=e.R;Array.isArray(s)||(s=[String(s)]),kt(n.i,"t",s),e.C=0,n=e.j.J,e.h=new je,e.g=Sn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ae(l(e.Y,e,e.g),e.O)),t=e.U,n=e.g,s=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(le[0]=i.toString()),i=le);for(var r=0;r<i.length;r++){var o=K(n,i[r],s||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?y(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ee(),function(e,t,n,s,i,r){e.info((function(){if(e.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var h=l[0];l=l[1];var u=h.split("_");o=2<=u.length&&"type"==u[1]?o+(h+"=")+l+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ve(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function ze(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?Ue:(n=Number(t.substring(n,s)),isNaN(n)?Me:(s+=1)+n>t.length?Ue:(t=t.slice(s,s+n),e.C=s+n,t))}function Be(e){e.S=Date.now()+e.I,qe(e,e.I)}function qe(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ce(l(e.ba,e),t)}function He(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function Ke(e){0==e.j.G||e.J||bn(e.j,e)}function Ge(e){He(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,he(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function We(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var s=n.Da.g.parse(t)}catch(e){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;vn(n),an(n)}gn(n),Te(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ce(l(n.Za,n),6e3));if(1>=Xe(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else wn(n,11)}else if((e.K||n.g==e)&&vn(n),!g(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.K=l[1],n.ia=l[2];const t=l[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=l[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const h=l[5];null!=h&&"number"==typeof h&&0<h&&(s=1.5*h,n.L=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=s.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(et(r,r.h),r.h=null))}if(s.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.ya=e,ht(s.I,s.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((s=n).qa=_n(s,s.J?s.ia:null,s.W),o.K){tt(s.h,o);var a=o,c=s.L;c&&(a.I=c),a.B&&(He(a),Be(a)),s.g=o}else pn(s);0<n.i.length&&ln(n)}else"stop"!=l[0]&&"close"!=l[0]||wn(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?wn(n,7):on(n):"noop"!=l[0]&&n.l&&n.l.ta(l),n.v=0)}Ee()}catch(e){}}Ne.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==tn(e)?t.j():this.Y(e)},Ne.prototype.Y=function(e){try{if(e==this.g)e:{const d=tn(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==t||Ee(),He(this);var n=this.g.Z();this.X=n;t:if(Ve(this)){var s=nn(this.g);e="";var r=s.length,o=4==tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ge(this),Ke(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(s[t],{stream:!(o&&t==r-1)});s.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,s,i,r,o){e.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+r+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(c)){var h=c;break t}}h=null}if(!(n=h)){this.o=!1,this.s=3,Te(12),Ge(this),Ke(this);break e}Re(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,We(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=ze(this,a),e==Ue){4==d&&(this.s=4,Te(14),n=!1),Re(this.i,this.l,null,"[Incomplete Response]");break}if(e==Me){this.s=4,Te(15),Re(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Re(this.i,this.l,e,null),We(this,e)}if(Ve(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Te(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),fn(u),u.M=!0,Te(11))}}else Re(this.i,this.l,a,"[Invalid Chunked Response]"),Ge(this),Ke(this)}else Re(this.i,this.l,a,null),We(this,a);4==d&&Ge(this),this.o&&!this.J&&(4==d?bn(this.j,this):(this.o=!1,Be(this)))}else(function(e){const t={};e=(e.g&&2<=tn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(g(e[s]))continue;var n=_(e[s]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=t[i]||[];t[i]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Te(12)):(this.s=0,Te(13)),Ge(this),Ke(this)}}}catch(e){}},Ne.prototype.cancel=function(){this.J=!0,Ge(this)},Ne.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Ee(),Te(17)),Ge(this),this.s=2,Ke(this)):qe(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Qe(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ye(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function st(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(r(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(r(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const s in e)t[n++]=s;return t}}}(e),s=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(r(e)){for(var t=[],n=e.length,s=0;s<n;s++)t.push(e[s]);return t}for(s in t=[],n=0,e)t[n++]=e[s];return t}(e),i=s.length,o=0;o<i;o++)t.call(void 0,s[o],n&&n[o],e)}Qe.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof rt){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new xt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),lt(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,at(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),ct(this,t[4]),this.l=dt(t[5]||"",!0),lt(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new xt(null,this.h))}function ot(e){return new rt(e)}function at(e,t,n){e.j=n?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function lt(e,t,n){t instanceof xt?(e.i=t,function(e,t){t&&!e.j&&(_t(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(St(this,t),kt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=pt(t,yt)),e.i=new xt(t,e.h))}function ht(e,t,n){e.i.set(t,n)}function ut(e){return ht(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function pt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,gt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function gt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}rt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(pt(t,mt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(pt(t,mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(pt(n,"/"==n.charAt(0)?bt:vt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",pt(n,wt)),e.join("")};var ft,mt=/[#\/\?@]/g,vt=/[#\?:]/g,bt=/[#\?]/g,yt=/[#\?@]/g,wt=/#/g;function xt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function _t(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var s=e[n].indexOf("="),i=null;if(0<=s){var r=e[n].substring(0,s);i=e[n].substring(s+1)}else r=e[n];t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function St(e,t){_t(e),t=Tt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Et(e,t){return _t(e),t=Tt(e,t),e.g.has(t)}function kt(e,t,n){St(e,t),0<n.length&&(e.i=null,e.g.set(Tt(e,t),d(n)),e.h+=n.length)}function Tt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function It(e,t,n,s,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),s(n)}catch(e){}}function Ct(){this.g=new pe}function At(e,t,n){const s=n||"";try{st(e,(function(e,n){let i=e;o(e)&&(i=ue(e)),t.push(s+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(s+"type="+encodeURIComponent("_badmap")),e}}function Rt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Pt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Lt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Dt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ot(e)}function Ot(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Nt(e){let t="";return b(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function jt(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=Nt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ht(e,t,n))}function Mt(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=xt.prototype).add=function(e,t){_t(this),this.i=null,e=Tt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){_t(this),this.g.forEach((function(n,s){n.forEach((function(n){e.call(t,n,s,this)}),this)}),this)},e.na=function(){_t(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let s=0;s<t.length;s++){const i=e[s];for(let e=0;e<i.length;e++)n.push(t[s])}return n},e.V=function(e){_t(this);let t=[];if("string"==typeof e)Et(this,e)&&(t=t.concat(this.g.get(Tt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return _t(this),this.i=null,Et(this,e=Tt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var s=t[n];const r=encodeURIComponent(String(s)),o=this.V(s);for(s=0;s<o.length;s++){var i=r;""!==o[s]&&(i+="="+encodeURIComponent(String(o[s]))),e.push(i)}}return this.i=e.join("&")},u(Rt,ge),Rt.prototype.g=function(){return new Pt(this.l,this.j)},Rt.prototype.i=(ft={},function(){return ft}),u(Pt,ne),(e=Pt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ot(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Dt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ot(this)),this.g&&(this.readyState=3,Ot(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Dt(this):Ot(this),3==this.readyState&&Lt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Dt(this))},e.Qa=function(e){this.g&&(this.response=e,Dt(this))},e.ga=function(){this.g&&Dt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Pt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Mt,ne);var Ut=/^https?$/i,Ft=["POST","PUT"];function $t(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Vt(e),Bt(e)}function Vt(e){e.A||(e.A=!0,se(e,"complete"),se(e,"error"))}function zt(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tn(e)||2!=e.Z()))if(e.u&&4==tn(e))re(e.Ea,0,e);else if(se(e,"readystatechange"),4==tn(e)){e.h=!1;try{const s=e.Z();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===s){var o=String(e.D).match(it)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),r=!Ut.test(o?o.toLowerCase():"")}n=r}if(n)se(e,"complete"),se(e,"success");else{e.m=6;try{var a=2<tn(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Vt(e)}}finally{Bt(e)}}}function Bt(e,t){if(e.g){qt(e);const n=e.g,s=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||se(e,"ready");try{n.onreadystatechange=s}catch(e){}}}function qt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function tn(e){return e.g?e.g.readyState:0}function nn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function sn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function rn(e){this.Aa=0,this.i=[],this.j=new Ae,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=sn("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=sn("baseRetryDelayMs",5e3,e),this.cb=sn("retryDelaySeedMs",1e4,e),this.Wa=sn("forwardChannelMaxRetries",2,e),this.wa=sn("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Qe(e&&e.concurrentRequestLimit),this.Da=new Ct,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(e){if(cn(e),3==e.G){var t=e.U++,n=ot(e.I);if(ht(n,"SID",e.K),ht(n,"RID",t),ht(n,"TYPE","terminate"),un(e,n),(t=new Ne(e,e.j,t)).L=2,t.v=ut(ot(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=Sn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Be(t)}xn(e)}function an(e){e.g&&(fn(e),e.g.cancel(),e.g=null)}function cn(e){an(e),e.u&&(i.clearTimeout(e.u),e.u=null),vn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function ln(e){if(!Ye(e.h)&&!e.s){e.s=!0;var t=e.Ga;I||R(),C||(I(),C=!0),A.add(t,e),e.B=0}}function hn(e,t){var n;n=t?t.l:e.U++;const s=ot(e.I);ht(s,"SID",e.K),ht(s,"RID",n),ht(s,"AID",e.T),un(e,s),e.m&&e.o&&jt(s,e.m,e.o),n=new Ne(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=dn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),Fe(n,s,t)}function un(e,t){e.H&&b(e.H,(function(e,n){ht(t,n,e)})),e.l&&st({},(function(e,n){ht(t,n,e)}))}function dn(e,t,n){n=Math.min(e.i.length,n);var s=e.l?l(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let r=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),r=!1;else try{At(a,e,"req"+n+"_")}catch(e){s&&s(a)}}if(r){s=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,s}function pn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;I||R(),C||(I(),C=!0),A.add(t,e),e.v=0}}function gn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ce(l(e.Fa,e),yn(e,e.v)),e.v++,0))}function fn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function mn(e){e.g=new Ne(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ot(e.qa);ht(t,"RID","rpc"),ht(t,"SID",e.K),ht(t,"AID",e.T),ht(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ht(t,"TO",e.ja),ht(t,"TYPE","xmlhttp"),un(e,t),e.m&&e.o&&jt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ut(ot(t)),n.m=null,n.P=!0,$e(n,e)}function vn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function bn(e,t){var n=null;if(e.g==t){vn(e),fn(e),e.g=null;var s=2}else{if(!Ze(e.h,t))return;n=t.D,tt(e.h,t),s=1}if(0!=e.G)if(t.o)if(1==s){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;se(s=_e(),new Ie(s,n)),ln(e)}else pn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==s&&function(e,t){return!(Xe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ce(l(e.Ga,e,t),yn(e,e.B)),e.B++,0)))}(e,t)||2==s&&gn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:wn(e,5);break;case 4:wn(e,10);break;case 3:wn(e,6);break;default:wn(e,2)}}function yn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function wn(e,t){if(e.j.info("Error code "+t),2==t){var n=l(e.fb,e),s=e.Xa;const t=!s;s=new rt(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||at(s,"https"),ut(s),t?function(e,t){const n=new Ae;if(i.Image){const s=new Image;s.onload=h(It,n,"TestLoadImage: loaded",!0,t,s),s.onerror=h(It,n,"TestLoadImage: error",!1,t,s),s.onabort=h(It,n,"TestLoadImage: abort",!1,t,s),s.ontimeout=h(It,n,"TestLoadImage: timeout",!1,t,s),i.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=e}else t(!1)}(s.toString(),n):function(e,t){new Ae;const n=new AbortController,s=setTimeout((()=>{n.abort(),It(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(s),e.ok?It(0,0,!0,t):It(0,0,!1,t)})).catch((()=>{clearTimeout(s),It(0,0,!1,t)}))}(s.toString(),n)}else Te(2);e.G=0,e.l&&e.l.sa(t),xn(e),cn(e)}function xn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function _n(e,t,n){var s=n instanceof rt?ot(n):new rt(n);if(""!=s.g)t&&(s.g=t+"."+s.g),ct(s,s.s);else{var r=i.location;s=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var o=new rt(null);s&&at(o,s),t&&(o.g=t),r&&ct(o,r),n&&(o.l=n),s=o}return n=e.D,t=e.ya,n&&t&&ht(s,n,t),ht(s,"VER",e.la),un(e,s),s}function Sn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Mt(new Rt({eb:n})):new Mt(e.pa)).Ha(e.J),t}function En(){}function kn(){}function Tn(e,t){ne.call(this),this.g=new rn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!g(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!g(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new An(this)}function In(e){be.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Cn(){ye.call(this),this.status=1}function An(e){this.g=e}(e=Mt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Pe.g(),this.v=this.o?fe(this.o):fe(Pe),this.g.onreadystatechange=l(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void $t(this,e)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),r=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Ft,t,void 0))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){$t(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,se(this,"complete"),se(this,"abort"),Bt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Bt(this,!0)),Mt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?zt(this):this.bb())},e.bb=function(){zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<tn(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),de(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=rn.prototype).la=8,e.G=1,e.connect=function(e,t,n,s){Te(0),this.W=e,this.H=t||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.I=_n(this,null,this.W),ln(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Ne(this,this.j,e);let r=this.o;if(this.S&&(r?(r=y(r),x(r,this.S)):r=this.S),null!==this.m||this.O||(i.H=r,r=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if(4096<(t+=s)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=dn(this,i,t),ht(n=ot(this.I),"RID",e),ht(n,"CVER",22),this.D&&ht(n,"X-HTTP-Session-Id",this.D),un(this,n),r&&(this.O?t="headers="+encodeURIComponent(String(Nt(r)))+"&"+t:this.m&&jt(n,this.m,r)),et(this.h,i),this.Ua&&ht(n,"TYPE","init"),this.P?(ht(n,"$req",t),ht(n,"SID","null"),i.T=!0,Fe(i,n,null)):Fe(i,n,t),this.G=2}}else 3==this.G&&(e?hn(this,e):0==this.i.length||Ye(this.h)||hn(this))},e.Fa=function(){if(this.u=null,mn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ce(l(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Te(10),an(this),mn(this))},e.Za=function(){null!=this.C&&(this.C=null,an(this),gn(this),Te(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=En.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},kn.prototype.g=function(e,t){return new Tn(e,t)},u(Tn,ne),Tn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Tn.prototype.close=function(){on(this.g)},Tn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ue(e),e=n);t.i.push(new Je(t.Ya++,e)),3==t.G&&ln(t)},Tn.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,Tn.aa.N.call(this)},u(In,be),u(Cn,ye),u(An,En),An.prototype.ua=function(){se(this.g,"a")},An.prototype.ta=function(e){se(this.g,new In(e))},An.prototype.sa=function(e){se(this.g,new Cn)},An.prototype.ra=function(){se(this.g,"b")},kn.prototype.createWebChannel=kn.prototype.g,Tn.prototype.send=Tn.prototype.o,Tn.prototype.open=Tn.prototype.m,Tn.prototype.close=Tn.prototype.close,Xt=en.createWebChannelTransport=function(){return new kn},Yt=en.getStatEventTarget=function(){return _e()},Qt=en.Event=we,Jt=en.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Le.NO_ERROR=0,Le.TIMEOUT=8,Le.HTTP_ERROR=6,Wt=en.ErrorCode=Le,De.COMPLETE="complete",Gt=en.EventType=De,me.EventType=ve,ve.OPEN="a",ve.CLOSE="b",ve.ERROR="c",ve.MESSAGE="d",ne.prototype.listen=ne.prototype.K,Kt=en.WebChannel=me,en.FetchXmlHttpFactory=Rt,Mt.prototype.listenOnce=Mt.prototype.L,Mt.prototype.getLastError=Mt.prototype.Ka,Mt.prototype.getLastErrorCode=Mt.prototype.Ba,Mt.prototype.getStatus=Mt.prototype.Z,Mt.prototype.getResponseJson=Mt.prototype.Oa,Mt.prototype.getResponseText=Mt.prototype.oa,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Ha,Ht=en.XhrIo=Mt}).apply(void 0!==Zt?Zt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const tn="@firebase/firestore",nn="4.7.17";class sn{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}sn.UNAUTHENTICATED=new sn(null),sn.GOOGLE_CREDENTIALS=new sn("google-credentials-uid"),sn.FIRST_PARTY=new sn("first-party-uid"),sn.MOCK_USER=new sn("mock-user");let rn="11.9.0";const on=new Ee("@firebase/firestore");function an(){return on.logLevel}function cn(e,...t){if(on.logLevel<=ye.DEBUG){const n=t.map(un);on.debug(`Firestore (${rn}): ${e}`,...n)}}function ln(e,...t){if(on.logLevel<=ye.ERROR){const n=t.map(un);on.error(`Firestore (${rn}): ${e}`,...n)}}function hn(e,...t){if(on.logLevel<=ye.WARN){const n=t.map(un);on.warn(`Firestore (${rn}): ${e}`,...n)}}function un(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function dn(e,t,n){let s="Unexpected state";"string"==typeof t?s=t:n=t,pn(e,s,n)}function pn(e,t,n){let s=`FIRESTORE (${rn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{s+=" CONTEXT: "+JSON.stringify(n)}catch(e){s+=" CONTEXT: "+n}throw ln(s),new Error(s)}function gn(e,t,n,s){let i="Unexpected state";"string"==typeof n?i=n:s=n,e||pn(t,i,s)}function fn(e,t){return e}const mn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class vn extends se{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class bn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class yn{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class wn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(sn.UNAUTHENTICATED)))}shutdown(){}}class xn{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class _n{constructor(e){this.t=e,this.currentUser=sn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){gn(void 0===this.o,42304);let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new bn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new bn,e.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await s(this.currentUser)}))},o=e=>{cn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(cn("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new bn)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(cn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(gn("string"==typeof t.accessToken,31837,{l:t}),new yn(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return gn(null===e||"string"==typeof e,2055,{h:e}),new sn(e)}}class Sn{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=sn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class En{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Sn(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(sn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class kn{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Tn{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,kt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){gn(void 0===this.o,3512);const n=e=>{null!=e.error&&cn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,cn("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const s=e=>{cn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>s(e))),setTimeout((()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?s(e):cn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new kn(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(gn("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new kn(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function In(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}function Cn(){return new TextEncoder}class An{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=In(40);for(let s=0;s<n.length;++s)t.length<20&&n[s]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return t}}function Rn(e,t){return e<t?-1:e>t?1:0}function Pn(e,t){let n=0;for(;n<e.length&&n<t.length;){const s=e.codePointAt(n),i=t.codePointAt(n);if(s!==i){if(s<128&&i<128)return Rn(s,i);{const r=Cn(),o=Dn(r.encode(Ln(e,n)),r.encode(Ln(t,n)));return 0!==o?o:Rn(s,i)}}n+=s>65535?2:1}return Rn(e.length,t.length)}function Ln(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function Dn(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return Rn(e[n],t[n]);return Rn(e.length,t.length)}function On(e,t,n){return e.length===t.length&&e.every(((e,s)=>n(e,t[s])))}const Nn=-62135596800,jn=1e6;class Mn{static now(){return Mn.fromMillis(Date.now())}static fromDate(e){return Mn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*jn);return new Mn(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new vn(mn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new vn(mn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Nn)throw new vn(mn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new vn(mn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/jn}_compareTo(e){return this.seconds===e.seconds?Rn(this.nanoseconds,e.nanoseconds):Rn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Nn;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Un{static fromTimestamp(e){return new Un(e)}static min(){return new Un(new Mn(0,0))}static max(){return new Un(new Mn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Fn="__name__";class $n{constructor(e,t,n){void 0===t?t=0:t>e.length&&dn(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&dn(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===$n.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $n?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=$n.compareSegments(e.get(s),t.get(s));if(0!==n)return n}return Rn(e.length,t.length)}static compareSegments(e,t){const n=$n.isNumericId(e),s=$n.isNumericId(t);return n&&!s?-1:!n&&s?1:n&&s?$n.extractNumericId(e).compare($n.extractNumericId(t)):Pn(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vt.fromString(e.substring(4,e.length-2))}}class Vn extends $n{construct(e,t,n){return new Vn(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new vn(mn.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Vn(t)}static emptyPath(){return new Vn([])}}const zn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bn extends $n{construct(e,t,n){return new Bn(e,t,n)}static isValidIdentifier(e){return zn.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bn.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Fn}static keyField(){return new Bn([Fn])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(0===n.length)throw new vn(mn.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new vn(mn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new vn(mn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(r=!r,s++):"."!==t||r?(n+=t,s++):(i(),s++)}if(i(),r)throw new vn(mn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bn(t)}static emptyPath(){return new Bn([])}}class qn{constructor(e){this.path=e}static fromPath(e){return new qn(Vn.fromString(e))}static fromName(e){return new qn(Vn.fromString(e).popFirst(5))}static empty(){return new qn(Vn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Vn.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Vn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new qn(new Vn(e.slice()))}}function Hn(e){return new Kn(e.readTime,e.key,-1)}class Kn{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Kn(Un.min(),qn.empty(),-1)}static max(){return new Kn(Un.max(),qn.empty(),-1)}}function Gn(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=qn.comparator(e.documentKey,t.documentKey),0!==n?n:Rn(e.largestBatchId,t.largestBatchId))}class Wn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Jn(e){if(e.code!==mn.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;cn("LocalStore","Unexpectedly lost primary lease")}class Qn{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&dn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Qn(((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Qn?t:Qn.resolve(t)}catch(e){return Qn.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Qn.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Qn.reject(t)}static resolve(e){return new Qn(((t,n)=>{t(e)}))}static reject(e){return new Qn(((t,n)=>{n(e)}))}static waitFor(e){return new Qn(((t,n)=>{let s=0,i=0,r=!1;e.forEach((e=>{++s,e.next((()=>{++i,r&&i===s&&t()}),(e=>n(e)))})),r=!0,i===s&&t()}))}static or(e){let t=Qn.resolve(!1);for(const n of e)t=t.next((e=>e?Qn.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,s)=>{n.push(t.call(this,e,s))})),this.waitFor(n)}static mapArray(e,t){return new Qn(((n,s)=>{const i=e.length,r=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{r[c]=e,++o,o===i&&n(r)}),(e=>s(e)))}}))}static doWhile(e,t){return new Qn(((n,s)=>{const i=()=>{!0===e()?t().next((()=>{i()}),s):n()};i()}))}}function Yn(e){return"IndexedDbTransactionError"===e.name}class Xn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Xn.le=-1;function Zn(e){return null==e}function es(e){return 0===e&&1/e==-1/0}function ts(e,t){let n=t;const s=e.length;for(let t=0;t<s;t++){const s=e.charAt(t);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function ns(e){return e+""}const ss="owner",is="mutationQueues",rs="mutations",os="documentMutations",as="remoteDocumentGlobal",cs="targets",ls="targetDocuments",hs="targetGlobal",us="collectionParents",ds="clientMetadata",ps="bundles",gs="namedQueries";function fs(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ms(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function vs(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class bs{constructor(e,t){this.comparator=e,this.root=t||ws.EMPTY}insert(e,t){return new bs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ws.BLACK,null,null))}remove(e){return new bs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ws.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ys(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ys(this.root,e,this.comparator,!1)}getReverseIterator(){return new ys(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ys(this.root,e,this.comparator,!0)}}class ys{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ws{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=null!=n?n:ws.RED,this.left=null!=s?s:ws.EMPTY,this.right=null!=i?i:ws.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new ws(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ws.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return ws.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ws.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ws.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw dn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw dn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw dn(27949);return e+(this.isRed()?0:1)}}ws.EMPTY=null,ws.RED=!0,ws.BLACK=!1,ws.EMPTY=new class{constructor(){this.size=0}get key(){throw dn(57766)}get value(){throw dn(16141)}get color(){throw dn(16727)}get left(){throw dn(29726)}get right(){throw dn(36894)}copy(e,t,n,s,i){return this}insert(e,t,n){return new ws(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class xs{constructor(e){this.comparator=e,this.data=new bs(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new _s(this.data.getIterator())}getIteratorFrom(e){return new _s(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof xs))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new xs(this.comparator);return t.data=e,t}}class _s{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ss{constructor(e){this.fields=e,e.sort(Bn.comparator)}static empty(){return new Ss([])}unionWith(e){let t=new xs(Bn.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ss(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return On(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Es extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ks{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Es("Invalid base64 string: "+e):e}}(e);return new ks(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ks(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Rn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ks.EMPTY_BYTE_STRING=new ks("");const Ts=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Is(e){if(gn(!!e,39018),"string"==typeof e){let t=0;const n=Ts.exec(e);if(gn(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Cs(e.seconds),nanos:Cs(e.nanos)}}function Cs(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function As(e){return"string"==typeof e?ks.fromBase64String(e):ks.fromUint8Array(e)}const Rs="server_timestamp",Ps="__type__",Ls="__previous_value__",Ds="__local_write_time__";function Os(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[Ps])||void 0===n?void 0:n.stringValue)===Rs}function Ns(e){const t=e.mapValue.fields[Ls];return Os(t)?Ns(t):t}function js(e){const t=Is(e.mapValue.fields[Ds].timestampValue);return new Mn(t.seconds,t.nanos)}class Ms{constructor(e,t,n,s,i,r,o,a,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=l}}const Us="(default)";class Fs{constructor(e,t){this.projectId=e,this.database=t||Us}static empty(){return new Fs("","")}get isDefaultDatabase(){return this.database===Us}isEqual(e){return e instanceof Fs&&e.projectId===this.projectId&&e.database===this.database}}const $s="__type__",Vs="__max__",zs={fields:{__type__:{stringValue:Vs}}},Bs="__vector__",qs="value";function Hs(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Os(e)?4:ci(e)?9007199254740991:oi(e)?10:11:dn(28295,{value:e})}function Ks(e,t){if(e===t)return!0;const n=Hs(e);if(n!==Hs(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return js(e).isEqual(js(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Is(e.timestampValue),s=Is(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return As(e.bytesValue).isEqual(As(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Cs(e.geoPointValue.latitude)===Cs(t.geoPointValue.latitude)&&Cs(e.geoPointValue.longitude)===Cs(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Cs(e.integerValue)===Cs(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Cs(e.doubleValue),s=Cs(t.doubleValue);return n===s?es(n)===es(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return On(e.arrayValue.values||[],t.arrayValue.values||[],Ks);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(fs(n)!==fs(s))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===s[e]||!Ks(n[e],s[e])))return!1;return!0}(e,t);default:return dn(52216,{left:e})}}function Gs(e,t){return void 0!==(e.values||[]).find((e=>Ks(e,t)))}function Ws(e,t){if(e===t)return 0;const n=Hs(e),s=Hs(t);if(n!==s)return Rn(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Rn(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Cs(e.integerValue||e.doubleValue),s=Cs(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return Js(e.timestampValue,t.timestampValue);case 4:return Js(js(e),js(t));case 5:return Pn(e.stringValue,t.stringValue);case 6:return function(e,t){const n=As(e),s=As(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let e=0;e<n.length&&e<s.length;e++){const t=Rn(n[e],s[e]);if(0!==t)return t}return Rn(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Rn(Cs(e.latitude),Cs(t.latitude));return 0!==n?n:Rn(Cs(e.longitude),Cs(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Qs(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,s,i,r;const o=e.fields||{},a=t.fields||{},c=null===(n=o[qs])||void 0===n?void 0:n.arrayValue,l=null===(s=a[qs])||void 0===s?void 0:s.arrayValue,h=Rn((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(r=null==l?void 0:l.values)||void 0===r?void 0:r.length)||0);return 0!==h?h:Qs(c,l)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===zs&&t===zs)return 0;if(e===zs)return 1;if(t===zs)return-1;const n=e.fields||{},s=Object.keys(n),i=t.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let e=0;e<s.length&&e<r.length;++e){const t=Pn(s[e],r[e]);if(0!==t)return t;const o=Ws(n[s[e]],i[r[e]]);if(0!==o)return o}return Rn(s.length,r.length)}(e.mapValue,t.mapValue);default:throw dn(23264,{Pe:n})}}function Js(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Rn(e,t);const n=Is(e),s=Is(t),i=Rn(n.seconds,s.seconds);return 0!==i?i:Rn(n.nanos,s.nanos)}function Qs(e,t){const n=e.values||[],s=t.values||[];for(let e=0;e<n.length&&e<s.length;++e){const t=Ws(n[e],s[e]);if(t)return t}return Rn(n.length,s.length)}function Ys(e){return Xs(e)}function Xs(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Is(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return As(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return qn.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=Xs(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const i of t)s?s=!1:n+=",",n+=`${i}:${Xs(e.fields[i])}`;return n+"}"}(e.mapValue):dn(61005,{value:e})}function Zs(e){switch(Hs(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Ns(e);return t?16+Zs(t):16;case 5:return 2*e.stringValue.length;case 6:return As(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+Zs(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return ms(e.fields,((e,n)=>{t+=e.length+Zs(n)})),t}(e.mapValue);default:throw dn(13486,{value:e})}}function ei(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ti(e){return!!e&&"integerValue"in e}function ni(e){return!!e&&"arrayValue"in e}function si(e){return!!e&&"nullValue"in e}function ii(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ri(e){return!!e&&"mapValue"in e}function oi(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[$s])||void 0===n?void 0:n.stringValue)===Bs}function ai(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ms(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=ai(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ai(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ci(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Vs}class li{constructor(e){this.value=e}static empty(){return new li({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ri(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ai(t)}setAll(e){let t=Bn.emptyPath(),n={},s=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=i.popLast()}e?n[i.lastSegment()]=ai(e):s.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());ri(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ks(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];ri(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){ms(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new li(ai(this.value))}}function hi(e){const t=[];return ms(e.fields,((e,n)=>{const s=new Bn([e]);if(ri(n)){const e=hi(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)})),new Ss(t)}class ui{constructor(e,t,n,s,i,r,o){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=o}static newInvalidDocument(e){return new ui(e,0,Un.min(),Un.min(),Un.min(),li.empty(),0)}static newFoundDocument(e,t,n,s){return new ui(e,1,t,Un.min(),n,s,0)}static newNoDocument(e,t){return new ui(e,2,t,Un.min(),Un.min(),li.empty(),0)}static newUnknownDocument(e,t){return new ui(e,3,t,Un.min(),Un.min(),li.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Un.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=li.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=li.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Un.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ui&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ui(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class di{constructor(e,t){this.position=e,this.inclusive=t}}function pi(e,t,n){let s=0;for(let i=0;i<e.position.length;i++){const r=t[i],o=e.position[i];if(s=r.field.isKeyField()?qn.comparator(qn.fromName(o.referenceValue),n.key):Ws(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function gi(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ks(e.position[n],t.position[n]))return!1;return!0}class fi{constructor(e,t="asc"){this.field=e,this.dir=t}}function mi(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class vi{}class bi extends vi{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ki(e,t,n):"array-contains"===t?new Ai(e,n):"in"===t?new Ri(e,n):"not-in"===t?new Pi(e,n):"array-contains-any"===t?new Li(e,n):new bi(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ti(e,n):new Ii(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Ws(t,this.value)):null!==t&&Hs(this.value)===Hs(t)&&this.matchesComparison(Ws(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return dn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class yi extends vi{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new yi(e,t)}matches(e){return wi(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function wi(e){return"and"===e.op}function xi(e){return function(e){for(const t of e.filters)if(t instanceof yi)return!1;return!0}(e)&&wi(e)}function _i(e){if(e instanceof bi)return e.field.canonicalString()+e.op.toString()+Ys(e.value);if(xi(e))return e.filters.map((e=>_i(e))).join(",");{const t=e.filters.map((e=>_i(e))).join(",");return`${e.op}(${t})`}}function Si(e,t){return e instanceof bi?function(e,t){return t instanceof bi&&e.op===t.op&&e.field.isEqual(t.field)&&Ks(e.value,t.value)}(e,t):e instanceof yi?function(e,t){return t instanceof yi&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,s)=>e&&Si(n,t.filters[s])),!0)}(e,t):void dn(19439)}function Ei(e){return e instanceof bi?function(e){return`${e.field.canonicalString()} ${e.op} ${Ys(e.value)}`}(e):e instanceof yi?function(e){return e.op.toString()+" {"+e.getFilters().map(Ei).join(" ,")+"}"}(e):"Filter"}class ki extends bi{constructor(e,t,n){super(e,t,n),this.key=qn.fromName(n.referenceValue)}matches(e){const t=qn.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ti extends bi{constructor(e,t){super(e,"in",t),this.keys=Ci(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ii extends bi{constructor(e,t){super(e,"not-in",t),this.keys=Ci(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ci(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>qn.fromName(e.referenceValue)))}class Ai extends bi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ni(t)&&Gs(t.arrayValue,this.value)}}class Ri extends bi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Gs(this.value.arrayValue,t)}}class Pi extends bi{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Gs(this.value.arrayValue,t)}}class Li extends bi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ni(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Gs(this.value.arrayValue,e)))}}class Di{constructor(e,t=null,n=[],s=[],i=null,r=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.Ie=null}}function Oi(e,t=null,n=[],s=[],i=null,r=null,o=null){return new Di(e,t,n,s,i,r,o)}function Ni(e){const t=fn(e);if(null===t.Ie){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>_i(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Zn(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Ys(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Ys(e))).join(",")),t.Ie=e}return t.Ie}function ji(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!mi(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Si(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!gi(e.startAt,t.startAt)&&gi(e.endAt,t.endAt)}function Mi(e){return qn.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Ui{constructor(e,t=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function Fi(e){return new Ui(e)}function $i(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Vi(e){return null!==e.collectionGroup}function zi(e){const t=fn(e);if(null===t.Ee){t.Ee=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ee.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",s=function(e){let t=new xs(Bn.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);s.forEach((s=>{e.has(s.canonicalString())||s.isKeyField()||t.Ee.push(new fi(s,n))})),e.has(Bn.keyField().canonicalString())||t.Ee.push(new fi(Bn.keyField(),n))}return t.Ee}function Bi(e){const t=fn(e);return t.de||(t.de=function(e,t){if("F"===e.limitType)return Oi(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new fi(e.field,t)}));const n=e.endAt?new di(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new di(e.startAt.position,e.startAt.inclusive):null;return Oi(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}}(t,zi(e))),t.de}function qi(e,t){const n=e.filters.concat([t]);return new Ui(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Hi(e,t,n){return new Ui(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Ki(e,t){return ji(Bi(e),Bi(t))&&e.limitType===t.limitType}function Gi(e){return`${Ni(Bi(e))}|lt:${e.limitType}`}function Wi(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Ei(e))).join(", ")}]`),Zn(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Ys(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Ys(e))).join(",")),`Target(${t})`}(Bi(e))}; limitType=${e.limitType})`}function Ji(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):qn.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of zi(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const s=pi(e,t,n);return e.inclusive?s<=0:s<0}(e.startAt,zi(e),t)||e.endAt&&!function(e,t,n){const s=pi(e,t,n);return e.inclusive?s>=0:s>0}(e.endAt,zi(e),t))}(e,t)}function Qi(e){return(t,n)=>{let s=!1;for(const i of zi(e)){const e=Yi(i,t,n);if(0!==e)return e;s=s||i.field.isKeyField()}return 0}}function Yi(e,t,n){const s=e.field.isKeyField()?qn.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),i=n.data.field(e);return null!==s&&null!==i?Ws(s,i):dn(42886)}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return dn(19790,{direction:e.dir})}}class Xi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,s]of n)if(this.equalsFn(t,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],e))return void(s[n]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ms(this.inner,((t,n)=>{for(const[t,s]of n)e(t,s)}))}isEmpty(){return vs(this.inner)}size(){return this.innerSize}}const Zi=new bs(qn.comparator);function er(){return Zi}const tr=new bs(qn.comparator);function nr(...e){let t=tr;for(const n of e)t=t.insert(n.key,n);return t}function sr(e){let t=tr;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function ir(){return or()}function rr(){return or()}function or(){return new Xi((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ar=new bs(qn.comparator),cr=new xs(qn.comparator);function lr(...e){let t=cr;for(const n of e)t=t.add(n);return t}const hr=new xs(Rn);function ur(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:es(t)?"-0":t}}function dr(e){return{integerValue:""+e}}function pr(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!es(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?dr(t):ur(e,t)}class gr{constructor(){this._=void 0}}function fr(e,t,n){return e instanceof br?function(e,t){const n={fields:{[Ps]:{stringValue:Rs},[Ds]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Os(t)&&(t=Ns(t)),t&&(n.fields[Ls]=t),{mapValue:n}}(n,t):e instanceof yr?wr(e,t):e instanceof xr?_r(e,t):function(e,t){const n=vr(e,t),s=Er(n)+Er(e.Re);return ti(n)&&ti(e.Re)?dr(s):ur(e.serializer,s)}(e,t)}function mr(e,t,n){return e instanceof yr?wr(e,t):e instanceof xr?_r(e,t):n}function vr(e,t){return e instanceof Sr?function(e){return ti(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class br extends gr{}class yr extends gr{constructor(e){super(),this.elements=e}}function wr(e,t){const n=kr(t);for(const t of e.elements)n.some((e=>Ks(e,t)))||n.push(t);return{arrayValue:{values:n}}}class xr extends gr{constructor(e){super(),this.elements=e}}function _r(e,t){let n=kr(t);for(const t of e.elements)n=n.filter((e=>!Ks(e,t)));return{arrayValue:{values:n}}}class Sr extends gr{constructor(e,t){super(),this.serializer=e,this.Re=t}}function Er(e){return Cs(e.integerValue||e.doubleValue)}function kr(e){return ni(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Tr{constructor(e,t){this.field=e,this.transform=t}}class Ir{constructor(e,t){this.version=e,this.transformResults=t}}class Cr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Cr}static exists(e){return new Cr(void 0,e)}static updateTime(e){return new Cr(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ar(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Rr{}function Pr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Vr(e.key,Cr.none()):new jr(e.key,e.data,Cr.none());{const n=e.data,s=li.empty();let i=new xs(Bn.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),i=i.add(e)}return new Mr(e.key,s,new Ss(i.toArray()),Cr.none())}}function Lr(e,t,n){e instanceof jr?function(e,t,n){const s=e.value.clone(),i=Fr(e.fieldTransforms,t,n.transformResults);s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Mr?function(e,t,n){if(!Ar(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=Fr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Ur(e)),i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Dr(e,t,n,s){return e instanceof jr?function(e,t,n,s){if(!Ar(e.precondition,t))return n;const i=e.value.clone(),r=$r(e.fieldTransforms,s,t);return i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,s):e instanceof Mr?function(e,t,n,s){if(!Ar(e.precondition,t))return n;const i=$r(e.fieldTransforms,s,t),r=t.data;return r.setAll(Ur(e)),r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,s):function(e,t,n){return Ar(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Or(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),i=vr(s.transform,e||null);null!=i&&(null===n&&(n=li.empty()),n.set(s.field,i))}return n||null}function Nr(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&On(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof yr&&t instanceof yr||e instanceof xr&&t instanceof xr?On(e.elements,t.elements,Ks):e instanceof Sr&&t instanceof Sr?Ks(e.Re,t.Re):e instanceof br&&t instanceof br}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class jr extends Rr{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Mr extends Rr{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ur(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}})),t}function Fr(e,t,n){const s=new Map;gn(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let i=0;i<n.length;i++){const r=e[i],o=r.transform,a=t.data.field(r.field);s.set(r.field,mr(o,a,n[i]))}return s}function $r(e,t,n){const s=new Map;for(const i of e){const e=i.transform,r=n.data.field(i.field);s.set(i.field,fr(e,r,t))}return s}class Vr extends Rr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zr extends Rr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Br{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const s=this.mutations[t];s.key.isEqual(e.key)&&Lr(s,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Dr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Dr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=rr();return this.mutations.forEach((s=>{const i=e.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=t.has(s.key)?null:o;const a=Pr(r,o);null!==a&&n.set(s.key,a),r.isValidDocument()||r.convertToNoDocument(Un.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),lr())}isEqual(e){return this.batchId===e.batchId&&On(this.mutations,e.mutations,((e,t)=>Nr(e,t)))&&On(this.baseMutations,e.baseMutations,((e,t)=>Nr(e,t)))}}class qr{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){gn(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let s=ar;const i=e.mutations;for(let e=0;e<i.length;e++)s=s.insert(i[e].key,n[e].version);return new qr(e,t,n,s)}}class Hr{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Kr{constructor(e,t){this.count=e,this.unchangedNames=t}}var Gr,Wr;function Jr(e){if(void 0===e)return ln("GRPC error has no .code"),mn.UNKNOWN;switch(e){case Gr.OK:return mn.OK;case Gr.CANCELLED:return mn.CANCELLED;case Gr.UNKNOWN:return mn.UNKNOWN;case Gr.DEADLINE_EXCEEDED:return mn.DEADLINE_EXCEEDED;case Gr.RESOURCE_EXHAUSTED:return mn.RESOURCE_EXHAUSTED;case Gr.INTERNAL:return mn.INTERNAL;case Gr.UNAVAILABLE:return mn.UNAVAILABLE;case Gr.UNAUTHENTICATED:return mn.UNAUTHENTICATED;case Gr.INVALID_ARGUMENT:return mn.INVALID_ARGUMENT;case Gr.NOT_FOUND:return mn.NOT_FOUND;case Gr.ALREADY_EXISTS:return mn.ALREADY_EXISTS;case Gr.PERMISSION_DENIED:return mn.PERMISSION_DENIED;case Gr.FAILED_PRECONDITION:return mn.FAILED_PRECONDITION;case Gr.ABORTED:return mn.ABORTED;case Gr.OUT_OF_RANGE:return mn.OUT_OF_RANGE;case Gr.UNIMPLEMENTED:return mn.UNIMPLEMENTED;case Gr.DATA_LOSS:return mn.DATA_LOSS;default:return dn(39323,{code:e})}}(Wr=Gr||(Gr={}))[Wr.OK=0]="OK",Wr[Wr.CANCELLED=1]="CANCELLED",Wr[Wr.UNKNOWN=2]="UNKNOWN",Wr[Wr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wr[Wr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wr[Wr.NOT_FOUND=5]="NOT_FOUND",Wr[Wr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wr[Wr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wr[Wr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wr[Wr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wr[Wr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wr[Wr.ABORTED=10]="ABORTED",Wr[Wr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wr[Wr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wr[Wr.INTERNAL=13]="INTERNAL",Wr[Wr.UNAVAILABLE=14]="UNAVAILABLE",Wr[Wr.DATA_LOSS=15]="DATA_LOSS";const Qr=new Vt([4294967295,4294967295],0);function Yr(e){const t=Cn().encode(e),n=new zt;return n.update(t),new Uint8Array(n.digest())}function Xr(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),i=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new Vt([n,s],0),new Vt([i,r],0)]}class Zr{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new eo(`Invalid padding: ${t}`);if(n<0)throw new eo(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new eo(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new eo(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Vt.fromNumber(this.pe)}we(e,t,n){let s=e.add(t.multiply(Vt.fromNumber(n)));return 1===s.compare(Qr)&&(s=new Vt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;const t=Yr(e),[n,s]=Xr(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,s,e);if(!this.be(t))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),r=new Zr(i,s,t);return n.forEach((e=>r.insert(e))),r}insert(e){if(0===this.pe)return;const t=Yr(e),[n,s]=Xr(t);for(let e=0;e<this.hashCount;e++){const t=this.we(n,s,e);this.Se(t)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class eo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class to{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,no.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new to(Un.min(),s,new bs(Rn),er(),lr())}}class no{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new no(n,t,lr(),lr(),lr())}}class so{constructor(e,t,n,s){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=s}}class io{constructor(e,t){this.targetId=e,this.Ce=t}}class ro{constructor(e,t,n=ks.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class oo{constructor(){this.Fe=0,this.Me=lo(),this.xe=ks.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=lr(),t=lr(),n=lr();return this.Me.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:dn(38017,{changeType:i})}})),new no(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=lo()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,gn(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class ao{constructor(e){this.ze=e,this.je=new Map,this.He=er(),this.Je=co(),this.Ye=co(),this.Ze=new bs(Rn)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,(t=>{const n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:dn(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach(((e,n)=>{this.it(n)&&t(n)}))}ot(e){const t=e.targetId,n=e.Ce.count,s=this._t(t);if(s){const i=s.target;if(Mi(i))if(0===n){const e=new qn(i.path);this.tt(t,e,ui.newNoDocument(e,Un.min()))}else gn(1===n,20013,{expectedCount:n});else{const s=this.ut(t);if(s!==n){const n=this.ct(e),i=n?this.lt(n,e,s):1;if(0!==i){this.st(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let r,o;try{r=As(n).toUint8Array()}catch(e){if(e instanceof Es)return hn("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Zr(r,s,i)}catch(e){return hn(e instanceof eo?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.pe?null:o}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){const n=this.ze.getRemoteKeysForTarget(t);let s=0;return n.forEach((n=>{const i=this.ze.Pt(),r=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(r)||(this.tt(t,n,null),s++)})),s}It(e){const t=new Map;this.je.forEach(((n,s)=>{const i=this._t(s);if(i){if(n.current&&Mi(i.target)){const t=new qn(i.target.path);this.Et(t).has(s)||this.dt(s,t)||this.tt(s,t,ui.newNoDocument(t,e))}n.Le&&(t.set(s,n.qe()),n.Qe())}}));let n=lr();this.Ye.forEach(((e,t)=>{let s=!0;t.forEachWhile((e=>{const t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)})),s&&(n=n.add(e))})),this.He.forEach(((t,n)=>n.setReadTime(e)));const s=new to(e,t,this.Ze,this.He,n);return this.He=er(),this.Je=co(),this.Ye=co(),this.Ze=new bs(Rn),s}et(e,t){if(!this.it(e))return;const n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;const s=this.rt(e);this.dt(e,t)?s.$e(t,1):s.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new oo,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new xs(Rn),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new xs(Rn),this.Je=this.Je.insert(e,t)),t}it(e){const t=null!==this._t(e);return t||cn("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new oo),this.ze.getRemoteKeysForTarget(e).forEach((t=>{this.tt(e,t,null)}))}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function co(){return new bs(qn.comparator)}function lo(){return new bs(qn.comparator)}const ho={asc:"ASCENDING",desc:"DESCENDING"},uo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},po={and:"AND",or:"OR"};class go{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function fo(e,t){return e.useProto3Json||Zn(t)?t:{value:t}}function mo(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function vo(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function bo(e,t){return mo(e,t.toTimestamp())}function yo(e){return gn(!!e,49232),Un.fromTimestamp(function(e){const t=Is(e);return new Mn(t.seconds,t.nanos)}(e))}function wo(e,t){return xo(e,t).canonicalString()}function xo(e,t){const n=function(e){return new Vn(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function _o(e){const t=Vn.fromString(e);return gn($o(t),10190,{key:t.toString()}),t}function So(e,t){return wo(e.databaseId,t.path)}function Eo(e,t){const n=_o(t);if(n.get(1)!==e.databaseId.projectId)throw new vn(mn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new vn(mn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new qn(Io(n))}function ko(e,t){return wo(e.databaseId,t)}function To(e){return new Vn(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Io(e){return gn(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Co(e,t,n){return{name:So(e,t),fields:n.value.mapValue.fields}}function Ao(e,t){return{documents:[ko(e,t.path)]}}function Ro(e,t){const n={structuredQuery:{}},s=t.path;let i;null!==t.collectionGroup?(i=s,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=ko(e,i);const r=function(e){if(0!==e.length)return Uo(yi.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:jo(e.field),direction:Do(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=fo(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{gt:n,parent:i}}function Po(e){let t=function(e){const t=_o(e);return 4===t.length?Vn.emptyPath():Io(t)}(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){gn(1===s,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=Lo(e);return t instanceof yi&&xi(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new fi(Mo(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Zn(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new di(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new di(n,t)}(n.endAt)),function(e,t,n,s,i,r,o,a){return new Ui(e,t,n,s,i,r,o,a)}(t,i,o,r,a,"F",c,l)}function Lo(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Mo(e.unaryFilter.field);return bi.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Mo(e.unaryFilter.field);return bi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Mo(e.unaryFilter.field);return bi.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Mo(e.unaryFilter.field);return bi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return dn(61313);default:return dn(60726)}}(e):void 0!==e.fieldFilter?function(e){return bi.create(Mo(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return dn(58110);default:return dn(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return yi.create(e.compositeFilter.filters.map((e=>Lo(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return dn(1026)}}(e.compositeFilter.op))}(e):dn(30097,{filter:e})}function Do(e){return ho[e]}function Oo(e){return uo[e]}function No(e){return po[e]}function jo(e){return{fieldPath:e.canonicalString()}}function Mo(e){return Bn.fromServerFormat(e.fieldPath)}function Uo(e){return e instanceof bi?function(e){if("=="===e.op){if(ii(e.value))return{unaryFilter:{field:jo(e.field),op:"IS_NAN"}};if(si(e.value))return{unaryFilter:{field:jo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ii(e.value))return{unaryFilter:{field:jo(e.field),op:"IS_NOT_NAN"}};if(si(e.value))return{unaryFilter:{field:jo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jo(e.field),op:Oo(e.op),value:e.value}}}(e):e instanceof yi?function(e){const t=e.getFilters().map((e=>Uo(e)));return 1===t.length?t[0]:{compositeFilter:{op:No(e.op),filters:t}}}(e):dn(54877,{filter:e})}function Fo(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function $o(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Vo{constructor(e,t,n,s,i=Un.min(),r=Un.min(),o=ks.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Vo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Vo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Vo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Vo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class zo{constructor(e){this.wt=e}}function Bo(e){const t=Po({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Hi(t,t.limit,"L"):t}class qo{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(Cs(e.integerValue));else if("doubleValue"in e){const n=Cs(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),es(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=Is(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(As(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?ci(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):oi(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):dn(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){const n=e.fields||{};this.Mt(t,55);for(const e of Object.keys(n))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,s;const i=e.fields||{};this.Mt(t,53);const r=qs,o=(null===(s=null===(n=i[r].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.length)||0;this.Mt(t,15),t.xt(Cs(o)),this.Nt(r,t),this.Ct(i[r],t)}$t(e,t){const n=e.values||[];this.Mt(t,50);for(const e of n)this.Ct(e,t)}kt(e,t){this.Mt(t,37),qn.fromName(e).path.forEach((e=>{this.Mt(t,60),this.Kt(e,t)}))}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}qo.Wt=new qo;class Ho{constructor(){this.Cn=new Ko}addToCollectionParentIndex(e,t){return this.Cn.add(t),Qn.resolve()}getCollectionParents(e,t){return Qn.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Qn.resolve()}deleteFieldIndex(e,t){return Qn.resolve()}deleteAllFieldIndexes(e){return Qn.resolve()}createTargetIndexes(e,t){return Qn.resolve()}getDocumentsMatchingTarget(e,t){return Qn.resolve(null)}getIndexType(e,t){return Qn.resolve(0)}getFieldIndexes(e,t){return Qn.resolve([])}getNextCollectionGroupToUpdate(e){return Qn.resolve(null)}getMinOffset(e,t){return Qn.resolve(Kn.min())}getMinOffsetFromCollectionGroup(e,t){return Qn.resolve(Kn.min())}updateCollectionGroup(e,t,n){return Qn.resolve()}updateIndexEntries(e,t){return Qn.resolve()}}class Ko{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new xs(Vn.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new xs(Vn.comparator)).toArray()}}new Uint8Array(0);const Go={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Wo=41943040;class Jo{static withCacheSize(e){return new Jo(e,Jo.DEFAULT_COLLECTION_PERCENTILE,Jo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Jo.DEFAULT_COLLECTION_PERCENTILE=10,Jo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Jo.DEFAULT=new Jo(Wo,Jo.DEFAULT_COLLECTION_PERCENTILE,Jo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Jo.DISABLED=new Jo(-1,0,0);class Qo{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new Qo(0)}static lr(){return new Qo(-1)}}const Yo="LruGarbageCollector";function Xo([e,t],[n,s]){const i=Rn(e,n);return 0===i?Rn(t,s):i}class Zo{constructor(e){this.Er=e,this.buffer=new xs(Xo),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Xo(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ea{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(e){cn(Yo,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Yn(e)?cn(Yo,"Ignoring IndexedDB error during garbage collection: ",e):await Jn(e)}await this.mr(3e5)}))}}class ta{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Qn.resolve(Xn.le);const n=new Zo(t);return this.gr.forEachTarget(e,(e=>n.Rr(e.sequenceNumber))).next((()=>this.gr.yr(e,(e=>n.Rr(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.gr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(cn("LruGarbageCollector","Garbage collection skipped; disabled"),Qn.resolve(Go)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(cn("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Go):this.wr(e,t)))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let n,s,i,r,o,a,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(cn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),s=this.params.maximumSequenceNumbersToCollect):s=t,r=Date.now(),this.nthSequenceNumber(e,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),an()<=ye.DEBUG&&cn("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-l}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-l}ms`),Qn.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e}))))}}class na{constructor(){this.changes=new Xi((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ui.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Qn.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sa{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ia{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(n=s,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Dr(n.mutation,e,Ss.empty(),Mn.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,lr()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=lr()){const s=ir();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,n).next((e=>{let t=nr();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=ir();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,lr())))}populateOverlays(e,t,n){const s=[];return n.forEach((e=>{t.has(e)||s.push(e)})),this.documentOverlayCache.getOverlays(e,s).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,s){let i=er();const r=or(),o=or();return t.forEach(((e,t)=>{const o=n.get(t.key);s.has(t.key)&&(void 0===o||o.mutation instanceof Mr)?i=i.insert(t.key,t):void 0!==o?(r.set(t.key,o.mutation.getFieldMask()),Dr(o.mutation,t,o.mutation.getFieldMask(),Mn.now())):r.set(t.key,Ss.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>r.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new sa(t,null!==(n=r.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=or();let s=new bs(((e,t)=>e-t)),i=lr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const r=t.get(e);if(null===r)return;let o=n.get(e)||Ss.empty();o=i.applyToLocalView(r,o),n.set(e,o);const a=(s.get(i.batchId)||lr()).add(e);s=s.insert(i.batchId,a)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),a=s.key,c=s.value,l=rr();c.forEach((e=>{if(!i.has(e)){const s=Pr(t.get(e),n.get(e));null!==s&&l.set(e,s),i=i.add(e)}})),r.push(this.documentOverlayCache.saveOverlays(e,a,l))}return Qn.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,s){return function(e){return qn.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Vi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):Qn.resolve(ir());let o=-1,a=i;return r.next((t=>Qn.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Qn.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,lr()))).next((e=>({batchId:o,changes:sr(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new qn(t)).next((e=>{let t=nr();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let r=nr();return this.indexManager.getCollectionParents(e,i).next((o=>Qn.forEach(o,(o=>{const a=function(e,t){return new Ui(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,s).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s)))).next((e=>{i.forEach(((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,ui.newInvalidDocument(s)))}));let n=nr();return e.forEach(((e,s)=>{const r=i.get(e);void 0!==r&&Dr(r.mutation,s,Ss.empty(),Mn.now()),Ji(t,s)&&(n=n.insert(e,s))})),n}))}}class ra{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return Qn.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:yo(e.createTime)}}(t)),Qn.resolve()}getNamedQuery(e,t){return Qn.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(e){return{name:e.name,query:Bo(e.bundledQuery),readTime:yo(e.readTime)}}(t)),Qn.resolve()}}class oa{constructor(){this.overlays=new bs(qn.comparator),this.Qr=new Map}getOverlay(e,t){return Qn.resolve(this.overlays.get(t))}getOverlays(e,t){const n=ir();return Qn.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,s)=>{this.St(e,t,s)})),Qn.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Qr.get(n);return void 0!==s&&(s.forEach((e=>this.overlays=this.overlays.remove(e))),this.Qr.delete(n)),Qn.resolve()}getOverlaysForCollection(e,t,n){const s=ir(),i=t.length+1,r=new qn(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===i&&e.largestBatchId>n&&s.set(e.getKey(),e)}return Qn.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new bs(((e,t)=>e-t));const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=ir(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=ir(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=s)););return Qn.resolve(o)}St(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.Qr.get(s.largestBatchId).delete(n.key);this.Qr.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Hr(t,n));let i=this.Qr.get(t);void 0===i&&(i=lr(),this.Qr.set(t,i)),this.Qr.set(t,i.add(n.key))}}class aa{constructor(){this.sessionToken=ks.EMPTY_BYTE_STRING}getSessionToken(e){return Qn.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Qn.resolve()}}class ca{constructor(){this.$r=new xs(la.Ur),this.Kr=new xs(la.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const n=new la(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.zr(new la(e,t))}jr(e,t){e.forEach((e=>this.removeReference(e,t)))}Hr(e){const t=new qn(new Vn([])),n=new la(t,e),s=new la(t,e+1),i=[];return this.Kr.forEachInRange([n,s],(e=>{this.zr(e),i.push(e.key)})),i}Jr(){this.$r.forEach((e=>this.zr(e)))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new qn(new Vn([])),n=new la(t,e),s=new la(t,e+1);let i=lr();return this.Kr.forEachInRange([n,s],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new la(e,0),n=this.$r.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class la{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return qn.comparator(e.key,t.key)||Rn(e.Zr,t.Zr)}static Wr(e,t){return Rn(e.Zr,t.Zr)||qn.comparator(e.key,t.key)}}class ha{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new xs(la.Ur)}checkEmpty(e){return Qn.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Br(i,t,n,s);this.mutationQueue.push(r);for(const t of s)this.Xr=this.Xr.add(new la(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Qn.resolve(r)}lookupMutationBatch(e,t){return Qn.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.ti(n),i=s<0?0:s;return Qn.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Qn.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(e){return Qn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new la(t,0),s=new la(t,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([n,s],(e=>{const t=this.ei(e.Zr);i.push(t)})),Qn.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new xs(Rn);return t.forEach((e=>{const t=new la(e,0),s=new la(e,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([t,s],(e=>{n=n.add(e.Zr)}))})),Qn.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;qn.isDocumentKey(i)||(i=i.child(""));const r=new la(new qn(i),0);let o=new xs(Rn);return this.Xr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(o=o.add(e.Zr)),!0)}),r),Qn.resolve(this.ni(o))}ni(e){const t=[];return e.forEach((e=>{const n=this.ei(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){gn(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return Qn.forEach(t.mutations,(s=>{const i=new la(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Xr=n}))}sr(e){}containsKey(e,t){const n=new la(t,0),s=this.Xr.firstAfterOrEqual(n);return Qn.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,Qn.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ua{constructor(e){this.ii=e,this.docs=new bs(qn.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,r=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Qn.resolve(n?n.document.mutableCopy():ui.newInvalidDocument(t))}getEntries(e,t){let n=er();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ui.newInvalidDocument(e))})),Qn.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=er();const r=t.path,o=new qn(r.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||Gn(Hn(o),n)<=0||(s.has(o.key)||Ji(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Qn.resolve(i)}getAllFromCollectionGroup(e,t,n,s){dn(9500)}si(e,t){return Qn.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new da(this)}getSize(e){return Qn.resolve(this.size)}}class da extends na{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?t.push(this.Br.addEntry(e,s)):this.Br.removeEntry(n)})),Qn.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}class pa{constructor(e){this.persistence=e,this.oi=new Xi((e=>Ni(e)),ji),this.lastRemoteSnapshotVersion=Un.min(),this.highestTargetId=0,this._i=0,this.ai=new ca,this.targetCount=0,this.ui=Qo.cr()}forEachTarget(e,t){return this.oi.forEach(((e,n)=>t(n))),Qn.resolve()}getLastRemoteSnapshotVersion(e){return Qn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Qn.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),Qn.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),Qn.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new Qo(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,Qn.resolve()}updateTargetData(e,t){return this.Tr(t),Qn.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,Qn.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.oi.forEach(((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.oi.delete(r),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),s++)})),Qn.waitFor(i).next((()=>s))}getTargetCount(e){return Qn.resolve(this.targetCount)}getTargetData(e,t){const n=this.oi.get(t)||null;return Qn.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),Qn.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((t=>{i.push(s.markPotentiallyOrphaned(e,t))})),Qn.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),Qn.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ai.Yr(t);return Qn.resolve(n)}containsKey(e,t){return Qn.resolve(this.ai.containsKey(t))}}class ga{constructor(e,t){this.ci={},this.overlays={},this.li=new Xn(0),this.hi=!1,this.hi=!0,this.Pi=new aa,this.referenceDelegate=e(this),this.Ti=new pa(this),this.indexManager=new Ho,this.remoteDocumentCache=function(e){return new ua(e)}((e=>this.referenceDelegate.Ii(e))),this.serializer=new zo(t),this.Ei=new ra(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oa,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new ha(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){cn("MemoryPersistence","Starting transaction:",e);const s=new fa(this.li.next());return this.referenceDelegate.di(),n(s).next((e=>this.referenceDelegate.Ai(s).next((()=>e)))).toPromise().then((e=>(s.raiseOnCommittedEvent(),e)))}Ri(e,t){return Qn.or(Object.values(this.ci).map((n=>()=>n.containsKey(e,t))))}}class fa extends Wn{constructor(e){super(),this.currentSequenceNumber=e}}class ma{constructor(e){this.persistence=e,this.Vi=new ca,this.mi=null}static fi(e){return new ma(e)}get gi(){if(this.mi)return this.mi;throw dn(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),Qn.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),Qn.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),Qn.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach((e=>this.gi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.gi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Qn.forEach(this.gi,(n=>{const s=qn.fromPath(n);return this.pi(e,s).next((e=>{e||t.removeEntry(s,Un.min())}))})).next((()=>(this.mi=null,t.apply(e))))}updateLimboDocument(e,t){return this.pi(e,t).next((e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())}))}Ii(e){return 0}pi(e,t){return Qn.or([()=>Qn.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class va{constructor(e,t){this.persistence=e,this.yi=new Xi((e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ns(t)),t=ts(e.get(n),t);return ns(t)}(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=function(e,t){return new ta(e,t)}(this,t)}static fi(e,t){return new va(e,t)}di(){}Ai(e){return Qn.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}br(e){let t=0;return this.yr(e,(e=>{t++})).next((()=>t))}yr(e,t){return Qn.forEach(this.yi,((n,s)=>this.Dr(e,n,s).next((e=>e?Qn.resolve():t(s)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.si(e,(s=>this.Dr(e,s,t).next((e=>{e||(n++,i.removeEntry(s,Un.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),Qn.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Qn.resolve()}removeReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Qn.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),Qn.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Zs(e.data.value)),t}Dr(e,t,n){return Qn.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.yi.get(t);return Qn.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ba{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.ds=n,this.As=s}static Rs(e,t){let n=lr(),s=lr();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:s=s.add(e.doc.key)}return new ba(e,t.fromCache,n,s)}}class ya{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class wa{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=ne()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}(te())>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.ws(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.bs(e,t,s,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new ya;return this.Ss(e,t,n).next((s=>{if(i.result=s,this.fs)return this.Ds(e,t,n,s.size)}))})).next((()=>i.result))}Ds(e,t,n,s){return n.documentReadCount<this.gs?(an()<=ye.DEBUG&&cn("QueryEngine","SDK will not create cache indexes for query:",Wi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Qn.resolve()):(an()<=ye.DEBUG&&cn("QueryEngine","Query:",Wi(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.ps*s?(an()<=ye.DEBUG&&cn("QueryEngine","The SDK decides to create cache indexes for query:",Wi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bi(t))):Qn.resolve())}ws(e,t){if($i(t))return Qn.resolve(null);let n=Bi(t);return this.indexManager.getIndexType(e,n).next((s=>0===s?null:(null!==t.limit&&1===s&&(t=Hi(t,null,"F"),n=Bi(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((s=>{const i=lr(...s);return this.ys.getDocuments(e,i).next((s=>this.indexManager.getMinOffset(e,n).next((n=>{const r=this.vs(t,s);return this.Cs(t,r,i,n.readTime)?this.ws(e,Hi(t,null,"F")):this.Fs(e,r,t,n)}))))})))))}bs(e,t,n,s){return $i(t)||s.isEqual(Un.min())?Qn.resolve(null):this.ys.getDocuments(e,n).next((i=>{const r=this.vs(t,i);return this.Cs(t,r,n,s)?Qn.resolve(null):(an()<=ye.DEBUG&&cn("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Wi(t)),this.Fs(e,r,t,function(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,i=Un.fromTimestamp(1e9===s?new Mn(n+1,0):new Mn(n,s));return new Kn(i,qn.empty(),t)}(s,-1)).next((e=>e)))}))}vs(e,t){let n=new xs(Qi(e));return t.forEach(((t,s)=>{Ji(e,s)&&(n=n.add(s))})),n}Cs(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,n){return an()<=ye.DEBUG&&cn("QueryEngine","Using full collection scan to execute query:",Wi(t)),this.ys.getDocumentsMatchingQuery(e,t,Kn.min(),n)}Fs(e,t,n,s){return this.ys.getDocumentsMatchingQuery(e,n,s).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const xa="LocalStore";class _a{constructor(e,t,n,s){this.persistence=e,this.Ms=t,this.serializer=s,this.xs=new bs(Rn),this.Os=new Xi((e=>Ni(e)),ji),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ia(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.xs)))}}async function Sa(e,t){const n=fn(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next((i=>(s=i,n.Ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],r=[];let o=lr();for(const e of s){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({ks:e,removedBatchIds:i,addedBatchIds:r})))}))}))}function Ea(e){const t=fn(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ti.getLastRemoteSnapshotVersion(e)))}function ka(e,t){const n=fn(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Ta(e,t,n){const s=fn(e),i=s.xs.get(t),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(e=>s.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Yn(e))throw e;cn(xa,`Failed to update sequence numbers for target ${t}: ${e}`)}s.xs=s.xs.remove(t),s.Os.delete(i.target)}function Ia(e,t,n){const s=fn(e);let i=Un.min(),r=lr();return s.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const s=fn(e),i=s.Os.get(n);return void 0!==i?Qn.resolve(s.xs.get(i)):s.Ti.getTargetData(t,n)}(s,e,Bi(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,s.Ti.getMatchingKeysForTargetId(e,t.targetId).next((e=>{r=e}))})).next((()=>s.Ms.getDocumentsMatchingQuery(e,t,n?i:Un.min(),n?r:lr()))).next((e=>(function(e,t,n){let s=e.Ns.get(t)||Un.min();n.forEach(((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)})),e.Ns.set(t,s)}(s,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,$s:r})))))}class Ca{constructor(){this.activeTargetIds=hr}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Aa{constructor(){this.xo=new Ca,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new Ca,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ra{No(e){}shutdown(){}}const Pa="ConnectivityMonitor";class La{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){cn(Pa,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){cn(Pa,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Da=null;function Oa(){return null===Da?Da=268435456+Math.round(2147483648*Math.random()):Da++,"0x"+Da.toString(16)}const Na="RestConnection",ja={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ma{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${s}`,this.Go=this.databaseId.database===Us?`project_id=${n}`:`project_id=${n}&database_id=${s}`}zo(e,t,n,s,i){const r=Oa(),o=this.jo(e,t.toUriEncodedString());cn(Na,`Sending RPC '${e}' ${r}:`,o,n);const a={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(a,s,i);const{host:c}=new URL(o),l=Q(c);return this.Jo(e,o,a,n,l).then((t=>(cn(Na,`Received RPC '${e}' ${r}: `,t),t)),(t=>{throw hn(Na,`RPC '${e}' ${r} failed with error: `,t,"url: ",o,"request:",n),t}))}Yo(e,t,n,s,i,r){return this.zo(e,t,n,s,i)}Ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+rn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}jo(e,t){const n=ja[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}class Ua{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}const Fa="WebChannelConnection";class $a extends Ma{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,s,i){const r=Oa();return new Promise(((i,o)=>{const a=new Ht;a.setWithCredentials(!0),a.listenOnce(Gt.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Wt.NO_ERROR:const t=a.getResponseJson();cn(Fa,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),i(t);break;case Wt.TIMEOUT:cn(Fa,`RPC '${e}' ${r} timed out`),o(new vn(mn.DEADLINE_EXCEEDED,"Request time out"));break;case Wt.HTTP_ERROR:const n=a.getStatus();if(cn(Fa,`RPC '${e}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(mn).indexOf(t)>=0?t:mn.UNKNOWN}(t.status);o(new vn(e,t.message))}else o(new vn(mn.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new vn(mn.UNAVAILABLE,"Connection failed."));break;default:dn(9055,{h_:e,streamId:r,P_:a.getLastErrorCode(),T_:a.getLastError()})}}finally{cn(Fa,`RPC '${e}' ${r} completed.`)}}));const c=JSON.stringify(s);cn(Fa,`RPC '${e}' ${r} sending request:`,s),a.send(t,"POST",c,n,15)}))}I_(e,t,n){const s=Oa(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=Xt(),o=Yt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Ho(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const l=i.join("");cn(Fa,`Creating RPC '${e}' stream ${s}: ${l}`,a);const h=r.createWebChannel(l,a);this.E_(h);let u=!1,d=!1;const p=new Ua({Zo:t=>{d?cn(Fa,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(u||(cn(Fa,`Opening RPC '${e}' stream ${s} transport.`),h.open(),u=!0),cn(Fa,`RPC '${e}' stream ${s} sending:`,t),h.send(t))},Xo:()=>h.close()}),g=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return g(h,Kt.EventType.OPEN,(()=>{d||(cn(Fa,`RPC '${e}' stream ${s} transport opened.`),p.__())})),g(h,Kt.EventType.CLOSE,(()=>{d||(d=!0,cn(Fa,`RPC '${e}' stream ${s} transport closed`),p.u_(),this.d_(h))})),g(h,Kt.EventType.ERROR,(t=>{d||(d=!0,hn(Fa,`RPC '${e}' stream ${s} transport errored. Name:`,t.name,"Message:",t.message),p.u_(new vn(mn.UNAVAILABLE,"The operation could not be completed")))})),g(h,Kt.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];gn(!!i,16349);const r=i,o=(null==r?void 0:r.error)||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){cn(Fa,`RPC '${e}' stream ${s} received error:`,o);const t=o.status;let n=function(e){const t=Gr[e];if(void 0!==t)return Jr(t)}(t),i=o.message;void 0===n&&(n=mn.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,p.u_(new vn(n,i)),h.close()}else cn(Fa,`RPC '${e}' stream ${s} received:`,i),p.c_(i)}})),g(o,Qt.STAT_EVENT,(t=>{t.stat===Jt.PROXY?cn(Fa,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===Jt.NOPROXY&&cn(Fa,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{p.a_()}),0),p}terminate(){this.l_.forEach((e=>e.close())),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter((t=>t===e))}}function Va(){return"undefined"!=typeof document?document:null}function za(e){return new go(e,!0)}class Ba{constructor(e,t,n=1e3,s=1.5,i=6e4){this.xi=e,this.timerId=t,this.A_=n,this.R_=s,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),n=Math.max(0,Date.now()-this.g_),s=Math.max(0,t-n);s>0&&cn("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,s,(()=>(this.g_=Date.now(),e()))),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){null!==this.f_&&(this.f_.skipDelay(),this.f_=null)}cancel(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}const qa="PersistentStream";class Ha{constructor(e,t,n,s,i,r,o,a){this.xi=e,this.S_=n,this.D_=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new Ba(e,t)}O_(){return 1===this.state||5===this.state||this.N_()}N_(){return 2===this.state||3===this.state}start(){this.M_=0,4!==this.state?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&null===this.C_&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,(()=>this.q_())))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,4!==e?this.x_.reset():t&&t.code===mn.RESOURCE_EXHAUSTED?(ln(t.toString()),ln("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===mn.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.v_===t&&this.z_(e,n)}),(t=>{e((()=>{const e=new vn(mn.UNKNOWN,"Fetching auth token failed: "+t.message);return this.j_(e)}))}))}z_(e,t){const n=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_((()=>{n((()=>this.listener.e_()))})),this.stream.n_((()=>{n((()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,(()=>(this.N_()&&(this.state=3),Promise.resolve()))),this.listener.n_())))})),this.stream.i_((e=>{n((()=>this.j_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.M_?this.J_(e):this.onNext(e)))}))}B_(){this.state=5,this.x_.y_((async()=>{this.state=0,this.start()}))}j_(e){return cn(qa,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget((()=>this.v_===e?t():(cn(qa,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ka extends Ha{constructor(e,t,n,s,i,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const s=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:dn(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(gn(void 0===t||"string"==typeof t,58123),ks.fromBase64String(t||"")):(gn(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),ks.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?mn.UNKNOWN:Jr(e.code);return new vn(t,e.message||"")}(o);n=new ro(s,i,r,a||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const i=Eo(e,s.document.name),r=yo(s.document.updateTime),o=s.document.createTime?yo(s.document.createTime):Un.min(),a=new li({mapValue:{fields:s.document.fields}}),c=ui.newFoundDocument(i,r,o,a),l=s.targetIds||[],h=s.removedTargetIds||[];n=new so(l,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const i=Eo(e,s.document),r=s.readTime?yo(s.readTime):Un.min(),o=ui.newNoDocument(i,r),a=s.removedTargetIds||[];n=new so([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const i=Eo(e,s.document),r=s.removedTargetIds||[];n=new so([],r,i,null)}else{if(!("filter"in t))return dn(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:i}=e,r=new Kr(s,i),o=e.targetId;n=new io(o,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Un.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Un.min():t.readTime?yo(t.readTime):Un.min()}(e);return this.listener.Y_(t,n)}Z_(e){const t={};t.database=To(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=Mi(s)?{documents:Ao(e,s)}:{query:Ro(e,s).gt},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=vo(e,t.resumeToken);const s=fo(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(Un.min())>0){n.readTime=mo(e,t.snapshotVersion.toTimestamp());const s=fo(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return dn(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Q_(t)}X_(e){const t={};t.database=To(this.serializer),t.removeTarget=e,this.Q_(t)}}class Ga extends Ha{constructor(e,t,n,s,i,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,r),this.serializer=i}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return gn(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,gn(!e.writeResults||0===e.writeResults.length,55816),this.listener.na()}onNext(e){gn(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=function(e,t){return e&&e.length>0?(gn(void 0!==t,14353),e.map((e=>function(e,t){let n=e.updateTime?yo(e.updateTime):yo(t);return n.isEqual(Un.min())&&(n=yo(t)),new Ir(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=yo(e.commitTime);return this.listener.ra(n,t)}ia(){const e={};e.database=To(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof jr)n={update:Co(e,t.key,t.value)};else if(t instanceof Vr)n={delete:So(e,t.key)};else if(t instanceof Mr)n={update:Co(e,t.key,t.data),updateMask:Fo(t.fieldMask)};else{if(!(t instanceof zr))return dn(16599,{ft:t.type});n={verify:So(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof br)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof yr)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof xr)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Sr)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw dn(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:bo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:dn(27497)}(e,t.precondition)),n}(this.serializer,e)))};this.Q_(t)}}class Wa{}class Ja extends Wa{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.sa=!1}oa(){if(this.sa)throw new vn(mn.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,s){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.zo(e,xo(t,n),s,i,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===mn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new vn(mn.UNKNOWN,e.toString())}))}Yo(e,t,n,s,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Yo(e,xo(t,n),s,r,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===mn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new vn(mn.UNKNOWN,e.toString())}))}terminate(){this.sa=!0,this.connection.terminate()}}class Qa{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){0===this._a&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve()))))}Pa(e){"Online"===this.state?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,"Online"===e&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(ln(t),this.ua=!1):cn("OnlineStateTracker",t)}Ta(){null!==this.aa&&(this.aa.cancel(),this.aa=null)}}const Ya="RemoteStore";class Xa{constructor(e,t,n,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No((e=>{n.enqueueAndForget((async()=>{ac(this)&&(cn(Ya,"Restarting streams for network reachability change."),await async function(e){const t=fn(e);t.da.add(4),await ec(t),t.Va.set("Unknown"),t.da.delete(4),await Za(t)}(this))}))})),this.Va=new Qa(n,s)}}async function Za(e){if(ac(e))for(const t of e.Aa)await t(!0)}async function ec(e){for(const t of e.Aa)await t(!1)}function tc(e,t){const n=fn(e);n.Ea.has(t.targetId)||(n.Ea.set(t.targetId,t),oc(n)?rc(n):kc(n).N_()&&sc(n,t))}function nc(e,t){const n=fn(e),s=kc(n);n.Ea.delete(t),s.N_()&&ic(n,t),0===n.Ea.size&&(s.N_()?s.k_():ac(n)&&n.Va.set("Unknown"))}function sc(e,t){if(e.ma.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Un.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}kc(e).Z_(t)}function ic(e,t){e.ma.Ke(t),kc(e).X_(t)}function rc(e){e.ma=new ao({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e.Ea.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),kc(e).start(),e.Va.ca()}function oc(e){return ac(e)&&!kc(e).O_()&&e.Ea.size>0}function ac(e){return 0===fn(e).da.size}function cc(e){e.ma=void 0}async function lc(e){e.Va.set("Online")}async function hc(e){e.Ea.forEach(((t,n)=>{sc(e,t)}))}async function uc(e,t){cc(e),oc(e)?(e.Va.Pa(t),rc(e)):e.Va.set("Unknown")}async function dc(e,t,n){if(e.Va.set("Online"),t instanceof ro&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.Ea.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.Ea.delete(s),e.ma.removeTarget(s))}(e,t)}catch(n){cn(Ya,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await pc(e,n)}else if(t instanceof so?e.ma.Xe(t):t instanceof io?e.ma.ot(t):e.ma.nt(t),!n.isEqual(Un.min()))try{const t=await Ea(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.ma.It(t);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ea.get(s);i&&e.Ea.set(s,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const s=e.Ea.get(t);if(!s)return;e.Ea.set(t,s.withResumeToken(ks.EMPTY_BYTE_STRING,s.snapshotVersion)),ic(e,t);const i=new Vo(s.target,t,n,s.sequenceNumber);sc(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){cn(Ya,"Failed to raise snapshot:",t),await pc(e,t)}}async function pc(e,t,n){if(!Yn(t))throw t;e.da.add(1),await ec(e),e.Va.set("Offline"),n||(n=()=>Ea(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{cn(Ya,"Retrying IndexedDB access"),await n(),e.da.delete(1),await Za(e)}))}function gc(e,t){return t().catch((n=>pc(e,n,t)))}async function fc(e){const t=fn(e),n=Tc(t);let s=t.Ia.length>0?t.Ia[t.Ia.length-1].batchId:-1;for(;mc(t);)try{const e=await ka(t.localStore,s);if(null===e){0===t.Ia.length&&n.k_();break}s=e.batchId,vc(t,e)}catch(e){await pc(t,e)}bc(t)&&yc(t)}function mc(e){return ac(e)&&e.Ia.length<10}function vc(e,t){e.Ia.push(t);const n=Tc(e);n.N_()&&n.ea&&n.ta(t.mutations)}function bc(e){return ac(e)&&!Tc(e).O_()&&e.Ia.length>0}function yc(e){Tc(e).start()}async function wc(e){Tc(e).ia()}async function xc(e){const t=Tc(e);for(const n of e.Ia)t.ta(n.mutations)}async function _c(e,t,n){const s=e.Ia.shift(),i=qr.from(s,t,n);await gc(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await fc(e)}async function Sc(e,t){t&&Tc(e).ea&&await async function(e,t){if(function(e){return function(e){switch(e){case mn.OK:return dn(64938);case mn.CANCELLED:case mn.UNKNOWN:case mn.DEADLINE_EXCEEDED:case mn.RESOURCE_EXHAUSTED:case mn.INTERNAL:case mn.UNAVAILABLE:case mn.UNAUTHENTICATED:return!1;case mn.INVALID_ARGUMENT:case mn.NOT_FOUND:case mn.ALREADY_EXISTS:case mn.PERMISSION_DENIED:case mn.FAILED_PRECONDITION:case mn.ABORTED:case mn.OUT_OF_RANGE:case mn.UNIMPLEMENTED:case mn.DATA_LOSS:return!0;default:return dn(15467,{code:e})}}(e)&&e!==mn.ABORTED}(t.code)){const n=e.Ia.shift();Tc(e).L_(),await gc(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await fc(e)}}(e,t),bc(e)&&yc(e)}async function Ec(e,t){const n=fn(e);n.asyncQueue.verifyOperationInProgress(),cn(Ya,"RemoteStore received new credentials");const s=ac(n);n.da.add(3),await ec(n),s&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.da.delete(3),await Za(n)}function kc(e){return e.fa||(e.fa=function(e,t,n){const s=fn(e);return s.oa(),new Ka(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{e_:lc.bind(null,e),n_:hc.bind(null,e),i_:uc.bind(null,e),Y_:dc.bind(null,e)}),e.Aa.push((async t=>{t?(e.fa.L_(),oc(e)?rc(e):e.Va.set("Unknown")):(await e.fa.stop(),cc(e))}))),e.fa}function Tc(e){return e.ga||(e.ga=function(e,t,n){const s=fn(e);return s.oa(),new Ga(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{e_:()=>Promise.resolve(),n_:wc.bind(null,e),i_:Sc.bind(null,e),na:xc.bind(null,e),ra:_c.bind(null,e)}),e.Aa.push((async t=>{t?(e.ga.L_(),await fc(e)):(await e.ga.stop(),e.Ia.length>0&&(cn(Ya,`Stopping write stream with ${e.Ia.length} pending writes`),e.Ia=[]))}))),e.ga}class Ic{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new bn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const r=Date.now()+n,o=new Ic(e,t,r,s,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new vn(mn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Cc(e,t){if(ln("AsyncQueue",`${t}: ${e}`),Yn(e))return new vn(mn.UNAVAILABLE,`${t}: ${e}`);throw e}class Ac{static emptySet(e){return new Ac(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||qn.comparator(t.key,n.key):(e,t)=>qn.comparator(e.key,t.key),this.keyedMap=nr(),this.sortedSet=new bs(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ac))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ac;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Rc{constructor(){this.pa=new bs(qn.comparator)}track(e){const t=e.doc.key,n=this.pa.get(t);n?0!==e.type&&3===n.type?this.pa=this.pa.insert(t,e):3===e.type&&1!==n.type?this.pa=this.pa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.pa=this.pa.remove(t):1===e.type&&2===n.type?this.pa=this.pa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):dn(63341,{Vt:e,ya:n}):this.pa=this.pa.insert(t,e)}wa(){const e=[];return this.pa.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Pc{constructor(e,t,n,s,i,r,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,i){const r=[];return t.forEach((e=>{r.push({type:0,doc:e})})),new Pc(e,t,Ac.emptySet(t),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ki(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Lc{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some((e=>e.va()))}}class Dc{constructor(){this.queries=Oc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=fn(e),s=n.queries;n.queries=Oc(),s.forEach(((e,n)=>{for(const e of n.Sa)e.onError(t)}))}(this,new vn(mn.ABORTED,"Firestore shutting down"))}}function Oc(){return new Xi((e=>Gi(e)),Ki)}async function Nc(e,t){const n=fn(e);let s=3;const i=t.query;let r=n.queries.get(i);r?!r.Da()&&t.va()&&(s=2):(r=new Lc,s=t.va()?0:1);try{switch(s){case 0:r.ba=await n.onListen(i,!0);break;case 1:r.ba=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Cc(e,`Initialization of query '${Wi(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,r),r.Sa.push(t),t.Fa(n.onlineState),r.ba&&t.Ma(r.ba)&&Fc(n)}async function jc(e,t){const n=fn(e),s=t.query;let i=3;const r=n.queries.get(s);if(r){const e=r.Sa.indexOf(t);e>=0&&(r.Sa.splice(e,1),0===r.Sa.length?i=t.va()?0:1:!r.Da()&&t.va()&&(i=2))}switch(i){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}function Mc(e,t){const n=fn(e);let s=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Sa)t.Ma(e)&&(s=!0);i.ba=e}}s&&Fc(n)}function Uc(e,t,n){const s=fn(e),i=s.queries.get(t);if(i)for(const e of i.Sa)e.onError(n);s.queries.delete(t)}function Fc(e){e.Ca.forEach((e=>{e.next()}))}var $c,Vc;(Vc=$c||($c={})).xa="default",Vc.Cache="cache";class zc{constructor(e,t,n){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=n||{}}Ma(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Pc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache)return!0;if(!this.va())return!0;const n="Offline"!==t;return(!this.options.Qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}La(e){if(e.docChanges.length>0)return!0;const t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}qa(e){e=Pc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==$c.Cache}}class Bc{constructor(e){this.key=e}}class qc{constructor(e){this.key=e}}class Hc{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=lr(),this.mutatedKeys=lr(),this.Za=Qi(e),this.Xa=new Ac(this.Za)}get eu(){return this.Ha}tu(e,t){const n=t?t.nu:new Rc,s=t?t.Xa:this.Xa;let i=t?t.mutatedKeys:this.mutatedKeys,r=s,o=!1;const a="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((e,t)=>{const l=s.get(e),h=Ji(this.query,t)?t:null,u=!!l&&this.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let p=!1;l&&h?l.data.isEqual(h.data)?u!==d&&(n.track({type:3,doc:h}),p=!0):this.ru(l,h)||(n.track({type:2,doc:h}),p=!0,(a&&this.Za(h,a)>0||c&&this.Za(h,c)<0)&&(o=!0)):!l&&h?(n.track({type:0,doc:h}),p=!0):l&&!h&&(n.track({type:1,doc:l}),p=!0,(a||c)&&(o=!0)),p&&(h?(r=r.add(h),i=d?i.add(e):i.delete(e)):(r=r.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Xa:r,nu:n,Cs:o,mutatedKeys:i}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const r=e.nu.wa();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return dn(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.Za(e.doc,t.doc))),this.iu(n),s=null!=s&&s;const o=t&&!s?this.su():[],a=0===this.Ya.size&&this.current&&!s?1:0,c=a!==this.Ja;return this.Ja=a,0!==r.length||c?{snapshot:new Pc(this.query,e.Xa,i,r,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ou:o}:{ou:o}}Fa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new Rc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach((e=>this.Ha=this.Ha.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ha=this.Ha.delete(e))),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=lr(),this.Xa.forEach((e=>{this._u(e.key)&&(this.Ya=this.Ya.add(e.key))}));const t=[];return e.forEach((e=>{this.Ya.has(e)||t.push(new qc(e))})),this.Ya.forEach((n=>{e.has(n)||t.push(new Bc(n))})),t}au(e){this.Ha=e.$s,this.Ya=lr();const t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return Pc.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,0===this.Ja,this.hasCachedResults)}}const Kc="SyncEngine";class Gc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Wc{constructor(e){this.key=e,this.cu=!1}}class Jc{constructor(e,t,n,s,i,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.lu={},this.hu=new Xi((e=>Gi(e)),Ki),this.Pu=new Map,this.Tu=new Set,this.Iu=new bs(qn.comparator),this.Eu=new Map,this.du=new ca,this.Au={},this.Ru=new Map,this.Vu=Qo.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return!0===this.mu}}async function Qc(e,t,n=!0){const s=ml(e);let i;const r=s.hu.get(t);return r?(s.sharedClientState.addLocalQueryTarget(r.targetId),i=r.view.uu()):i=await Xc(s,t,n,!0),i}async function Yc(e,t){const n=ml(e);await Xc(n,t,!0,!1)}async function Xc(e,t,n,s){const i=await function(e,t){const n=fn(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let s;return n.Ti.getTargetData(e,t).next((i=>i?(s=i,Qn.resolve(s)):n.Ti.allocateTargetId(e).next((i=>(s=new Vo(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ti.addTargetData(e,s).next((()=>s)))))))})).then((e=>{const s=n.xs.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.xs=n.xs.insert(e.targetId,e),n.Os.set(t,e.targetId)),e}))}(e.localStore,Bi(t)),r=i.targetId,o=e.sharedClientState.addLocalQueryTarget(r,n);let a;return s&&(a=await async function(e,t,n,s,i){e.fu=(t,n,s)=>async function(e,t,n,s){let i=t.view.tu(n);i.Cs&&(i=await Ia(e.localStore,t.query,!1).then((({documents:e})=>t.view.tu(e,i))));const r=s&&s.targetChanges.get(t.targetId),o=s&&null!=s.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,r,o);return hl(e,t.targetId,a.ou),a.snapshot}(e,t,n,s);const r=await Ia(e.localStore,t,!0),o=new Hc(t,r.$s),a=o.tu(r.documents),c=no.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,i),l=o.applyChanges(a,e.isPrimaryClient,c);hl(e,n,l.ou);const h=new Gc(t,n,o);return e.hu.set(t,h),e.Pu.has(n)?e.Pu.get(n).push(t):e.Pu.set(n,[t]),l.snapshot}(e,t,r,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&tc(e.remoteStore,i),a}async function Zc(e,t,n){const s=fn(e),i=s.hu.get(t),r=s.Pu.get(i.targetId);if(r.length>1)return s.Pu.set(i.targetId,r.filter((e=>!Ki(e,t)))),void s.hu.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(i.targetId),s.sharedClientState.isActiveQueryTarget(i.targetId)||await Ta(s.localStore,i.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(i.targetId),n&&nc(s.remoteStore,i.targetId),cl(s,i.targetId)})).catch(Jn)):(cl(s,i.targetId),await Ta(s.localStore,i.targetId,!0))}async function el(e,t){const n=fn(e),s=n.hu.get(t),i=n.Pu.get(s.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),nc(n.remoteStore,s.targetId))}async function tl(e,t){const n=fn(e);try{const e=await function(e,t){const n=fn(e),s=t.snapshotVersion;let i=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const r=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.xs;const o=[];t.targetChanges.forEach(((r,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ti.removeMatchingKeys(e,r.removedDocuments,a).next((()=>n.Ti.addMatchingKeys(e,r.addedDocuments,a))));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?l=l.withResumeToken(ks.EMPTY_BYTE_STRING,Un.min()).withLastLimboFreeSnapshotVersion(Un.min()):r.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(r.resumeToken,s)),i=i.insert(a,l),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,r)&&o.push(n.Ti.updateTargetData(e,l))}));let a=er(),c=lr();if(t.documentUpdates.forEach((s=>{t.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))})),o.push(function(e,t,n){let s=lr(),i=lr();return n.forEach((e=>s=s.add(e))),t.getEntries(e,s).next((e=>{let s=er();return n.forEach(((n,r)=>{const o=e.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(Un.min())?(t.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(r),s=s.insert(n,r)):cn(xa,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{qs:s,Qs:i}}))}(e,r,t.documentUpdates).next((e=>{a=e.qs,c=e.Qs}))),!s.isEqual(Un.min())){const t=n.Ti.getLastRemoteSnapshotVersion(e).next((t=>n.Ti.setTargetsMetadata(e,e.currentSequenceNumber,s)));o.push(t)}return Qn.waitFor(o).next((()=>r.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.xs=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const s=n.Eu.get(t);s&&(gn(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?s.cu=!0:e.modifiedDocuments.size>0?gn(s.cu,14607):e.removedDocuments.size>0&&(gn(s.cu,42227),s.cu=!1))})),await pl(n,e,t)}catch(e){await Jn(e)}}function nl(e,t,n){const s=fn(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.hu.forEach(((n,s)=>{const i=s.view.Fa(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=fn(e);n.onlineState=t;let s=!1;n.queries.forEach(((e,n)=>{for(const e of n.Sa)e.Fa(t)&&(s=!0)})),s&&Fc(n)}(s.eventManager,t),e.length&&s.lu.Y_(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function sl(e,t,n){const s=fn(e);s.sharedClientState.updateQueryState(t,"rejected",n);const i=s.Eu.get(t),r=i&&i.key;if(r){let e=new bs(qn.comparator);e=e.insert(r,ui.newNoDocument(r,Un.min()));const n=lr().add(r),i=new to(Un.min(),new Map,new bs(Rn),e,n);await tl(s,i),s.Iu=s.Iu.remove(r),s.Eu.delete(t),dl(s)}else await Ta(s.localStore,t,!1).then((()=>cl(s,t,n))).catch(Jn)}async function il(e,t){const n=fn(e),s=t.batch.batchId;try{const e=await function(e,t){const n=fn(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const s=t.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const i=n.batch,r=i.keys();let o=Qn.resolve();return r.forEach((e=>{o=o.next((()=>s.getEntry(t,e))).next((t=>{const r=n.docVersions.get(e);gn(null!==r,48541),t.version.compareTo(r)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=lr();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(n.localStore,t);al(n,s,null),ol(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await pl(n,e)}catch(e){await Jn(e)}}async function rl(e,t,n){const s=fn(e);try{const e=await function(e,t){const n=fn(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(gn(null!==t,37113),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s))).next((()=>n.localDocuments.getDocuments(e,s)))}))}(s.localStore,t);al(s,t,n),ol(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await pl(s,e)}catch(n){await Jn(n)}}function ol(e,t){(e.Ru.get(t)||[]).forEach((e=>{e.resolve()})),e.Ru.delete(t)}function al(e,t,n){const s=fn(e);let i=s.Au[s.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),s.Au[s.currentUser.toKey()]=i}}function cl(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Pu.get(t))e.hu.delete(s),n&&e.lu.gu(s,n);e.Pu.delete(t),e.isPrimaryClient&&e.du.Hr(t).forEach((t=>{e.du.containsKey(t)||ll(e,t)}))}function ll(e,t){e.Tu.delete(t.path.canonicalString());const n=e.Iu.get(t);null!==n&&(nc(e.remoteStore,n),e.Iu=e.Iu.remove(t),e.Eu.delete(n),dl(e))}function hl(e,t,n){for(const s of n)s instanceof Bc?(e.du.addReference(s.key,t),ul(e,s)):s instanceof qc?(cn(Kc,"Document no longer in limbo: "+s.key),e.du.removeReference(s.key,t),e.du.containsKey(s.key)||ll(e,s.key)):dn(19791,{pu:s})}function ul(e,t){const n=t.key,s=n.path.canonicalString();e.Iu.get(n)||e.Tu.has(s)||(cn(Kc,"New document in limbo: "+n),e.Tu.add(s),dl(e))}function dl(e){for(;e.Tu.size>0&&e.Iu.size<e.maxConcurrentLimboResolutions;){const t=e.Tu.values().next().value;e.Tu.delete(t);const n=new qn(Vn.fromString(t)),s=e.Vu.next();e.Eu.set(s,new Wc(n)),e.Iu=e.Iu.insert(n,s),tc(e.remoteStore,new Vo(Bi(Fi(n.path)),s,"TargetPurposeLimboResolution",Xn.le))}}async function pl(e,t,n){const s=fn(e),i=[],r=[],o=[];s.hu.isEmpty()||(s.hu.forEach(((e,a)=>{o.push(s.fu(a,t,n).then((e=>{var t;if((e||n)&&s.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;s.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=ba.Rs(a.targetId,e);r.push(t)}})))})),await Promise.all(o),s.lu.Y_(i),await async function(e,t){const n=fn(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Qn.forEach(t,(t=>Qn.forEach(t.ds,(s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s))).next((()=>Qn.forEach(t.As,(s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))))))}catch(e){if(!Yn(e))throw e;cn(xa,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.xs.get(t),s=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(s);n.xs=n.xs.insert(t,i)}}}(s.localStore,r))}async function gl(e,t){const n=fn(e);if(!n.currentUser.isEqual(t)){cn(Kc,"User change. New user:",t.toKey());const e=await Sa(n.localStore,t);n.currentUser=t,function(e){e.Ru.forEach((e=>{e.forEach((e=>{e.reject(new vn(mn.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ru.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await pl(n,e.ks)}}function fl(e,t){const n=fn(e),s=n.Eu.get(t);if(s&&s.cu)return lr().add(s.key);{let e=lr();const s=n.Pu.get(t);if(!s)return e;for(const t of s){const s=n.hu.get(t);e=e.unionWith(s.view.eu)}return e}}function ml(e){const t=fn(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=tl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=fl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=sl.bind(null,t),t.lu.Y_=Mc.bind(null,t.eventManager),t.lu.gu=Uc.bind(null,t.eventManager),t}function vl(e){const t=fn(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=il.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=rl.bind(null,t),t}class bl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=za(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return function(e,t,n,s){return new _a(e,t,n,s)}(this.persistence,new wa,e.initialUser,this.serializer)}Su(e){return new ga(ma.fi,this.serializer)}bu(e){return new Aa}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bl.provider={build:()=>new bl};class yl extends bl{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){gn(this.persistence.referenceDelegate instanceof va,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new ea(n,e.asyncQueue,t)}Su(e){const t=void 0!==this.cacheSizeBytes?Jo.withCacheSize(this.cacheSizeBytes):Jo.DEFAULT;return new ga((e=>va.fi(e,t)),this.serializer)}}class wl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>nl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=gl.bind(null,this.syncEngine),await async function(e,t){const n=fn(e);t?(n.da.delete(2),await Za(n)):t||(n.da.add(2),await ec(n),n.Va.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Dc}createDatastore(e){const t=za(e.databaseInfo.databaseId),n=function(e){return new $a(e)}(e.databaseInfo);return function(e,t,n,s){return new Ja(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,s,i){return new Xa(e,t,n,s,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>nl(this.syncEngine,e,0)),La.C()?new La:new Ra)}createSyncEngine(e,t){return function(e,t,n,s,i,r,o){const a=new Jc(e,t,n,s,i,r);return o&&(a.mu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=fn(e);cn(Ya,"RemoteStore shutting down."),t.da.add(5),await ec(t),t.Ra.shutdown(),t.Va.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}wl.provider={build:()=>new wl};class xl{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):ln("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const _l="FirestoreClient";class Sl{constructor(e,t,n,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=sn.UNAUTHENTICATED,this.clientId=An.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{cn(_l,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(cn(_l,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Cc(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function El(e,t){e.asyncQueue.verifyOperationInProgress(),cn(_l,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener((async e=>{s.isEqual(e)||(await Sa(t.localStore,e),s=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function kl(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){cn(_l,"Using user provided OfflineComponentProvider");try{await El(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===mn.FAILED_PRECONDITION||e.code===mn.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;hn("Error using user provided cache. Falling back to memory cache: "+n),await El(e,new bl)}}else cn(_l,"Using default OfflineComponentProvider"),await El(e,new yl(void 0));return e._offlineComponents}(e);cn(_l,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Ec(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ec(t.remoteStore,n))),e._onlineComponents=t}async function Tl(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(cn(_l,"Using user provided OnlineComponentProvider"),await kl(e,e._uninitializedComponentsProvider._online)):(cn(_l,"Using default OnlineComponentProvider"),await kl(e,new wl))),e._onlineComponents}async function Il(e){const t=await Tl(e),n=t.eventManager;return n.onListen=Qc.bind(null,t.syncEngine),n.onUnlisten=Zc.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Yc.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=el.bind(null,t.syncEngine),n}function Cl(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Al=new Map;function Rl(e,t,n){if(!n)throw new vn(mn.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Pl(e){if(!qn.isDocumentKey(e))throw new vn(mn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ll(e){if(qn.isDocumentKey(e))throw new vn(mn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Dl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":dn(12329,{type:typeof e})}function Ol(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new vn(mn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Dl(e);throw new vn(mn.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const Nl="firestore.googleapis.com",jl=!0;class Ml{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new vn(mn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Nl,this.ssl=jl}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:jl;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Wo;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new vn(mn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,s){if(!0===t&&!0===s)throw new vn(mn.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Cl(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new vn(mn.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new vn(mn.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new vn(mn.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ul{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ml({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new vn(mn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new vn(mn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ml(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new wn;switch(e.type){case"firstParty":return new En(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new vn(mn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Al.get(e);t&&(cn("ComponentProvider","Removing Datastore"),Al.delete(e),t.terminate())}(this),Promise.resolve()}}class Fl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Fl(this.firestore,e,this._query)}}class $l{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $l(this.firestore,e,this._key)}}class Vl extends Fl{constructor(e,t,n){super(e,t,Fi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $l(this.firestore,null,new qn(e))}withConverter(e){return new Vl(this.firestore,e,this._path)}}function zl(e,t,...n){if(e=pe(e),Rl("collection","path",t),e instanceof Ul){const s=Vn.fromString(t,...n);return Ll(s),new Vl(e,null,s)}{if(!(e instanceof $l||e instanceof Vl))throw new vn(mn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(Vn.fromString(t,...n));return Ll(s),new Vl(e.firestore,null,s)}}function Bl(e,t,...n){if(e=pe(e),1===arguments.length&&(t=An.newId()),Rl("doc","path",t),e instanceof Ul){const s=Vn.fromString(t,...n);return Pl(s),new $l(e,null,new qn(s))}{if(!(e instanceof $l||e instanceof Vl))throw new vn(mn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(Vn.fromString(t,...n));return Pl(s),new $l(e.firestore,e instanceof Vl?e.converter:null,new qn(s))}}const ql="AsyncQueue";class Hl{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new Ba(this,"async_queue_retry"),this.rc=()=>{const e=Va();e&&cn(ql,"Visibility state changed to "+e.visibilityState),this.x_.b_()},this.sc=e;const t=Va();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=Va();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise((()=>{}));const t=new bn;return this._c((()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Ju.push(e),this.ac())))}async ac(){if(0!==this.Ju.length){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!Yn(e))throw e;cn(ql,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_((()=>this.ac()))}}_c(e){const t=this.sc.then((()=>(this.ec=!0,e().catch((e=>{throw this.Xu=e,this.ec=!1,ln("INTERNAL UNHANDLED ERROR: ",Kl(e)),e})).then((e=>(this.ec=!1,e))))));return this.sc=t,t}enqueueAfterDelay(e,t,n){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const s=Ic.createAndSchedule(this,e,t,n,(e=>this.uc(e)));return this.Zu.push(s),s}oc(){this.Xu&&dn(47125,{cc:Kl(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do{e=this.sc,await e}while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then((()=>{this.Zu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Zu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.lc()}))}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function Kl(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Gl extends Ul{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Hl,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Hl(e),this._firestoreClient=void 0,await e}}}function Wl(e){if(e._terminated)throw new vn(mn.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,s;const i=e._freezeSettings(),r=function(e,t,n,s){return new Ms(e,t,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Cl(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=i.localCache)||void 0===s?void 0:s._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Sl(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class Jl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Jl(ks.fromBase64String(e))}catch(e){throw new vn(mn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Jl(ks.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ql{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new vn(mn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Yl{constructor(e){this._methodName=e}}class Xl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new vn(mn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new vn(mn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Rn(this._lat,e._lat)||Rn(this._long,e._long)}}class Zl{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const eh=/^__.*__$/;class th{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Mr(e,this.data,this.fieldMask,t,this.fieldTransforms):new jr(e,this.data,t,this.fieldTransforms)}}class nh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Mr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function sh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw dn(40011,{Ic:e})}}class ih{constructor(e,t,n,s,i,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Ec(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new ih(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.dc({path:n,Rc:!1});return s.Vc(e),s}mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.dc({path:n,Rc:!1});return s.Ec(),s}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return vh(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(0===e.length)throw this.gc("Document fields must not be empty");if(sh(this.Ic)&&eh.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class rh{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||za(e)}bc(e,t,n,s=!1){return new ih({Ic:e,methodName:t,wc:n,path:Bn.emptyPath(),Rc:!1,yc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function oh(e){const t=e._freezeSettings(),n=za(e._databaseId);return new rh(e._databaseId,!!t.ignoreUndefinedProperties,n)}function ah(e,t,n,s,i,r={}){const o=e.bc(r.merge||r.mergeFields?2:0,t,n,i);ph("Data must be an object, but it was:",o,s);const a=uh(s,o);let c,l;if(r.merge)c=new Ss(o.fieldMask),l=o.fieldTransforms;else if(r.mergeFields){const e=[];for(const s of r.mergeFields){const i=gh(t,s,n);if(!o.contains(i))throw new vn(mn.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);bh(e,i)||e.push(i)}c=new Ss(e),l=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,l=o.fieldTransforms;return new th(new li(a),c,l)}class ch extends Yl{_toFieldTransform(e){if(2!==e.Ic)throw 1===e.Ic?e.gc(`${this._methodName}() can only appear at the top level of your update data`):e.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ch}}class lh extends Yl{constructor(e,t){super(e),this.Sc=t}_toFieldTransform(e){const t=function(e,t,n){return new ih({Ic:3,wc:t.settings.wc,methodName:e._methodName,Rc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}(this,e,!0),n=this.Sc.map((e=>hh(e,t))),s=new yr(n);return new Tr(e.path,s)}isEqual(e){return e instanceof lh&&oe(this.Sc,e.Sc)}}function hh(e,t){if(dh(e=pe(e)))return ph("Unsupported field value:",t,e),uh(e,t);if(e instanceof Yl)return function(e,t){if(!sh(t.Ic))throw t.gc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.gc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Rc&&4!==t.Ic)throw t.gc("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const i of e){let e=hh(i,t.fc(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=pe(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return pr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Mn.fromDate(e);return{timestampValue:mo(t.serializer,n)}}if(e instanceof Mn){const n=new Mn(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:mo(t.serializer,n)}}if(e instanceof Xl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Jl)return{bytesValue:vo(t.serializer,e._byteString)};if(e instanceof $l){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.gc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:wo(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Zl)return function(e,t){return{mapValue:{fields:{[$s]:{stringValue:Bs},[qs]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.gc("VectorValues must only contain numeric values.");return ur(t.serializer,e)}))}}}}}}(e,t);throw t.gc(`Unsupported field value: ${Dl(e)}`)}(e,t)}function uh(e,t){const n={};return vs(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ms(e,((e,s)=>{const i=hh(s,t.Ac(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function dh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Mn||e instanceof Xl||e instanceof Jl||e instanceof $l||e instanceof Yl||e instanceof Zl)}function ph(e,t,n){if(!dh(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const s=Dl(n);throw"an object"===s?t.gc(e+" a custom object"):t.gc(e+" "+s)}}function gh(e,t,n){if((t=pe(t))instanceof Ql)return t._internalPath;if("string"==typeof t)return mh(e,t);throw vh("Field path arguments must be of type string or ",e,!1,void 0,n)}const fh=new RegExp("[~\\*/\\[\\]]");function mh(e,t,n){if(t.search(fh)>=0)throw vh(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ql(...t.split("."))._internalPath}catch(s){throw vh(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function vh(e,t,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new vn(mn.INVALID_ARGUMENT,a+e+c)}function bh(e,t){return e.some((e=>e.isEqual(t)))}class yh{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $l(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new wh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(xh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class wh extends yh{data(){return super.data()}}function xh(e,t){return"string"==typeof t?mh(e,t):t instanceof Ql?t._internalPath:t._delegate._internalPath}class _h{}class Sh extends _h{}function Eh(e,t,...n){let s=[];t instanceof _h&&s.push(t),s=s.concat(n),function(e){const t=e.filter((e=>e instanceof Ih)).length,n=e.filter((e=>e instanceof kh)).length;if(t>1||t>0&&n>0)throw new vn(mn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const t of s)e=t._apply(e);return e}class kh extends Sh{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new kh(e,t,n)}_apply(e){const t=this._parse(e);return Rh(e._query,t),new Fl(e.firestore,e.converter,qi(e._query,t))}_parse(e){const t=oh(e.firestore),n=function(e,t,n,s,i,r,o){let a;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new vn(mn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){Ah(o,r);const t=[];for(const n of o)t.push(Ch(s,e,n));a={arrayValue:{values:t}}}else a=Ch(s,e,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||Ah(o,r),a=function(e,t,n,s=!1){return hh(n,e.bc(s?4:3,t))}(n,"where",o,"in"===r||"not-in"===r);return bi.create(i,r,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Th(e,t,n){const s=t,i=xh("where",e);return kh._create(i,s,n)}class Ih extends _h{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ih(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:yi.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const s=t.getFlattenedFilters();for(const e of s)Rh(n,e),n=qi(n,e)}(e._query,t),new Fl(e.firestore,e.converter,qi(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ch(e,t,n){if("string"==typeof(n=pe(n))){if(""===n)throw new vn(mn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Vi(t)&&-1!==n.indexOf("/"))throw new vn(mn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=t.path.child(Vn.fromString(n));if(!qn.isDocumentKey(s))throw new vn(mn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return ei(e,new qn(s))}if(n instanceof $l)return ei(e,n._key);throw new vn(mn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Dl(n)}.`)}function Ah(e,t){if(!Array.isArray(e)||0===e.length)throw new vn(mn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Rh(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new vn(mn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new vn(mn.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Ph{convertValue(e,t="none"){switch(Hs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(As(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw dn(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return ms(e,((e,s)=>{n[e]=this.convertValue(s,t)})),n}convertVectorValue(e){var t,n,s;const i=null===(s=null===(n=null===(t=e.fields)||void 0===t?void 0:t[qs].arrayValue)||void 0===n?void 0:n.values)||void 0===s?void 0:s.map((e=>Cs(e.doubleValue)));return new Zl(i)}convertGeoPoint(e){return new Xl(Cs(e.latitude),Cs(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ns(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(js(e));default:return null}}convertTimestamp(e){const t=Is(e);return new Mn(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Vn.fromString(e);gn($o(n),9688,{name:e});const s=new Fs(n.get(1),n.get(3)),i=new qn(n.popFirst(5));return s.isEqual(t)||ln(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Lh(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class Dh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Oh extends yh{constructor(e,t,n,s,i,r){super(e,t,n,s,r),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Nh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(xh("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Nh extends Oh{data(e={}){return super.data(e)}}class jh{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Dh(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Nh(this._firestore,this._userDataWriter,n.key,n,new Dh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new vn(mn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const s=new Nh(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Dh(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const s=new Nh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Dh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,r=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:Mh(t.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Mh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return dn(61501,{type:e})}}function Uh(e){e=Ol(e,$l);const t=Ol(e.firestore,Gl);return function(e,t,n={}){const s=new bn;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,s,i){const r=new xl({next:a=>{r.xu(),t.enqueueAndForget((()=>jc(e,o)));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new vn(mn.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&s&&"server"===s.source?i.reject(new vn(mn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new zc(Fi(n.path),r,{includeMetadataChanges:!0,Qa:!0});return Nc(e,o)}(await Il(e),e.asyncQueue,t,n,s))),s.promise}(Wl(t),e._key).then((n=>function(e,t,n){const s=n.docs.get(t._key),i=new Fh(e);return new Oh(e,i,t._key,s,new Dh(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class Fh extends Ph{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jl(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $l(this.firestore,null,t)}}function $h(e){e=Ol(e,Fl);const t=Ol(e.firestore,Gl),n=Wl(t),s=new Fh(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new vn(mn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const s=new bn;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,s,i){const r=new xl({next:n=>{r.xu(),t.enqueueAndForget((()=>jc(e,o))),n.fromCache&&"server"===s.source?i.reject(new vn(mn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new zc(n,r,{includeMetadataChanges:!0,Qa:!0});return Nc(e,o)}(await Il(e),e.asyncQueue,t,n,s))),s.promise}(n,e._query).then((n=>new jh(t,s,e,n)))}function Vh(e,t,n){e=Ol(e,$l);const s=Ol(e.firestore,Gl),i=Lh(e.converter,t,n);return Bh(s,[ah(oh(s),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Cr.none())])}function zh(e,t,n,...s){e=Ol(e,$l);const i=Ol(e.firestore,Gl),r=oh(i);let o;return o="string"==typeof(t=pe(t))||t instanceof Ql?function(e,t,n,s,i,r){const o=e.bc(1,t,n),a=[gh(t,s,n)],c=[i];if(r.length%2!=0)throw new vn(mn.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<r.length;e+=2)a.push(gh(t,r[e])),c.push(r[e+1]);const l=[],h=li.empty();for(let e=a.length-1;e>=0;--e)if(!bh(l,a[e])){const t=a[e];let n=c[e];n=pe(n);const s=o.mc(t);if(n instanceof ch)l.push(t);else{const e=hh(n,s);null!=e&&(l.push(t),h.set(t,e))}}const u=new Ss(l);return new nh(h,u,o.fieldTransforms)}(r,"updateDoc",e._key,t,n,s):function(e,t,n,s){const i=e.bc(1,t,n);ph("Data must be an object, but it was:",i,s);const r=[],o=li.empty();ms(s,((e,s)=>{const a=mh(t,e,n);s=pe(s);const c=i.mc(a);if(s instanceof ch)r.push(a);else{const e=hh(s,c);null!=e&&(r.push(a),o.set(a,e))}}));const a=new Ss(r);return new nh(o,a,i.fieldTransforms)}(r,"updateDoc",e._key,t),Bh(i,[o.toMutation(e._key,Cr.exists(!0))])}function Bh(e,t){return function(e,t){const n=new bn;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const s=vl(e);try{const e=await function(e,t){const n=fn(e),s=Mn.now(),i=t.reduce(((e,t)=>e.add(t.key)),lr());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=er(),c=lr();return n.Bs.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{r=i;const o=[];for(const e of t){const t=Or(e,r.get(e.key).overlayedDocument);null!=t&&o.push(new Mr(e.key,t,hi(t.value.mapValue),Cr.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,o,t)})).next((t=>{o=t;const s=t.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:sr(r)})))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.Au[e.currentUser.toKey()];s||(s=new bs(Rn)),s=s.insert(t,n),e.Au[e.currentUser.toKey()]=s}(s,e.batchId,n),await pl(s,e.changes),await fc(s.remoteStore)}catch(e){const t=Cc(e,"Failed to persist write");n.reject(t)}}(await function(e){return Tl(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Wl(e),t)}function qh(...e){return new lh("arrayUnion",e)}function Hh(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n}new WeakMap,function(e,t=!0){!function(e){rn=e}(Ct),St(new ge("firestore",((e,{instanceIdentifier:n,options:s})=>{const i=e.getProvider("app").getImmediate(),r=new Gl(new _n(e.getProvider("auth-internal")),new Tn(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new vn(mn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fs(e.options.projectId,t)}(i,n),i);return s=Object.assign({useFetchStreams:t},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),Pt(tn,nn,e),Pt(tn,nn,"esm2017")}(),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Kh=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Gh=new ie("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Wh=new Ee("@firebase/auth");function Jh(e,...t){Wh.logLevel<=ye.ERROR&&Wh.error(`Auth (${Ct}): ${e}`,...t)}function Qh(e,...t){throw eu(e,...t)}function Yh(e,...t){return eu(e,...t)}function Xh(e,t,n){const s=Object.assign(Object.assign({},Kh()),{[t]:n});return new ie("auth","Firebase",s).create(t,{appName:e.name})}function Zh(e){return Xh(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eu(e,...t){if("string"!=typeof e){const n=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(n,...s)}return Gh.create(e,...t)}function tu(e,t,...n){if(!e)throw eu(t,...n)}function nu(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Jh(t),new Error(t)}function su(e,t){e||nu(t)}function iu(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function ru(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function ou(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===ru()||"https:"===ru()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class au{constructor(e,t){this.shortDelay=e,this.longDelay=t,su(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(te())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return ou()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function cu(e,t){su(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class lu{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void nu("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void nu("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void nu("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const hu={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},uu=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],du=new au(3e4,6e4);function pu(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function gu(e,t,n,s,i={}){return fu(e,i,(async()=>{let i={},r={};s&&("GET"===t?r=s:i={body:JSON.stringify(s)});const o=ce(Object.assign({key:e.config.apiKey},r)).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:a},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&Q(e.emulatorConfig.host)&&(c.credentials="include"),lu.fetch()(await vu(e,e.config.apiHost,n,o),c)}))}async function fu(e,t,n){e._canInitEmulator=!1;const s=Object.assign(Object.assign({},hu),t);try{const t=new yu(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await i.json();if("needConfirmation"in r)throw wu(e,"account-exists-with-different-credential",r);if(i.ok&&!("errorMessage"in r))return r;{const t=i.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw wu(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw wu(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw wu(e,"user-disabled",r);const a=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Xh(e,a,o);Qh(e,a)}}catch(t){if(t instanceof se)throw t;Qh(e,"network-request-failed",{message:String(t)})}}async function mu(e,t,n,s,i={}){const r=await gu(e,t,n,s,i);return"mfaPendingCredential"in r&&Qh(e,"multi-factor-auth-required",{_serverResponse:r}),r}async function vu(e,t,n,s){const i=`${t}${n}?${s}`,r=e,o=r.config.emulator?cu(e.config,i):`${e.config.apiScheme}://${i}`;return uu.includes(n)&&(await r._persistenceManagerAvailable,"COOKIE"===r._getPersistenceType())?r._getPersistence()._getFinalTarget(o).toString():o}function bu(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class yu{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Yh(this.auth,"network-request-failed"))),du.get())}))}}function wu(e,t,n){const s={appName:e.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const i=Yh(e,t,s);return i.customData._tokenResponse=n,i}function xu(e){return void 0!==e&&void 0!==e.enterprise}class _u{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return bu(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Su(e,t){return gu(e,"GET","/v2/recaptchaConfig",pu(e,t))}async function Eu(e,t){return gu(e,"POST","/v1/accounts:lookup",t)}function ku(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Tu(e){return 1e3*Number(e)}function Iu(e){const[t,n,s]=e.split(".");if(void 0===t||void 0===n||void 0===s)return Jh("JWT malformed, contained fewer than 3 sections"),null;try{const e=q(n);return e?JSON.parse(e):(Jh("Failed to decode base64 JWT payload"),null)}catch(e){return Jh("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function Cu(e){const t=Iu(e);return tu(t,"internal-error"),tu(void 0!==t.exp,"internal-error"),tu(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Au(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof se&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Ru{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Pu{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ku(this.lastLoginAt),this.creationTime=ku(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Lu(e){var t;const n=e.auth,s=await e.getIdToken(),i=await Au(e,Eu(n,{idToken:s}));tu(null==i?void 0:i.users.length,n,"internal-error");const r=i.users[0];e._notifyReloadListener(r);const o=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?Du(r.providerUserInfo):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Pu(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(e,p)}function Du(e){return e.map((e=>{var{providerId:t}=e,n=Hh(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class Ou{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tu(e.idToken,"internal-error"),tu(void 0!==e.idToken,"internal-error"),tu(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Cu(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tu(0!==e.length,"internal-error");const t=Cu(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tu(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:i}=await async function(e,t){const n=await fu(e,{},(async()=>{const n=ce({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:i}=e.config,r=await vu(e,s,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&Q(e.emulatorConfig.host)&&(a.credentials="include"),lu.fetch()(r,a)}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,s,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:i}=t,r=new Ou;return n&&(tu("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),s&&(tu("string"==typeof s,"internal-error",{appName:e}),r.accessToken=s),i&&(tu("number"==typeof i,"internal-error",{appName:e}),r.expirationTime=i),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ou,this.toJSON())}_performRefresh(){return nu("not implemented")}}function Nu(e,t){tu("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ju{constructor(e){var{uid:t,auth:n,stsTokenManager:s}=e,i=Hh(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ru(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Pu(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Au(this,this.stsTokenManager.getToken(this.auth,e));return tu(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=pe(e),s=await n.getIdToken(t),i=Iu(s);tu(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const r="object"==typeof i.firebase?i.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:ku(Tu(i.auth_time)),issuedAtTime:ku(Tu(i.iat)),expirationTime:ku(Tu(i.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=pe(e);await Lu(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(tu(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ju(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){tu(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Lu(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(kt(this.auth.app))return Promise.reject(Zh(this.auth));const e=await this.getIdToken();return await Au(this,async function(e,t){return gu(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,s,i,r,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(s=t.email)&&void 0!==s?s:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(r=t.photoURL)&&void 0!==r?r:void 0,g=null!==(o=t.tenantId)&&void 0!==o?o:void 0,f=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:b,emailVerified:y,isAnonymous:w,providerData:x,stsTokenManager:_}=t;tu(b&&_,e,"internal-error");const S=Ou.fromJSON(this.name,_);tu("string"==typeof b,e,"internal-error"),Nu(h,e.name),Nu(u,e.name),tu("boolean"==typeof y,e,"internal-error"),tu("boolean"==typeof w,e,"internal-error"),Nu(d,e.name),Nu(p,e.name),Nu(g,e.name),Nu(f,e.name),Nu(m,e.name),Nu(v,e.name);const E=new ju({uid:b,auth:e,email:u,emailVerified:y,displayName:h,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:g,stsTokenManager:S,createdAt:m,lastLoginAt:v});return x&&Array.isArray(x)&&(E.providerData=x.map((e=>Object.assign({},e)))),f&&(E._redirectEventId=f),E}static async _fromIdTokenResponse(e,t,n=!1){const s=new Ou;s.updateFromServerResponse(t);const i=new ju({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await Lu(i),i}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];tu(void 0!==s.localId,"internal-error");const i=void 0!==s.providerUserInfo?Du(s.providerUserInfo):[],r=!(s.email&&s.passwordHash||(null==i?void 0:i.length)),o=new Ou;o.updateFromIdToken(n);const a=new ju({uid:s.localId,auth:e,stsTokenManager:o,isAnonymous:r}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Pu(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash||(null==i?void 0:i.length))};return Object.assign(a,c),a}}const Mu=new Map;function Uu(e){su(e instanceof Function,"Expected a class definition");let t=Mu.get(e);return t?(su(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Mu.set(e,t),t)}class Fu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Fu.type="NONE";const $u=Fu;function Vu(e,t,n){return`firebase:${e}:${t}:${n}`}class zu{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:i}=this.auth;this.fullUserKey=Vu(this.userKey,s.apiKey,i),this.fullPersistenceKey=Vu("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await Eu(this.auth,{idToken:e}).catch((()=>{}));return t?ju._fromGetAccountInfoResponse(this.auth,t,e):null}return ju._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new zu(Uu($u),e,n);const s=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=s[0]||Uu($u);const r=Vu(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(r);if(t){let s;if("string"==typeof t){const n=await Eu(e,{idToken:t}).catch((()=>{}));if(!n)break;s=await ju._fromGetAccountInfoResponse(e,n,t)}else s=ju._fromJSON(e,t);n!==i&&(o=s),i=n;break}}catch(e){}const a=s.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(r,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(r)}catch(e){}}))),new zu(i,e,n)):new zu(i,e,n)}}function Bu(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Gu(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(qu(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ju(t))return"Blackberry";if(Qu(t))return"Webos";if(Hu(t))return"Safari";if((t.includes("chrome/")||Ku(t))&&!t.includes("edge/"))return"Chrome";if(Wu(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function qu(e=te()){return/firefox\//i.test(e)}function Hu(e=te()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ku(e=te()){return/crios\//i.test(e)}function Gu(e=te()){return/iemobile/i.test(e)}function Wu(e=te()){return/android/i.test(e)}function Ju(e=te()){return/blackberry/i.test(e)}function Qu(e=te()){return/webos/i.test(e)}function Yu(e=te()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Xu(e=te()){return Yu(e)||Wu(e)||Qu(e)||Ju(e)||/windows phone/i.test(e)||Gu(e)}function Zu(e,t=[]){let n;switch(e){case"Browser":n=Bu(te());break;case"Worker":n=`${Bu(te())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ct}/${s}`}class ed{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,s)=>{try{n(e(t))}catch(e){s(e)}}));n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class td{constructor(e){var t,n,s,i;const r=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=r.minPasswordLength)&&void 0!==t?t:6,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),void 0!==r.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),void 0!==r.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),void 0!==r.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),void 0!==r.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(s=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==s?s:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,s,i,r,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(s=a.containsLowercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(r=a.containsNumericCharacter)||void 0===r||r),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class nd{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new id(this),this.idTokenSubscription=new id(this),this.beforeStateQueue=new ed(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Gh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Uu(t)),this._initializationPromise=this.queue((async()=>{var n,s,i;if(!this._deleted&&(this.persistenceManager=await zu.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(s=this._popupRedirectResolver)||void 0===s?void 0:s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Eu(this,{idToken:e}),n=await ju._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(kt(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let s=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==s?void 0:s._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null==o?void 0:o.user)||(s=o.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return tu(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Lu(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(kt(this.app))return Promise.reject(Zh(this));const t=e?pe(e):null;return t&&tu(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tu(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return kt(this.app)?Promise.reject(Zh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return kt(this.app)?Promise.reject(Zh(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Uu(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return gu(e,"GET","/v2/passwordPolicy",pu(e,t))}(this),t=new td(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ie("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return gu(e,"POST","/v2/accounts:revokeToken",pu(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Uu(e)||this._popupRedirectResolver;tu(t,this,"argument-error"),this.redirectPersistenceManager=await zu.create(this,[Uu(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let r=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(tu(o,this,"internal-error"),o.then((()=>{r||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,s);return()=>{r=!0,i()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tu(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Zu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;if(kt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Wh.logLevel<=ye.WARN&&Wh.warn(`Auth (${Ct}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function sd(e){return pe(e)}class id{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new ue(e,void 0);return t.subscribe.bind(t)}((e=>this.observer=e))}get next(){return tu(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let rd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function od(e){return rd.loadJS(e)}function ad(e){return`__${e}${Math.floor(1e6*Math.random())}`}class cd{constructor(){this.enterprise=new ld}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ld{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const hd="NO_RECAPTCHA";class ud{constructor(e){this.type="recaptcha-enterprise",this.auth=sd(e)}async verify(e="verify",t=!1){function n(t,n,s){const i=window.grecaptcha;xu(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(hd)}))})):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new cd).execute("siteKey",{action:"verify"}):new Promise(((e,s)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{Su(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((s=>{if(void 0!==s.recaptchaKey){const n=new _u(s);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&xu(window.grecaptcha))n(i,e,s);else{if("undefined"==typeof window)return void s(new Error("RecaptchaVerifier is only supported in browser"));let t=rd.recaptchaEnterpriseScript;0!==t.length&&(t+=i),od(t).then((()=>{n(i,e,s)})).catch((e=>{s(e)}))}})).catch((e=>{s(e)}))}))}}async function dd(e,t,n,s=!1,i=!1){const r=new ud(e);let o;if(i)o=hd;else try{o=await r.verify(n)}catch(e){o=await r.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function pd(e,t,n,s,i){var r,o;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await dd(e,t,n,"getOobCode"===n);return s(e,i)}return s(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await dd(e,t,n,"getOobCode"===n);return s(e,i)}return Promise.reject(i)}))}if("PHONE_PROVIDER"===i){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const i=await dd(e,t,n);return s(e,i).catch((async i=>{var r;if("AUDIT"===(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const i=await dd(e,t,n,!1,!0);return s(e,i)}return Promise.reject(i)}))}{const i=await dd(e,t,n,!1,!0);return s(e,i)}}return Promise.reject(i+" provider is not supported.")}function gd(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function fd(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class md{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return nu("not implemented")}_getIdTokenResponse(e){return nu("not implemented")}_linkToIdToken(e,t){return nu("not implemented")}_getReauthenticationResolver(e){return nu("not implemented")}}async function vd(e,t){return gu(e,"POST","/v1/accounts:signUp",t)}async function bd(e,t){return mu(e,"POST","/v1/accounts:signInWithPassword",pu(e,t))}class yd extends md{constructor(e,t,n,s=null){super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new yd(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new yd(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return pd(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",bd,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return mu(e,"POST","/v1/accounts:signInWithEmailLink",pu(e,t))}(e,{email:this._email,oobCode:this._password});default:Qh(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return pd(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",vd,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return mu(e,"POST","/v1/accounts:signInWithEmailLink",pu(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Qh(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function wd(e,t){return mu(e,"POST","/v1/accounts:signInWithIdp",pu(e,t))}class xd extends md{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new xd(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Qh("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s}=t,i=Hh(t,["providerId","signInMethod"]);if(!n||!s)return null;const r=new xd(n,s);return r.idToken=i.idToken||void 0,r.accessToken=i.accessToken||void 0,r.secret=i.secret,r.nonce=i.nonce,r.pendingToken=i.pendingToken||null,r}_getIdTokenResponse(e){return wd(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,wd(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,wd(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ce(t)}return e}}async function _d(e,t){return gu(e,"POST","/v1/accounts:sendVerificationCode",pu(e,t))}const Sd={USER_NOT_FOUND:"user-not-found"};class Ed extends md{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ed({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ed({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return mu(e,"POST","/v1/accounts:signInWithPhoneNumber",pu(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await mu(e,"POST","/v1/accounts:signInWithPhoneNumber",pu(e,t));if(n.temporaryProof)throw wu(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return mu(e,"POST","/v1/accounts:signInWithPhoneNumber",pu(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Sd)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:s,temporaryProof:i}=e;return n||t||s||i?new Ed({verificationId:t,verificationCode:n,phoneNumber:s,temporaryProof:i}):null}}class kd{constructor(e){var t,n,s,i,r,o;const a=le(he(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(s=a.mode)&&void 0!==s?s:null);tu(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(r=a.lang)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=le(he(e)).link,n=t?le(he(t)).deep_link_id:null,s=le(he(e)).deep_link_id;return(s?le(he(s)).link:null)||s||n||t||e}(e);try{return new kd(t)}catch(e){return null}}}class Td{constructor(){this.providerId=Td.PROVIDER_ID}static credential(e,t){return yd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=kd.parseLink(t);return tu(n,"argument-error"),yd._fromEmailAndCode(e,n.code,n.tenantId)}}Td.PROVIDER_ID="password",Td.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Td.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Id{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Cd extends Id{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ad extends Cd{constructor(){super("facebook.com")}static credential(e){return xd._fromParams({providerId:Ad.PROVIDER_ID,signInMethod:Ad.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ad.credentialFromTaggedObject(e)}static credentialFromError(e){return Ad.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ad.credential(e.oauthAccessToken)}catch(e){return null}}}Ad.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ad.PROVIDER_ID="facebook.com";class Rd extends Cd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return xd._fromParams({providerId:Rd.PROVIDER_ID,signInMethod:Rd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Rd.credentialFromTaggedObject(e)}static credentialFromError(e){return Rd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Rd.credential(t,n)}catch(e){return null}}}Rd.GOOGLE_SIGN_IN_METHOD="google.com",Rd.PROVIDER_ID="google.com";class Pd extends Cd{constructor(){super("github.com")}static credential(e){return xd._fromParams({providerId:Pd.PROVIDER_ID,signInMethod:Pd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pd.credentialFromTaggedObject(e)}static credentialFromError(e){return Pd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Pd.credential(e.oauthAccessToken)}catch(e){return null}}}Pd.GITHUB_SIGN_IN_METHOD="github.com",Pd.PROVIDER_ID="github.com";class Ld extends Cd{constructor(){super("twitter.com")}static credential(e,t){return xd._fromParams({providerId:Ld.PROVIDER_ID,signInMethod:Ld.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ld.credentialFromTaggedObject(e)}static credentialFromError(e){return Ld.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ld.credential(t,n)}catch(e){return null}}}async function Dd(e,t){return mu(e,"POST","/v1/accounts:signUp",pu(e,t))}Ld.TWITTER_SIGN_IN_METHOD="twitter.com",Ld.PROVIDER_ID="twitter.com";class Od{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,s=!1){const i=await ju._fromIdTokenResponse(e,n,s),r=Nd(n);return new Od({user:i,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=Nd(n);return new Od({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function Nd(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class jd extends se{constructor(e,t,n,s){var i;super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,jd.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new jd(e,t,n,s)}}function Md(e,t,n,s){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw jd._fromErrorAndOperation(e,n,t,s);throw n}))}async function Ud(e,t,n=!1){if(kt(e.app))return Promise.reject(Zh(e));const s="signIn",i=await Md(e,s,t),r=await Od._fromIdTokenResponse(e,s,i);return n||await e._updateCurrentUser(r.user),r}async function Fd(e){const t=sd(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function $d(e,t){return gu(e,"POST","/v2/accounts/mfaEnrollment:start",pu(e,t))}new WeakMap;const Vd="__sak";class zd{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Vd,"1"),this.storage.removeItem(Vd),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Bd extends zd{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Xu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=te();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?s():setTimeout(s,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Bd.type="LOCAL";const qd=Bd;class Hd extends zd{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Hd.type="SESSION";const Kd=Hd;class Gd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Gd(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:i}=t.data,r=this.handlersMap[s];if(!(null==r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const o=Array.from(r).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Wd(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Gd.receivers=[];class Jd{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,r;return new Promise(((o,a)=>{const c=Wd("",20);s.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:s,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(l),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function Qd(){return window}function Yd(){return void 0!==Qd().WorkerGlobalScope&&"function"==typeof Qd().importScripts}const Xd="firebaseLocalStorageDb",Zd="firebaseLocalStorage",ep="fbase_key";class tp{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function np(e,t){return e.transaction([Zd],t?"readwrite":"readonly").objectStore(Zd)}function sp(){const e=indexedDB.open(Xd,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Zd,{keyPath:ep})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Zd)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Xd);return new tp(e).toPromise()}(),t(await sp()))}))}))}async function ip(e,t,n){const s=np(e,!0).put({[ep]:t,value:n});return new tp(s).toPromise()}function rp(e,t){const n=np(e,!0).delete(t);return new tp(n).toPromise()}class op{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await sp()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Yd()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Gd._getInstance(Yd()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Jd(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await sp();return await ip(e,Vd,"1"),await rp(e,Vd),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>ip(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=np(e,!1).get(t),s=await new tp(n).toPromise();return void 0===s?null:s.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>rp(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=np(e,!1).getAll();return new tp(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:s,value:i}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}op.type="LOCAL";const ap=op;function cp(e,t){return gu(e,"POST","/v2/accounts/mfaSignIn:start",pu(e,t))}ad("rcb"),new au(3e4,6e4);const lp="recaptcha";async function hp(e,t,n){var s;if(!e._getRecaptchaConfig())try{await async function(e){const t=sd(e),n=await Su(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),s=new _u(n);null==t.tenantId?t._agentRecaptchaConfig=s:t._tenantRecaptchaConfigs[t.tenantId]=s,s.isAnyProviderEnabled()&&new ud(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){tu("enroll"===t.type,e,"internal-error");const s=pd(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",(async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===hd?(tu((null==n?void 0:n.type)===lp,e,"argument-error"),$d(e,await up(e,t,n))):$d(e,t)),"PHONE_PROVIDER");return(await s.catch((e=>Promise.reject(e)))).phoneSessionInfo.sessionInfo}{tu("signin"===t.type,e,"internal-error");const r=(null===(s=i.multiFactorHint)||void 0===s?void 0:s.uid)||i.multiFactorUid;tu(r,e,"missing-multi-factor-info");const o=pd(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:r,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",(async(e,t)=>t.phoneSignInInfo.captchaResponse===hd?(tu((null==n?void 0:n.type)===lp,e,"argument-error"),cp(e,await up(e,t,n))):cp(e,t)),"PHONE_PROVIDER");return(await o.catch((e=>Promise.reject(e)))).phoneResponseInfo.sessionInfo}}{const t=pd(e,{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",(async(e,t)=>t.captchaResponse===hd?(tu((null==n?void 0:n.type)===lp,e,"argument-error"),_d(e,await up(e,t,n))):_d(e,t)),"PHONE_PROVIDER");return(await t.catch((e=>Promise.reject(e)))).sessionInfo}}finally{null==n||n._reset()}}async function up(e,t,n){tu(n.type===lp,e,"argument-error");const s=await n.verify();tu("string"==typeof s,e,"argument-error");const i=Object.assign({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,r=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:s,captchaResponse:t,clientType:n,recaptchaVersion:r}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:s,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:s}),i}class dp{constructor(e){this.providerId=dp.PROVIDER_ID,this.auth=sd(e)}verifyPhoneNumber(e,t){return hp(this.auth,e,pe(t))}static credential(e,t){return Ed._fromVerification(e,t)}static credentialFromResult(e){const t=e;return dp.credentialFromTaggedObject(t)}static credentialFromError(e){return dp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ed._fromTokenResponse(t,n):null}}dp.PROVIDER_ID="phone",dp.PHONE_SIGN_IN_METHOD="phone";class pp extends md{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return wd(e,this._buildIdpRequest())}_linkToIdToken(e,t){return wd(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return wd(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function gp(e){return Ud(e.auth,new pp(e),e.bypassAuthState)}function fp(e){const{auth:t,user:n}=e;return tu(n,t,"internal-error"),async function(e,t,n=!1){const{auth:s}=e;if(kt(s.app))return Promise.reject(Zh(s));const i="reauthenticate";try{const r=await Au(e,Md(s,i,t,e),n);tu(r.idToken,s,"internal-error");const o=Iu(r.idToken);tu(o,s,"internal-error");const{sub:a}=o;return tu(e.uid===a,s,"user-mismatch"),Od._forOperation(e,i,r)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Qh(s,"user-mismatch"),e}}(n,new pp(e),e.bypassAuthState)}async function mp(e){const{auth:t,user:n}=e;return tu(n,t,"internal-error"),async function(e,t,n=!1){const s=await Au(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Od._forOperation(e,"link",s)}(n,new pp(e),e.bypassAuthState)}class vp{constructor(e,t,n,s,i=!1){this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:i,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return gp;case"linkViaPopup":case"linkViaRedirect":return mp;case"reauthViaPopup":case"reauthViaRedirect":return fp;default:Qh(this.auth,"internal-error")}}resolve(e){su(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){su(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const bp=new au(2e3,1e4);class yp extends vp{constructor(e,t,n,s,i){super(e,t,s,i),this.provider=n,this.authWindow=null,this.pollId=null,yp.currentPopupAction&&yp.currentPopupAction.cancel(),yp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return tu(e,this.auth,"internal-error"),e}async onExecution(){su(1===this.filter.length,"Popup operations only handle one event");const e=Wd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Yh(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Yh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Yh(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,bp.get())};e()}}yp.currentPopupAction=null;const wp=new Map;class xp extends vp{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=wp.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Vu("pendingRedirect",e.config.apiKey,e.name)}(t),s=function(e){return Uu(e._redirectPersistence)}(e);if(!await s._isAvailable())return!1;const i="true"===await s._get(n);return await s._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}wp.set(this.auth._key(),e)}return this.bypassAuthState||wp.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function _p(e,t){wp.set(e._key(),t)}async function Sp(e,t,n=!1){if(kt(e.app))return Promise.reject(Zh(e));const s=sd(e),i=function(e,t){return t?Uu(t):(tu(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(s,t),r=new xp(s,i,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,t)),o}class Ep{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Tp(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Tp(e)){const s=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Yh(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(kp(e))}saveEventToCache(e){this.cachedEventUids.add(kp(e)),this.lastProcessedEventTime=Date.now()}}function kp(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Tp({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Ip=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Cp=/^https?/;function Ap(e){const t=iu(),{protocol:n,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===s?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===s}if(!Cp.test(n))return!1;if(Ip.test(e))return s===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}const Rp=new au(3e4,6e4);function Pp(){const e=Qd().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Lp(e){return new Promise(((t,n)=>{var s,i,r;function o(){Pp(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Pp(),n(Yh(e,"network-request-failed"))},timeout:Rp.get()})}if(null===(i=null===(s=Qd().gapi)||void 0===s?void 0:s.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=Qd().gapi)||void 0===r?void 0:r.load)){const t=ad("iframefcb");return Qd()[t]=()=>{gapi.load?o():n(Yh(e,"network-request-failed"))},od(`${rd.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Dp=null,e}))}let Dp=null;const Op=new au(5e3,15e3),Np={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},jp=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Mp(e){const t=e.config;tu(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?cu(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:Ct},i=jp.get(e.config.apiHost);i&&(s.eid=i);const r=e._getFrameworks();return r.length&&(s.fw=r.join(",")),`${n}?${ce(s).slice(1)}`}const Up={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Fp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const $p=encodeURIComponent("fac");async function Vp(e,t,n,s,i,r){tu(e.config.authDomain,e,"auth-domain-config-required"),tu(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:Ct,eventId:i};if(t instanceof Id){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(r||{}))o[e]=t}if(t instanceof Cd){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),l=c?`#${$p}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?cu(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${ce(a).slice(1)}${l}`}const zp="webStorageSupport",Bp=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Kd,this._completeRedirectFn=Sp,this._overrideRedirectResult=_p}async _openPopup(e,t,n,s){var i;return su(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,s=500,i=600){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Up),{width:s.toString(),height:i.toString(),top:r,left:o}),l=te().toLowerCase();n&&(a=Ku(l)?"_blank":n),qu(l)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=te()){var t;return Yu(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}(t||"",a),new Fp(null);const u=window.open(t||"",a,h);tu(u,e,"popup-blocked");try{u.focus()}catch(e){}return new Fp(u)}(e,await Vp(e,t,n,iu(),s),Wd())}async _openRedirect(e,t,n,s){return await this._originValidation(e),i=await Vp(e,t,n,iu(),s),Qd().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(su(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Dp=Dp||Lp(e),Dp}(e),n=Qd().gapi;return tu(n,e,"internal-error"),t.open({where:document.body,url:Mp(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Np,dontclear:!0},(t=>new Promise((async(n,s)=>{await t.restyle({setHideOnLeave:!1});const i=Yh(e,"network-request-failed"),r=Qd().setTimeout((()=>{s(i)}),Op.get());function o(){Qd().clearTimeout(r),n(t)}t.ping(o).then(o,(()=>{s(i)}))}))))}(e),n=new Ep(e);return t.register("authEvent",(t=>(tu(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(zp,{type:zp},(n=>{var s;const i=null===(s=null==n?void 0:n[0])||void 0===s?void 0:s[zp];void 0!==i&&t(!!i),Qh(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return gu(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Ap(e))return}catch(e){}Qh(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xu()||Hu()||Yu()}};var qp="@firebase/auth",Hp="1.10.7";class Kp{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tu(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Gp=W("authIdTokenMaxAge")||300;let Wp=null;var Jp;rd={loadJS:e=>new Promise(((t,n)=>{const s=document.createElement("script");var i,r;s.setAttribute("src",e),s.onload=t,s.onerror=e=>{const t=Yh("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(null!==(r=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==r?r:document).appendChild(s)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Jp="Browser",St(new ge("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:r,authDomain:o}=n.options;tu(r&&!r.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:r,authDomain:o,clientPlatform:Jp,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zu(Jp)},c=new nd(n,s,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],s=(Array.isArray(n)?n:[n]).map(Uu);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),St(new ge("auth-internal",(e=>(e=>new Kp(e))(sd(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Pt(qp,Hp,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Jp)),Pt(qp,Hp,"esm2017");const Qp=At({apiKey:"AIzaSyBjPD4_kmHnQRDDyhwX51Zu0iiowlt54XA",authDomain:"nexo-2d650.firebaseapp.com",projectId:"nexo-2d650",storageBucket:"nexo-2d650.firebasestorage.app",messagingSenderId:"561680150156",appId:"1:561680150156:web:392db0b22394775633d5a9",measurementId:"G-XH7LZ775HR"}),Yp=function(e){const t="object"==typeof e?e:Rt(),n="string"==typeof e?e:Us,s=Et(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const e=(()=>{const e=K("firestore");if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),n]:[e.substring(0,t),n]})();e&&function(e,t,n,s={}){var i;e=Ol(e,Ul);const r=Q(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),c=`${t}:${n}`;r&&(Y(`https://${c}`),ee("Firestore",!0)),o.host!==Nl&&o.host!==c&&hn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},o),{host:c,ssl:r,emulatorOptions:s});if(!oe(l,a)&&(e._setSettings(l),s.mockUserToken)){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=sn.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[B(JSON.stringify({alg:"none",type:"JWT"})),B(JSON.stringify(r)),""].join(".")}(s.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new vn(mn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new sn(r)}e._authCredentials=new xn(new yn(t,n))}}(s,...e)}return s}(Qp),Xp=function(e=Rt()){const t=Et(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Et(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(oe(n.getOptions(),null!=t?t:{}))return e;Qh(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Bp,persistence:[ap,qd,Kd]}),s=W("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(s,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Gp)return;const s=null==t?void 0:t.token;Wp!==s&&(Wp=s,await fetch(i,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});!function(e,t,n){pe(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e){pe(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}var i;const r=K("auth");return r&&function(e,t,n){const s=sd(e);tu(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),r=gd(t),{host:o,port:a}=function(e){const t=gd(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const e=i[1];return{host:e,port:fd(s.substr(e.length+1))}}{const[e,t]=s.split(":");return{host:e,port:fd(t)}}}(t),c=null===a?"":`:${a}`,l={url:`${r}//${o}${c}/`},h=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!s._canInitEmulator)return tu(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),void tu(oe(l,s.config.emulator)&&oe(h,s.emulatorConfig),s,"emulator-config-failed");s.config.emulator=l,s.emulatorConfig=h,s.settings.appVerificationDisabledForTesting=!0,Q(o)?(Y(`${r}//${o}${c}`),ee("Auth",!0)):i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}(Qp),Zp=async(e,t)=>{try{console.log("Logging in user with username:",e);const n=Eh(zl(Yp,"users"),Th("username","==",e)),s=await $h(n);if(s.empty)return{isLoggedIn:!1,error:"User not found"};const i=s.docs[0].data(),r=await function(e,t,n){return kt(e.app)?Promise.reject(Zh(e)):async function(e,t){return Ud(sd(e),t)}(pe(e),Td.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Fd(e),t}))}(Xp,i.email,t);return console.log(r.user),{isLoggedIn:!0,user:r}}catch(e){return console.error(e),{isLoggedIn:!1,error:e}}};class eg extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class tg extends eg{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ng extends eg{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class sg extends eg{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ig;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(ig||(ig={}));class rg{constructor(e,{headers:t={},customFetch:s,region:i=ig.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(n.bind(n,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n,s,i,r,o;return s=this,i=void 0,o=function*(){try{const{headers:s,method:i,body:r}=t;let o,a={},{region:c}=t;c||(c=this.region),c&&"any"!==c&&(a["x-region"]=c),r&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&r instanceof Blob||r instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",o=r):"string"==typeof r?(a["Content-Type"]="text/plain",o=r):"undefined"!=typeof FormData&&r instanceof FormData?o=r:(a["Content-Type"]="application/json",o=JSON.stringify(r)));const l=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:o}).catch((e=>{throw new tg(e)})),h=l.headers.get("x-relay-error");if(h&&"true"===h)throw new ng(l);if(!l.ok)throw new sg(l);let u,d=(null!==(n=l.headers.get("Content-Type"))&&void 0!==n?n:"text/plain").split(";")[0].trim();return u="application/json"===d?yield l.json():"application/octet-stream"===d?yield l.blob():"text/event-stream"===d?l:"multipart/form-data"===d?yield l.formData():yield l.text(),{data:u,error:null}}catch(e){return{data:null,error:e}}},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof r?s:new r((function(e){e(s)}))).then(n,a)}c((o=o.apply(s,i||[])).next())}))}}var og=n(279);const{PostgrestClient:ag,PostgrestQueryBuilder:cg,PostgrestFilterBuilder:lg,PostgrestTransformBuilder:hg,PostgrestBuilder:ug,PostgrestError:dg}=og;let pg;pg="undefined"==typeof window?n(591):window.WebSocket;const gg=pg,fg={"X-Client-Info":"realtime-js/2.11.10"};var mg,vg,bg,yg,wg,xg,_g;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(mg||(mg={})),(_g=vg||(vg={})).closed="closed",_g.errored="errored",_g.joined="joined",_g.joining="joining",_g.leaving="leaving",function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(bg||(bg={})),function(e){e.websocket="websocket"}(yg||(yg={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(wg||(wg={}));class Sg{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),i=t.getUint8(2);let r=this.HEADER_LENGTH+2;const o=n.decode(e.slice(r,r+s));r+=s;const a=n.decode(e.slice(r,r+i));return r+=i,{ref:null,topic:o,event:a,payload:JSON.parse(n.decode(e.slice(r,e.byteLength)))}}}class Eg{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(xg||(xg={}));const kg=(e,t,n={})=>{var s;const i=null!==(s=n.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce(((n,s)=>(n[s]=Tg(s,e,t,i),n)),{})},Tg=(e,t,n,s)=>{const i=t.find((t=>t.name===e)),r=null==i?void 0:i.type,o=n[e];return r&&!s.includes(r)?Ig(r,o):Cg(o)},Ig=(e,t)=>{if("_"===e.charAt(0)){const n=e.slice(1,e.length);return Lg(t,n)}switch(e){case xg.bool:return Ag(t);case xg.float4:case xg.float8:case xg.int2:case xg.int4:case xg.int8:case xg.numeric:case xg.oid:return Rg(t);case xg.json:case xg.jsonb:return Pg(t);case xg.timestamp:return Dg(t);case xg.abstime:case xg.date:case xg.daterange:case xg.int4range:case xg.int8range:case xg.money:case xg.reltime:case xg.text:case xg.time:case xg.timestamptz:case xg.timetz:case xg.tsrange:case xg.tstzrange:default:return Cg(t)}},Cg=e=>e,Ag=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Rg=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Pg=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Lg=(e,t)=>{if("string"!=typeof e)return e;const n=e.length-1,s=e[n];if("{"===e[0]&&"}"===s){let s;const i=e.slice(1,n);try{s=JSON.parse("["+i+"]")}catch(e){s=i?i.split(","):[]}return s.map((e=>Ig(t,e)))}return e},Dg=e=>"string"==typeof e?e.replace(" ","T"):e,Og=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Ng{constructor(e,t,n={},s=1e4){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var jg,Mg,Ug,Fg;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(jg||(jg={}));class $g{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},(e=>{const{onJoin:t,onLeave:n,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=$g.syncState(this.state,e,t,n),this.pendingDiffs.forEach((e=>{this.state=$g.syncDiff(this.state,e,t,n)})),this.pendingDiffs=[],s()})),this.channel._on(n.diff,{},(e=>{const{onJoin:t,onLeave:n,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=$g.syncDiff(this.state,e,t,n),s())})),this.onJoin(((e,t,n)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})})),this.onLeave(((e,t,n)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,n,s){const i=this.cloneDeep(e),r=this.transformState(t),o={},a={};return this.map(i,((e,t)=>{r[e]||(a[e]=t)})),this.map(r,((e,t)=>{const n=i[e];if(n){const s=t.map((e=>e.presence_ref)),i=n.map((e=>e.presence_ref)),r=t.filter((e=>i.indexOf(e.presence_ref)<0)),c=n.filter((e=>s.indexOf(e.presence_ref)<0));r.length>0&&(o[e]=r),c.length>0&&(a[e]=c)}else o[e]=t})),this.syncDiff(i,{joins:o,leaves:a},n,s)}static syncDiff(e,t,n,s){const{joins:i,leaves:r}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,((t,s)=>{var i;const r=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(s),r.length>0){const n=e[t].map((e=>e.presence_ref)),s=r.filter((e=>n.indexOf(e.presence_ref)<0));e[t].unshift(...s)}n(t,r,s)})),this.map(r,((t,n)=>{let i=e[t];if(!i)return;const r=n.map((e=>e.presence_ref));i=i.filter((e=>r.indexOf(e.presence_ref)<0)),e[t]=i,s(t,i,n),0===i.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((n=>t(n,e[n])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,n)=>{const s=e[n];return t[n]="metas"in s?s.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):s,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Mg||(Mg={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(Ug||(Ug={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Fg||(Fg={}));class Vg{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=vg.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ng(this,bg.join,this.params,this.timeout),this.rejoinTimer=new Eg((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=vg.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=vg.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=vg.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=vg.errored,this.rejoinTimer.scheduleTimeout())})),this._on(bg.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new $g(this),this.broadcastEndpointURL=Og(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:r,private:o}}=this.params;this._onError((t=>null==e?void 0:e(Fg.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(Fg.CLOSED)));const a={},c={broadcast:i,presence:r,postgres_changes:null!==(s=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map((e=>e.filter)))&&void 0!==s?s:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var n;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,i=null!==(n=null==s?void 0:s.length)&&void 0!==n?n:0,r=[];for(let n=0;n<i;n++){const i=s[n],{filter:{event:o,schema:a,table:c,filter:l}}=i,h=t&&t[n];if(!h||h.event!==o||h.schema!==a||h.table!==c||h.filter!==l)return this.unsubscribe(),this.state=vg.errored,void(null==e||e(Fg.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));r.push(Object.assign(Object.assign({},i),{id:h.id}))}return this.bindings.postgres_changes=r,void(e&&e(Fg.SUBSCRIBED))}null==e||e(Fg.SUBSCRIBED)})).receive("error",(t=>{this.state=vg.errored,null==e||e(Fg.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(Fg.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this._on(e,t,n)}async send(e,t={}){var n,s;if(this._canPush()||"broadcast"!==e.type)return new Promise((n=>{var s,i,r;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(r=null===(i=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===i?void 0:i.broadcast)||void 0===r?void 0:r.ack)||n("ok"),o.receive("ok",(()=>n("ok"))),o.receive("error",(()=>n("error"))),o.receive("timeout",(()=>n("timed out")))}));{const{event:i,payload:r}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:r,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(n=t.timeout)&&void 0!==n?n:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=vg.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(bg.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise((n=>{const s=new Ng(this,bg.leave,{},e);s.receive("ok",(()=>{t(),n("ok")})).receive("timeout",(()=>{t(),n("timed out")})).receive("error",(()=>{n("error")})),s.send(),this._canPush()||s.trigger("ok",{})}))}teardown(){this.pushBuffer.forEach((e=>e.destroy())),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,n){const s=new AbortController,i=setTimeout((()=>s.abort()),n),r=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),r}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ng(this,e,t,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;const r=e.toLocaleLowerCase(),{close:o,error:a,leave:c,join:l}=bg;if(n&&[o,a,c,l].indexOf(r)>=0&&n!==this._joinRef())return;let h=this._onMessage(r,t,n);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(r)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter((e=>{var t,n,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===s?void 0:s.toLocaleLowerCase())===r})).map((e=>e.callback(h,n))):null===(i=this.bindings[r])||void 0===i||i.filter((e=>{var n,s,i,o,a,c;if(["broadcast","presence","postgres_changes"].includes(r)){if("id"in e){const r=e.id,o=null===(n=e.filter)||void 0===n?void 0:n.event;return r&&(null===(s=t.ids)||void 0===s?void 0:s.includes(r))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const n=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===n||n===(null===(c=null==t?void 0:t.event)||void 0===c?void 0:c.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===r})).map((e=>{if("object"==typeof h&&"ids"in h){const e=h.data,{schema:t,table:n,commit_timestamp:s,type:i,errors:r}=e,o={schema:t,table:n,commit_timestamp:s,eventType:i,new:{},old:{},errors:r};h=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(h,n)}))}_isClosed(){return this.state===vg.closed}_isJoined(){return this.state===vg.joined}_isJoining(){return this.state===vg.joining}_isLeaving(){return this.state===vg.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter((e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===n&&Vg.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(bg.close,{},e)}_onError(e){this._on(bg.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=vg.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=kg(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=kg(e.columns,e.old_record)),t}}const zg=()=>{};class Bg{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=fg,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=zg,this.ref=0,this.logger=zg,this.conn=null,this.sendBuffer=[],this.serializer=new Sg,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(n.bind(n,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${yg.websocket}`,this.httpEndpoint=Og(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),((null==t?void 0:t.logLevel)||(null==t?void 0:t.log_level))&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Eg((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=gg),this.transport){const e="undefined"!=typeof window&&this.transport===window.WebSocket;return this.conn=e?new this.transport(this.endpointURL()):new this.transport(this.endpointURL(),void 0,{headers:this.headers}),void this.setupConnection()}this.conn=new qg(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach((e=>e.teardown())))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels=this.channels.filter((t=>t._joinRef!==e._joinRef)),0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case mg.connecting:return wg.Connecting;case mg.open:return wg.Open;case mg.closing:return wg.Closing;default:return wg.Closed}}isConnected(){return this.connectionState()===wg.Open}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find((e=>e.topic===n));if(s)return s;{const n=new Vg(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:n,payload:s,ref:i}=e,r=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${n} (${i})`,s),this.isConnected()?r():this.sendBuffer.push(r)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t,version:this.headers&&this.headers["X-Client-Info"]}),e.joinedOnce&&e._isJoined()&&e._push(bg.access_token,{access_token:t})})))}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t.topic!==e.topic))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:n,payload:s,ref:i}=e;"phoenix"===t&&"phx_reply"===n&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${n} ${i&&"("+i+")"||""}`,s),Array.from(this.channels).filter((e=>e._isMember(t))).forEach((e=>e._trigger(n,s,i))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(bg.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\?/)?"&":"?";return`${e}${n}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class qg{constructor(e,t,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=mg.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class Hg extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Kg(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Gg extends Hg{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Wg extends Hg{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const Jg=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(n.bind(n,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Qg=e=>{if(Array.isArray(e))return e.map((e=>Qg(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,n])=>{const s=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[s]=Qg(n)})),t};var Yg=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const Xg=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Zg=(e,t,s)=>Yg(void 0,void 0,void 0,(function*(){const i=yield(r=void 0,o=void 0,a=void 0,c=function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(n.bind(n,907))).Response:Response},new(a||(a=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function s(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(n,s)}i((c=c.apply(r,o||[])).next())})));var r,o,a,c;e instanceof i&&!(null==s?void 0:s.noResolveJson)?e.json().then((n=>{t(new Gg(Xg(n),e.status||500))})).catch((e=>{t(new Wg(Xg(e),e))})):t(new Wg(Xg(e),e))}));function ef(e,t,n,s,i,r){return Yg(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{e(n,((e,t,n,s)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),s&&(i.body=JSON.stringify(s)),Object.assign(Object.assign({},i),n))})(t,s,i,r)).then((e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()})).then((e=>o(e))).catch((e=>Zg(e,a,s)))}))}))}function tf(e,t,n,s){return Yg(this,void 0,void 0,(function*(){return ef(e,"GET",t,n,s)}))}function nf(e,t,n,s,i){return Yg(this,void 0,void 0,(function*(){return ef(e,"POST",t,s,i,n)}))}function sf(e,t,n,s,i){return Yg(this,void 0,void 0,(function*(){return ef(e,"DELETE",t,s,i,n)}))}var rf=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const of={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},af={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class cf{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Jg(s)}uploadOrUpdate(e,t,n,s){return rf(this,void 0,void 0,(function*(){try{let i;const r=Object.assign(Object.assign({},af),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(r.upsert)});const a=r.metadata;"undefined"!=typeof Blob&&n instanceof Blob?(i=new FormData,i.append("cacheControl",r.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(i=n,i.append("cacheControl",r.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=n,o["cache-control"]=`max-age=${r.cacheControl}`,o["content-type"]=r.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const c=this._removeEmptyFolders(t),l=this._getFinalPath(c),h=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:i,headers:o},(null==r?void 0:r.duplex)?{duplex:r.duplex}:{})),u=yield h.json();return h.ok?{data:{path:c,id:u.Id,fullPath:u.Key},error:null}:{data:null,error:u}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}upload(e,t,n){return rf(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,n)}))}uploadToSignedUrl(e,t,n,s){return rf(this,void 0,void 0,(function*(){const i=this._removeEmptyFolders(e),r=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${r}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:af.upsert},s),r=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&n instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(e=n,e.append("cacheControl",t.cacheControl)):(e=n,r["cache-control"]=`max-age=${t.cacheControl}`,r["content-type"]=t.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:e,headers:r}),c=yield a.json();return a.ok?{data:{path:i,fullPath:c.Key},error:null}:{data:null,error:c}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}createSignedUploadUrl(e,t){return rf(this,void 0,void 0,(function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const i=yield nf(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),r=new URL(this.url+i.url),o=r.searchParams.get("token");if(!o)throw new Hg("No token returned by API");return{data:{signedUrl:r.toString(),path:e,token:o},error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}update(e,t,n){return rf(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,n)}))}move(e,t,n){return rf(this,void 0,void 0,(function*(){try{return{data:yield nf(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==n?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}copy(e,t,n){return rf(this,void 0,void 0,(function*(){try{return{data:{path:(yield nf(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==n?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}createSignedUrl(e,t,n){return rf(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e),i=yield nf(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==n?void 0:n.transform)?{transform:n.transform}:{}),{headers:this.headers});const r=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${r}`)},{data:i,error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}createSignedUrls(e,t,n){return rf(this,void 0,void 0,(function*(){try{const s=yield nf(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return{data:s.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null}))),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}download(e,t){return rf(this,void 0,void 0,(function*(){const n=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield tf(this.fetch,`${this.url}/${n}/${t}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}info(e){return rf(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield tf(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Qg(e),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}exists(e){return rf(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,n){return Yg(this,void 0,void 0,(function*(){return ef(e,"HEAD",t,Object.assign(Object.assign({},n),{noResolveJson:!0}),undefined)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(Kg(e)&&e instanceof Wg){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}))}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&s.push(i);const r=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${r}/public/${n}${a}`)}}}remove(e){return rf(this,void 0,void 0,(function*(){try{return{data:yield sf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}list(e,t,n){return rf(this,void 0,void 0,(function*(){try{const s=Object.assign(Object.assign(Object.assign({},of),t),{prefix:e||""});return{data:yield nf(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const lf={"X-Client-Info":"storage-js/2.7.1"};var hf=function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};class uf{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},lf),t),this.fetch=Jg(n)}listBuckets(){return hf(this,void 0,void 0,(function*(){try{return{data:yield tf(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}getBucket(e){return hf(this,void 0,void 0,(function*(){try{return{data:yield tf(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}createBucket(e,t={public:!1}){return hf(this,void 0,void 0,(function*(){try{return{data:yield nf(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}updateBucket(e,t){return hf(this,void 0,void 0,(function*(){try{const n=yield function(e,t,n,s){return Yg(this,void 0,void 0,(function*(){return ef(e,"PUT",t,s,undefined,n)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:n,error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}emptyBucket(e){return hf(this,void 0,void 0,(function*(){try{return{data:yield nf(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}deleteBucket(e){return hf(this,void 0,void 0,(function*(){try{return{data:yield sf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(Kg(e))return{data:null,error:e};throw e}}))}}class df extends uf{constructor(e,t={},n){super(e,t,n)}from(e){return new cf(this.url,this.headers,e,this.fetch)}}let pf="";pf="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const gf={headers:{"X-Client-Info":`supabase-js-${pf}/2.50.0`}},ff={schema:"public"},mf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},vf={};var bf=n(907);const yf=e=>{let t;return t=e||("undefined"==typeof fetch?bf.default:fetch),(...e)=>t(...e)},wf=(e,t,n)=>{const s=yf(n),i="undefined"==typeof Headers?bf.Headers:Headers;return(n,r)=>{return o=void 0,a=void 0,l=function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let c=new i(null==r?void 0:r.headers);return c.has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization",`Bearer ${a}`),s(n,Object.assign(Object.assign({},r),{headers:c}))},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function s(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof c?i:new c((function(e){e(i)}))).then(n,s)}i((l=l.apply(o,a||[])).next())}));var o,a,c,l}};const xf="2.70.0",_f=3e4,Sf={"X-Client-Info":`gotrue-js/${xf}`},Ef="X-Supabase-Api-Version",kf=Date.parse("2024-01-01T00:00:00.0Z"),Tf="2024-01-01",If=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Cf extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Af(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Rf extends Cf{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}class Pf extends Cf{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Lf extends Cf{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Df extends Lf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Of extends Lf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Nf extends Lf{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class jf extends Lf{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Mf extends Lf{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Uf extends Lf{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ff(e){return Af(e)&&"AuthRetryableFetchError"===e.name}class $f extends Lf{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Vf extends Lf{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const zf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Bf=" \t\n\r=".split(""),qf=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Bf.length;t+=1)e[Bf[t].charCodeAt(0)]=-2;for(let t=0;t<zf.length;t+=1)e[zf[t].charCodeAt(0)]=t;return e})();function Hf(e,t,n){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(zf[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(zf[e]),t.queuedBits-=6}}function Kf(e,t,n){const s=qf[e];if(!(s>-1)){if(-2===s)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Gf(e){const t=[],n=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},r=e=>{!function(e,t,n){if(0===t.utf8seq){if(e<=127)return void n(e);for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&n(t.codepoint)}}(e,s,n)};for(let t=0;t<e.length;t+=1)Kf(e.charCodeAt(t),i,r);return t.join("")}function Wf(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Jf(e){const t=[],n={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)Kf(e.charCodeAt(t),n,s);return new Uint8Array(t)}function Qf(e){const t=[],n={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach((e=>Hf(e,n,s))),Hf(null,n,s),t.join("")}const Yf=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Xf={tested:!1,writable:!1},Zf=()=>{if(!Yf())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(Xf.tested)return Xf.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Xf.tested=!0,Xf.writable=!0}catch(e){Xf.tested=!0,Xf.writable=!1}return Xf.writable},em=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(n.bind(n,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},tm=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},nm=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch(e){return n}},sm=async(e,t)=>{await e.removeItem(t)};class im{constructor(){this.promise=new im.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function rm(e){const t=e.split(".");if(3!==t.length)throw new Vf("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!If.test(t[e]))throw new Vf("JWT not in base64url format");return{header:JSON.parse(Gf(t[0])),payload:JSON.parse(Gf(t[1])),signature:Jf(t[2]),raw:{header:t[0],payload:t[1]}}}function om(e){return("0"+e.toString(16)).substr(-2)}async function am(e,t,n=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let s=0;s<56;s++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(e),Array.from(e,om).join("")}();let i=s;n&&(i+="/PASSWORD_RECOVERY"),await tm(e,`${t}-code-verifier`,i);const r=await async function(e){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(s);return[r,s===r?"plain":"s256"]}im.promiseConstructor=Promise;const cm=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,lm=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function hm(e){if(!lm.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}const um=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),dm=[502,503,504];async function pm(e){var t,n;if(!("object"==typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"==typeof n.json))throw new Uf(um(e),0);if(dm.includes(e.status))throw new Uf(um(e),e.status);let s,i;try{s=await e.json()}catch(e){throw new Pf(um(e),e)}const r=function(e){const t=e.headers.get(Ef);if(!t)return null;if(!t.match(cm))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(r&&r.getTime()>=kf&&"object"==typeof s&&s&&"string"==typeof s.code?i=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(i=s.error_code),i){if("weak_password"===i)throw new $f(um(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===i)throw new Df}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new $f(um(s),e.status,s.weak_password.reasons);throw new Rf(um(s),e.status||500,i)}async function gm(e,t,n,s){var i;const r=Object.assign({},null==s?void 0:s.headers);r[Ef]||(r[Ef]=Tf),(null==s?void 0:s.jwt)&&(r.Authorization=`Bearer ${s.jwt}`);const o=null!==(i=null==s?void 0:s.query)&&void 0!==i?i:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await async function(e,t,n,s,i,r){const o=((e,t,n,s)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),n))})(t,s,{},r);let a;try{a=await e(n,Object.assign({},o))}catch(e){throw console.error(e),new Uf(um(e),0)}if(a.ok||await pm(a),null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(e){await pm(e)}}(e,t,n+a,{headers:r,noResolveJson:null==s?void 0:s.noResolveJson},0,null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(c):{data:Object.assign({},c),error:null}}function fm(e){var t;let n=null;var s;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s))),{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function mm(e){const t=fm(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function vm(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function bm(e){return{data:e,error:null}}function ym(e){const{action_link:t,email_otp:n,hashed_token:s,redirect_to:i,verification_type:r}=e,o=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:s,redirect_to:i,verification_type:r},user:Object.assign({},o)},error:null}}function wm(e){return e}const xm=["global","local","others"];class _m{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=em(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=xm[0]){if(xm.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${xm.join(", ")}`);try{return await gm(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(Af(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await gm(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:vm})}catch(e){if(Af(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,n=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n}(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=null==n?void 0:n.newEmail,delete s.newEmail),await gm(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:ym,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(Af(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await gm(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:vm})}catch(e){if(Af(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,n,s,i,r,o,a;try{const c={nextPage:null,lastPage:0,total:0},l=await gm(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(i=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==i?i:""},xform:wm});if(l.error)throw l.error;const h=await l.json(),u=null!==(r=l.headers.get("x-total-count"))&&void 0!==r?r:0,d=null!==(a=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);c[`${n}Page`]=t})),c.total=parseInt(u)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(e){if(Af(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){hm(e);try{return await gm(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:vm})}catch(e){if(Af(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){hm(e);try{return await gm(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:vm})}catch(e){if(Af(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){hm(e);try{return await gm(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:vm})}catch(e){if(Af(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){hm(e.userId);try{const{data:t,error:n}=await gm(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:n}}catch(e){if(Af(e))return{data:null,error:e};throw e}}async _deleteFactor(e){hm(e.userId),hm(e.id);try{return{data:await gm(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(Af(e))return{data:null,error:e};throw e}}}const Sm={getItem:e=>Zf()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Zf()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Zf()&&globalThis.localStorage.removeItem(e)}};function Em(e={}){return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const km=!!(globalThis&&Zf()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Tm extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Im extends Tm{}async function Cm(e,t,n){km&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout((()=>{s.abort(),km&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},(async s=>{if(!s){if(0===t)throw km&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Im(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(km)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}km&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await n()}finally{km&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Am={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Sf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Rm(e,t,n){return await n()}class Pm{constructor(e){var t,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Pm.nextInstanceID,Pm.nextInstanceID+=1,this.instanceID>0&&Yf()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Am),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new _m({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=em(s.fetch),this.lock=s.lock||Rm,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Yf()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Cm:this.lock=Rm,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Zf()?this.storage=Sm:(this.memoryStorage={},this.storage=Em(this.memoryStorage)):(this.memoryStorage={},this.storage=Em(this.memoryStorage)),Yf()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${xf}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach(((e,n)=>{t[n]=e}))}catch(e){}return n.searchParams.forEach(((e,n)=>{t[n]=e})),t}(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),Yf()&&this.detectSessionInUrl&&"none"!==n){const{data:s,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),function(e){return Af(e)&&"AuthImplicitGrantRedirectError"===e.name}(i)){const t=null===(e=i.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}const{session:r,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",r,"redirect type",o),await this._saveSession(r),setTimeout((async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return Af(e)?{error:e}:{error:new Pf("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const i=await gm(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(n=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:fm}),{data:r,error:o}=i;if(o||!r)return{data:{user:null,session:null},error:o};const a=r.session,c=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async signUp(e){var t,n,s;try{let i;if("email"in e){const{email:n,password:s,options:r}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await am(this.storage,this.storageKey)),i=await gm(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==r?void 0:r.emailRedirectTo,body:{email:n,password:s,data:null!==(t=null==r?void 0:r.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},code_challenge:o,code_challenge_method:a},xform:fm})}else{if(!("phone"in e))throw new Nf("You must provide either an email or phone number and a password");{const{phone:t,password:r,options:o}=e;i=await gm(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:r,data:null!==(n=null==o?void 0:o.data)&&void 0!==n?n:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:fm})}}const{data:r,error:o}=i;if(o||!r)return{data:{user:null,session:null},error:o};const a=r.session,c=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:s,options:i}=e;t=await gm(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:mm})}else{if(!("phone"in e))throw new Nf("You must provide either an email or phone number and a password");{const{phone:n,password:s,options:i}=e;t=await gm(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:mm})}}const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:n&&n.session&&n.user?(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s}):{data:{user:null,session:null},error:new Of}}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,i,r,o,a,c,l,h,u,d;let p,g;if("message"in e)p=e.message,g=e.signature;else{const{chain:u,wallet:d,statement:f,options:m}=e;let v;if(Yf())if("object"==typeof d)v=d;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!=typeof d||!(null==m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=d}const b=new URL(null!==(t=null==m?void 0:m.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==m?void 0:m.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");p="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),g=t.signature}else{if(!("signMessage"in v&&"function"==typeof v.signMessage&&"publicKey"in v&&"object"==typeof v&&v.publicKey&&"toBase58"in v.publicKey&&"function"==typeof v.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${b.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(s=null===(n=null==m?void 0:m.signInWithSolana)||void 0===n?void 0:n.issuedAt)&&void 0!==s?s:(new Date).toISOString()}`,...(null===(i=null==m?void 0:m.signInWithSolana)||void 0===i?void 0:i.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(r=null==m?void 0:m.signInWithSolana)||void 0===r?void 0:r.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(o=null==m?void 0:m.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(a=null==m?void 0:m.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(c=null==m?void 0:m.signInWithSolana)||void 0===c?void 0:c.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(h=null===(l=null==m?void 0:m.signInWithSolana)||void 0===l?void 0:l.resources)||void 0===h?void 0:h.length)?["Resources",...m.signInWithSolana.resources.map((e=>`- ${e}`))]:[]].join("\n");const e=await v.signMessage((new TextEncoder).encode(p),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=e}}try{const{data:t,error:n}=await gm(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Qf(g)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:fm});if(n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:n}):{data:{user:null,session:null},error:new Of}}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async _exchangeCodeForSession(e){const t=await nm(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(null!=t?t:"").split("/");try{const{data:t,error:i}=await gm(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:fm});if(await sm(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:i}):{data:{user:null,session:null,redirectType:null},error:new Of}}catch(e){if(Af(e))return{data:{user:null,session:null,redirectType:null},error:e};throw e}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:i,nonce:r}=e,o=await gm(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:r,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:fm}),{data:a,error:c}=o;return c?{data:{user:null,session:null},error:c}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:c}):{data:{user:null,session:null},error:new Of}}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,n,s,i,r;try{if("email"in e){const{email:s,options:i}=e;let r=null,o=null;"pkce"===this.flowType&&([r,o]=await am(this.storage,this.storageKey));const{error:a}=await gm(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(n=null==i?void 0:i.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:r,code_challenge_method:o},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:n}=e,{data:o,error:a}=await gm(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==n?void 0:n.data)&&void 0!==s?s:{},create_user:null===(i=null==n?void 0:n.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},channel:null!==(r=null==n?void 0:n.channel)&&void 0!==r?r:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new Nf("You must provide either an email or phone number.")}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,n;try{let s,i;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(n=e.options)||void 0===n?void 0:n.captchaToken);const{data:r,error:o}=await gm(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:fm});if(o)throw o;if(!r)throw new Error("An error occurred on token verification.");const a=r.session,c=r.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:c,session:a},error:null}}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,n,s;try{let i=null,r=null;return"pkce"===this.flowType&&([i,r]=await am(this.storage,this.storageKey)),await gm(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==n?n:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:r}),headers:this.headers,xform:bm})}catch(e){if(Af(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Df;const{error:s}=await gm(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}}))}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:r}=await gm(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:r}}if("phone"in e){const{phone:n,type:s,options:i}=e,{data:r,error:o}=await gm(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==r?void 0:r.message_id},error:o}}throw new Nf("You must provide either an email or phone number and a type")}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch(e){}})()),n}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await nm(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=!!e.expires_at&&1e3*e.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,n,s)=>(t||"user"!==n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,n,s))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,(async()=>await this._getUser())))}async _getUser(e){try{return e?await gm(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:vm}):await this._useSession((async e=>{var t,n,s;const{data:i,error:r}=e;if(r)throw r;return(null===(t=i.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await gm(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(n=i.session)||void 0===n?void 0:n.access_token)&&void 0!==s?s:void 0,xform:vm}):{data:{user:null},error:new Df}}))}catch(e){if(Af(e))return function(e){return Af(e)&&"AuthSessionMissingError"===e.name}(e)&&(await this._removeSession(),await sm(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new Df;const r=s.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await am(this.storage,this.storageKey));const{data:c,error:l}=await gm(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:r.access_token,xform:vm});if(l)throw l;return r.user=c.user,await this._saveSession(r),await this._notifyAllSubscribers("USER_UPDATED",r),{data:{user:r.user},error:null}}))}catch(e){if(Af(e))return{data:{user:null},error:e};throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Df;const t=Date.now()/1e3;let n=t,s=!0,i=null;const{payload:r}=rm(e.access_token);if(r.exp&&(n=r.exp,s=n<=t),s){const{session:t,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return{data:{user:null,session:null},error:n};if(!t)return{data:{user:null,session:null},error:null};i=t}else{const{data:s,error:r}=await this._getUser(e.access_token);if(r)throw r;i={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(Af(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var n;if(!e){const{data:s,error:i}=t;if(i)throw i;e=null!==(n=s.session)&&void 0!==n?n:void 0}if(!(null==e?void 0:e.refresh_token))throw new Df;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}}))}catch(e){if(Af(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e,t){try{if(!Yf())throw new jf("No browser detected.");if(e.error||e.error_description||e.error_code)throw new jf(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Mf("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new jf("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Mf("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:r,expires_in:o,expires_at:a,token_type:c}=e;if(!(i&&o&&r&&c))throw new jf("No session defined in URL");const l=Math.round(Date.now()/1e3),h=parseInt(o);let u=l+h;a&&(u=parseInt(a));const d=u-l;1e3*d<=_f&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const p=u-h;l-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,u,l):l-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,u,l);const{data:g,error:f}=await this._getUser(i);if(f)throw f;const m={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:u,refresh_token:r,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(e){if(Af(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await nm(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var n;const{data:s,error:i}=t;if(i)return{error:i};const r=null===(n=s.session)||void 0===n?void 0:n.access_token;if(r){const{error:t}=await this.admin.signOut(r,e);if(t&&(!function(e){return Af(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await sm(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession((async t=>{var n,s;try{const{data:{session:s},error:i}=t;if(i)throw i;await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}}))}async resetPasswordForEmail(e,t={}){let n=null,s=null;"pkce"===this.flowType&&([n,s]=await am(this.storage,this.storageKey,!0));try{return await gm(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(Af(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(e){if(Af(e))return{data:null,error:e};throw e}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession((async t=>{var n,s,i,r,o;const{data:a,error:c}=t;if(c)throw c;const l=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await gm(this.fetch,"GET",l,{headers:this.headers,jwt:null!==(o=null===(r=a.session)||void 0===r?void 0:r.access_token)&&void 0!==o?o:void 0})}));if(s)throw s;return Yf()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==n?void 0:n.url),{data:{provider:e.provider,url:null==n?void 0:n.url},error:null}}catch(t){if(Af(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var n,s;const{data:i,error:r}=t;if(r)throw r;return await gm(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(n=i.session)||void 0===n?void 0:n.access_token)&&void 0!==s?s:void 0})}))}catch(e){if(Af(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await(n=async n=>(n>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await gm(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:fm})),s=(e,t)=>{const n=200*Math.pow(2,e);return t&&Ff(t)&&Date.now()+n-i<_f},new Promise(((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{const t=await n(i);if(!s(i,null))return void e(t)}catch(e){if(!s(i,e))return void t(e)}})()})))}catch(e){if(this._debug(t,"error",e),Af(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}var n,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Yf()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const n=await nm(this.storage,this.storageKey);if(this._debug(t,"session from storage",n),!this._isValidSession(n))return this._debug(t,"session is not valid"),void(null!==n&&await this._removeSession());const s=1e3*(null!==(e=n.expires_at)&&void 0!==e?e:1/0)-Date.now()<9e4;if(this._debug(t,`session has${s?"":" not"} expired with margin of 90000s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(console.error(e),Ff(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(e){return this._debug(t,"error",e),void console.error(e)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Df;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new im;const{data:t,error:n}=await this._refreshAccessToken(e);if(n)throw n;if(!t.session)throw new Df;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,"error",e),Af(e)){const n={session:null,error:e};return Ff(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(n),n}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],i=Array.from(this.stateChangeEmitters.values()).map((async n=>{try{await n.callback(e,t)}catch(e){s.push(e)}}));if(await Promise.all(i),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await tm(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await sm(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Yf()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),_f);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const e=Date.now();try{return await this._useSession((async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*n.expires_at-e)/_f);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(n.refresh_token)}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof Tm))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Yf()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if((null==n?void 0:n.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),(null==n?void 0:n.scopes)&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===this.flowType){const[e,t]=await am(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(n.toString())}if(null==n?void 0:n.queryParams){const e=new URLSearchParams(n.queryParams);s.push(e.toString())}return(null==n?void 0:n.skipBrowserRedirect)&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await gm(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(n=null==s?void 0:s.session)||void 0===n?void 0:n.access_token})}))}catch(e){if(Af(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession((async t=>{var n,s;const{data:i,error:r}=t;if(r)return{data:null,error:r};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:c}=await gm(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(n=null==i?void 0:i.session)||void 0===n?void 0:n.access_token});return c?{data:null,error:c}:("totp"===e.factorType&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(e){if(Af(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var n;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:r,error:o}=await gm(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(n=null==s?void 0:s.session)||void 0===n?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+r.expires_in},r)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",r),{data:r,error:o})}))}catch(e){if(Af(e))return{data:null,error:e};throw e}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await gm(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(n=null==s?void 0:s.session)||void 0===n?void 0:n.access_token})}))}catch(e){if(Af(e))return{data:null,error:e};throw e}}))}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(null==e?void 0:e.factors)||[],s=n.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),i=n.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:n,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,n;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:r}=rm(s.access_token);let o=null;r.aal&&(o=r.aal);let a=o;return(null!==(n=null===(t=s.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==n?n:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:r.amr||[]},error:null}}))))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find((t=>t.kid===e));if(n)return n;if(n=this.jwks.keys.find((t=>t.kid===e)),n&&this.jwks_cached_at+6e5>Date.now())return n;const{data:s,error:i}=await gm(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||0===s.keys.length)throw new Vf("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),n=s.keys.find((t=>t.kid===e)),!n)throw new Vf("No matching signing key found in JWKS");return n}async getClaims(e,t={keys:[]}){try{let n=e;if(!n){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};n=e.session.access_token}const{header:s,payload:i,signature:r,raw:{header:o,payload:a}}=rm(n);if(function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(i.exp),!s.kid||"HS256"===s.alg||!("crypto"in globalThis)||!("subtle"in globalThis.crypto)){const{error:e}=await this.getUser(n);if(e)throw e;return{data:{claims:i,header:s,signature:r},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(s.alg),l=await this.fetchJwk(s.kid,t),h=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,h,r,function(e){const t=[];return function(e,t){for(let n=0;n<e.length;n+=1){let s=e.charCodeAt(n);if(s>55295&&s<=56319){const t=1024*(s-55296)&65535;s=65536+(e.charCodeAt(n+1)-56320&65535|t),n+=1}Wf(s,t)}}(e,(e=>t.push(e))),new Uint8Array(t)}(`${o}.${a}`)))throw new Vf("Invalid JWT signature");return{data:{claims:i,header:s,signature:r},error:null}}catch(e){if(Af(e))return{data:null,error:e};throw e}}}Pm.nextInstanceID=0;const Lm=Pm;class Dm extends Lm{constructor(e){super(e)}}class Om{constructor(e,t,n){var s,i,r;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=(a=e).endsWith("/")?a:a+"/";var a;const c=new URL(o);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const l=`sb-${c.hostname.split(".")[0]}-auth-token`,h=function(e,t){var n,s;const{db:i,auth:r,realtime:o,global:a}=e,{db:c,auth:l,realtime:h,global:u}=t,d={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},l),r),realtime:Object.assign(Object.assign({},h),o),global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},null!==(n=null==u?void 0:u.headers)&&void 0!==n?n:{}),null!==(s=null==a?void 0:a.headers)&&void 0!==s?s:{})}),accessToken:()=>{return e=this,t=void 0,s=function*(){return""},new((n=void 0)||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}));var e,t,n,s}};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=n?n:{},{db:ff,realtime:vf,auth:Object.assign(Object.assign({},mf),{storageKey:l}),global:gf});this.storageKey=null!==(s=h.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(i=h.global.headers)&&void 0!==i?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(r=h.auth)&&void 0!==r?r:{},this.headers,h.global.fetch),this.fetch=wf(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new ag(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new rg(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new df(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,n,s,i,r;return n=this,s=void 0,r=function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return null!==(t=null===(e=n.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{c(r.next(e))}catch(e){t(e)}}function a(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(o,a)}c((r=r.apply(n,s||[])).next())}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:i,flowType:r,lock:o,debug:a},c,l){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Dm({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:r,lock:o,debug:a,fetch:l,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Bg(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=n}}const Nm=new Om("https://bnmfdyivzrqzfdebnljj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJubWZkeWl2enJxemZkZWJubGpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3ODI0NDQsImV4cCI6MjA2NTM1ODQ0NH0.wZXTN-4vnuPfDqKlC7ZcppegMbcew_UOn3o8NwFEbN4",void 0),jm="DELETE_ACCOUNT_SUCCESS",Mm="DELETE_ACCOUNT_ERROR",Um="UPDATE_PROFILE_SUCCESS",Fm="UPDATE_PROFILE_ERROR",$m="UPDATE_PROFILE_PHOTO";var Vm;!function(e){e.ADD_COMMENT="ADD_COMMENT"}(Vm||(Vm={}));const zm={addComment(e){r.dispatch({type:Vm.ADD_COMMENT,payload:e})}};var Bm;!function(e){e.OPEN_POST_MODAL="OPEN_POST_MODAL",e.CLOSE_POST_MODAL="CLOSE_POST_MODAL",e.SHARE_POST="SHARE_POST",e.LOAD_POSTS_FROM_STORAGE="LOAD_POSTS_FROM_STORAGE"}(Bm||(Bm={}));const qm=()=>{r.dispatch({type:Bm.CLOSE_POST_MODAL})},Hm=async()=>{await Jm.loadPostsFromFirestore()};var Km;async function Gm(){const e=Eh(zl(Yp,"posts"));return(await $h(e)).docs.map((e=>({id:e.id,...e.data()})))}!function(e){e.SELECT_TAG="SELECT_TAG"}(Km||(Km={}));class Wm{constructor(){this._myState={currentPath:window.location.pathname,history:[],auth:{isAuthenticated:!1,user:null},signUp:{loading:!1,error:null,success:!1},posts:[],profilePosts:[],teacherRatings:{},subjectRatings:{},selectedTeacher:null,selectedSubject:null,searchQuery:"",userLikes:{},comments:{},postModal:{isOpen:!1,postId:null},selectedTag:"All",navigation:{returnToFeed:!1,returnToProfile:!1,activeAcademicTab:"teachers"},filteredTeachers:null,filteredSubjects:null,searchDebounceTimeout:null,teachers:[],subjects:[]},this._listeners=[],this._listeners=[],r.register(this._handleActions.bind(this)),window.addEventListener("popstate",(()=>{const e=window.location.pathname;this._handleRouteChange(e)}))}_handleRouteChange(e){if(this._myState.currentPath!==e)return["/","/login","/signup"].includes(e)?(this._myState={...this._myState,currentPath:e,history:[...this._myState.history,e]},void this._emitChange()):(this._myState.auth.isAuthenticated?this._myState={...this._myState,currentPath:e,history:[...this._myState.history,e]}:(window.history.replaceState({},"","/"),this._myState={...this._myState,currentPath:"/",history:[...this._myState.history,"/"]}),void this._emitChange())}getState(){return this._myState}_handleActions(e){switch(e.type){case O:this.setUserFromFirebase(),this._emitChange();break;case N:e.payload&&(this._myState={...this._myState,auth:{isAuthenticated:!0,user:e.payload}},localStorage.setItem("loggedInUser",JSON.stringify(e.payload)),["/","/login","/signup"].includes(this._myState.currentPath)&&(window.history.replaceState({},"","/feed"),this._handleRouteChange("/feed"),window.location.reload())),this._emitChange();break;case j:(function(e){return pe(e).signOut()})(Xp).then((()=>{localStorage.removeItem("loggedInUser"),this._myState={...this._myState,auth:{isAuthenticated:!1,user:null}},window.history.replaceState({},"","/"),this._handleRouteChange("/"),this._emitChange()}));break;case o:if(e.payload&&"object"==typeof e.payload&&"path"in e.payload){const t=String(e.payload.path);window.history.pushState({},"",t),this._handleRouteChange(t)}break;case a:if(e.payload&&"object"==typeof e.payload&&"path"in e.payload){const t=String(e.payload.path);window.history.replaceState({},"",t),this._handleRouteChange(t)}break;case C:this._myState={...this._myState,signUp:{loading:!0,error:null,success:!1}},this._handleSignUp(e.payload);break;case A:this._myState={...this._myState,signUp:{loading:!1,error:null,success:!0}},this._emitChange();break;case R:if(e.payload){const t=e.payload;this._myState={...this._myState,signUp:{loading:!1,error:t.error,success:!1}},this._emitChange()}break;case D.LIKE_POST:if(e.payload&&"object"==typeof e.payload&&"postId"in e.payload&&"likes"in e.payload){const t=String(e.payload.postId),n=Number(e.payload.likes);this._myState={...this._myState,posts:this._myState.posts.map((e=>e.id===t?{...e,likes:n}:e))},this._emitChange()}break;case D.UNLIKE_POST:if(e.payload&&"object"==typeof e.payload&&"postId"in e.payload&&"likes"in e.payload){const t=String(e.payload.postId),n=Number(e.payload.likes);this._myState={...this._myState,posts:this._myState.posts.map((e=>e.id===t?{...e,likes:n}:e))},this._emitChange()}break;case D.ADD_TEACHER_RATING:if(e.payload&&"object"==typeof e.payload&&"teacherName"in e.payload&&"rating"in e.payload&&"comment"in e.payload&&"timestamp"in e.payload){const t=e.payload,{teacherName:n,rating:s,comment:i,timestamp:r,author:o,image:a}=t,c=this._myState.teacherRatings[n]||[];this._myState={...this._myState,teacherRatings:{...this._myState.teacherRatings,[n]:[...c,{rating:s,comment:i,timestamp:r,author:o,image:a}]}},localStorage.setItem("teacherRatings",JSON.stringify(this._myState.teacherRatings)),this._emitChange()}break;case D.ADD_SUBJECT_RATING:if(e.payload&&"object"==typeof e.payload&&"subjectName"in e.payload){const t=e.payload,{subjectName:n,rating:s,comment:i,timestamp:r,author:o,image:a}=t;this._myState.subjectRatings[n]}break;case D.UPDATE_TEACHER_RATING:if(e.payload&&"object"==typeof e.payload&&"teacherName"in e.payload){const t=e.payload,{teacherName:n,rating:s}=t,i=this._myState.teacherRatings[n]||[],r=i.length>0?i.reduce(((e,t)=>e+t.rating),0)/i.length:s,o=JSON.parse(localStorage.getItem("selectedTeacher")||"{}");o.name===n&&(o.rating=r.toFixed(1),localStorage.setItem("selectedTeacher",JSON.stringify(o))),this._emitChange()}break;case D.UPDATE_SUBJECT_RATING:if(e.payload&&"object"==typeof e.payload&&"subjectName"in e.payload){const t=e.payload,{subjectName:n,rating:s}=t,i=this._myState.subjectRatings[n]||[],r=i.length>0?i.reduce(((e,t)=>e+t.rating),0)/i.length:s,o=JSON.parse(localStorage.getItem("selectedSubject")||"{}");o.name===n&&(o.rating=r.toFixed(1),localStorage.setItem("selectedSubject",JSON.stringify(o))),this._emitChange()}break;case D.LOAD_POSTS:if(e.payload&&Array.isArray(e.payload)){const t=localStorage.getItem("posts"),n=t?JSON.parse(t):e.payload;this._myState={...this._myState,posts:n},this._emitChange()}break;case D.ADD_POST:if(e.payload&&"object"==typeof e.payload){const t=[e.payload,...this._myState.posts];localStorage.setItem("posts",JSON.stringify(t)),this._myState={...this._myState,posts:t},this._emitChange()}break;case P:e.payload&&(this._myState={...this._myState,selectedTeacher:e.payload},this._emitChange());break;case L:e.payload&&(this._myState={...this._myState,selectedSubject:e.payload},this._emitChange());break;case U:if(e.payload&&"object"==typeof e.payload){const t=e.payload;JSON.stringify(this._myState.filteredSubjects)!==JSON.stringify(t)&&(this._myState={...this._myState,filteredSubjects:t},this._emitChange())}break;case F:if(e.payload&&"object"==typeof e.payload){const t=e.payload;JSON.stringify(this._myState.filteredTeachers)!==JSON.stringify(t)&&(this._myState={...this._myState,filteredTeachers:t},this._emitChange())}break;case"CLEAR_SEARCH":null===this._myState.filteredSubjects&&null===this._myState.filteredTeachers||(this._myState={...this._myState,filteredSubjects:null,filteredTeachers:null},this._emitChange());break;case jm:if(e.payload){const t=e.payload;this._myState={...this._myState,auth:{isAuthenticated:!1,user:null},posts:this._myState.posts.filter((e=>e.name!==t.username)),userLikes:{}}}this._emitChange();break;case Mm:if(e.payload){const t=e.payload;console.error("Error deleting account:",t.error)}this._emitChange();break;case Vm.ADD_COMMENT:e.payload&&this.addComment(e.payload);break;case Bm.OPEN_POST_MODAL:this._myState={...this._myState,postModal:{isOpen:!0,postId:e.payload?.postId||null}},this._emitChange();break;case Bm.CLOSE_POST_MODAL:this._myState={...this._myState,postModal:{isOpen:!1,postId:null}},this._emitChange();break;case Bm.SHARE_POST:if(e.payload&&"object"==typeof e.payload&&"postId"in e.payload){const t=e.payload,n=this._myState.posts.find((e=>e.id===t.postId));n&&console.log("Compartiendo post:",n)}break;case Bm.LOAD_POSTS_FROM_STORAGE:if(e.payload&&"object"==typeof e.payload&&"posts"in e.payload){const t=e.payload;this._myState={...this._myState,posts:t.posts},this._emitChange()}break;case Km.SELECT_TAG:if(e.payload){const t=e.payload;console.log("Store: Changing selected tag to:",t),this._myState={...this._myState,selectedTag:t},this._emitChange()}break;case $m:if(e.payload&&"object"==typeof e.payload&&"photo"in e.payload){const t=e.payload,n=this._myState.auth.user;if(n){localStorage.setItem(`profilePic_${n.username}`,t.photo),this._myState={...this._myState,auth:{...this._myState.auth,user:{...n,profilePic:t.photo}}},localStorage.setItem("loggedInUser",JSON.stringify(this._myState.auth.user));const e=this._myState.posts.map((e=>e.name===n.username?{...e,photo:t.photo}:e));this._myState={...this._myState,posts:e},localStorage.setItem("posts",JSON.stringify(e)),this._emitChange()}}break;case Um:e.payload&&"object"==typeof e.payload&&"user"in e.payload&&(this._myState={...this._myState,auth:{...this._myState.auth,user:e.payload.user}},this._emitChange());break;case c:this._myState={...this._myState,navigation:{...this._myState.navigation,returnToFeed:!0}},sessionStorage.setItem("returnToFeed","true"),this._emitChange();break;case l:this._myState={...this._myState,navigation:{...this._myState.navigation,returnToProfile:!0}},sessionStorage.setItem("returnToProfile","true"),this._emitChange();break;case"CLEAR_RETURN_FLAGS":this._myState={...this._myState,navigation:{...this._myState.navigation,returnToFeed:!1,returnToProfile:!1}},sessionStorage.removeItem("returnToFeed"),sessionStorage.removeItem("returnToProfile"),this._emitChange();break;case h:e.payload&&"object"==typeof e.payload&&"tab"in e.payload&&(this._myState={...this._myState,navigation:{...this._myState.navigation,activeAcademicTab:String(e.payload.tab)}},this._emitChange())}}_handleSignUp(e){try{e.degree?e.career=e.degree:e.career&&(e.degree=e.career),localStorage.setItem("loggedInUser",JSON.stringify(e)),r.dispatch({type:N,payload:e})}catch(e){r.dispatch({type:R,payload:{error:"An error occurred during sign up"}})}}_emitChange(){const e=this.getState();for(const t of this._listeners)t(e)}subscribe(e){return this._listeners.push(e),e(this.getState()),()=>{this._listeners=this._listeners.filter((t=>t!==e))}}_saveUserLikes(e,t,n){const s=this._myState.userLikes[e]||[];if(n&&!s.includes(t))s.push(t);else if(!n){const e=s.indexOf(t);e>-1&&s.splice(e,1)}this._myState.userLikes[e]=s,localStorage.setItem("userLikes",JSON.stringify(this._myState.userLikes)),this._emitChange()}_getUserLikes(e){return this._myState.userLikes[e]||[]}_saveCurrentPost(e){sessionStorage.setItem("currentPostId",e.id),sessionStorage.setItem("currentPost",JSON.stringify(e))}_getCurrentPost(){const e=sessionStorage.getItem("currentPost");return e?JSON.parse(e):null}_setFromProfile(e){sessionStorage.setItem("fromProfile",e.toString())}_getFromProfile(){return"true"===sessionStorage.getItem("fromProfile")}_saveScrollPosition(e){sessionStorage.setItem("feedScrollPosition",e.toString())}_getScrollPosition(){const e=sessionStorage.getItem("feedScrollPosition");return e?parseInt(e):0}_clearReturnToFeed(){sessionStorage.removeItem("returnToFeed")}_getReturnToFeed(){return"true"===sessionStorage.getItem("returnToFeed")}_saveCurrentPostId(e){sessionStorage.setItem("currentPostId",e)}_getCurrentPostId(){return sessionStorage.getItem("currentPostId")||""}_setReturnToProfile(e){sessionStorage.setItem("returnToProfile",e.toString())}saveScrollPosition(e){this._saveScrollPosition(e)}getScrollPosition(){return this._getScrollPosition()}clearReturnToFeed(){this._clearReturnToFeed()}getReturnToFeed(){return this._getReturnToFeed()}saveCurrentPostId(e){this._saveCurrentPostId(e)}getCurrentPostId(){return this._getCurrentPostId()}setFromProfile(e){this._setFromProfile(e)}getFromProfile(){return this._getFromProfile()}setReturnToProfile(e){this._setReturnToProfile(e)}saveUserLikes(e,t,n){this._saveUserLikes(e,t,n)}getUserLikes(e){return this._getUserLikes(e)}saveCurrentPost(e){this._saveCurrentPost(e)}getCurrentPost(){return this._getCurrentPost()}load(){try{const e=localStorage.getItem("loggedInUser");if(e){const t=JSON.parse(e);this._myState={...this._myState,auth:{isAuthenticated:!0,user:t}}}this._loadAllData(),this.loadPostsFromFirestore().then((()=>{this._myState.posts.forEach((async e=>{if(e.id)try{await this.loadCommentsForPost(e.id)}catch(t){console.error(`Error loading comments for post ${e.id}:`,t)}}))})),Xp&&Xp.onAuthStateChanged((async e=>{if(e)try{const t=await Uh(Bl(Yp,"users",e.uid));if(t.exists()){const e=t.data();this._myState={...this._myState,auth:{isAuthenticated:!0,user:e}},localStorage.setItem("loggedInUser",JSON.stringify(e))}}catch(e){console.error("Error fetching Firebase user doc:",e),this._handleAuthError()}else this._handleAuthError()}))}catch(e){console.error("Fatal error during store load:",e),this._handleAuthError()}}_handleAuthError(){this._myState={...this._myState,auth:{isAuthenticated:!1,user:null},currentPath:"/"},localStorage.removeItem("loggedInUser"),window.history.replaceState({},"","/"),this._handleRouteChange("/"),this._emitChange()}_loadAllData(){const e=localStorage.getItem("posts");e&&(this._myState.posts=JSON.parse(e));const t=localStorage.getItem("teacherRatings");t&&(this._myState.teacherRatings=JSON.parse(t));const n=localStorage.getItem("subjectRatings");n&&(this._myState.subjectRatings=JSON.parse(n));const s=localStorage.getItem("userLikes");s&&(this._myState.userLikes=JSON.parse(s));const i=localStorage.getItem("comments");i&&(this._myState.comments=JSON.parse(i)),this._myState.navigation.returnToFeed="true"===sessionStorage.getItem("returnToFeed"),this._myState.navigation.returnToProfile="true"===sessionStorage.getItem("returnToProfile")}syncWithLocalStorage(){if(console.log("syncWithLocalStorage: Current auth user status:",this._myState.auth.user),console.log("syncWithLocalStorage: Posts state at start:",this._myState.posts),this._myState.auth.isAuthenticated&&this._myState.auth.user){const e=this._myState.auth.user.username;this._myState.userLikes[e]||(this._myState.userLikes[e]=[]),localStorage.setItem("userLikes",JSON.stringify(this._myState.userLikes))}else console.log("syncWithLocalStorage: No authenticated user, clearing user-specific data from localStorage."),localStorage.removeItem("loggedInUser"),this._myState={...this._myState,userLikes:{}},localStorage.setItem("userLikes",JSON.stringify({}));console.log("Final State after sync:",this._myState)}getFilteredPosts(e=this._myState.selectedTag){const t=this._myState.posts;if(!t||!Array.isArray(t))return[];if("All"===e)return[...t];const n=e.toLowerCase().trim();return t.filter((e=>!!e.tag&&e.tag.toLowerCase().trim()===n))}getReturnToProfile(){return this._myState.navigation.returnToProfile}_loadPostsFromStorage(){try{return JSON.parse(localStorage.getItem("posts")||"[]")}catch(e){return console.error("Failed to load posts from storage:",e),[]}}_savePostsToStorage(e){try{localStorage.setItem("posts",JSON.stringify(e))}catch(e){console.error("Failed to save posts to storage:",e)}}_getLoggedInUser(){try{return JSON.parse(localStorage.getItem("loggedInUser")||"null")}catch(e){return console.error("Error getting logged in user:",e),null}}_removeLoggedInUser(){try{localStorage.removeItem("loggedInUser")}catch(e){throw console.error("Error removing logged in user:",e),e}}getLoggedInUser(){return this._getLoggedInUser()}removeLoggedInUser(){this._removeLoggedInUser()}_updatePostLikes(e,t){const n=this._loadPostsFromStorage(),s=n.find((t=>t.id===e));s&&(s.likes=t?(s.likes||0)+1:Math.max(0,(s.likes||0)-1),this._savePostsToStorage(n))}async createPost(e){const t=this._createNewPost({...e,createdAt:(new Date).toISOString()});if(!t)return;await async function(e){return(await function(e,t){const n=Ol(e.firestore,Gl),s=Bl(e),i=Lh(e.converter,t);return Bh(n,[ah(oh(e.firestore),"addDoc",s._key,i,null!==e.converter,{}).toMutation(s._key,Cr.exists(!1))]).then((()=>s))}(zl(Yp,"posts"),e)).id}(t),await this.loadPostsFromFirestore();const n=this._getLoggedInUser();n&&t.name===n.username&&await this.loadProfilePosts()}_safeToISOString(e){try{if(!e)return(new Date).toISOString();const t=new Date(e);return isNaN(t.getTime())?(new Date).toISOString():t.toISOString()}catch(e){return(new Date).toISOString()}}_createNewPost(e){const t=this._getLoggedInUser();if(!t)return console.error("No logged in user found"),null;const n=t?.username||"Unknown User",s=t?.career||t?.degree||"Unknown Career",i=t?.semester||"";return{photo:t?.profilePic||`https://picsum.photos/800/450?random=${Math.floor(100*Math.random())}`,name:n,date:(new Date).toLocaleDateString(),career:s,semestre:i,message:e.content,tag:e.category,likes:0,share:"0",comments:[],image:e.image||null,createdAt:e.createdAt}}async loadPostsFromFirestore(){const e=(await Gm()).map((e=>({id:e.id||"",photo:e.photo||"",name:e.name||"",date:e.date||"",career:e.career||"",semestre:e.semestre||"",message:e.message||"",tag:e.tag||"",likes:e.likes||0,share:e.share||"0",comments:e.comments||[],image:e.image||null,createdAt:e.createdAt||this._safeToISOString(e.date)})));e.sort(((e,t)=>{const n=e.createdAt?new Date(e.createdAt).getTime():0;return(t.createdAt?new Date(t.createdAt).getTime():0)-n})),this._myState={...this._myState,posts:e},this._emitChange()}async loadProfilePosts(){const e=this._getLoggedInUser();if(!e)return;const t=await async function(e){const t=Eh(zl(Yp,"posts"),Th("name","==",e));return(await $h(t)).docs.map((e=>({id:e.id,...e.data()})))}(e.username),n=t.map((t=>({id:t.id||"",photo:t.photo||"",name:t.name||"",date:t.date||"",career:e.career||e.degree||t.career||"",semestre:e.semester||t.semestre||"",message:t.message||"",tag:t.tag||"",likes:t.likes||0,share:t.share||"0",comments:t.comments||[],image:t.image||null,createdAt:t.createdAt||this._safeToISOString(t.date)})));n.sort(((e,t)=>{const n=e.createdAt?new Date(e.createdAt).getTime():0;return(t.createdAt?new Date(t.createdAt).getTime():0)-n})),this._myState={...this._myState,profilePosts:n},this._emitChange()}getProfilePosts(){return this._myState.profilePosts}_getUserData(){try{const e=JSON.parse(localStorage.getItem("loggedInUser")||"null");return{photo:e?.profilePic||"https://picsum.photos/seed/default/200/300",name:e?.username||"Anonymous",career:e?.career||e?.degree||""}}catch(e){return console.error("Error getting user data:",e),{photo:"https://picsum.photos/seed/default/200/300",name:"Anonymous",career:""}}}getUserData(){return this._getUserData()}async addComment(e){const t=this._getCurrentPost();if(!t)return void console.error("No current post found");const n=t.id,s={...this._getUserData(),date:(new Date).toLocaleDateString(),message:e.message,timestamp:(new Date).toISOString()};try{console.log("Adding comment to post ID:",n),console.log("New comment data:",s);const e=await async function(e,t){try{if(!e||!t)throw new Error("Post ID and comment are required");if(!t.message||!t.name||!t.photo)throw new Error("Comment must include message, name, and photo");console.log("Attempting to add comment to post:",e);const n=Bl(Yp,"posts",e),s={...t,timestamp:t.timestamp||(new Date).toISOString(),id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`};return await zh(n,{comments:qh(s)}),console.log("Comment successfully added to post:",e),s}catch(t){throw console.error("Error in addCommentToPost for postId:",e,t),t}}(n,s),t=[...this._myState.comments[n]||[],e];this._myState={...this._myState,comments:{...this._myState.comments,[n]:t}},localStorage.setItem("comments",JSON.stringify(this._myState.comments));const i=this._myState.posts.map((e=>e.id===n?{...e,comments:t}:e));this._myState.posts=i,localStorage.setItem("posts",JSON.stringify(i)),this._emitChange()}catch(e){console.error("Error adding comment:",e)}}async loadCommentsForPost(e){try{if(!e)return void console.error("No post ID provided");const t=await async function(e){try{if(!e)throw new Error("Post ID is required");const t=Bl(Yp,"posts",e),n=await Uh(t);if(!n.exists())throw new Error("Post not found");return(n.data().comments||[]).sort(((e,t)=>{const n=new Date(e.timestamp).getTime();return new Date(t.timestamp).getTime()-n}))}catch(t){throw console.error("Error in getCommentsForPost for postId:",e,t),t}}(e);this._myState={...this._myState,comments:{...this._myState.comments,[e]:t}},localStorage.setItem("comments",JSON.stringify(this._myState.comments));const n=this._myState.posts.map((n=>n.id===e?{...n,comments:t}:n));this._myState.posts=n,this._emitChange()}catch(e){console.error("Error loading comments:",e)}}_createReview(e){return{rating:e.rating,text:e.text,date:(new Date).toLocaleDateString(),author:e.author,image:e.image,["teacher"===e.type?"teacherName":"subjectName"]:e.name,type:e.type}}_updateRating(e,t,n){const s=("teacher"===e?this._myState.teacherRatings:this._myState.subjectRatings)[t]||[],i=s.length>0?s.reduce(((e,t)=>e+t.rating),0)/s.length:n,r=JSON.parse(localStorage.getItem("selected"+("teacher"===e?"Teacher":"Subject"))||"{}");r.name===t&&(r.rating=i.toFixed(1),localStorage.setItem("selected"+("teacher"===e?"Teacher":"Subject"),JSON.stringify(r)))}submitReview(e){const t=this._getUserData(),n=this._createReview({...e,author:t.name,image:t.photo});if("teacher"===e.type){const n=this._myState.teacherRatings[e.name]||[];this._myState={...this._myState,teacherRatings:{...this._myState.teacherRatings,[e.name]:[...n,{rating:e.rating,comment:e.text,timestamp:(new Date).toISOString(),author:t.name,image:t.photo}]}},localStorage.setItem("teacherRatings",JSON.stringify(this._myState.teacherRatings))}else{const n=this._myState.subjectRatings[e.name]||[];this._myState={...this._myState,subjectRatings:{...this._myState.subjectRatings,[e.name]:[...n,{rating:e.rating,comment:e.text,timestamp:(new Date).toISOString(),author:t.name,image:t.photo}]}},localStorage.setItem("subjectRatings",JSON.stringify(this._myState.subjectRatings))}this._updateRating(e.type,e.name,e.rating),r.dispatch({type:"teacher"===e.type?"ADD_TEACHER_RATING":"ADD_SUBJECT_RATING",payload:n}),this._emitChange()}_getPostById(e){try{return JSON.parse(localStorage.getItem("posts")||"[]").find((t=>t.id===e))||null}catch(e){return console.error("Error getting post by ID:",e),null}}_getUserLikeStatus(e,t){try{const n=JSON.parse(localStorage.getItem("userLikes")||"{}");return n[e]&&n[e].includes(t)}catch(e){return console.error("Error getting user like status:",e),!1}}getPostById(e){return this._getPostById(e)}getUserLikeStatus(e,t){return this._getUserLikeStatus(e,t)}_validateUserCredentials(e,t){try{return JSON.parse(localStorage.getItem("users")||"[]").find((n=>n.username===e&&n.password===t))||null}catch(e){return console.error("Error validating user credentials:",e),null}}validateUserCredentials(e,t){return this._validateUserCredentials(e,t)}_validateEmail(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)}_validatePassword(e){return e.length<6?{isValid:!1,error:"Password must be at least 6 characters long"}:/[A-Z]/.test(e)?/[0-9]/.test(e)?/[!@#$%^&*(),.?":{}|<>]/.test(e)?{isValid:!0}:{isValid:!1,error:'Password must contain at least one special character (!@#$%^&*(),.?":{}|<>) '}:{isValid:!1,error:"Password must contain at least one number"}:{isValid:!1,error:"Password must contain at least one capital letter"}}_validatePhone(e){return/^\d+$/.test(e)?10!==e.length?{isValid:!1,error:"Phone number must be exactly 10 digits long"}:{isValid:!0}:{isValid:!1,error:"Phone number can only contain numbers (0-9)"}}validatePhone(e){return this._validatePhone(e)}_validateSignUpForm(e,t,n,s,i,r){if(!(e&&t&&n&&s&&i&&r))return{isValid:!1,error:"Please fill in all fields"};if(!this._validateEmail(t))return{isValid:!1,error:"Please enter a valid email address"};const o=this._validatePassword(s);if(!o.isValid)return o;const a=this._validatePhone(n);return a.isValid?JSON.parse(localStorage.getItem("users")||"[]").find((n=>n.username===e||n.email===t))?{isValid:!1,error:"Username or email already exists"}:{isValid:!0}:a}_getSubjectReviews(e){try{const t=`subjectReviews_${e}`;return JSON.parse(localStorage.getItem(t)||"[]")}catch(e){return console.error("Error getting subject reviews:",e),[]}}_saveSubjectReview(e,t){try{const n=`subjectReviews_${e}`,s=this._getSubjectReviews(e);s.some((e=>e.author===t.author&&e.text===t.text&&e.date===t.date))||(s.unshift(t),localStorage.setItem(n,JSON.stringify(s)))}catch(e){console.error("Error saving subject review:",e)}}getSubjectReviews(e){return this._getSubjectReviews(e)}saveSubjectReview(e,t){this._saveSubjectReview(e,t)}_getTeacherReviews(e){try{const t=`teacherReviews_${e}`;return JSON.parse(localStorage.getItem(t)||"[]")}catch(e){return console.error("Error getting teacher reviews:",e),[]}}_saveTeacherReview(e,t){try{const n=`teacherReviews_${e}`,s=this._getTeacherReviews(e);s.some((e=>e.author===t.author&&e.text===t.text&&e.date===t.date))||(s.unshift(t),localStorage.setItem(n,JSON.stringify(s)))}catch(e){console.error("Error saving teacher review:",e)}}getTeacherReviews(e){return this._getTeacherReviews(e)}saveTeacherReview(e,t){this._saveTeacherReview(e,t)}_setActiveAcademicTab(e){this._myState={...this._myState,navigation:{...this._myState.navigation,activeAcademicTab:e}},this._emitChange()}getActiveAcademicTab(){return this._myState.navigation.activeAcademicTab}_deleteUserAccount(e){try{const t=JSON.parse(localStorage.getItem("posts")||"[]").filter((t=>t.name!==e));localStorage.setItem("posts",JSON.stringify(t));const n=JSON.parse(localStorage.getItem("userLikes")||"{}");delete n[e],localStorage.setItem("userLikes",JSON.stringify(n));const s=JSON.parse(localStorage.getItem("teacherRatings")||"{}");Object.keys(s).forEach((t=>{s[t]=s[t].filter((t=>t.userId!==e))})),localStorage.setItem("teacherRatings",JSON.stringify(s));const i=JSON.parse(localStorage.getItem("subjectRatings")||"{}");Object.keys(i).forEach((t=>{i[t]=i[t].filter((t=>t.userId!==e))})),localStorage.setItem("subjectRatings",JSON.stringify(i)),localStorage.removeItem("loggedInUser")}catch(e){throw console.error("Error deleting user account:",e),e}}async _updateUserProfile(e,t){try{t.degree?t.career=t.degree:t.career&&(t.degree=t.career);const n=Xp.currentUser;if(!n)throw new Error("No authenticated user found");const s=Bl(Yp,"users",n.uid);await zh(s,{username:t.username,degree:t.degree,career:t.career,semester:t.semester,phone:t.phone,bio:t.bio});const i=await Uh(s);if(!i.exists())throw new Error("User document not found after update");const r=i.data(),o=r.profilePic?`${r.profilePic}?v=${(new Date).getTime()}`:r.profilePic;console.log("[_updateUserProfile] oldUsername:",e),console.log("[_updateUserProfile] latestUserData:",r),console.log("[_updateUserProfile] updatedProfilePic (with cache-buster):",o),localStorage.setItem("loggedInUser",JSON.stringify({...r,profilePic:o}));const a=(await Gm()).filter((t=>t.name===e));for(const t of a)if(t.id)try{const n=Bl(Yp,"posts",t.id),s=(t.comments||[]).map((t=>t.name===e?(console.log(`[_updateUserProfile] Updating comment from ${e}: old career: ${t.career}, new career: ${r.career}`),{...t,career:r.career||r.degree,photo:o||t.photo}):t));console.log(`[_updateUserProfile] Post ${t.id}: updatedComments array before Firestore update:`,s),await zh(n,{name:r.username,career:r.career||r.degree,semestre:r.semester,photo:o||t.photo,comments:s}),console.log(`[_updateUserProfile] Post ${t.id} updated in Firestore. New career: ${r.career}`)}catch(e){console.error(`Error updating post ${t.id}:`,e);continue}this._myState={...this._myState,auth:{...this._myState.auth,user:{...r,profilePic:o}}};const c={};for(const t in this._myState.comments)c[t]=this._myState.comments[t].map((t=>t.name===e?{...t,career:r.career||r.degree,photo:o||t.photo}:t));console.log("[_updateUserProfile] updatedLocalComments for local state:",c),this._myState={...this._myState,comments:c};const l=this._myState.posts.map((t=>t.name===e?{...t,name:r.username,career:r.career||r.degree,semestre:r.semester,photo:o||t.photo,comments:(t.comments||[]).map((t=>t.name===e?{...t,career:r.career||r.degree,photo:o||t.photo}:t))}:t));console.log("[_updateUserProfile] updatedLocalPosts for localStorage:",l),this._myState.posts=l,localStorage.setItem("posts",JSON.stringify(l)),localStorage.setItem("comments",JSON.stringify(c)),this._emitChange(),console.log("[_updateUserProfile] Calling loadPostsFromFirestore and loadProfilePosts..."),await this.loadPostsFromFirestore(),await this.loadProfilePosts()}catch(e){throw console.error("Error updating user profile:",e),e}}deleteAccount(e){this._deleteUserAccount(e)}async updateProfile(e,t){await this._updateUserProfile(e,t)}static getInstance(){return Wm.instance||(Wm.instance=new Wm),Wm.instance}validateSignUpForm(e,t,n,s,i,r){return this._validateSignUpForm(e,t,n,s,i,r)}async setUserFromFirebase(){const e=Xp.currentUser;if(e){const t=await Uh(Bl(Yp,"users",e.uid));if(t.exists()){const e=t.data();e.degree?e.career=e.degree:e.career&&(e.degree=e.career),this._myState={...this._myState,auth:{isAuthenticated:!0,user:e}},localStorage.setItem("loggedInUser",JSON.stringify(e)),this._emitChange()}}}async updatePostLikes(e,t,n){const s=this._myState.posts.findIndex((t=>t.id===e));if(-1===s)return;let i=this._myState.posts[s].likes||0;n?(i+=1,this._myState.userLikes[t]||(this._myState.userLikes[t]=[]),this._myState.userLikes[t].includes(e)||this._myState.userLikes[t].push(e)):(i=Math.max(0,i-1),this._myState.userLikes[t]&&(this._myState.userLikes[t]=this._myState.userLikes[t].filter((t=>t!==e)))),await async function(e,t){const n=Bl(Yp,"posts",e);await zh(n,{likes:t})}(e,i),this._myState.posts[s].likes=i,this._emitChange()}}const Jm=Wm.getInstance(),Qm=Jm,Ym={createPost(e){Jm.createPost(e)},async likePost(e,t){await Jm.updatePostLikes(e,t,!0)},async unlikePost(e,t){await Jm.updatePostLikes(e,t,!1)}};class Xm extends HTMLElement{constructor(){super(),this.scrollPosition=0,this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.handleStoreChange=this.handleStoreChange.bind(this)}connectedCallback(){if(this.subscribeToStore(),this.render(),this.setupEventListeners(),Jm.getReturnToFeed()){const e=Jm.getScrollPosition();e&&setTimeout((()=>{window.scrollTo(0,e),Jm.clearReturnToFeed()}),100)}}disconnectedCallback(){Jm.saveScrollPosition(window.scrollY),window.removeEventListener("scroll",this.handleScroll.bind(this)),this.unsubscribeStore&&this.unsubscribeStore()}subscribeToStore(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange)}handleStoreChange(e){e.auth.isAuthenticated||u("/login")}setupEventListeners(){window.addEventListener("scroll",this.handleScroll.bind(this))}handleScroll(){this.scrollPosition=window.scrollY}render(){this.shadowRoot.innerHTML="\n        <style>\n          :host {\n            display: block;\n            width: 100%;\n            max-width: 100vw;\n            overflow-x: hidden;\n            background-color: white;\n          }\n        </style>\n        <nav-bar></nav-bar> \n        <tag-filters-bar></tag-filters-bar>\n        <post-container></post-container>\n        <floating-btn></floating-btn>\n        <post-modal></post-modal>\n      "}}const Zm=Xm;class ev extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML="\n            <style>\n                h2 { color: #4f46e5; }\n            </style> \n            <nav-bar></nav-bar>  \n            <tabs-component></tabs-component>\n        "}}const tv=ev;class nv extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML="\n            <style>\n                h2 { color: #4f46e5; }\n            </style>\n            \n            <nav-bar></nav-bar>\n            <profile-header></profile-header>\n            <profile-container></profile-container>\n\n        ",document.addEventListener("navigate",(e=>{const t=e.detail;"/comments-detail-feed"===t&&(window.location.href=t)}))}}const sv=nv;class iv extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML="\n            <style>\n                h2 { color: #4f46e5; }\n            </style>\n            \n            <nav-bar></nav-bar>  \n            <settings-profile-header></settings-profile-header>\n            <settings-profile-container></settings-profile-container>\n\n        "}}const rv=iv;class ov extends HTMLElement{constructor(){super(),this.unsubscribeStore=null,this.attachShadow({mode:"open"})}connectedCallback(){console.log("TeacherDetailPage: connectedCallback"),this.render(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(e){console.log("TeacherDetailPage: handleStoreChange",e),this.render()}calculateAverageRating(e){console.log("TeacherDetailPage: calculateAverageRating for",e);const t=Jm.getState().teacherRatings[e]||[];if(console.log("TeacherDetailPage: ratings from store",t),0===t.length)return console.log("TeacherDetailPage: no ratings, returning 0"),0;const n=t.reduce(((e,t)=>e+t.rating),0);console.log("TeacherDetailPage: sum of ratings",n);const s=Number((n/t.length).toFixed(1));return console.log("TeacherDetailPage: calculated average rating",s),s}render(){console.log("TeacherDetailPage: render");const e=Jm.getState();console.log("TeacherDetailPage: current state",e);const t=e.selectedTeacher;console.log("TeacherDetailPage: teacherData from store",t);const n=t?.name||"Jimmy Ramirez";console.log("TeacherDetailPage: rendering for teacher",n);const s=t?.subject||"Logic & Argumentation",i=this.calculateAverageRating(n),r=t?.nucleus||"basic",o=t?.image||"425";this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block;\n          background-color: #ffffff;\n          min-height: 100vh;\n        }\n        \n        body {\n          margin: 0;\n          background-color: #ffffff !important;\n        }\n        \n        .page-wrapper {\n          min-height: 100vh;\n          padding-bottom: 60px;\n          background-color: #ffffff;\n        }\n        \n        .teacher-detail-container {\n          max-width: 850px;\n          margin: 0 auto;\n          padding: 25px 20px;\n          font-family: 'Arial', sans-serif;\n          background-color: #f8f9fd;\n          border-radius: 20px;\n          margin-top: 20px;\n          margin-bottom: 40px;\n          margin-left: 16px;\n          margin-right: 16px;\n        }\n        \n        back-button {\n          margin-bottom: 24px;\n          display: block;\n        }\n        \n        @media (min-width: 768px) {\n          .teacher-detail-container {\n            padding: 30px;\n            margin-top: 25px;\n            margin-left: auto;\n            margin-right: auto;\n          }\n        }\n      </style>\n      <div class="page-wrapper">\n        <nav-bar></nav-bar>  \n        <div class="teacher-detail-container">\n          <back-button text="Teacher Reviews" target="/academic"></back-button>\n          <teacher-detail-card \n            name="${n}" \n            subject="${s}"\n            nucleus="${r}"\n            rating="${i}"\n            image="${o}">\n          </teacher-detail-card>\n          <teacher-comments-container teacher-name="${n}">\n          </teacher-comments-container>\n        </div>\n      </div>\n    `}}const av=ov;class cv extends HTMLElement{constructor(){super(),this.unsubscribeStore=null,this.attachShadow({mode:"open"})}connectedCallback(){console.log("SubjectDetailPage: connectedCallback"),this.render(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(e){console.log("SubjectDetailPage: handleStoreChange",e),this.render()}calculateAverageRating(e){const t=Jm.getState().subjectRatings[e]||[];if(0===t.length)return 0;const n=t.reduce(((e,t)=>e+t.rating),0);return Number((n/t.length).toFixed(1))}render(){console.log("SubjectDetailPage: render");const e=Jm.getState();console.log("SubjectDetailPage: current state",e);const t=e.selectedSubject;console.log("SubjectDetailPage: subjectData from store",t);const n=t?.name||"Logic & Argumentation",s=t?.career||"Computer Science",i=t?.credits||"3",r=this.calculateAverageRating(n),o=t?.id||"301";this.shadowRoot.innerHTML=`\n            <style>\n                :host {\n                    display: block;\n                    background-color: #ffffff;\n                    min-height: 100vh;\n                }\n                \n                body {\n                    margin: 0;\n                    background-color: #ffffff;\n                }\n                \n                .page-wrapper {\n                    min-height: 100vh;\n                    padding-bottom: 60px;\n                    background-color: #ffffff;\n                }\n                \n                .subject-detail-container {\n                    max-width: 850px;\n                    margin: 0 auto;\n                    padding: 25px 20px;\n                    font-family: 'Arial', sans-serif;\n                    background-color: #f8f9fd;\n                    border-radius: 20px;\n                    margin-top: 20px;\n                    margin-bottom: 40px;\n                }\n                \n                back-button {\n                    margin-bottom: 24px;\n                    display: block;\n                }\n                \n                @media (min-width: 768px) {\n                    .subject-detail-container {\n                        padding: 30px;\n                        margin-top: 25px;\n                    }\n                }\n            </style>\n            <div class="page-wrapper">\n                <nav-bar></nav-bar>  \n                <div class="subject-detail-container">\n                    <back-button text="Subject Reviews" target="/academic"></back-button>\n                    <subject-detail-card \n                        name="${n}" \n                        career="${s}"\n                        nucleus="Disciplinary"\n                        credits="${i}"\n                        rating="${r}"\n                        image="${o}">\n                    </subject-detail-card>\n                    <subject-comments-container subject-name="${n}">\n                    </subject-comments-container>\n                </div>\n            </div>\n        `}}const lv=cv;class hv extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML='\n    <style>\n      :host {\n        display: block;\n        color: #000;\n      }\n      .hero {\n      max-width: 1200px;\n      margin: 64px auto 96px;\n      display: grid;\n      grid-template-columns: 1fr 420px;\n      align-items: center;\n      gap: 48px;\n      padding: 0 24px;\n      grid-template-areas: "text image";\n      }\n\n         .hero .text {\n        grid-area: text;\n        }\n\n\n      .hero h1 {\n        font-size: 2.4rem;\n        font-weight: 700;\n        line-height: 1.2;\n        margin: 0 0 16px;\n      }\n\n      .hero h4 {\n        font-size: 0.90rem;\n        font-weight: 400;\n        margin: 0 0 32px;\n      }\n\n      .hero img {\n      grid-area: image;\n      width: 100%;\n      height: auto;\n      }\n\n      start-button {\n        margin-bottom: 32px;\n      }\n\n      \n      .cards-row {\n      display: grid;\n      grid-template-columns: repeat(4, 0fr);\n      gap: 15px; \n      padding: 0;\n      margin: 0;\n      max-width: 1200px;\n      margin: 0 auto; \n      padding: 0 24px;\n      margin-bottom: 40px;\n      }\n\n      .logo {\n        display: none;\n        justify-content: center;\n        align-items: center;\n        padding: 16px 0;\n      }\n\n      .logo img {\n        width: 150px;\n        height: auto;\n        display: block;\n        margin: 0 auto;\n      }\n\n      nav-bar-login-signup {\n        display: block;\n      }\n\n    @media (max-width: 768px) {\n      .hero {\n        grid-template-columns: 1fr;\n        grid-template-areas:\n          "image"\n          "text";\n        text-align: center;\n        padding: 0 16px;\n        gap: 24px;\n      }\n\n      .hero .text {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n      }\n\n      .hero h1 {\n        font-size: 1.5rem;\n      }\n\n      .hero h4 {\n        font-size: 0.95rem;\n      }\n\n      .hero img {\n        max-width: 400px;\n        margin: 0 auto;\n      }\n\n      .cards-row {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        gap: 24px;\n        padding: 0 16px;\n        margin-top: 32px;\n      }\n\n      landing-cards {\n        width: 100%;\n        max-width: 320px;\n      }\n\n      start-button {\n        margin-bottom: 16px;\n      }\n\n      .logo {\n        display: block;\n        margin-top: 16px;\n        margin-bottom: -60px\n      }\n\n      nav-bar-login-signup {\n        display: none;\n      }\n    }\n    </style>\n <nav-bar-login-signup></nav-bar-login-signup>\n    <div class="logo">\n      <img src="/assets/images/logonexobig.png" alt="Nexo Logo" />\n    </div>\n    \n    <section class="hero">\n      <div class="text">\n        <h1>Your Academic Network for<br/>Connecting, Learning and Growing.</h1>\n        <h4>Our space to share knowledge, solve doubts, and find academic support.</h4>\n        <start-button></start-button>\n      </div>\n\n      <img src="/assets/images/Science.png" alt="Science illustration"/>\n    </section>\n\n    <div class="cards-row">\n      <landing-cards\n        image="/assets/images/Freedom.png"\n        text="Find tutors and professors to help you improve your academic performance.">\n      </landing-cards>\n\n      <landing-cards\n        image="/assets/images/tasks.png"\n        text="Access materials, guides, and tools designed to enhance your learning.">\n      </landing-cards>\n\n      <landing-cards\n        image="/assets/images/search.png"\n        text="Connect with other students and professionals to share experiences and knowledge.">\n      </landing-cards>\n\n      <landing-cards\n        image="/assets/images/botle.png"\n        text="Post questions, share ideas, and learn from others in a collaborative environment.">\n      </landing-cards>\n    </div>\n  '}}const uv=hv;class dv extends HTMLElement{constructor(){super(),this.liked=!1,this.postData=null,this.postId="",this.fromProfile=!1,this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.handleStoreChange=this.handleStoreChange.bind(this)}connectedCallback(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange),this.loadPostData()}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(e){if(e.posts&&this.postData){const t=e.posts.find((e=>e.id===this.postData.id));t&&(this.postData=t,this.checkUserLikeStatus(),this.render())}}async loadPostData(){const e=Jm.getCurrentPost();if(e){this.postData=e,this.postId=this.postData.id,this.fromProfile=Jm.getFromProfile(),this.checkUserLikeStatus();try{await Jm.loadCommentsForPost(this.postId)}catch(e){console.error("Error loading comments:",e)}return this.render(),void this.setupEventListeners()}await this.fetchPostData()}async fetchPostData(){try{if(this.postId){const e=Jm.getPostById(this.postId);e?(this.postData=e,this.fromProfile=Jm.getFromProfile(),this.checkUserLikeStatus(),await Jm.loadCommentsForPost(this.postId),this.render(),this.setupEventListeners()):(console.error("Post not found"),u("/feed"))}}catch(e){console.error("Error fetching post data:",e),u("/feed")}}checkUserLikeStatus(){const e=Jm.getState().auth.user;if(e&&this.postData&&this.postData.id){const t=Jm.getUserLikes(e.username);this.liked=t.includes(this.postData.id)}else this.liked=!1}setupEventListeners(){const e=this.shadowRoot?.querySelector("back-button"),t=this.shadowRoot?.querySelector(".just-likes");this.shadowRoot?.querySelector("comment-form"),e?.addEventListener("click",(()=>{const e=Jm.getFromProfile()?"/profile":"/feed";Jm.setFromProfile(!1),u(e)})),t?.addEventListener("click",(()=>{const e=Jm.getState().auth.user;if(!e||!this.postData||!this.postData.id)return void console.warn("Cannot toggle like: user not logged in or post data missing.");const t=e.username,n=this.postData.id;Jm.getUserLikes(t).includes(n)?Ym.unlikePost(n,t):Ym.likePost(n,t)}))}render(){const e=this.postData||{photo:"https://i.pravatar.cc/150?img=3",name:"Juan Tel√≥n",date:"16/03/25",career:"Multimedia Engineering",semestre:"Semester 6",message:"Did anyone else stumble against a guy using boots in the stairs???",tag:"Daily Life",likes:19},t=Jm.getState(),n=t.posts?.find((t=>t.id===e.id)),s=n?n.likes:e.likes;this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block;\n          width: 100%;\n          max-width: 100vw;\n          overflow-x: hidden;\n          min-height: 100vh;\n          background-color: white;\n          --nexopurple: #5354ed;\n          --nexowhite: white;\n        }\n        \n        h1 {\n          color: #5354ed;\n          text-align: center;\n          margin: 2rem 0;\n          font-size: 2.2rem;\n          font-weight: 700;\n        }\n        \n        .container {\n          max-width: 850px;\n          width: calc(100% - 20px);\n          margin: 20px auto 40px auto;\n          padding: 25px 20px;\n          background-color: #f8f9fd;\n          border-radius: 20px;\n          box-sizing: border-box;\n        }\n        \n        .back-button-container {\n          margin: 1rem 0;\n        }\n        \n        .post-container {\n          background-color: white;\n          border-radius: 16px;\n          padding: 1.5rem;\n          margin-bottom: 2rem;\n          box-shadow: 0 4px 12px rgba(83, 84, 237, 0.1);\n          width: 100%;\n          max-width: 740px;\n          height: auto;\n          min-height: 240px;\n          margin-left: auto;\n          margin-right: auto;\n          box-sizing: border-box;\n        }\n        \n        .attributes-container {\n          display: flex;\n          flex-direction: column;\n          gap: 1rem;\n        }\n        \n        .user-container {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          width: 100%;\n          flex-wrap: wrap;\n          gap: 0.5rem;\n        }\n\n        .profile-container {\n          display: flex;\n          gap: 1rem;\n          align-items: center;\n        }\n\n        .name-container {\n          display: flex;\n          flex-direction: column;\n          gap: 0.2rem;\n        }\n\n        .profile-picture {\n          width: 50px;\n          height: 50px;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n\n        .name {\n          font-weight: 600;\n          margin: 0;\n        }\n\n        .date {\n          color: #5354ed;\n          font-size: 0.9rem;\n          margin: 0;\n        }\n\n        .the-career {\n          display: flex;\n          gap: 0.5rem;\n          margin-top: 0.2rem;\n        }\n\n        .career, .semestre {\n          font-size: 0.75rem;\n          color: black;\n          font-weight: bold;\n          align-items: flex-start;\n          padding: 0;\n          margin: 0;\n        }\n\n        .message-container {\n          margin-top: 1rem;\n        }\n        \n        .post-content {\n          font-size: 1.1rem;\n          line-height: 1.6;\n          margin: 0;\n          word-wrap: break-word;\n        }\n        \n        .footer {\n          display: flex;\n          justify-content: center;\n          padding-top: 0.75rem;\n          border-top: 1px solid #f0f0f0;\n        }\n        \n        .align-likes, .align-share {\n          display: flex;\n          align-items: center;\n        }\n        \n        .just-likes, .just-share {\n          background: none;\n          border: none;\n          display: flex;\n          align-items: center;\n          gap: 5px;\n          cursor: pointer;\n          padding: 5px 10px;\n          border-radius: 4px;\n          transition: all 0.2s ease;\n        }\n        \n        .just-likes:hover, .just-share:hover {\n          transform: scale(1.05);\n        }\n        \n        .like-icon {\n          stroke: #5354ed;\n          fill: none;\n          transition: all 0.2s ease;\n        }\n        \n        .like-icon.liked {\n          fill: #5354ed;\n          stroke: #5354ed;\n        }\n\n        .share-icon path {\n          transition: fill 0.3s ease;\n          fill: #5354ed;\n        }\n        \n        .likes-count, .share-count {\n          margin: 0;\n          font-size: 0.85rem;\n          font-weight: bold;\n          color: #6b7280;\n          cursor: pointer;\n        }\n\n        .tag {\n          display: inline-block;\n          padding: 4px 12px;\n          border-radius: 0.85rem;\n          font-size: 0.7rem;\n          font-weight: 500;\n          margin-bottom: 0.5rem;\n          background-color: rgb(255, 255, 255);\n          border: 2px solid rgba(31, 31, 241, 0.57);\n          color: rgba(31, 31, 241, 0.57);\n          text-align: center;\n          margin: 1rem 0;\n          position: relative;\n          z-index: 1;\n        }\n        \n        @media (max-width: 768px) {\n          .container {\n            width: calc(100% - 16px);\n            margin: 10px auto 30px auto;\n            padding: 15px 10px;\n            border-radius: 15px;\n          }\n          \n          .post-container {\n            padding: 1rem;\n          }\n          \n          .user-container {\n            flex-direction: column;\n            align-items: flex-start;\n          }\n          \n          .the-career {\n            margin-top: 0.5rem;\n            margin-left: 60px; /* Alinea con la imagen de perfil */\n          }\n          \n          h1 {\n            font-size: 1.8rem;\n            margin: 1.5rem 0;\n          }\n          \n          .post-content {\n            font-size: 1rem;\n          }\n        }\n        \n        @media (max-width: 480px) {\n          .container {\n            width: calc(100% - 10px);\n            margin: 5px auto 20px auto;\n            padding: 10px 8px;\n            border-radius: 12px;\n          }\n          \n          .post-container {\n            padding: 0.8rem;\n            min-height: 200px;\n          }\n          \n          .profile-picture {\n            width: 40px;\n            height: 40px;\n          }\n          \n          .name {\n            font-size: 0.9rem;\n          }\n          \n          .date {\n            font-size: 0.8rem;\n          }\n          \n          .the-career {\n            margin-left: 50px;\n          }\n          \n          .career, .semestre {\n            font-size: 0.7rem;\n          }\n          \n          .post-content {\n            font-size: 0.95rem;\n            line-height: 1.5;\n          }\n          \n          .likes-count, .share-count {\n            font-size: 0.75rem;\n          }\n          \n          .just-likes, .just-share {\n            padding: 3px 6px;\n          }\n          \n          .like-icon, .share-icon {\n            width: 18px;\n            height: 18px;\n          }\n          \n          .tag {\n            font-size: 0.65rem;\n            padding: 3px 10px;\n          }\n        }\n      </style>\n      \n      <nav-bar></nav-bar>\n      \n      <div class="container">\n        <div class="back-button-container">\n          <back-button></back-button>\n        </div>\n        \n        <div class="post-container">\n          <div class="attributes-container">\n            <div class="user-container">\n              <div class="profile-container">\n                <img class="profile-picture" src="${e.photo}" alt="${e.name}">\n                <div class="name-container">\n                  <p class="name">${e.name}</p>\n                  <p class="date">${e.date}</p>\n                </div>\n              </div>\n\n              <div class="the-career">\n                <p class="career">${e.career}</p>\n                <p class="semestre">${e.semestre}</p>\n              </div>\n            </div>\n\n            <div class="message-container">\n              <p class="post-content">${e.message}</p>\n            </div>\n          </div>\n\n          <p class="tag">${e.tag}</p>\n          <div class="footer">  \n            <div class="align-likes">\n              <button class="just-likes">\n                <svg class="like-icon ${this.liked?"liked":""}" viewBox="0 0 24 24" fill="none" stroke="currentColor" width="20" height="20">\n                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke-width="2"/>\n                </svg>\n                <p class="likes-count">${s} Likes</p>\n              </button>\n            </div>  \n\n            <div class="align-share">\n              <button class="just-share">\n                <svg class="share-icon" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                  <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/>\n                </svg>\n                <p class="share-count">Share</p>\n              </button>\n            </div>\n          </div>\n        </div>\n        \n        <comments-container post-id="${this.postId}"></comments-container>\n      </div>\n    `}}const pv=dv;class gv extends HTMLElement{connectedCallback(){this.innerHTML='\n    <style>\n      section {\n        width: 80%;\n        max-width: 35.625rem; \n        margin: 3rem auto;\n        padding: 1.5rem;\n        background: #ddddfb;\n        border-radius: 0.5rem;\n        border: 0.063rem solid #5354ed; \n        box-shadow: 0 0 0.375rem rgba(0, 0, 0, 0.1); \n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex-direction: column;\n      }\n\n      @media (max-width: 430px) { \n        section {\n          width: 80%;\n          height: auto;\n          margin: 3.0625rem auto; \n          padding: 0;\n          border-radius: 0;\n          border: none;\n          background: white;\n          box-shadow: none;\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n          align-items: center;\n          gap: 1rem;\n        }\n\n        header-title,\n        form-fields,\n        forgot-password,\n        primary-button,\n        custom-divider,\n        social-buttons {\n          width: 100%;\n          padding: 0 1.5rem;\n        }\n      }\n    </style>\n\n    <nav-bar-login-signup></nav-bar-login-signup>\n\n    <section>\n      <header-title title="Login" subtitle="Enter your profile info"></header-title>\n      <form-fields mode="login"></form-fields>\n      <forgot-password></forgot-password>\n      <primary-button text="Login"></primary-button>\n      <custom-divider></custom-divider>\n      <social-buttons></social-buttons>\n    </section>\n    ',this.setupLoginHandler()}setupLoginHandler(){const e=this.querySelector("primary-button");e?.addEventListener("click",(async()=>{const e=this.querySelector("#login-form");if(!e)return;const t=e.querySelector('input[type="text"]'),n=e.querySelector('input[type="password"]'),s=t?.value.trim(),i=n?.value;if(!s||!i)return void alert("Please enter both username and password.");const r=await Zp(s,i);if(!r.isLoggedIn)return void alert("Usuario o contrase√±a inv√°lidos.");if(!r.user||!r.user.user)return void alert("No user credential returned from Firebase.");const o=r.user.user,a=await Uh(Bl(Yp,"users",o.uid));if(!a.exists())return void alert("No user profile found in Firestore.");const c=a.data();M(c)}))}}const fv=gv;class mv{static validateForm(e,t,n,s,i,r){return Jm.validateSignUpForm(e,t,n,s,i,r)}static async saveUser(e){try{const t=await(async(e,t,n,s,i,r)=>{try{console.log("Registering user with username:",e);const o=Eh(zl(Yp,"users"),Th("username","==",e));if(!(await $h(o)).empty)return{isRegistered:!1,error:"Username already exists"};const a=await async function(e,t,n){if(kt(e.app))return Promise.reject(Zh(e));const s=sd(e),i=pd(s,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Dd,"EMAIL_PASSWORD_PROVIDER"),r=await i.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Fd(e),t})),o=await Od._fromIdTokenResponse(s,"signIn",r);return await s._updateCurrentUser(o.user),o}(Xp,t,r),c={uid:a.user.uid,username:e,email:t,phone:n,career:s,semester:i,createdAt:(new Date).toISOString()};return await Vh(Bl(Yp,"users",a.user.uid),c),{isRegistered:!0,user:a}}catch(e){return console.error(e),{isRegistered:!1,error:e}}})(e.username,e.email,e.phone,e.degree,e.semester,e.password);return t.isRegistered?{success:!0}:{success:!1,error:t.error}}catch(e){return{success:!1,error:"Failed to register user"}}}}class vv{static setError(e){r.dispatch({type:R,payload:{error:e}})}static validateSignUpForm(e,t,n,s){const i=e.get("username"),r=e.get("email"),o=e.get("phone"),a=e.get("password");if(!(i&&r&&o&&a&&t&&n))return{isValid:!1,error:"Please complete all fields"};if(!s?.checked)return{isValid:!1,error:"You must accept the terms of use"};const c=mv.validateForm(i,r,o,a,t,n);return c.isValid?{isValid:!0}:c}static async initiateSignUp(e){const t=mv.validateForm(e.username,e.email,e.phone,e.password,e.degree,e.semester);if(t.isValid){r.dispatch({type:C,payload:e});try{const t=await mv.saveUser(e);if(!t.success)return void r.dispatch({type:R,payload:{error:t.error||"An error occurred during sign up"}});r.dispatch({type:A}),u("/feed")}catch(e){r.dispatch({type:R,payload:{error:"An error occurred during sign up"}})}}else r.dispatch({type:R,payload:{error:t.error}})}}class bv extends HTMLElement{connectedCallback(){this.innerHTML='\n      <style>\n        section {\n          width: 80%;\n          max-width: 35.625rem; \n          margin: 3rem auto;\n          padding: 1.5rem;\n          background: #ddddfb;\n          border-radius: 0.5rem;\n          border: 0.063rem solid #5354ed; \n          box-shadow: 0 0 0.375rem rgba(0, 0, 0, 0.1); \n          display: flex;\n          justify-content: center;\n          align-items: center;\n          flex-direction: column;\n        }\n\n        .error-message {\n          color: #ff0000;\n          font-size: 0.875rem;\n          margin: 0.5rem 0 1rem 0;\n          text-align: center;\n          display: none;\n        }\n\n        @media (max-width: 430px) { \n          section {\n            width: 80%;\n            height: auto;\n            margin: 3.0625rem auto; \n            padding: 0;\n            border-radius: 0;\n            border: none;\n            background: white;\n            box-shadow: none;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n            gap: 1rem;\n          }\n\n          header-title,\n          signup-form-fields,\n          custom-checkbox,\n          primary-button,\n          custom-divider,\n          social-buttons {\n            width: 100%;\n            padding: 0 1.5rem;\n          }\n        }\n      </style>\n\n      <nav-bar-login-signup></nav-bar-login-signup>\n\n      <section>\n        <header-title title="Sign Up" subtitle="Enter your info"></header-title>\n        <div class="error-message" id="error-message"></div>\n        <signup-form-fields></signup-form-fields>\n        <custom-checkbox></custom-checkbox>\n        <primary-button text="Sign Up"></primary-button>\n        <custom-divider></custom-divider>\n        <social-buttons></social-buttons>\n      </section>\n    ',this.setupEventListeners(),this.setupStoreSubscription()}setupStoreSubscription(){Jm.subscribe((e=>{const t=this.querySelector("#error-message");this.querySelector("signup-form-fields"),t&&(e.signUp.error?(t.textContent=e.signUp.error,t.style.display="block"):t.style.display="none")}))}setupEventListeners(){const e=this.querySelector("primary-button"),t=this.querySelector("signup-form-fields");e?.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const n=this.querySelector("#signup-form"),s=this.querySelector('input[name="terms"]');if(!n||!t)return;const i=new FormData(n),r=t.getDegree(),o=t.getSemester(),a=vv.validateSignUpForm(i,r,o,s);if(a.isValid)await vv.initiateSignUp({username:i.get("username"),email:i.get("email"),phone:i.get("phone"),password:i.get("password"),degree:r,semester:o});else{const e=this.querySelector("#error-message");e&&(e.textContent=a.error||"An error occurred",e.style.display="block")}}))}}const yv=bv;class wv extends HTMLElement{constructor(){super(),this.isRendered=!1,this.isOpen=!1,this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.isRendered=!0,this.setupStoreSubscription()}setupStoreSubscription(){Jm.subscribe((e=>{this.isRendered&&e.postModal.isOpen!==this.isOpen&&(this.isOpen=e.postModal.isOpen,this.isOpen?this.openModal():this.closeModal())}))}render(){this.shadowRoot.innerHTML='\n      <style>\n        * {\n          font-family: Arial, sans-serif;\n          box-sizing: border-box;\n          margin: 0;\n          padding: 0;\n        }\n\n        .modal-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background-color: rgba(0, 0, 0, 0.5);\n          z-index: 1000;\n          opacity: 0;\n          transition: opacity 0.3s ease;\n          backdrop-filter: blur(1px);\n          display: none;\n        }\n\n        .modal-overlay.visible {\n          opacity: 1;\n        }\n\n        .modal {\n          position: fixed;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%) scale(0.9);\n          display: flex;\n          flex-direction: column;\n          background: white;\n          width: 550px;\n          border-radius: 25px;\n          overflow: hidden;\n          box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.15);\n          z-index: 1001;\n          opacity: 0;\n          transition: all 0.3s ease;\n          display: none;\n        }\n\n        .modal.visible {\n          opacity: 1;\n          transform: translate(-50%, -50%) scale(1);\n        }\n\n        .modal-header {\n          background: var(--nexopurple, #5354ED);\n          color: white;\n          padding: 25px 30px;\n          font-size: 28px;\n          font-weight: bold;\n          font-style: italic;\n          text-align: left;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n\n        .close-btn {\n          background: none;\n          border: none;\n          cursor: pointer;\n          padding: 5px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .close-btn img {\n          width: 24px;\n          height: 24px;\n          filter: brightness(0) invert(1);\n          transition: transform 0.2s ease;\n        }\n\n        .close-btn:hover img {\n          transform: scale(1.1);\n        }\n\n        .modal-body {\n          padding: 30px;\n          display: flex;\n          flex-direction: column;\n          gap: 25px;\n          position: relative;\n        }\n\n        .textarea-container {\n          position: relative;\n          width: 100%;\n        }\n\n        textarea {\n          width: 100%;\n          height: 120px;\n          padding: 20px;\n          padding-bottom: 60px;\n          border: 1px solid #E0E0E0;\n          border-radius: 20px;\n          font-size: 16px;\n          resize: none;\n          transition: border-color 0.2s ease;\n          background: #FFFFFF;\n        }\n\n        textarea:focus {\n          outline: none;\n          border-color: var(--nexopurple, #5354ED);\n        }\n\n        textarea::placeholder {\n          color: #9E9E9E;\n          font-size: 16px;\n        }\n\n        .categories {\n          display: flex;\n          justify-content: flex-start;\n          gap: 40px;\n          padding: 0 10px;\n        }\n\n        .category {\n          display: flex;\n          align-items: center;\n          gap: 10px;\n          cursor: pointer;\n        }\n\n        .category input[type="radio"] {\n          appearance: none;\n          -webkit-appearance: none;\n          width: 24px;\n          height: 24px;\n          border: 2px solid var(--nexopurple, #5354ED);\n          border-radius: 50%;\n          margin: 0;\n          position: relative;\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n\n        .category input[type="radio"]:checked {\n          background-color: var(--nexopurple, #5354ED);\n          border-width: 7px;\n        }\n\n        .category label {\n          font-size: 16px;\n          color: #000000;\n          cursor: pointer;\n          font-weight: 500;\n        }\n\n        .upload-box {\n          border: 2px dashed var(--nexopurple, #5354ED);\n          border-radius: 50px;\n          padding: 15px;\n          text-align: center;\n          color: var(--nexopurple, #5354ED);\n          cursor: pointer;\n          transition: all 0.2s ease;\n          font-style: italic;\n          opacity: 0.6;\n          font-size: 16px;\n        }\n\n        .upload-box:hover {\n          opacity: 1;\n          background-color: rgba(83, 84, 237, 0.05);\n        }\n\n        .publish-btn {\n          position: absolute;\n          bottom: 15px;\n          right: 15px;\n          background-color: var(--nexopurple, #5354ED);\n          color: white;\n          font-size: 14px;\n          border: 2px solid black;\n          padding: 7px 30px;\n          border-radius: 50px;\n          cursor: pointer;\n          outline: none;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          transition: all 0.3s ease;\n        }\n\n        .publish-btn:hover {\n          filter: brightness(1.2);\n          transform: scale(1.05);\n          -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n          -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n          box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n        }\n\n        .publish-btn:active {\n          transform: scale(0.95);\n          -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n          -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n          box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n          filter: brightness(0.8);\n        }\n\n        .publish-btn img {\n          width: 18px;\n          height: 18px;\n          filter: brightness(0) invert(1);\n          margin-left: 8px;\n        }\n\n        input[type="file"] {\n          display: none;\n        }\n\n        @media (max-width: 600px) {\n          .modal {\n            width: 90%;\n            margin: 20px;\n          }\n\n          .categories {\n            gap: 20px;\n          }\n        }\n      </style>\n\n      <div class="modal-overlay">\n        <div class="modal">\n          <div class="modal-header">\n            New Post\n            <button class="close-btn">\n              <img src="https://api.iconify.design/lucide:x.svg" alt="Close">\n            </button>\n          </div>\n          <div class="modal-body">\n            <div class="textarea-container">\n              <textarea id="post-content" placeholder="Write something"></textarea>\n              <button class="publish-btn">\n                Post\n                <img src="https://api.iconify.design/lucide:send.svg" alt="Send">\n              </button>\n            </div>\n            <div class="categories">\n              <div class="category">\n                <input type="radio" id="daily-life" name="category" value="Daily Life" checked>\n                <label for="daily-life">Daily Life</label>\n              </div>\n              <div class="category">\n                <input type="radio" id="carpool" name="category" value="Carpool">\n                <label for="carpool">Carpool</label>\n              </div>\n              <div class="category">\n                <input type="radio" id="academics" name="category" value="Academics">\n                <label for="academics">Academics</label>\n              </div>\n            </div>\n            <label class="upload-box" for="file-upload">\n              Upload Image\n              <input type="file" id="file-upload" accept="image/*">\n            </label>\n          </div>\n        </div>\n      </div>\n    ',this.setupEventListeners()}setupEventListeners(){const e=this.shadowRoot?.querySelector(".close-btn"),t=this.shadowRoot?.querySelector(".modal-overlay"),n=this.shadowRoot?.querySelector(".publish-btn"),s=this.shadowRoot?.querySelector("#post-content"),i=this.shadowRoot?.querySelector("#file-upload"),r=this.shadowRoot?.querySelectorAll('input[name="category"]');e&&t&&n&&s&&i&&r&&(e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),qm()})),t.addEventListener("click",(e=>{e.target===t&&qm()})),n.addEventListener("click",(async e=>{e.preventDefault();const t=s.value.trim(),n=Array.from(r).find((e=>e.checked))?.value||"Daily Life",o=i.files?.[0]||null;if(!t)return void alert("Por favor escribe algo antes de publicar");let a=null;o&&(a=await new Promise(((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsDataURL(o)}))),Ym.createPost({content:t,category:n,image:a,createdAt:(new Date).toISOString()}),s.value="",i.value="";const c=this.shadowRoot?.querySelector("#daily-life");c&&(c.checked=!0),qm()})),i.addEventListener("change",(e=>{e.target.files})))}openModal(){console.log("PostModal: Abriendo modal");const e=this.shadowRoot?.querySelector(".modal-overlay"),t=this.shadowRoot?.querySelector(".modal");e&&t?(e.style.display="block",t.style.display="block",requestAnimationFrame((()=>{e.classList.add("visible"),t.classList.add("visible")}))):console.error("PostModal: No se encontraron los elementos del modal al intentar abrir")}closeModal(){const e=this.shadowRoot?.querySelector(".modal-overlay"),t=this.shadowRoot?.querySelector(".modal");e&&t?(e.classList.remove("visible"),t.classList.remove("visible"),setTimeout((()=>{e.style.display="none",t.style.display="none"}),300)):console.error("PostModal: No se encontraron los elementos del modal al intentar cerrar")}}const xv=wv;class _v extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.shadowRoot.innerHTML='\n     <style>\n     \n.fab {\n    position: fixed;\n    bottom: 30px;\n    right: 30px;\n    width: 56px;\n    height: 56px;\n    border-radius: 50%;\n    background-color: var(--nexopurple);\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: transform 0.2s, box-shadow 0.2s;\n    border: none;\n}\n\n.fab:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);\n}\n\n.fab:active {\n    transform: translateY(0);\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.fab svg {\n    width: 24px;\n    height: 24px;\n    fill: var(--nexowhite);\n}\n\n\n    </style>        \n     <button class="fab" title="Crear Publicaci√≥n">\n        <img src="https://api.iconify.design/lucide:plus.svg?color=white" alt="Plus Icon">\n      </button>\n    ',this.shadowRoot.querySelector("button").addEventListener("click",(e=>{var t;e.preventDefault(),e.stopPropagation(),t="",r.dispatch({type:Bm.OPEN_POST_MODAL,payload:{postId:t}})}))}}const Sv=_v;var Ev;!function(e){e.textbutton="textbutton",e.active="active"}(Ev||(Ev={}));class kv extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.values(Ev)}attributeChangedCallback(e,t,n){e===Ev.active&&(this.active=null!==n,this.render())}connectedCallback(){this.render()}render(){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n          <style>\n            button {\n              padding: 8px 40px;\n              border-radius: 999px;\n              border: 2px solid #5354ED;\n              color: #5354ED;\n              background-color: white;\n              font-size: 14px;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              width: 100%;\n              max-width: 100%;\n              text-overflow: ellipsis;\n              overflow: hidden;\n              white-space: nowrap;\n            }\n  \n            button:hover {\n              background-color:rgba(83, 83, 237, 0.32);\n              color:#5354ED; \n            }\n  \n            button:active {\n              background-color:#5354ED;\n              color:rgb(255, 255, 255);\n            }\n\n            button.active {\n              background-color:#5354ED;\n              color:rgb(255, 255, 255);\n            }\n\n            @media (max-width: 644px) {\n              button {\n                padding: 8px 12px;\n                font-size: 13px;\n                width: 100%;\n              }\n            }\n\n            @media (max-width: 400px) {\n              button {\n                padding: 6px 8px;\n                font-size: 12px;\n                border-width: 1.5px;\n              }\n            }\n          </style>\n  \n          <button class="${this.active?"active":""}">${this.getAttribute("textbutton")}</button>\n        `)}}const Tv=kv,Iv=window;class Cv extends HTMLElement{constructor(){super(),this.filteredPosts=[],this.currentFilter="All",this.tagSelectedListener=null,this.postPublishedListener=null,this.profileUpdatedListener=null,this.isListenerAttached=!1,this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.handleStoreChange=this.handleStoreChange.bind(this)}connectedCallback(){this.subscribeToStore(),this.setupEventListeners()}disconnectedCallback(){this.tagSelectedListener&&document.removeEventListener("tagSelected",this.tagSelectedListener),this.postPublishedListener&&document.removeEventListener("post-published",this.postPublishedListener),this.profileUpdatedListener&&document.removeEventListener("profile-updated",this.profileUpdatedListener),this.unsubscribeStore&&this.unsubscribeStore()}subscribeToStore(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange)}setupEventListeners(){this.isListenerAttached||(this.tagSelectedListener=e=>{e.detail},document.addEventListener("tagSelected",this.tagSelectedListener),this.postPublishedListener=()=>{Hm()},document.addEventListener("post-published",this.postPublishedListener),this.profileUpdatedListener=()=>{Hm()},document.addEventListener("profile-updated",this.profileUpdatedListener),this.isListenerAttached=!0,Iv.postContainerConnected=!0)}handleStoreChange(e){this.filteredPosts=Jm.getFilteredPosts(e.selectedTag),this.render()}render(){if(!this.shadowRoot)return;const e=this.filteredPosts.length>0?this.filteredPosts.map((e=>{const t=e.photo?e.photo.replace(/"/g,"&quot;"):"",n=e.name?e.name.replace(/"/g,"&quot;"):"",s=e.date?e.date.replace(/"/g,"&quot;"):"",i=e.career?e.career.replace(/"/g,"&quot;"):"",r=e.semestre?e.semestre.replace(/"/g,"&quot;"):"",o=e.message?e.message.replace(/"/g,"&quot;"):"",a=e.tag?e.tag.replace(/"/g,"&quot;"):"",c=e.share?e.share.replace(/"/g,"&quot;"):"";return`\n              <feed-post\n                ${e.id?`id="${e.id}"`:""}\n                photo="${t}"\n                name="${n}"\n                date="${s}"\n                career="${i}"\n                semestre="${r}"\n                message="${o}"\n                tag="${a}"\n                likes="${e.likes||0}"\n                share="${c}"\n                comments='${JSON.stringify(e.comments||[])}'\n                image="${e.image?e.image.replace(/"/g,"&quot;"):""}"\n              ></feed-post>\n            `})).join(""):'\n        <div class="no-posts">\n          <p class="no-posts-title">No posts yet</p>\n          <p class="subtitle">Be the first to share something interesting</p>\n        </div>\n      ';this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block;\n          width: 100%;\n          min-height: 100vh;\n        }\n\n        .posts-container {\n          max-width: 800px;\n          margin: 0 auto;\n          padding: 20px;\n        }\n\n        .no-posts {\n          text-align: center;\n          padding: 40px 20px;\n          background: white;\n          border-radius: 15px;\n          margin: 20px auto;\n          max-width: 690px;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n        }\n\n        .no-posts p {\n          margin: 0;\n          color: #1f2937;\n        }\n\n        .no-posts-title {\n          font-size: 1.5rem;\n          font-weight: bold;\n          color: #4a4a4a;\n          margin-bottom: 10px !important;\n          animation: float 3s ease-in-out infinite;\n        }\n\n        @keyframes float {\n          0% { transform: translateY(0); }\n          50% { transform: translateY(-10px); }\n          100% { transform: translateY(0); }\n        }\n\n        .no-posts .subtitle {\n          color: #6b7280;\n          font-size: 1rem;\n        }\n\n        @media (max-width: 576px) {\n          .posts-container {\n            padding: 10px;\n          }\n\n          .no-posts {\n            margin: 10px;\n            padding: 30px 15px;\n          }\n\n          .no-posts-title {\n            font-size: 1.2rem;\n          }\n\n          .no-posts .subtitle {\n            font-size: 0.9rem;\n          }\n        }\n      </style>\n      <div class="posts-container">\n        ${e}\n      </div>\n    `}}console.log("se carg√≥ este archivo");const Av={selectTag(e){r.dispatch({type:Km.SELECT_TAG,payload:e})}};class Rv extends HTMLElement{constructor(){super(),this.activeTag="All",this.attachShadow({mode:"open"}),this.setupStoreSubscription()}setupStoreSubscription(){Jm.subscribe((e=>{this.activeTag!==e.selectedTag&&(this.activeTag=e.selectedTag,this.updateActiveButton())}))}connectedCallback(){this.render(),setTimeout((()=>{this.addEventListeners(),this.updateActiveButton()}),0)}addEventListeners(){this.shadowRoot.querySelectorAll("button-tags").forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("textbutton");t&&Av.selectTag(t)}))}))}updateActiveButton(){this.shadowRoot.querySelectorAll("button-tags").forEach((e=>{e.getAttribute("textbutton")===this.activeTag?e.setAttribute("active","true"):e.removeAttribute("active")}))}render(){this.shadowRoot.innerHTML='\n    <style>\n      .section-buttons {\n        width: 100%;\n        display: flex;\n        gap: 6%;\n        padding: 2% 0;\n        justify-self: center;\n        justify-content: center;\n        flex-wrap: wrap;\n      }\n\n      @media (max-width: 644px) {\n        .section-buttons {\n          gap: 4%;\n          padding: 3% 2%;\n          row-gap: 12px;\n        }\n\n        .button-tags {\n          margin-bottom: 0;\n          width: 48%;\n          min-width: 48%;\n          max-width: 48%;\n          height: 40px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          padding: 8px 12px;\n          flex: none;\n        }\n      }\n\n      @media (max-width: 400px) {\n        .section-buttons {\n          gap: 3%;\n          padding: 3% 2%;\n          row-gap: 10px;\n        }\n\n        .button-tags {\n          width: 47%;\n          min-width: 47%;\n          max-width: 47%;\n          height: 36px;\n          font-size: 0.85rem;\n          padding: 6px 8px;\n        }\n      }\n    </style>\n      <section class="section-buttons">\n        <button-tags textbutton="All"></button-tags>\n        <button-tags textbutton="Daily Life"></button-tags>\n        <button-tags textbutton="Carpool"></button-tags>\n        <button-tags textbutton="Academics"></button-tags>\n      </section>\n    '}}const Pv=Rv;class Lv extends HTMLElement{constructor(){super(),this.liked=!1,this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.post={id:"",photo:"",name:"",career:"",semestre:"",message:"",tag:"",likes:0,date:"",share:"",comments:[]}}static get observedAttributes(){return["photo","name","career","semestre","message","tag","likes","date","share","comments","id","image"]}attributeChangedCallback(e,t,n){if("likes"===e)this.post.likes=n?Number(n):0;else if("comments"===e)try{this.post.comments=JSON.parse(n)}catch{this.post.comments=[]}else"id"===e?this.post.id=n:"image"===e?this.post.image=n:"string"==typeof n&&(this.post[e]=n);this.render()}connectedCallback(){this.render(),this.setupEventListeners(),this.subscribeToStore()}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}subscribeToStore(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}handleStoreChange(e){const t=e.auth.user,n=t?.username||"",s=e.userLikes[n]||[],i=this.post.id||"",r=!!i&&s.includes(i),o=this.shadowRoot?.querySelector(".just-likes")?.classList.contains("liked");r!==o&&this.render()}setupEventListeners(){const e=this.shadowRoot?.querySelector(".just-comments");e?.addEventListener("click",(()=>{this.post.id&&(Jm.saveCurrentPost(this.post),Jm.setFromProfile(!1),u("/comments-detail"))}));const t=this.shadowRoot?.querySelector(".just-share");t?.addEventListener("click",(()=>{var e;this.post.id&&(e=this.post.id,r.dispatch({type:Bm.SHARE_POST,payload:{postId:e}}))}));const n=this.shadowRoot?.querySelector(".just-likes");n?.addEventListener("click",(()=>{if(this.post.id){const e=Jm.getState(),t=e.auth.user;if(t){const n=t.username;(e.userLikes[n]||[]).includes(this.post.id)?Ym.unlikePost(this.post.id,n):Ym.likePost(this.post.id,n)}else console.log("User not logged in, cannot like post."),this.showNotification("Please log in to like posts.")}}))}render(){if(this.shadowRoot){let e=!1;const t=Jm.getState(),n=t.auth.user;if(n&&this.post.id){const s=n.username;(t.userLikes[s]||[]).includes(this.post.id)&&(e=!0)}this.shadowRoot.innerHTML=`\n        <style>\n          .post {\n            background: white;\n            border-radius: 15px;\n            padding: 25px 25px 5px 25px;\n            margin: 15px auto;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n            width: 690px;\n            min-height: 190.578px;\n            border: 0.125rem solid rgba(0, 0, 0, 0.56);\n            display: block;\n          }\n\n          .footer {\n            display: flex;\n            justify-content: space-between;\n            margin: 0;\n            gap: 0.5rem;\n          }\n\n          .message-container {\n            font-size: 0.95rem;\n            margin: 0;\n          }\n\n          .message {\n            margin: 0;\n          }\n\n          .like-container {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            align-items: flex-button;\n            border: none;\n            background: none;\n          }\n\n          .profile-picture {\n            border-radius: 50%;\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n          }\n\n          .name {\n            color: black;\n            font-weight: bold;\n            margin: 0;\n            font-size: 1rem;\n            display: inline-block;\n          }\n\n          .like-icon path {\n            color: #6b7280;\n            transition: all 0.3s ease;\n            stroke: #5354ed;\n            stroke-width: 2;\n            display: flex;\n            align-items: center;\n            background: none;\n            border: none;\n            cursor: pointer;\n            font-size: 0.9rem;\n            padding: 5px 10px;\n          }\n          .liked path {\n            fill: #5354ed;\n          }\n\n          .likes-count {\n            margin-bottom: 0.5rem;\n          }\n\n          .tag {\n            display: inline-block;\n            padding: 4px 12px;\n            border: 2px solid rgba(31, 31, 241, 0.57);\n            border-radius: 0.85rem;\n            color: rgba(31, 31, 241, 0.57);\n            background-color: rgb(255, 255, 255);\n            font-weight: 500;\n            font-size: 0.7rem;\n            text-align: center;\n            margin: 1rem 0;\n            position: relative;\n            z-index: 1;\n          }\n          .user-container {\n            display: flex;\n            align-items: flex-start;\n            gap: 12px;\n            justify-content: space-between;\n          }\n\n          .profile-container {\n            display: flex;\n            align-items: center;\n            gap: 1rem;\n            align-items: flex-start;\n          }\n\n          .career {\n            color: black;\n            font-weight: bold;\n            align-items: flex-start;\n            padding: 0;\n            margin: 0;\n          }\n\n          .semestre {\n            color: black;\n            font-weight: bold;\n            padding: 0;\n            margin: 0;\n          }\n\n          .the-career {\n            text-align: right;\n            display: flex;\n            gap: 0.2rem;\n            font-size: 14px;\n          }\n\n          .name-container {\n            display: flex;\n            flex-direction: column;\n            line-height: 1.2;\n          }\n\n          .date {\n            display: inline-block;\n            transform: translateY(-10px);\n            font-size: 0.95rem;\n            color: #666;\n          }\n\n          .just-likes,\n          .just-comments,\n          .just-share {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 0.4rem;\n            font-size: 0.85rem;\n            font-weight: bold;\n            padding: 0.5rem 0;\n            border: none;\n            background: none;\n            color: #6b7280;\n            cursor: pointer;\n            transition: transform 0.3s ease;\n          }\n\n          .just-likes:hover,\n          .just-comments:hover,\n          .just-share:hover {\n            transform: scale(1.03);\n          }\n\n          .just-likes:active,\n          .just-comments:active,\n          .just-share:active {\n            transform: scale(0.97);\n          }\n\n          .comment-icon path,\n          .share-icon path {\n            transition: fill 0.3s ease;\n            fill: #5354ed;\n          }\n\n          .just-likes:hover .comment-icon path {\n            fill: #3a3b9e;\n          }\n\n          .just-likes:active .comment-icon path {\n            fill: #2d2e7a;\n          }\n\n          .liked path {\n            fill: #5354ed;\n          }\n\n          .attributes-container {\n            display: flex;\n            flex-direction: column;\n          }\n\n          hr {\n            border: none;\n            border-top: 1px solid #ddd;\n            margin: 0;\n            width: 100%;\n            position: relative;\n            z-index: 0;\n          }\n\n          .like-icon {\n            transition: all 0.3s ease;\n          }\n\n          .like-icon:hover {\n            transform: scale(1.1);\n          }\n\n          .just-likes:active .like-icon {\n            transform: scale(0.9);\n          }\n\n          @keyframes heartBeat {\n            0% {\n              transform: scale(1);\n            }\n            14% {\n              transform: scale(1.3);\n            }\n            28% {\n              transform: scale(1);\n            }\n            42% {\n              transform: scale(1.3);\n            }\n            70% {\n              transform: scale(1);\n            }\n          }\n\n          .liked .just-likes {\n            animation: heartBeat 1s ease;\n          }\n\n          .liked .like-icon path {\n            fill: #5354ed;\n            stroke: #5354ed;\n          }\n\n          .notification {\n            position: fixed;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background-color: #5354ed;\n            color: white;\n            padding: 10px 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n            z-index: 1000;\n            animation: notification-enter 0.5s forwards;\n          }\n\n          @keyframes notification-enter {\n            0% {\n              opacity: 0;\n              transform: translate(-50%, 20px);\n            }\n            100% {\n              opacity: 1;\n              transform: translate(-50%, 0);\n            }\n          }\n\n          @keyframes notification-exit {\n            0% {\n              opacity: 1;\n              transform: translate(-50%, 0);\n            }\n            100% {\n              opacity: 0;\n              transform: translate(-50%, 20px);\n            }\n          }\n\n          .notification-exit {\n            animation: notification-exit 0.8s forwards;\n          }\n\n          @media (max-width: 576px) {\n            .post {\n              width: 90%;\n              padding: 15px 15px 5px 15px;\n              margin: 10px auto;\n            }\n\n            .user-container {\n              flex-direction: row;\n              justify-content: space-between;\n              align-items: flex-start;\n              gap: 8px;\n            }\n\n            .profile-container {\n              width: auto;\n              justify-content: flex-start;\n            }\n\n            .the-career {\n              text-align: right;\n              margin-top: 0;\n              align-self: flex-start;\n              min-width: fit-content;\n            }\n\n            .message-container {\n              font-size: 0.9rem;\n            }\n\n            .footer {\n              flex-direction: row;\n              gap: 0.5rem;\n              margin-top: 10px;\n            }\n\n            .just-likes,\n            .just-comments,\n            .just-share {\n              flex: 1;\n              justify-content: center;\n              padding: 0.3rem 0;\n              font-size: 0.8rem;\n            }\n\n            .tag {\n              display: inline-block;\n              max-width: 120px; /* Ajusta el valor seg√∫n tu dise√±o */\n              overflow: hidden;\n              text-overflow: ellipsis;\n              white-space: nowrap;\n              padding: 4px 12px;\n              border: 2px solid rgba(31, 31, 241, 0.57);\n              border-radius: 0.85rem;\n              color: rgba(31, 31, 241, 0.57);\n              background-color: rgb(255, 255, 255);\n              font-weight: 500;\n              font-size: 0.7rem;\n              text-align: center;\n              margin: 1rem 0;\n              position: relative;\n              z-index: 1;\n            }\n\n            .profile-picture {\n              width: 40px;\n              height: 40px;\n            }\n\n            .name {\n              font-size: 0.95rem;\n            }\n\n            .date {\n              font-size: 0.85rem;\n              transform: translateY(0);\n            }\n          }\n\n          .post-image {\n          display: block;\n          max-width: 100%;\n          width: 220px;      /* Puedes ajustar el ancho */\n          height: 160px;     /* Altura fija */\n          object-fit: cover; /* Recorta la imagen si es necesario */\n          margin-top: 10px;\n          border-radius: 10px;\n        }\n        </style>\n        <div class="post">\n          <div class="attributes-container">\n            <div class="user-container"> \n              <div class="profile-container">\n                <img class="profile-picture" src="${this.post.photo}" alt="Profile Picture">\n                <div class="name-container">\n                  <p class="name">${this.post.name}</p>\n                  <p class="date">${this.post.date}</p>\n                </div>\n              </div>\n\n              <div class="the-career">\n                <p class="career">${this.post.career}</p>\n                <p class="semestre">${this.post.semestre}</p>\n              </div>\n            </div>\n\n      <div class="message-container">\n        <p class="message">${this.post.message}</p>\n        ${this.post.image?`<img class="post-image" src="${this.post.image}" alt="Imagen del post">`:""}\n        <p class="tag">${this.post.tag}</p>\n      </div>\n          \n          <hr>\n          <div class="footer">  \n             <div class="align-likes">\n              <button class="just-likes ${e?"liked":""}">\n                <svg class="like-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" width="20" height="20">\n                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke-width="2"/>\n                </svg>\n                <p class="likes-count">${this.post.likes} Likes</p>\n              </button>\n            </div>  \n\n            <div class="align-comments">\n              <button class="just-comments">\n                <svg class="comment-icon" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                  <path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n                </svg>\n                <p class="comments-count">${this.post.comments&&this.post.comments.length>0?this.post.comments.length+" Comments":" comment"}</p>\n              </button>\n            </div>\n\n            <div class="align-share">\n              <button class="just-share">\n                <svg class="share-icon" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                  <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/>\n                </svg>\n                <p class="share-count">Shared</p>\n              </button>\n            </div>\n          </div>\n        </div>\n        <comments-modal></comments-modal>\n      `}}showNotification(e){const t=document.createElement("style");t.textContent="\n      .feed-post-notification {\n        position: fixed;\n        bottom: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background-color: #5354ed;\n        color: white;\n        padding: 10px 20px;\n        border-radius: 5px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n        z-index: 1000;\n        animation: notification-enter 0.5s forwards;\n      }\n      \n      @keyframes notification-enter {\n        0% {\n          opacity: 0;\n          transform: translate(-50%, 20px);\n        }\n        100% {\n          opacity: 1;\n          transform: translate(-50%, 0);\n        }\n      }\n      \n      @keyframes notification-exit {\n        0% {\n          opacity: 1;\n          transform: translate(-50%, 0);\n        }\n        100% {\n          opacity: 0;\n          transform: translate(-50%, 20px);\n        }\n      }\n      \n      .notification-exit {\n        animation: notification-exit 0.8s forwards;\n      }\n    ";const n=document.createElement("div");n.className="feed-post-notification",n.textContent=e,document.head.appendChild(t),document.body.appendChild(n),setTimeout((()=>{n.classList.add("notification-exit"),setTimeout((()=>{document.body.removeChild(n),document.head.removeChild(t)}),800)}),2e3)}}const Dv=Lv;class Ov extends HTMLElement{constructor(){super(),this.liked=!1,this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.post={id:"",photo:"",name:"",career:"",semestre:"",message:"",tag:"",likes:0,date:"",share:"",comments:[]}}static get observedAttributes(){return["id","photo","name","career","semestre","message","tag","likes","date","share","comments"]}attributeChangedCallback(e,t,n){if("likes"===e)this.post.likes=n?Number(n):0;else if("comments"===e)try{this.post.comments=JSON.parse(n)}catch{this.post.comments=[]}else"string"==typeof n&&(this.post[e]=n);const s=this.shadowRoot?.querySelector(".comments-count");s&&this.post.comments&&(s.textContent=`${this.post.comments.length} Comments`),this.render()}connectedCallback(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this)),this.render()}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(e){if(this.post.id){const t=Jm.getUserLikes(e.auth.user?.username||"");this.liked=t.includes(this.post.id),this.render()}}render(){if(this.shadowRoot){const e=Jm.getState().auth.user;let t=!1;e&&this.post.id&&(t=Jm.getUserLikes(e.username).includes(this.post.id)),this.shadowRoot.innerHTML=`\n        <style>\n          .post {\n            background: white;\n            border-radius: 15px;\n            padding: 25px 25px 5px 25px;\n            margin: 15px auto;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n            width: 690px;\n            min-height: 190.578px;\n            border: 0.125rem solid rgba(0, 0, 0, 0.56);\n            display: block;\n          }\n\n          .footer {\n            display: flex;\n            justify-content: space-between;\n            margin: 0;\n            gap: 0.5rem;\n          }\n\n          .message-container {\n            font-size: 0.95rem;\n            margin: 0;\n          }\n\n          .message {\n            margin: 0;\n          }\n\n          .like-container {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            align-items: flex-button;\n            border: none;\n            background: none;\n          }\n\n          .profile-picture {\n            border-radius: 50%;\n            width: 50px;\n            height: 50px;\n            object-fit: cover;\n          }\n\n          .name {\n            color: black;\n            font-weight: bold;\n            margin: 0;\n            font-size: 1rem;\n            display: inline-block;\n          }\n\n          .like-icon path {\n            color: #6b7280;\n            transition: all 0.3s ease;\n            stroke: #5354ed;\n            stroke-width: 2;\n            display: flex;\n            align-items: center;\n            background: none;\n            border: none;\n            cursor: pointer;\n            font-size: 0.9rem;\n            padding: 5px 10px;\n          }\n          .liked path {\n            fill: #5354ed;\n          }\n\n          .likes-count {\n            margin-bottom: 0.5rem;\n          }\n\n          .tag {\n            display: inline-block;\n            padding: 4px 12px;\n            border: 2px solid rgba(31, 31, 241, 0.57);\n            border-radius: 0.85rem;\n            color: rgba(31, 31, 241, 0.57);\n            background-color: rgb(255, 255, 255);\n            font-weight: 500;\n            font-size: 0.7rem;\n            text-align: center;\n            margin: 1rem 0;\n            position: relative;\n            z-index: 1;\n          }\n          .user-container {\n            display: flex;\n            align-items: flex-start;\n            gap: 12px;\n            justify-content: space-between;\n          }\n\n          .profile-container {\n            display: flex;\n            align-items: center;\n            gap: 1rem;\n            align-items: flex-start;\n          }\n\n          .career {\n            color: black;\n            font-weight: bold;\n            align-items: flex-start;\n            padding: 0;\n            margin: 0;\n          }\n\n          .semestre {\n            color: black;\n            font-weight: bold;\n            padding: 0;\n            margin: 0;\n          }\n\n          .the-career {\n            text-align: right;\n            display: flex;\n            gap: 0.2rem;\n            font-size: 14px;\n          }\n\n          .name-container {\n            display: flex;\n            flex-direction: column;\n            line-height: 1.2;\n          }\n\n          .date {\n            display: inline-block;\n            transform: translateY(-10px);\n            font-size: 0.95rem;\n            color: #666;\n          }\n\n          .just-likes,\n          .just-comments,\n          .just-share {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 0.4rem;\n            font-size: 0.85rem;\n            font-weight: bold;\n            padding: 0.5rem 0;\n            border: none;\n            background: none;\n            color: #6b7280;\n            cursor: pointer;\n            transition: transform 0.3s ease;\n          }\n\n          .just-likes:hover,\n          .just-comments:hover,\n          .just-share:hover {\n            transform: scale(1.03);\n          }\n\n          .just-likes:active,\n          .just-comments:active,\n          .just-share:active {\n            transform: scale(0.97);\n          }\n\n          .comment-icon path,\n          .share-icon path {\n            transition: fill 0.3s ease;\n            fill: #5354ed;\n          }\n\n          .just-likes:hover .comment-icon path {\n            fill: #3a3b9e;\n          }\n\n          .just-likes:active .comment-icon path {\n            fill: #2d2e7a;\n          }\n\n          .liked path {\n            fill: #5354ed;\n          }\n\n          .attributes-container {\n            display: flex;\n            flex-direction: column;\n          }\n\n          hr {\n            border: none;\n            border-top: 1px solid #ddd;\n            margin: 0;\n            width: 100%;\n            position: relative;\n            z-index: 0;\n          }\n\n          .like-icon {\n            transition: all 0.3s ease;\n          }\n\n          .like-icon:hover {\n            transform: scale(1.1);\n          }\n\n          .just-likes:active .like-icon {\n            transform: scale(0.9);\n          }\n\n          @keyframes heartBeat {\n            0% {\n              transform: scale(1);\n            }\n            14% {\n              transform: scale(1.3);\n            }\n            28% {\n              transform: scale(1);\n            }\n            42% {\n              transform: scale(1.3);\n            }\n            70% {\n              transform: scale(1);\n            }\n          }\n\n          .liked .just-likes {\n            animation: heartBeat 1s ease;\n          }\n\n          .liked .like-icon path {\n            fill: #5354ed;\n            stroke: #5354ed;\n          }\n\n          .notification {\n            position: fixed;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background-color: #5354ed;\n            color: white;\n            padding: 10px 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n            z-index: 1000;\n            animation: notification-enter 0.5s forwards;\n          }\n\n          @keyframes notification-enter {\n            0% {\n              opacity: 0;\n              transform: translate(-50%, 20px);\n            }\n            100% {\n              opacity: 1;\n              transform: translate(-50%, 0);\n            }\n          }\n\n          @keyframes notification-exit {\n            0% {\n              opacity: 1;\n              transform: translate(-50%, 0);\n            }\n            100% {\n              opacity: 0;\n              transform: translate(-50%, 20px);\n            }\n          }\n\n          .notification-exit {\n            animation: notification-exit 0.8s forwards;\n          }\n\n          @media (max-width: 576px) {\n            .post {\n              width: 90%;\n              padding: 15px 15px 5px 15px;\n              margin: 10px auto;\n            }\n\n            .user-container {\n              flex-direction: row;\n              justify-content: space-between;\n              align-items: flex-start;\n              gap: 8px;\n            }\n\n            .profile-container {\n              width: auto;\n              justify-content: flex-start;\n            }\n\n            .the-career {\n              text-align: right;\n              margin-top: 0;\n              align-self: flex-start;\n              min-width: fit-content;\n            }\n\n            .message-container {\n              font-size: 0.9rem;\n            }\n\n            .footer {\n              flex-direction: row;\n              gap: 0.5rem;\n              margin-top: 10px;\n            }\n\n            .just-likes,\n            .just-comments,\n            .just-share {\n              flex: 1;\n              justify-content: center;\n              padding: 0.3rem 0;\n              font-size: 0.8rem;\n            }\n\n            .tag {\n              font-size: 0.65rem;\n              padding: 3px 10px;\n              margin: 0.5rem 0;\n            }\n\n            .profile-picture {\n              width: 40px;\n              height: 40px;\n            }\n\n            .name {\n              font-size: 0.95rem;\n            }\n\n            .date {\n              font-size: 0.85rem;\n              transform: translateY(0);\n            }\n          }\n\n        </style>\n        <div class="post">\n          <div class="attributes-container">\n            <div class="user-container"> \n              <div class="profile-container">\n                <img class="profile-picture" src="${this.post.photo}" alt="Profile Picture">\n                <div class="name-container">\n                  <p class="name">${this.post.name}</p>\n                  <p class="date">${this.post.date}</p>\n                </div>\n              </div>\n\n              <div class="the-career">\n                <p class="career">${this.post.career}</p>\n                <p class="semestre">${this.post.semestre}</p>\n              </div>\n            </div>\n\n            <div class="message-container">\n              <p class="message">${this.post.message}</p>\n            </div>\n          </div>\n\n          <p class="tag">${this.post.tag}</p>\n          \n          <hr>\n          <div class="footer">  \n             <div class="align-likes">\n              <button class="just-likes ${t?"liked":""}">\n                <svg class="like-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" width="20" height="20">\n                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke-width="2"/>\n                </svg>\n                <p class="likes-count">${this.post.likes} Likes</p>\n              </button>\n            </div>  \n\n            <div class="align-comments">\n              <button class="just-comments">\n                <svg class="comment-icon" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                  <path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>\n                </svg>\n                <p class="comments-count">Comment</p>\n              </button>\n            </div>\n\n            <div class="align-share">\n              <button class="just-share">\n                <svg class="share-icon" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                  <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/>\n                </svg>\n                <p class="share-count">Shared</p>\n              </button>\n            </div>\n          </div>\n        </div>\n      `;const n=this.shadowRoot.querySelector(".just-likes");n?.addEventListener("click",(()=>{const e=window.scrollY,t=Jm.getState().auth.user;if(!t)return void alert("Please log in to like posts.");if(!this.post.id)return void console.error("Post is missing ID, cannot like.");const n=t.username,s=this.post.id;Jm.getUserLikes(n).includes(s)?Ym.unlikePost(s,n):Ym.likePost(s,n),requestAnimationFrame((()=>{window.scrollTo(0,e)}))}));const s=this.shadowRoot.querySelector(".just-comments");s?.addEventListener("click",(()=>{this.post.id&&(Jm.saveCurrentPost(this.post),Jm.setFromProfile(!0),u("/comments-detail"))}));const i=this.shadowRoot.querySelector(".just-share");i?.addEventListener("click",(()=>{navigator.clipboard.writeText("https://www.icesi.edu.co/").then((()=>{this.showNotification("Link copied to clipboard")})).catch((e=>{console.error("Error, sorry :c: ",e)}))}))}}showNotification(e){const t=document.createElement("style");t.textContent="\n      .feed-post-notification {\n        position: fixed;\n        bottom: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background-color: #5354ed;\n        color: white;\n        padding: 10px 20px;\n        border-radius: 5px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n        z-index: 1000;\n        animation: notification-enter 0.5s forwards;\n      }\n      \n      @keyframes notification-enter {\n        0% {\n          opacity: 0;\n          transform: translate(-50%, 20px);\n        }\n        100% {\n          opacity: 1;\n          transform: translate(-50%, 0);\n        }\n      }\n      \n      @keyframes notification-exit {\n        0% {\n          opacity: 1;\n          transform: translate(-50%, 0);\n        }\n        100% {\n          opacity: 0;\n          transform: translate(-50%, 20px);\n        }\n      }\n      \n      .notification-exit {\n        animation: notification-exit 0.8s forwards;\n      }\n    ";const n=document.createElement("div");n.className="feed-post-notification",n.textContent=e,document.head.appendChild(t),document.body.appendChild(n),setTimeout((()=>{n.classList.add("notification-exit"),setTimeout((()=>{document.body.removeChild(n),document.head.removeChild(t)}),800)}),2e3)}}const Nv=Ov;class jv extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(){this.shadowRoot.innerHTML='\n      <style>\n          #start{\n  background-color: #5354ed;\n  color: white;\n  font-size: 12px;\n  border: 2px solid black;\n  padding: 15px 85px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: all 0.3s ease;\n}\n\n#start:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\n#start:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n  transition: all 0.1s ease;\n}\n      </style>\n      <button id="start">Start Now</button>\n    ',this.shadowRoot.querySelector("#start")?.addEventListener("click",(()=>{u("/login")}))}}const Mv=jv;var Uv;!function(e){e.text="text",e.image="image"}(Uv||(Uv={}));class Fv extends HTMLElement{constructor(){super(),this.text="",this.image="",this.attachShadow({mode:"open"})}static get observedAttributes(){return Object.values(Uv)}attributeChangedCallback(e,t,n){switch(e){case Uv.text:this.text=n??"";break;case Uv.image:this.image=n??""}this.render()}connectedCallback(){this.render()}render(){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n\n      <style>\n        :host {\n  display: block;\n  margin: 0;\n  width: 255px;\n  background: #f2f4ff;\n  border: 2px solid #000;\n  border-radius: 12px;\n  padding: 15px;\n  filter: drop-shadow(0 0 0.5rem rgba(158, 158, 158, 0.249));\n}\nimg {\n  width: 250px;\n  height: auto;\n\n  display: block;\n  margin: 0 auto;\n}\np {\n  margin: 0;\n  font-size: 0.9rem;\n  text-align: start;\n  margin-top: 30px;\n  margin-bottom: 60px;\n  margin-left: 1.2em;\n  margin-right: 1.2rem;\n}\n\n@media (max-width: 480px) {\n  :host {\n    width: 90%;\n    padding: 12px;\n  }\n\n  img {\n    width: 100%;\n    max-width: 300px;\n  }\n\n  p {\n    text-align: center;\n    margin: 20px 36px 40px;\n    font-size: 1rem;\n  }\n}\n\n      </style>\n      <div class= image>\n        <img src="${this.image}" alt="" />\n      </div>\n     \n      <p>${this.text}</p>\n    `)}}const $v=Fv;async function Vv(){try{const e=await fetch("/data/TeachersReviews.json");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json();return console.log("Fetched teachers:",t),t}catch(e){throw console.error("Failed to fetch teachers:",e),e}}async function zv(){try{const e=await fetch("/data/SubjectsReviews.json");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json();return console.log("Fetched subjects:",t),t}catch(e){throw console.error("Failed to fetch subjects:",e),e}}class Bv extends HTMLElement{constructor(){super(),this.searchInput=null,this.attachShadow({mode:"open"}),this.searchtype=""}static get observedAttributes(){return["searchtype"]}connectedCallback(){this.render(),this.setupEventListeners()}attributeChangedCallback(e,t,n){this.searchtype=n}setupEventListeners(){this.searchInput=this.shadowRoot?.querySelector("#search-input"),this.searchInput&&this.searchInput.addEventListener("input",(async e=>{let t;switch(e.preventDefault(),console.log(this.searchtype),this.searchtype){case"teacher":const e=await Vv();t=e.teachers.filter((e=>e.name.toLocaleLowerCase().includes(this.searchInput.value.toLowerCase()))),0===this.searchInput?.value.length&&(t=e.teachers),(e=>{const t=Jm.getState();t.searchDebounceTimeout&&clearTimeout(t.searchDebounceTimeout);const n=window.setTimeout((()=>{const n=(t.teachers||[]).filter((t=>t.name.toLowerCase().includes(e.toLowerCase())||t.subject.toLowerCase().includes(e.toLowerCase())));r.dispatch({type:F,payload:n})}),300);Jm.getState().searchDebounceTimeout=n})(this.searchInput.value);break;case"subjects":const n=await zv();t=n.subjects.filter((e=>e.name.toLocaleLowerCase().includes(this.searchInput.value.toLowerCase()))),0===this.searchInput?.value.length&&(t=n.subjects),(e=>{const t=Jm.getState();t.searchDebounceTimeout&&clearTimeout(t.searchDebounceTimeout);const n=window.setTimeout((()=>{const n=(t.subjects||[]).filter((t=>t.name.toLowerCase().includes(e.toLowerCase())||t.career.toLowerCase().includes(e.toLowerCase())));r.dispatch({type:U,payload:n})}),300);Jm.getState().searchDebounceTimeout=n})(this.searchInput.value)}console.log(Jm.getState())}))}render(){this.shadowRoot.innerHTML='\n      <style>\n        .search-container {\n          position: relative;\n          width: 100%;\n          max-width: 600px;\n          margin: 0 auto;\n          box-sizing: border-box;\n        }\n\n        .search-input {\n          width: 100%;\n          padding: 12px 20px;\n          padding-left: 50px;\n          font-size: 1rem;\n          border: 2px solid var(--nexolightwhite);\n          border-radius: 50px;\n          outline: none;\n          background-color: white;\n          color: #2d3748;\n          box-sizing: border-box;\n        }\n\n        @media (max-width: 576px) {\n          .search-input {\n            font-size: 0.9rem;\n            padding: 10px 20px;\n            padding-left: 50px;\n          }\n\n          .search-icon {\n            width: 18px;\n            height: 18px;\n          }\n        }\n\n        .search-input:focus {\n          border-color: var(--nexopurple);\n          box-shadow: 0 0 0 3px rgba(83, 84, 237, 0.1);\n        }\n\n        .search-input::placeholder {\n          color: #a0aec0;\n        }\n\n        .search-icon {\n          position: absolute;\n          left: 15px;\n          top: 50%;\n          transform: translateY(-50%);\n          color: #a0aec0;\n          pointer-events: none;\n        }\n      </style>\n\n      <div class="search-container">\n        <svg\n          class="search-icon"\n          width="20"\n          height="20"\n          viewBox="0 0 24 24"\n          fill="none"\n          stroke="currentColor"\n          stroke-width="2"\n          stroke-linecap="round">\n          <circle cx="11" cy="11" r="8"></circle>\n          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>\n        </svg>\n        <input\n          class="search-input"\n          placeholder="Search teachers, subjects..."\n          id="search-input"\n          name="search-input"\n        />\n      </div>\n    '}}const qv=Bv;class Hv extends HTMLElement{constructor(){super(),this.unsubscribeStore=null,this.handleClick=e=>{const t=this.getAttribute("name")||"",n=this.getAttribute("career")||"",s=this.getAttribute("credits")||"",i=this.calculateAverageRating(),o=this.getAttribute("id")||"";var a;a={name:t,career:n,credits:s,rating:i,id:o},r.dispatch({type:L,payload:a}),u("/subject-detail")},this.attachShadow({mode:"open"})}static get observedAttributes(){return["name","career","credits","id","rating"]}connectedCallback(){this.render(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(){this.render()}calculateAverageRating(){const e=this.getAttribute("name")||"",t=Jm.getState().subjectRatings[e]||[];if(0===t.length)return 0;const n=t.reduce(((e,t)=>e+t.rating),0);return Number((n/t.length).toFixed(1))}render(){const e=this.getAttribute("name")||"Name not specified",t=this.getAttribute("career")||"Career not specified",n=this.getAttribute("credits")||"0",s=this.calculateAverageRating(),i=this.hashString(e),r=`https://picsum.photos/id/${Math.abs(i%30)}/250/150`,o=Array(5).fill(0).map(((e,t)=>`\n          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="${t<s?"#5354ED":"#ccc"}" class="star-icon">\n            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n          </svg>\n        `)).join("");this.shadowRoot.innerHTML=`\n      <style>\n        .card {\n          max-width: 300px;\n          border-radius: 12px;\n          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n          background-color: #eff0fd;\n          padding: 0;\n          text-align: left;\n          border: 1px solid rgb(0, 0, 0);\n          transition: all 0.3s ease;\n          overflow: hidden;\n          cursor: pointer;\n        }\n\n        .card:hover {\n          transform: translateY(-5px);\n          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);\n        }\n\n        .image-container {\n          position: relative;\n          width: 100%;\n          height: 160px;\n          overflow: hidden;\n        }\n\n        .card img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          transition: transform 0.5s ease;\n        }\n\n        .card:hover .image-container img {\n          transform: scale(1.05);\n        }\n\n        .content {\n          padding: 20px;\n        }\n\n        .card h4 {\n          font-size: 1.25rem;\n          font-weight: 700;\n          margin: 0 0 8px 0;\n          color: #2c3e50;\n          line-height: 1.3;\n        }\n\n        .card p {\n          font-size: 0.95rem;\n          color: #666;\n          margin: 0 0 12px 0;\n          line-height: 1.5;\n        }\n\n        .credits {\n          font-size: 1rem;\n          font-weight: 600;\n          color: var(--nexopurple);\n          margin: 0 0 12px 0;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n\n        .credits::before {\n          content: "‚Ä¢";\n          color: var(--nexopurple);\n          font-size: 1.2rem;\n        }\n\n        .stars {\n          display: flex;\n          gap: 4px;\n          margin-top: 12px;\n        }\n\n        .star-icon {\n          transition: fill 0.2s;\n          cursor: pointer;\n        }\n      </style>\n      <div class="card" id="subjectCard">\n        <div class="image-container">\n          <img src="${r}" alt="${e}">\n        </div>\n        <div class="content">\n          <h4>${e}</h4>\n          <p>${t}</p>\n          <p class="credits">${n} credits</p>\n          <div class="stars">\n            ${o}\n          </div>\n        </div>\n      </div>\n    `;const a=this.shadowRoot?.querySelector("#subjectCard");a?a.addEventListener("click",this.handleClick):console.error("SubjectCard: Could not find #subjectCard element")}attributeChangedCallback(e,t,n){t!==n&&this.render()}hashString(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}}const Kv=Hv;class Gv extends HTMLElement{constructor(){super(),this.subjects=[],this.currentPage=1,this.itemsPerPage=8,this.unsubscribeStore=null,this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.loadSubjects(),this.unsubscribeStore=Qm.subscribe((()=>{this.renderPage(),this.renderPagination()}))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}render(){this.shadowRoot.innerHTML='\n  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">\n  <style>\n     \n\n    .container {\n      padding: 20px;\n    }\n\n    .row {\n      margin: 0 -10px;\n    }\n\n    .col {\n      padding: 10px;\n    }\n\n    .pagination {\n      display: flex;\n      justify-content: center;\n      margin-top: 20px;\n      gap: 10px;\n    }\n\n    .pagination button {\n      padding: 8px 16px;\n      border: 1px solid var(--nexolightwhite);\n      background-color: var(--nexolightwhite);\n      cursor: pointer;\n      border-radius: 8px;\n      color: var(--nexopurple);\n      font-weight: 500;\n      transition: all 0.2s ease;\n    }\n\n    .pagination button:hover {\n      background-color: var(--nexolightwhite);\n      transform: translateY(-2px);\n    }\n\n    .pagination button.active {\n      background-color: var(--nexopurple);\n      color: var(--nexolightwhite);\n      border-color: var(--nexopurple);\n    }\n\n    .pagination button:disabled {\n      cursor: not-allowed;\n      opacity: 0.5;\n    }\n\n    @media (max-width: 576px) {\n      .container {\n        padding: 0;\n        font-size: 0.7rem;\n      }\n\n      .row {\n        margin: 0 -2px;\n      }\n\n      .col {\n        padding: 2px;\n      }\n\n      :host {\n        font-size: 0.7rem;\n      }\n\n      .g-4 {\n        gap: 0.5rem !important;\n      }\n\n      .pagination button {\n        padding: 6px 12px;\n        font-size: 0.7rem;\n      }\n    }\n  </style>\n  <div class="container">\n    <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-2">\n    </div>\n    <div class="pagination"></div>\n  </div>\n'}async loadSubjects(){try{const e=await zv();this.subjects=e.subjects,Qm.getState().subjects=e.subjects,this.renderPage(),this.renderPagination()}catch(e){console.error("Error loading subjects:",e)}}renderPage(){const e=this.shadowRoot?.querySelector(".row");if(e){e.innerHTML="";const t=Qm.getState(),n=t.filteredSubjects?t.filteredSubjects:this.subjects;if(0===n.length)return void(e.innerHTML="<div style='width:100%;text-align:center;padding:2rem;'>No subjects found.</div>");const s=(this.currentPage-1)*this.itemsPerPage,i=Math.min(s+this.itemsPerPage,n.length);for(let t=s;t<i;t++){const s=n[t];if(!s)continue;const i=document.createElement("div");i.className="col";const r=document.createElement("subject-card");r.setAttribute("name",s.name),r.setAttribute("career",s.career),r.setAttribute("credits",s.credits),r.setAttribute("image",s.image),r.setAttribute("rating",s.rating),i.appendChild(r),e.appendChild(i)}}}renderPagination(){const e=this.shadowRoot?.querySelector(".pagination");if(e){e.innerHTML="";const t=Qm.getState(),n=t.filteredSubjects?t.filteredSubjects:this.subjects,s=Math.ceil(n.length/this.itemsPerPage),i=document.createElement("button");i.textContent="¬´",i.disabled=1===this.currentPage,i.addEventListener("click",(()=>{this.currentPage>1&&(this.currentPage--,this.renderPage(),this.renderPagination())})),e.appendChild(i);for(let t=1;t<=s;t++){const n=document.createElement("button");n.textContent=t.toString(),t===this.currentPage&&n.classList.add("active"),n.addEventListener("click",(()=>{this.currentPage=t,this.renderPage(),this.renderPagination()})),e.appendChild(n)}const r=document.createElement("button");r.textContent="¬ª",r.disabled=this.currentPage===s,r.addEventListener("click",(()=>{this.currentPage<s&&(this.currentPage++,this.renderPage(),this.renderPagination())})),e.appendChild(r)}}}const Wv=Gv;class Jv extends HTMLElement{constructor(){super(),this.unsubscribeStore=null,this.attachShadow({mode:"open"})}connectedCallback(){console.log("TABS COMPONENT! ========================================"),this.render(),this.setupEventListeners(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(e){const t=e.navigation.activeAcademicTab,n=this.shadowRoot?.querySelector(".nav-tabs")?.getAttribute("data-active-tab");n!==t?this.updateActiveTab(t):console.log("============ MISMA TAB ==============")}setupEventListeners(){const e=this.shadowRoot?.querySelector(".nav-tabs"),t=this.shadowRoot?.querySelectorAll(".nav-link"),n=this.shadowRoot?.querySelectorAll(".tab-pane"),s=this.shadowRoot?.querySelector("search-bar");if(!t||!n)return;t.forEach((r=>{r.addEventListener("click",(()=>{const o=r.getAttribute("data-target");o&&(t.forEach((e=>e.classList.remove("active"))),r.classList.add("active"),n.forEach((e=>{e.classList.remove("show","active"),e.id===o&&e.classList.add("show","active")})),e&&(e.setAttribute("data-active-tab",o),s?.setAttribute("searchtype",o),i.navigation.activeAcademicTab=o))}))}));const i=Jm.getState();this.updateActiveTab(i.navigation.activeAcademicTab)}updateActiveTab(e){const t=this.shadowRoot?.querySelector(".nav-tabs"),n=this.shadowRoot?.querySelector(`[data-target="${e}"]`),s=this.shadowRoot?.querySelector(`#${e}`);if(n&&s&&t){const i=this.shadowRoot?.querySelectorAll(".nav-link");i?.forEach((e=>e.classList.remove("active"))),n.classList.add("active");const r=this.shadowRoot?.querySelectorAll(".tab-pane");r?.forEach((e=>e.classList.remove("show","active"))),s.classList.add("show","active"),t.setAttribute("data-active-tab",e)}}render(){this.shadowRoot.innerHTML='\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">\n      <style>\n       \n  \n        .project-tab {\n          padding: 20px;\n          background: white;\n          border-radius: 8px;\n        }\n  \n        .nav-tabs {\n          border-bottom: 2px solid var(--nexolightwhite);\n          margin-bottom: 20px;\n          position: relative;\n        }\n  \n        .nav-tabs::after {\n          content: "";\n          position: absolute;\n          bottom: -2px;\n          left: 0;\n          width: 50%;\n          height: 2px;\n          background-color: var(--nexopurple);\n          transition: transform 0.3s ease;\n        }\n  \n        .nav-tabs[data-active-tab="subjects"]::after {\n          transform: translateX(100%);\n        }\n  \n        .nav-tabs .nav-link {\n          color: rgb(100, 100, 100);\n          border: none;\n          padding: 10px 20px;\n          font-weight: 500;\n          position: relative;\n        }\n  \n        .nav-tabs .nav-link:hover {\n          color: var(--nexopurple);\n          border: none;\n        }\n  \n        .nav-tabs .nav-link.active {\n          color: var(--nexopurple);\n          background: none;\n          border: none;\n        }\n  \n        .tab-content {\n          padding: 20px 0;\n        }\n  \n        .tab-pane {\n          display: none;\n        }\n  \n        .tab-pane.show.active {\n          display: block;\n        }\n      </style>\n  \n      <section id="tabs" class="project-tab">\n        <div class="container">\n          <nav>\n            <div class="nav nav-tabs nav-fill" data-active-tab="teacher">\n              <button class="nav-item nav-link" data-target="teacher" type="button">Teacher Reviews</button>\n              <button class="nav-item nav-link" data-target="subjects" type="button">Subjects Reviews</button>\n            </div>\n          </nav>\n  \n          <search-bar searchtype="teacher"></search-bar>\n  \n          <div class="tab-content">\n            <div class="tab-pane" id="teacher">\n              <teachers-container></teachers-container>\n            </div>\n            <div class="tab-pane" id="subjects">\n              <subjects-container></subjects-container>\n            </div>\n          </div>\n        </div>\n      </section>\n    '}}const Qv=Jv;class Yv extends HTMLElement{constructor(){super(),this.unsubscribeStore=null,this.handleClick=e=>{const t=this.getAttribute("name")||"",n=this.getAttribute("subject")||"",s=this.getAttribute("nucleus")||"",i=this.getAttribute("rating")||"0",o=this.hashString(t),a=Math.abs(o%30);var c;c={name:t,subject:n,nucleus:s,rating:i,image:`https://picsum.photos/id/${a}/250/150`},r.dispatch({type:P,payload:c}),u("/teacher-detail")},this.attachShadow({mode:"open"})}static get observedAttributes(){return["name","subject","nucleus","rating","image","id"]}connectedCallback(){this.render(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(){this.render()}render(){const e=this.getAttribute("name")||"Name not specified",t=this.getAttribute("subject")||"Subject not specified",n=this.getAttribute("nucleus")||"Nucleus not specified",s=this.calculateAverageRating(),i=this.hashString(e),r=`https://picsum.photos/id/${Math.abs(i%30)}/250/150`,o=Array(5).fill(0).map(((e,t)=>`\n          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="${t<s?"#5354ED":"#ccc"}" class="star-icon">\n            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n          </svg>\n        `)).join("");this.shadowRoot.innerHTML=`\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">\n      <style>\n       \n    \n        .card {\n          max-width: 300px;\n          border-radius: 12px;\n          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n          background-color: #eff0fd;\n          padding: 0;\n          text-align: left;\n          border: 1px solid rgb(0, 0, 0);\n          transition: all 0.3s ease;\n          overflow: hidden;\n          cursor: pointer;\n        }\n    \n        .card:hover {\n          transform: translateY(-5px);\n          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);\n        }\n    \n        .image-container {\n          position: relative;\n          width: 100%;\n          height: 160px;\n          overflow: hidden;\n        }\n    \n        .card img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n          transition: transform 0.5s ease;\n        }\n    \n        .card:hover .image-container img {\n          transform: scale(1.05);\n        }\n    \n        .content {\n          padding: 20px;\n        }\n    \n        .card h4 {\n          font-size: 1.25rem;\n          font-weight: 700;\n          margin: 0 0 8px 0;\n          color: #2c3e50;\n          line-height: 1.3;\n        }\n    \n        .card p {\n          font-size: 0.95rem;\n          color: #666;\n          margin: 0 0 12px 0;\n          line-height: 1.5;\n        }\n    \n        .subject {\n          font-size: 1rem;\n          font-weight: 600;\n          color: var(--nexopurple);\n          margin: 0 0 12px 0;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n    \n        .subject::before {\n          content: "‚Ä¢";\n          color: var(--nexopurple);\n          font-size: 1.2rem;\n        }\n    \n        .stars {\n          display: flex;\n          gap: 4px;\n          margin-top: 12px;\n        }\n    \n        .star-icon {\n          transition: fill 0.2s;\n          cursor: pointer;\n        }\n    \n        .card::before {\n          content: "";\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          border-radius: 12px;\n          pointer-events: none;\n        }\n      </style>\n    \n      <div class="card" id="teacherCard">\n        <div class="image-container">\n          <img src="${r}" alt="${e}">\n        </div>\n        <div class="content">\n          <h4>${e}</h4>\n          <p class="subject">${t}</p>\n          <p>${n}</p>\n          <div class="stars">\n            ${o}\n          </div>\n        </div>\n      </div>\n    `;const a=this.shadowRoot?.querySelector("#teacherCard");a?a.addEventListener("click",this.handleClick):console.error("TeacherCard: Could not find #teacherCard element")}calculateAverageRating(){const e=this.getAttribute("name")||"",t=Jm.getState().teacherRatings[e]||[];if(0===t.length)return 0;const n=t.reduce(((e,t)=>e+t.rating),0);return Number((n/t.length).toFixed(1))}attributeChangedCallback(e,t,n){t!==n&&this.render()}hashString(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}}const Xv=Yv;class Zv extends HTMLElement{constructor(){super(),this.currentPage=1,this.itemsPerPage=8,this.teachers=[],this.unsubscribeStore=null,this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.loadTeachers(),this.unsubscribeStore=Jm.subscribe((()=>{this.renderPage(),this.renderPagination()}))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}async loadTeachers(){try{const e=await Vv();this.teachers=e.teachers,Jm.getState().teachers=e.teachers,this.renderPage(),this.renderPagination()}catch(e){console.error("Error loading teachers:",e)}}renderPage(){const e=this.shadowRoot?.querySelector(".row");if(!e)return;e.innerHTML="";const t=Jm.getState(),n=t.filteredTeachers?t.filteredTeachers:this.teachers;if(0===n.length)return void(e.innerHTML="<div style='width:100%;text-align:center;padding:2rem;'>No teachers found.</div>");const s=(this.currentPage-1)*this.itemsPerPage,i=Math.min(s+this.itemsPerPage,n.length);for(let t=s;t<i;t++){const s=n[t];if(!s)continue;const i=document.createElement("div");i.className="col";const r=document.createElement("teacher-card");r.setAttribute("name",s.name),r.setAttribute("subject",s.subject),r.setAttribute("nucleus",s.nucleus),r.setAttribute("rating",s.rating),r.setAttribute("image",s.image),i.appendChild(r),e.appendChild(i)}}renderPagination(){const e=this.shadowRoot?.querySelector(".pagination");if(e){e.innerHTML="";const t=Jm.getState(),n=t.filteredTeachers?t.filteredTeachers:this.teachers,s=Math.ceil(n.length/this.itemsPerPage),i=document.createElement("button");i.textContent="¬´",i.disabled=1===this.currentPage,i.addEventListener("click",(()=>{this.currentPage>1&&(this.currentPage--,this.renderPage(),this.renderPagination())})),e.appendChild(i);for(let t=1;t<=s;t++){const n=document.createElement("button");n.textContent=t.toString(),t===this.currentPage&&n.classList.add("active"),n.addEventListener("click",(()=>{this.currentPage=t,this.renderPage(),this.renderPagination()})),e.appendChild(n)}const r=document.createElement("button");r.textContent="¬ª",r.disabled=this.currentPage===s,r.addEventListener("click",(()=>{this.currentPage<s&&(this.currentPage++,this.renderPage(),this.renderPagination())})),e.appendChild(r)}}render(){this.shadowRoot.innerHTML='\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">\n      <style>\n\n      .container {\n          padding: 20px;\n      }\n\n      .row {\n          margin: 0 -10px;\n      }\n\n      .col {\n          padding: 10px;\n      }\n\n      .pagination {\n          display: flex;\n          justify-content: center;\n          margin-top: 20px;\n          gap: 10px;\n      }\n\n      .pagination button {\n          padding: 8px 16px;\n          border: 1px solid var(--nexolightwhite);\n          background-color: var(--nexowhite);\n          cursor: pointer;\n          border-radius: 8px;\n          color: var(--nexopurple);\n          font-weight: 500;\n          transition: all 0.2s ease;\n      }\n\n      .pagination button:hover {\n          background-color: var(--nexolightwhite);\n          transform: translateY(-2px);\n      }\n\n      .pagination button.active {\n          background-color: var(--nexopurple);\n          color: var(--nexowhite);\n          border-color: var(--nexopurple);\n      }\n\n      .pagination button:disabled {\n          cursor: not-allowed;\n          opacity: 0.5;\n      }\n\n    @media (max-width: 576px) {\n      .container {\n          padding: 0;\n          font-size: 0.7rem;\n      }\n\n      .row {\n          margin: 0 -2px;\n      }\n\n      .col {\n          padding: 2px;\n      }\n\n      :host {\n          font-size: 0.7rem;\n      }\n\n      .g-4 {\n          gap: 0.5rem !important;\n      }\n      \n      .pagination button {\n          padding: 6px 12px;\n          font-size: 0.7rem;\n      }\n    }\n    </style>\n    <div class="container">\n        <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-2">\n        </div>\n        <div class="pagination"></div>\n    </div>\n    '}}const eb=Zv;class tb extends HTMLElement{constructor(){super(),this.posts=[],this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.handleStoreChange=this.handleStoreChange.bind(this)}connectedCallback(){this.subscribeToStore(),this.setupEventListeners(),Jm.loadProfilePosts(),document.addEventListener("profile-updated",(()=>{console.log("ProfileContainer: 'profile-updated' event received. Loading posts."),Jm.loadProfilePosts(),this.render()})),document.addEventListener("navigate",(e=>{"/profile"===e.detail&&(console.log("ProfileContainer: 'navigate' to profile event received. Loading posts."),Jm.loadProfilePosts(),this.render())}))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}subscribeToStore(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange)}handleStoreChange(e){this.posts=Jm.getProfilePosts(),this.render()}setupEventListeners(){}render(){const e=this.posts.map((e=>`\n      <profile-post\n        ${e.id?`id="${e.id}"`:""}\n        photo="${e.photo}"\n        name="${e.name}"\n        date="${e.date}"\n        career="${e.career}"\n        semestre="${e.semestre}"\n        message="${e.message}"\n        tag="${e.tag}"\n        likes="${e.likes}"\n        share="${e.share}"\n        comments="${JSON.stringify(e.comments)}"\n        image="${e.image||""}"\n      ></profile-post>\n    `)).join("");this.shadowRoot.innerHTML=`\n     <style>\n      :host {\n        display: block;\n        width: 100%;\n        min-height: 100vh;\n      }\n\n      .profile-container {\n        max-width: 800px;\n        margin: 0 auto;\n      }\n\n      .posts-container {\n        border-radius: 30px;\n        padding: 20px;\n      }\n\n      @media (max-width: 576px) {\n        .profile-container {\n          max-width: 100%;\n        }\n\n        .posts-container {\n          margin: 0 10px;\n          padding: 10px;\n        }\n      }\n     </style>\n            <div class="profile-container">\n                <div class="posts-container">\n                    ${e}\n                </div>\n            <floating-btn></floating-btn>\n            <post-modal></post-modal>\n            </div>\n        `}}const nb=tb;class sb extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.render=this.render.bind(this),this.handleStoreChange=this.handleStoreChange.bind(this)}connectedCallback(){this.setupStoreListeners(),this.addEventListeners(),this.render()}disconnectedCallback(){this.unsubscribe&&this.unsubscribe()}setupStoreListeners(){this.unsubscribe=Jm.subscribe(this.handleStoreChange)}handleStoreChange(e){this.render()}addEventListeners(){const e=this.shadowRoot.querySelector(".edit-button");e?.addEventListener("click",(()=>{u("/profile-settings")}))}render(){const e=Jm.getState().auth.user,t=e?.username||"Unknown User",n=e?.career||e?.degree||"Unknown Career",s=e?.bio||"",i=e?.profilePic||"https://picsum.photos/seed/picsum/200/300";this.shadowRoot.innerHTML=`\n          <style>\n            \n\n:host {\n  display: block;\n  width: 100%;\n  overflow-x: hidden;\n}\n\n.banner {\n  width: 100vw;\n  height: 200px;\n  background-color: #ffa500;\n  position: relative;\n  overflow: hidden;\n  left: 50%;\n  right: 50%;\n  margin-left: -50vw;\n  margin-right: -50vw;\n}\n\n.banner-illustrations {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n\n.banner-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n@media (max-width: 576px) {\n  .banner-image {\n    content: url("/assets/images/bannerimgsmall.png");\n  }\n}\n\n.profile-section {\n  text-align: center;\n  margin-top: -50px;\n  position: relative;\n}\n\n.profile-picture {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  border: 4px solid white;\n  margin: 0 auto;\n  position: relative;\n  z-index: 2;\n  object-fit: cover;\n  background-color: white;\n}\n\n.edit-button {\n  position: absolute;\n  right: 30%;\n  top: 30px;\n  background: #6366f1;\n  border: none;\n  border-radius: 50%;\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  z-index: 3;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.edit-button:hover {\n  transform: scale(1.1) rotate(90deg);\n  background: #5354ed;\n  box-shadow: 3px 3px 15px -6px rgba(0, 0, 0, 0.4);\n}\n\n.edit-button:active {\n  transform: scale(0.95);\n  box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);\n}\n\n.edit-button svg {\n  width: 20px;\n  height: 20px;\n  fill: white;\n  transition: all 0.3s ease;\n}\n\n.edit-button:hover svg {\n  fill: #ffffff;\n}\n\n.profile-info {\n  background-color: white;\n  padding: 20px;\n}\n\nh1 {\n  margin: 10px 0;\n  color: #1f2937;\n  font-size: 1.5rem;\n}\n\n.career {\n  color: #6b7280;\n  margin: 5px 0;\n}\n\n.bio {\n  color: #4b5563;\n  margin: 15px 0;\n  font-size: 0.9rem;\n}\n\n          </style>\n            <div class="banner">\n                <div class="banner-illustrations">\n                    <img class="banner-image" src="/assets/images/bannerimg.png" alt="Banner image">\n                </div>\n            </div>\n            <div class="profile-section">\n                <img class="profile-picture" src="${i}" alt="Profile Picture">\n                <button class="edit-button">\n                    <svg viewBox="0 0 24 24">\n                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>\n                    </svg>\n                </button>\n                <div class="profile-info">\n                    <h1>${t}</h1>\n                    <p class="career">${n}</p>\n                    <p class="bio">${s}</p>\n                </div>\n            </div>\n        `,this.addEventListeners()}}const ib=sb;class rb extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.setupEventListeners(),setTimeout((()=>{const e=this.shadowRoot.querySelector(".confirmation-dialog");e&&(e.style.opacity="1",e.style.transform="translateY(0)"),this.shadowRoot.host.classList.add("visible")}),10)}render(){this.shadowRoot.innerHTML='\n            <style>\n \n\n:host {\n  display: block;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n  transition: background-color 0.3s ease;\n  font-family:\n    "Inter",\n    "Segoe UI",\n    Roboto,\n    -apple-system,\n    sans-serif;\n}\n\n:host(.visible) {\n  background-color: rgba(0, 0, 0, 0.6);\n  backdrop-filter: blur(4px);\n}\n\n.confirmation-dialog {\n  background-color: var(--nexowhite);\n  border-radius: 24px;\n  width: 90%;\n  max-width: 480px;\n  overflow: hidden;\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n  opacity: 0;\n  transform: translateY(20px) scale(0.98);\n  transition:\n    opacity 0.4s ease,\n    transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);\n}\n\n.dialog-header {\n  background: linear-gradient(135deg, #4f46e5, #6366f1);\n  padding: 24px 20px;\n  text-align: center;\n  position: relative;\n}\n\n.warning-icon {\n  width: 56px;\n  height: 56px;\n  background-color: var(--nexowhite);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 auto 16px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.warning-icon svg {\n  width: 32px;\n  height: 32px;\n  fill: #ef4444;\n}\n\n.dialog-header h2 {\n  color: var(--nexowhite);\n  font-size: 22px;\n  margin: 0;\n  padding: 0;\n  font-weight: 600;\n  line-height: 1.3;\n}\n\n.dialog-content {\n  padding: 24px 20px;\n}\n\n.message {\n  color: #4b5563;\n  font-size: 16px;\n  line-height: 1.5;\n  margin-bottom: 24px;\n  text-align: center;\n}\n\n.action-buttons {\n  display: flex;\n  justify-content: center;\n  gap: 12px;\n}\n\n.btn {\n  background-color: var(--nexopurple);\n  color: white;\n  font-size: 14px;\n  border: 2px solid var(--nexoblack);\n  padding: 7px 30px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  font-weight: 600;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: all 0.2s ease-in-out;\n}\n\n.confirm-btn {\n  background-color: var(--nexopurple);\n}\n\n.cancel-btn {\n  background-color: var(--nexowhite);\n  color: var(--nexoblack);\n}\n\n.btn:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\n.btn:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n}\n\n@media (max-width: 576px) {\n  .action-buttons {\n    flex-direction: column;\n  }\n  .btn {\n    width: 100%;\n  }\n}\n\n            </style>\n            <div class="confirmation-dialog">\n                <div class="dialog-header">\n                    <div class="warning-icon">\n                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                            <path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm-1-5h2v2h-2v-2zm0-8h2v6h-2V7z"/>\n                        </svg>\n                    </div>\n                    <h2>Are you sure you want to delete your account?</h2>\n                    \n                </div>\n                <div class="dialog-content">\n                    <div class="action-buttons">\n                        <button class="btn cancel-btn">Cancel</button>\n                        <button class="btn confirm-btn">Delete account</button>\n                    </div>\n                </div>\n            </div>\n        '}setupEventListeners(){const e=this.shadowRoot.querySelector(".confirm-btn"),t=this.shadowRoot.querySelector(".cancel-btn");e&&e.addEventListener("click",(()=>{e.disabled=!0,(()=>{const e=Jm.getState().auth.user;if(e)try{Jm.deleteAccount(e.username),r.dispatch({type:jm,payload:{username:e.username}})}catch(e){r.dispatch({type:Mm,payload:{error:"Failed to delete account"}})}else r.dispatch({type:Mm,payload:{error:"No logged in user found"}})})(),this.remove(),u("/")})),t?.addEventListener("click",(()=>{this.animateOut().then((()=>{this.remove()}))}))}animateOut(){return new Promise((e=>{const t=this.shadowRoot.querySelector(".confirmation-dialog");this.shadowRoot.host.classList.remove("visible"),t&&(t.style.opacity="0",t.style.transform="translateY(20px) scale(0.95)"),setTimeout((()=>{e()}),300)}))}}const ob=rb;class ab extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.render=this.render.bind(this),this.handleStoreChange=this.handleStoreChange.bind(this),this.setupStoreListeners()}setupStoreListeners(){this.unsubscribe=Jm.subscribe(this.handleStoreChange),this.handleStoreChange(Jm.getState())}disconnectedCallback(){this.unsubscribe&&this.unsubscribe()}connectedCallback(){this.setupEventListeners()}handleStoreChange(e){this.render()}render(){const e=Jm.getState().auth.user,t=e?.username||"",n=e?.phone||"",s=e?.career||e?.degree||"",i=e?.semester||"",r=e?.bio||"";this.shadowRoot.innerHTML=`\n    <style>\n:host {\n    display: block;\n    width: 100%;\n    min-height: 100vh;\n}\n\n.settings-container {\n    max-width: 800px;\n    margin: 0 auto;\n    padding: 20px;\n}\n\n.profile-form {\n    background-color: #EFF0FD;\n    border-radius: 30px;\n    padding: 30px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.form-group {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.form-group label {\n    font-weight: 600;\n    color: #6B7280;\n    font-size: 15px;\n    margin-left: 10px;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: inline-block;\n}\n\ninput, select {\n    width: 100%;\n    padding: 12px 15px;\n    border-radius: 25px;\n    border: 1px solid #d1d5db;\n    font-size: 16px;\n    transition: all 0.3s ease;\n    background-color: white;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n\nselect {\n    padding-right: 30px;\n    appearance: none;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235C6EF8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");\n    background-repeat: no-repeat;\n    background-position: right 12px center;\n    background-size: 16px;\n}\n\nselect::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n    border-radius: 10px;\n}\n\nselect::-webkit-scrollbar-track {\n    background: #e3e5ff;\n    border-radius: 10px;\n}\n\nselect::-webkit-scrollbar-thumb {\n    background: #5354ed;\n    border-radius: 10px;\n}\n\nselect::-webkit-scrollbar-thumb:hover {\n    background: #4445c9;\n    border-radius: 10px;\n}\n\nselect {\n    scrollbar-width: thin;\n    scrollbar-color: #5354ed #f1f1f1;\n}\n\ntextarea {\n    width: 100%;\n    padding: 12px 15px;\n    border-radius: 0;\n    border: 1px solid #d1d5db;\n    font-size: 16px;\n    transition: all 0.3s ease;\n    background-color: white;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n\ninput:focus, select:focus, textarea:focus {\n    outline: none;\n    border-color: #5C6EF8;\n    box-shadow: 0 0 0 3px rgba(92, 110, 248, 0.2);\n}\n\n.bio-container {\n    background-color: white;\n    border-radius: 15px;\n    padding: 20px;\n    margin-top: 10px;\n    position: relative;\n    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);\n    transition: all 0.3s ease;\n}\n\n.bio-container:hover {\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n}\n\n.bio-text {\n    width: 100%;\n    min-height: 100px;\n    border: none;\n    resize: vertical;\n    font-family: inherit;\n    font-size: 16px;\n    line-height: 1.5;\n    padding: 0;\n    margin-bottom: 30px;\n    background: transparent;\n    border-radius: 10px;\n    box-shadow: none;\n}\n\n.bio-text:focus {\n    outline: none;\n}\n\n.char-counter {\n    position: absolute;\n    bottom: 10px;\n    right: 15px;\n    color: #5C6EF8;\n    font-size: 14px;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.char-counter:hover {\n    color: #4550e5;\n    text-decoration: none;\n}\n\n.buttons-container {\n    display: flex;\n    justify-content: center;\n    gap: 20px;\n    margin-top: 20px;\n}\n\n.save-btn, .unlog-btn {\n    font-size: 16px;\n    font-weight: 600;\n    border: 2px solid black;\n    padding: 10px 40px;\n    border-radius: 50px;\n    cursor: pointer;\n    outline: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    transition: all 0.2s ease-in-out;\n}\n\n.save-btn {\n    background-color: #5354ED;\n    color: white;\n}\n\n.unlog-btn {\n    background-color: white;\n    color: #333;\n}\n\n.save-btn:hover, .unlog-btn:hover {\n    filter: brightness(1.2);\n    transform: scale(1.05);\n    -webkit-box-shadow: 0px 6px 0px -4px rgba(0,0,0,1);\n    -moz-box-shadow: 0px 6px 0px -4px rgba(0,0,0,1);\n    box-shadow: 0px 6px 0px -4px rgba(0,0,0,1);\n}\n\n.save-btn:active, .unlog-btn:active {\n    transform: scale(0.95);\n    -webkit-box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);\n    -moz-box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);\n    box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);\n    filter: brightness(0.8);\n}\n\n#username, #phone{\n width: 96%;\n}\n\n.delete-account {\n    text-align: center;\n    margin-top: 5px;\n    color: #dd4b39;\n    font-weight: 500;\n    font-size: 14px;\n    text-decoration: underline;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.delete-account:hover {\n    color: #c23321;\n    transform: scale(1.05);\n}\n\n@media (max-width: 576px) {\n    .settings-container {\n        max-width: 100%;\n        padding: 15px;\n    }\n    \n    .profile-form {\n        padding: 20px;\n    }\n    \n    .buttons-container {\n        flex-direction: column;\n        align-items: center;\n    }\n    \n    .save-btn, .unlog-btn {\n        width: 80%;\n    }\n}\n            </style>        \n    <div class="settings-container">\n                <div class="profile-form">\n                    <div class="form-group">\n                        <label>Change Username</label>\n                        <input type="text" id="username" placeholder="Username" value="${t}">\n                    </div>\n                    \n                    <div class="form-group">\n                        <label>Change Semester info</label>\n                        <select id="Semester">\n                            <option value="" ${""===i?"selected":""}>Select a semester</option>\n                            <option value="First semester" ${"First semester"===i?"selected":""}>First semester</option>\n                            <option value="Second semester" ${"Second semester"===i?"selected":""}>Second semester</option>\n                            <option value="Third semester" ${"Third semester"===i?"selected":""}>Third semester</option>\n                            <option value="Fourth semester" ${"Fourth semester"===i?"selected":""}>Fourth semester</option>\n                            <option value="Fifth semester" ${"Fifth semester"===i?"selected":""}>Fifth semester</option>\n                            <option value="Sixth semester" ${"Sixth semester"===i?"selected":""}>Sixth semester</option>\n                            <option value="Seventh semester" ${"Seventh semester"===i?"selected":""}>Seventh semester</option>\n                            <option value="Eighth semester" ${"Eighth semester"===i?"selected":""}>Eighth semester</option>\n                            <option value="Ninth semester" ${"Ninth semester"===i?"selected":""}>Ninth semester</option>\n                            <option value="Tenth semester" ${"Tenth semester"===i?"selected":""}>Tenth semester</option>\n                            <option value="+Tenth semester" ${"+Tenth semester"===i?"selected":""}>+Tenth semester</option>\n                        </select>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label>Change career info</label>\n                        <select id="career">\n                            <option value="" ${""===s?"selected":""}>Select a career</option>\n                            <option value="Business Administration with an Emphasis in International Business" ${"Business Administration with an Emphasis in International Business"===s?"selected":""}>Business Administration with an Emphasis in International Business</option>\n                            <option value="Anthropology" ${"Anthropology"===s?"selected":""}>Anthropology</option>\n                            <option value="Biology" ${"Biology"===s?"selected":""}>Biology</option>\n                            <option value="Political Science with an Emphasis in International Relations" ${"Political Science with an Emphasis in International Relations"===s?"selected":""}>Political Science with an Emphasis in International Relations</option>\n                            <option value="Communication with a Digital Approach" ${"Communication with a Digital Approach"===s?"selected":""}>Communication with a Digital Approach</option>\n                            <option value="Public Accounting and International Finance" ${"Public Accounting and International Finance"===s?"selected":""}>Public Accounting and International Finance</option>\n                            <option value="Law" ${"Law"===s?"selected":""}>Law</option>\n                            <option value="Interactive Media Design" ${"Interactive Media Design"===s?"selected":""}>Interactive Media Design</option>\n                            <option value="Industrial Design" ${"Industrial Design"===s?"selected":""}>Industrial Design</option>\n                            <option value="Economics" ${"Economics"===s?"selected":""}>Economics</option>\n                            <option value="Economics and International Business" ${"Economics and International Business"===s?"selected":""}>Economics and International Business</option>\n                            <option value="Finance" ${"Finance"===s?"selected":""}>Finance</option>\n                            <option value="Biochemical Engineering" ${"Biochemical Engineering"===s?"selected":""}>Biochemical Engineering</option>\n                            <option value="Systems Engineering" ${"Systems Engineering"===s?"selected":""}>Systems Engineering</option>\n                            <option value="Industrial Engineering" ${"Industrial Engineering"===s?"selected":""}>Industrial Engineering</option>\n                            <option value="Telematics Engineering" ${"Telematics Engineering"===s?"selected":""}>Telematics Engineering</option>\n                            <option value="Bachelor's Degree in Social Sciences" ${"Bachelor's Degree in Social Sciences"===s?"selected":""}>Bachelor's Degree in Social Sciences</option>\n                            <option value="Bachelor's Degree in Foreign Languages with an Emphasis in English" ${"Bachelor's Degree in Foreign Languages with an Emphasis in English"===s?"selected":""}>Bachelor's Degree in Foreign Languages with an Emphasis in English</option>\n                            <option value="Medicine" ${"Medicine"===s?"selected":""}>Medicine</option>\n                            <option value="Music" ${"Music"===s?"selected":""}>Music</option>\n                            <option value="International Marketing and Advertising" ${"International Marketing and Advertising"===s?"selected":""}>International Marketing and Advertising</option>\n                            <option value="Psychology" ${"Psychology"===s?"selected":""}>Psychology</option>\n                            <option value="Chemistry" ${"Chemistry"===s?"selected":""}>Chemistry</option>\n                            <option value="Pharmaceutical Chemistry" ${"Pharmaceutical Chemistry"===s?"selected":""}>Pharmaceutical Chemistry</option>\n                            <option value="Sociology" ${"Sociology"===s?"selected":""}>Sociology</option>\n                        </select>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label>Change Phone number</label>\n                        <input type="tel" id="phone" placeholder="Phone number" value="${n}">\n                    </div>\n                    \n                    <div class="bio-container">\n                        <textarea class="bio-text">${r}</textarea>\n                        <span class="char-counter">0/280 caracteres</span>\n                    </div>\n                    \n                    <div class="buttons-container">\n                        <button class="save-btn">Save</button>\n                        <button class="unlog-btn">Unlog</button>\n                    </div>\n                    \n                    <div class="delete-account">Delete account?</div>\n                </div>\n            </div>\n        `;const o=this.shadowRoot.querySelector("#Semester"),a=this.shadowRoot.querySelector("#career");o&&i&&(o.value=i),a&&s&&(a.value=s),this.updateCharCounter(),this.setupEventListeners()}updateCharCounter(){const e=this.shadowRoot.querySelector(".bio-text"),t=this.shadowRoot.querySelector(".char-counter");if(e&&t){const n=e.value.length;t.textContent=`${n}/400 caracteres`}}setupEventListeners(){this.shadowRoot.querySelector(".profile-form");const e=this.shadowRoot.querySelector(".bio-text"),t=this.shadowRoot.querySelector(".delete-account"),n=this.shadowRoot.querySelector(".unlog-btn"),s=this.shadowRoot.querySelector(".save-btn");s&&s.addEventListener("click",(async e=>{e.preventDefault();const t={username:this.shadowRoot.querySelector("#username").value||"",phone:this.shadowRoot.querySelector("#phone").value||"",degree:this.shadowRoot.querySelector("#career").value||"",semester:this.shadowRoot.querySelector("#Semester").value||"",bio:this.shadowRoot.querySelector(".bio-text").value||""};try{s.disabled=!0,s.textContent="Saving...",await(async e=>{try{const t=Jm.getState().auth.user;if(!t)return void r.dispatch({type:Fm,payload:{error:"No logged in user found"}});const n=Jm.validatePhone(e.phone);if(!n.isValid)return alert("Change number action canceled, the new number should be 10 digits long and no letters"),void r.dispatch({type:Fm,payload:{error:n.error}});const s=t.username,i={...t,...e,career:e.degree};if(t.uid){const e=Bl(Yp,"users",t.uid);await Vh(e,{username:i.username,phone:i.phone,degree:i.degree,career:i.degree,semester:i.semester,bio:i.bio},{merge:!0});const n=await Uh(e);if(!n.exists())throw new Error("User document not found after update");const o=n.data();await Jm.updateProfile(s,o),r.dispatch({type:Um,payload:{user:o}}),document.dispatchEvent(new CustomEvent("profile-updated"))}}catch(e){console.error("Error updating profile:",e),r.dispatch({type:Fm,payload:{error:"Failed to update profile"}})}})(t),u("/profile")}catch(e){console.error("Error updating profile:",e),alert("Failed to update profile. Please try again.")}finally{s.disabled=!1,s.textContent="Save"}})),e&&e.addEventListener("input",(()=>this.updateCharCounter())),t&&t.addEventListener("click",(()=>{if(!document.querySelector("delete-account-confirmation")){const e=document.createElement("delete-account-confirmation");document.body.appendChild(e)}})),n&&n.addEventListener("click",(()=>{(()=>{try{Jm.removeLoggedInUser(),r.dispatch({type:"LOGOUT_SUCCESS"})}catch(e){r.dispatch({type:"LOGOUT_ERROR",payload:{error:"Failed to logout"}})}})(),u("/")}))}}const cb=ab;class lb extends HTMLElement{constructor(){super(),this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.handleStoreChange=this.handleStoreChange.bind(this)}connectedCallback(){this.subscribeToStore(),this.render(),this.addEventListeners()}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}subscribeToStore(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange)}handleStoreChange(e){this.render()}addEventListeners(){const e=this.shadowRoot.querySelector(".x-button");e?.addEventListener("click",(()=>{u("/profile")}));const t=this.shadowRoot.querySelector(".profile-picture-container"),n=this.shadowRoot.querySelector("#profile-upload");t?.addEventListener("click",(()=>{n.click()})),n?.addEventListener("change",(async()=>{if(n.files&&n.files[0]){const e=n.files[0];try{await async function(e){try{const t=Jm.getState().auth.user;if(!t||!t.uid)return void r.dispatch({type:Fm,payload:{error:"No logged in user found"}});const n=await async function(e,t){const n=`profile/${t}/${e.name}`,{data:s,error:i}=await Nm.storage.from("pictures").upload(n,e,{cacheControl:"3600",upsert:!0});if(i)throw i;const{publicUrl:r}=Nm.storage.from("pictures").getPublicUrl(n).data;if(!r)throw new Error("Could not get public URL from Supabase");return r}(e,t.uid);await Vh(Bl(Yp,"users",t.uid),{profilePic:n},{merge:!0}),r.dispatch({type:$m,payload:{photo:n}})}catch(e){r.dispatch({type:Fm,payload:{error:"Failed to update profile photo"}})}}(e)}catch(e){console.error("Error uploading image:",e),alert("Error uploading image. Please try again.")}}}))}render(){const e=Jm.getState().auth.user;let t=e?.profilePic;const n=localStorage.getItem(`profilePic_${e?.username}`);n&&(t=n),t||(t="https://picsum.photos/seed/picsum/200/300"),this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n  display: block;\n  width: 100%;\n  overflow-x: hidden;\n}\n\n.banner {\n  width: 100vw;\n  height: 200px;\n  background-color: #ffa500;\n  position: relative;\n  overflow: hidden;\n  left: 50%;\n  right: 50%;\n  margin-left: -50vw;\n  margin-right: -50vw;\n}\n\n.banner-illustrations {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n\n.banner-image {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n@media (max-width: 576px) {\n  .banner-image {\n    content: url("/assets/images/bannerimgsmall.png");\n  }\n}\n\n.profile-section {\n  text-align: center;\n  margin-top: -50px;\n  position: relative;\n}\n\n.profile-picture-container {\n  width: 100px;\n  height: 100px;\n  border-radius: 50%;\n  border: 4px solid white;\n  margin: 0 auto;\n  position: relative;\n  z-index: 2;\n  cursor: pointer;\n  overflow: hidden;\n}\n\n.profile-picture {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  background-color: white;\n  transition: filter 0.3s ease;\n}\n\n.profile-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n  color: white;\n  font-size: 0.8rem;\n  font-weight: bold;\n}\n\n.profile-picture-container:hover .profile-overlay {\n  opacity: 1;\n}\n\n.profile-picture-container:hover .profile-picture {\n  filter: brightness(0.8);\n}\n\n#profile-upload {\n  display: none;\n}\n\n.x-button {\n  position: absolute;\n  right: 30%;\n  top: 30px;\n  background: #6366f1;\n  border: none;\n  border-radius: 50%;\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  z-index: 3;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n}\n\n.x-button:hover {\n  transform: scale(1.1) rotate(90deg);\n  background: #5354ed;\n  box-shadow: 3px 3px 15px -6px rgba(0, 0, 0, 0.4);\n}\n\n.x-button:active {\n  transform: scale(0.95);\n  box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);\n}\n\n.x-button svg {\n  width: 20px;\n  height: 20px;\n  fill: white;\n  transition: all 0.3s ease;\n}\n\n.x-button:hover svg {\n  fill: #ffffff;\n}\n\n.profile-info {\n  background-color: white;\n  padding: 20px;\n}\n\nh1 {\n  margin: 10px 0;\n  color: #1f2937;\n  font-size: 1.5rem;\n}\n\n.career {\n  color: #6b7280;\n  margin: 5px 0;\n}\n\n.bio {\n  color: #4b5563;\n  margin: 15px 0;\n  font-size: 0.9rem;\n}\n      </style>\n\n      <div class="banner">\n        <div class="banner-illustrations">\n          <img class="banner-image" src="/assets/images/bannerimg.png" alt="Banner image">\n        </div>\n      </div>\n      <div class="profile-section">\n        <div class="profile-picture-container">\n          <img class="profile-picture" src="${t}" alt="Profile picture">\n          <div class="profile-overlay">\n            <span>Change Image</span>\n          </div>\n          <input id="profile-upload" type="file" accept="image/*" style="display:none" />\n        </div>\n        <button class="x-button">\n          <svg viewBox="0 0 24 24">\n            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n          </svg>\n        </button>\n      </div>\n    `,this.addEventListeners()}}const hb=lb;class ub extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return["name","career","credits","rating","image"]}connectedCallback(){this.render()}attributeChangedCallback(e,t,n){t!==n&&this.render()}render(){const e=this.getAttribute("name")||"Logic & Argumentation",t=this.getAttribute("career")||"Computer Science",n=this.getAttribute("credits")||"3",s=parseInt(this.getAttribute("rating")||"3"),i=`https://picsum.photos/id/${this.getAttribute("image")||"301"}/400/300`,r=Array(5).fill(0).map(((e,t)=>`\n            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="${t<s?"filled":""}" fill="${t<s?"#5354ED":"#e0e0fe"}" stroke="none" class="star-icon">\n                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n            </svg>\n        `)).join("");this.shadowRoot.innerHTML=`\n           <style>\n \n\n.subject-card {\n  display: flex;\n  flex-direction: column;\n  background-color: white;\n  border-radius: 16px;\n  padding: 30px 24px;\n  margin-bottom: 24px;\n  box-shadow: 0 6px 18px rgba(83, 84, 237, 0.1);\n  transition:\n    transform 0.3s ease,\n    box-shadow 0.3s ease;\n}\n\n.subject-card:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 10px 25px rgba(83, 84, 237, 0.15);\n}\n\n.subject-image {\n  width: 100%;\n  height: 180px;\n  border-radius: 10px;\n  object-fit: cover;\n  margin-bottom: 24px;\n  box-shadow: 0 5px 12px rgba(0, 0, 0, 0.08);\n  background-color: #f0f2fa;\n}\n\n.subject-name {\n  font-size: 28px;\n  font-weight: 700;\n  margin: 0 0 12px 0;\n  color: #000;\n}\n\n.subject-career {\n  font-size: 18px;\n  margin: 0 0 16px 0;\n  color: #5354ed;\n  font-weight: 500;\n}\n\n.subject-details {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px;\n  margin-bottom: 20px;\n}\n\n.detail-item {\n  background-color: #f5f7ff;\n  padding: 10px 16px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  font-size: 15px;\n  font-weight: 500;\n  color: #5354ed;\n  box-shadow: 0 3px 8px rgba(83, 84, 237, 0.06);\n  transition:\n    transform 0.2s ease,\n    box-shadow 0.2s ease;\n}\n\n.detail-item:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 5px 12px rgba(83, 84, 237, 0.1);\n}\n\n.detail-icon {\n  width: 20px;\n  height: 20px;\n  fill: var(--nexopurple);\n}\n\n.rating {\n  display: flex;\n  gap: 10px;\n  margin-top: 12px;\n}\n\n.rating svg.filled {\n  fill: var(--nexopurple);\n}\n\n@media (min-width: 576px) {\n  .subject-card {\n    flex-direction: row;\n    gap: 28px;\n    padding: 36px;\n  }\n\n  .subject-image {\n    width: 280px;\n    height: 200px;\n    margin-bottom: 0;\n  }\n\n  .subject-info {\n    flex: 1;\n  }\n}\n\n               </style>\n    <div class="subject-card">\n                <img class="subject-image" src="${i}" alt="${e}" onerror="this.onerror=null; this.src='data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%22400%22%20height%3D%22300%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22400%22%20height%3D%22300%22%20fill%3D%22%23f0f2fa%22%2F%3E%3Ctext%20x%3D%22200%22%20y%3D%22150%22%20font-size%3D%2240%22%20alignment-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20fill%3D%22%235354ED%22%3E${e.charAt(0)}%3C%2Ftext%3E%3C%2Fsvg%3E';">\n                <div class="subject-info">\n                    <h2 class="subject-name">${e}</h2>\n                    <p class="subject-career">${t}</p>\n                    <div class="subject-details">\n                        <div class="detail-item">\n                            <svg class="detail-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                                <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>\n                            </svg>\n                            ${n} Cr√©ditos\n                        </div>\n                    </div>\n                    <div class="rating">\n                        ${r}\n                    </div>\n                </div>\n            </div>\n        `}}const db=ub;class pb extends HTMLElement{constructor(){super(),this.selectedRating=0,this.subjectName="",this.attachShadow({mode:"open"})}static get observedAttributes(){return["subject-name"]}attributeChangedCallback(e,t,n){"subject-name"===e&&t!==n&&(this.subjectName=n)}connectedCallback(){this.subjectName=this.getAttribute("subject-name")||"",this.render(),this.setupEventListeners()}setupEventListeners(){const e=this.shadowRoot?.querySelectorAll(".star-rating svg"),t=this.shadowRoot?.querySelector(".publish-button"),n=this.shadowRoot?.querySelector(".review-input"),s=this.shadowRoot?.querySelector("#subject-review-form");e?.forEach(((t,n)=>{t.addEventListener("click",(()=>{this.selectedRating=n+1,this.updateStars()})),t.addEventListener("mouseover",(()=>{e.forEach(((e,t)=>{e.classList.toggle("hovered",t<=n)}))})),t.addEventListener("mouseout",(()=>{e.forEach((e=>e.classList.remove("hovered")))}))})),t?.addEventListener("click",(e=>{if(e.preventDefault(),console.log("SubjectReviewForm: Publish button clicked, preventDefault called."),0===this.selectedRating)return void alert("Por favor selecciona una calificaci√≥n antes de publicar tu rese√±a.");const t=n?.value||"";""!==t.trim()?(Jm.submitReview({rating:this.selectedRating,text:t,type:"subject",name:this.subjectName}),this.selectedRating=0,n&&(n.value=""),this.updateStars()):alert("Por favor, escribe un comentario antes de publicar tu rese√±a.")})),n?.addEventListener("keydown",this.handleKeydown.bind(this)),s?.addEventListener("submit",this.handleSubmit.bind(this))}handleSubmit(e){e.preventDefault(),console.log("SubjectReviewForm: Form submitted, preventDefault called.")}handleKeydown(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),console.log("SubjectReviewForm: Enter key pressed in review input, preventDefault called."))}updateStars(){const e=this.shadowRoot?.querySelectorAll(".star-rating svg");e?.forEach(((e,t)=>{e.classList.toggle("selected",t<this.selectedRating)}))}render(){const e=Array(5).fill(0).map((()=>'\n            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n            </svg>\n        ')).join("");this.shadowRoot.innerHTML=`\n          <style>\n \n\n.form-title {\n  font-size: 18px;\n  font-weight: 600;\n  margin-top: 10px;\n  color: var(--nexoblack);\n  position: relative;\n  padding-bottom: 3px;\n  text-align: center;\n}\n\n.form-title::after {\n  content: "";\n  position: absolute;\n  bottom: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 160px;\n  height: 3px;\n  background-color: var(--nexopurple);\n  border-radius: 2px;\n}\n\n.star-rating {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 20px;\n  justify-content: center;\n}\n\n.star-rating svg {\n  width: 40px;\n  height: 40px;\n  cursor: pointer;\n  fill: var(--nexolightwhite);\n  stroke: none;\n  transition: all 0.3s ease;\n}\n\n.star-rating svg:hover {\n  transform: scale(1.1);\n}\n\n.star-rating svg.selected,\n.star-rating svg.hovered {\n  fill: var(--nexopurple);\n}\n\n.review-input {\n  width: 100%;\n  min-height: 120px;\n  border: 1px solid var(--nexolightwhite);\n  border-radius: 10px;\n  padding: 14px;\n  font-family: inherit;\n  font-size: 15px;\n  margin-bottom: 20px;\n  resize: vertical;\n  background-color: white;\n  transition: all 0.3s ease;\n  box-sizing: border-box;\n}\n\n@media (max-width: 576px) {\n  .review-input {\n    min-height: 100px;\n    font-size: 14px;\n    padding: 10px;\n  }\n}\n\n@media (max-width: 576px) {\n  .review-input {\n    min-height: 80px;\n    font-size: 13px;\n    padding: 8px;\n  }\n}\n\n.review-input:focus {\n  outline: none;\n  border-color: var(--nexopurple);\n  box-shadow: 0 0 0 3px rgba(83, 84, 237, 0.15);\n  background-color: white;\n}\n\n.button-container {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.publish-button {\n  background-color: var(--nexopurple);\n  color: var(--nexowhite);\n  font-size: 15px;\n  border: 2px solid var(--nexoblack);\n  padding: 10px 24px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 8px;\n  transition: all 0.2s ease-in-out;\n}\n\n.publish-button:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\n.publish-button:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n}\n\n.publish-button svg {\n  width: 18px;\n  height: 18px;\n  fill: var(--nexowhite);\n}\n\n               </style>\n                <form id="subject-review-form">\n                <div class="review-form">\n                <h3 class="form-title">Leave your review:</h3>\n                <div class="star-rating">\n                    ${e}\n                </div>\n                <textarea class="review-input" placeholder="Write something..."></textarea>\n                <div class="button-container">\n                    <button class="publish-button">\n                        Publish\n                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n            </form>\n        `}}const gb=pb;class fb extends HTMLElement{constructor(){super(),this.reviews=[],this.subjectName="",this.unsubscribeStore=null,this.attachShadow({mode:"open"})}static get observedAttributes(){return["subject-name"]}attributeChangedCallback(e,t,n){"subject-name"===e&&t!==n&&(this.subjectName=n,this.fetchReviews())}async fetchReviews(){try{this.subjectName||(this.subjectName=this.getAttribute("subject-name")||"");const e=Jm.getState().subjectRatings[this.subjectName]||[];this.reviews=e.map((e=>({rating:e.rating,text:e.comment,date:new Date(e.timestamp).toLocaleDateString(),author:e.author||"Anonymous",image:e.image||`https://i.pravatar.cc/150?img=${Math.floor(70*Math.random())}`}))),this.render()}catch(e){console.error("Error fetching reviews:",e),this.reviews=[],this.render()}}connectedCallback(){this.fetchReviews(),this.setupEventListeners(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}setupEventListeners(){}handleStoreChange(e){if(!this.isConnected||!this.subjectName)return;const t=e.subjectRatings[this.subjectName]||[];this.reviews=t.map((e=>({rating:e.rating,text:e.comment,date:new Date(e.timestamp).toLocaleDateString(),author:e.author||"Anonymous",image:e.image||`https://i.pravatar.cc/150?img=${Math.floor(70*Math.random())}`}))),this.render()}addReview(e){console.warn("addReview method in SubjectReviewList called. Consider using the store for updates."),Jm.saveSubjectReview(this.subjectName,e),this.reviews=Jm.getSubjectReviews(this.subjectName),this.render()}render(){const e=this.reviews.map((e=>{const t=Array(5).fill(0).map(((t,n)=>`\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" \n                    fill="${n<e.rating?"#5354ED":"#e0e0fe"}" class="star-icon">\n                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                </svg>\n            `)).join(""),n=`data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%22150%22%20height%3D%22150%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22150%22%20height%3D%22150%22%20fill%3D%22%23f0f2fa%22%2F%3E%3Ctext%20x%3D%2275%22%20y%3D%2275%22%20font-size%3D%2250%22%20alignment-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20fill%3D%22%235354ED%22%3E${e.author.charAt(0)}%3C%2Ftext%3E%3C%2Fsvg%3E`;return`\n                <div class="review-item">\n                    <div class="review-header">\n                        <div class="user-info">\n                            <img src="${e.image||n}" alt="${e.author}" class="user-avatar" onerror="this.onerror=null; this.src='${n}';">\n                            <div>\n                                <h4 class="user-name">${e.author}</h4>\n                                <div class="review-date">${e.date}</div>\n                            </div>\n                        </div>\n                        <div class="review-rating">\n                            ${t}\n                        </div>\n                    </div>\n                    <p class="review-text">${e.text}</p>\n                </div>\n            `})).join("");this.shadowRoot.innerHTML=`\n          <style>\n \n\n.reviews-title {\n    top:-10;\n    font-size: 18px;\n    font-weight: 600;\n    margin-bottom: 20px;\n    color: var(--nexoblack);\n    position: relative;\n    padding-bottom: 1px;\n}\n\n.reviews-title::after {\n    content: '';\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 70px;\n    height: 3px;\n    background-color: var(--nexopurple);\n    border-radius: 2px;\n}\n\n.review-item {\n    background-color: var(--nexolightwhite);\n    border-radius: 12px;\n    padding: 20px;\n    margin-bottom: 16px;\n    box-shadow: 0 3px 10px rgba(83, 84, 237, 0.06);\n    transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n.review-item:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 12px rgba(83, 84, 237, 0.1);\n}\n\n.review-item:last-child {\n    margin-bottom: 0;\n}\n\n.review-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: 14px;\n}\n\n.user-info {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.user-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    object-fit: cover;\n    border: 2px solid var(--nexowhite);\n    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);\n    background-color: var(--nexolightwhite);\n}\n\n.user-name {\n    margin: 0 0 4px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: var(--nexoblack);\n}\n\n.review-date {\n    font-size: 13px;\n    color: var(--nexopurple);\n}\n\n.review-rating {\n    display: flex;\n    gap: 4px;\n    padding: 5px 10px;\n    background-color: var(--nexowhite);\n    border-radius: 20px;\n    box-shadow: 0 2px 6px rgba(83, 84, 237, 0.06);\n}\n\n.review-text {\n    margin: 0;\n    font-size: 15px;\n    line-height: 1.5;\n    color: var(--nexogray);\n}\n\n.empty-state {\n    text-align: center;\n    padding: 30px 16px;\n    color: #555;\n    font-size: 15px;\n    background-color: #f8f9fd;\n    border-radius: 12px;\n}\n\n@media (min-width: 576px) {\n    .reviews-container {\n        padding: 0px 36px 36px 36px;\n    }\n    \n    .review-item {\n        padding: 24px;\n    }\n}\n               </style>\n            <div class="reviews-container">\n                <h3 class="reviews-title">Reviews</h3>\n                ${e}\n            </div>\n        `}}const mb=fb;class vb extends HTMLElement{constructor(){super(),this.unsubscribeStore=null,this.attachShadow({mode:"open"})}static get observedAttributes(){return["name","subject","rating","image","nucleus"]}connectedCallback(){this.render(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(){this.render()}calculateAverageRating(){const e=this.getAttribute("name")||"",t=Jm.getState().teacherRatings[e]||[];if(0===t.length)return 0;const n=t.reduce(((e,t)=>e+t.rating),0);return Number((n/t.length).toFixed(1))}attributeChangedCallback(e,t,n){t!==n&&this.render()}render(){const e=this.getAttribute("name")||"Jimmy Ramirez",t=this.getAttribute("subject")||"Logic & Argumentation",n=this.calculateAverageRating(),s=this.getAttribute("nucleus")||"basic",i=Array(5).fill(0).map(((e,t)=>`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="${t<n?"filled":""}" fill="${t<n?"#5354ED":"#e0e0fe"}" stroke="none" class="star-icon">\n                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n            </svg>`)).join(""),r="basic"===s?"N√∫cleo B√°sico":"N√∫cleo Profesional";this.shadowRoot.innerHTML=`\n           <style>\n               \n\n.teacher-card {\n  display: flex;\n  flex-direction: column;\n  background-color: white;\n  border-radius: 16px;\n  padding: 30px 24px;\n  margin-bottom: 24px;\n  box-shadow: 0 6px 18px rgba(83, 84, 237, 0.1);\n  transition:\n    transform 0.3s ease,\n    box-shadow 0.3s ease;\n}\n\n.teacher-card:hover {\n  transform: translateY(-4px);\n  box-shadow: 0 10px 25px rgba(83, 84, 237, 0.15);\n}\n\n.teacher-image {\n  width: 100%;\n  height: 180px;\n  border-radius: 10px;\n  object-fit: cover;\n  margin-bottom: 24px;\n  box-shadow: 0 5px 12px rgba(0, 0, 0, 0.08);\n  background-color: #f0f2fa;\n}\n\n.teacher-name {\n  font-size: 28px;\n  font-weight: 700;\n  margin: 0 0 12px 0;\n  color: #000;\n}\n\n.teacher-subject {\n  font-size: 18px;\n  margin: 0 0 16px 0;\n  color: var(--nexopurple);\n  font-weight: 500;\n}\n\n.subject-details {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12px;\n  margin-bottom: 20px;\n}\n\n.detail-item {\n  background-color: var(--nexolightwhite);\n  padding: 10px 16px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  font-size: 15px;\n  font-weight: 500;\n  color: var(--nexopurple);\n  box-shadow: 0 3px 8px rgba(83, 84, 237, 0.06);\n  transition:\n    transform 0.2s ease,\n    box-shadow 0.2s ease;\n}\n\n.detail-item:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 5px 12px rgba(83, 84, 237, 0.1);\n}\n\n.detail-icon {\n  width: 20px;\n  height: 20px;\n  fill: var(--nexopurple);\n}\n\n.rating {\n  display: flex;\n  gap: 10px;\n  margin-top: 12px;\n}\n\n.rating svg.filled {\n  fill: var(--nexopurple);\n}\n\n@media (min-width: 576px) {\n  .teacher-card {\n    flex-direction: row;\n    gap: 28px;\n    padding: 36px;\n  }\n\n  .teacher-image {\n    width: 280px;\n    height: 200px;\n    margin-bottom: 0;\n  }\n\n  .teacher-info {\n    flex: 1;\n  }\n}\n\n                </style>\n            <div class="teacher-card">\n                <img class="teacher-image" src="https://picsum.photos/id/301/400/300" alt="${e}" onerror="this.onerror=null; this.src='data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%22400%22%20height%3D%22300%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22400%22%20height%3D%22300%22%20fill%3D%22%23f0f2fa%22%2F%3E%3Ctext%20x%3D%22200%22%20y%3D%22150%22%20font-size%3D%2240%22%20alignment-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20fill%3D%22%235354ED%22%3E${e.charAt(0)}%3C%2Ftext%3E%3C%2Fsvg%3E';">\n                <div class="teacher-info">\n                    <h2 class="teacher-name">${e}</h2>\n                    <p class="teacher-subject">${t}</p>\n                    <div class="subject-details">\n                        <div class="detail-item">\n                            <svg class="detail-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n                                <path d="M22 9l-7-5v3H9v4h6v3l7-5zM2 9l7-5v3h6v4h-6v3l-7-5z"/>\n                            </svg>\n                            ${r}\n                        </div>\n                    </div>\n                    <div class="rating">\n                        ${i}\n                    </div>\n                </div>\n            </div>\n        `}}const bb=vb;class yb extends HTMLElement{constructor(){super(),this.selectedRating=0,this.teacherName="",this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.setupEventListeners()}updateStars(){const e=this.shadowRoot?.querySelectorAll(".star-rating svg");e?.forEach(((e,t)=>{e.classList.toggle("selected",t<this.selectedRating),e.classList.toggle("hovered",!1)}))}setupEventListeners(){const e=this.shadowRoot?.querySelectorAll(".star-rating svg"),t=this.shadowRoot?.querySelector(".publish-button"),n=this.shadowRoot?.querySelector(".review-input"),s=this.shadowRoot?.querySelector("#review-form");e?.forEach(((t,n)=>{t.addEventListener("click",(()=>{this.selectedRating=n+1,this.updateStars()})),t.addEventListener("mouseover",(()=>{e.forEach(((e,t)=>{e.classList.toggle("hovered",t<=n)}))})),t.addEventListener("mouseout",(()=>{e.forEach((e=>e.classList.remove("hovered")))}))})),t?.addEventListener("click",(e=>{if(e.preventDefault(),console.log("TeacherReviewForm: Publish button clicked, preventDefault called."),0===this.selectedRating)return void alert("Por favor, selecciona una calificaci√≥n antes de publicar tu rese√±a.");const t=n?.value||"";""!==t.trim()?this.teacherName?(Jm.submitReview({rating:this.selectedRating,text:t,type:"teacher",name:this.teacherName}),n&&(n.value=""),this.selectedRating=0,this.updateStars()):console.error("Teacher name not found on component property"):alert("Por favor, escribe un comentario antes de publicar tu rese√±a.")})),n?.addEventListener("keydown",this.handleKeydown.bind(this)),s?.addEventListener("submit",this.handleSubmit.bind(this))}handleSubmit(e){e.preventDefault(),console.log("TeacherReviewForm: Form submitted, preventDefault called.")}handleKeydown(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),console.log("TeacherReviewForm: Enter key pressed in review input, preventDefault called."))}render(){this.shadowRoot.innerHTML=`\n           <style>\n                 \n\n.form-title {\n  font-size: 18px;\n  font-weight: 600;\n  margin-top: 10px;\n  color: var(--nexoblack);\n  position: relative;\n  padding-bottom: 3px;\n  text-align: center;\n}\n\n.form-title::after {\n  content: "";\n  position: absolute;\n  bottom: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 160px;\n  height: 3px;\n  background-color: var(--nexopurple);\n  border-radius: 2px;\n}\n\n.star-rating {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 20px;\n  justify-content: center;\n}\n\n.star-rating svg {\n  width: 40px;\n  height: 40px;\n  cursor: pointer;\n  fill: var(--nexolightwhite);\n  stroke: none;\n  transition: all 0.3s ease;\n}\n\n.star-rating svg:hover {\n  transform: scale(1.1);\n}\n\n.star-rating svg.selected,\n.star-rating svg.hovered {\n  fill: var(--nexopurple);\n}\n\n.review-input {\n  width: 100%;\n  min-height: 120px;\n  border: 1px solid var(--nexolightwhite);\n  border-radius: 10px;\n  padding: 14px;\n  font-family: inherit;\n  font-size: 15px;\n  margin-bottom: 20px;\n  resize: vertical;\n  background-color: white;\n  transition: all 0.3s ease;\n  box-sizing: border-box;\n}\n\n@media (max-width: 768px) {\n  .review-input {\n    min-height: 100px;\n    font-size: 14px;\n    padding: 10px;\n  }\n}\n\n@media (max-width: 480px) {\n  .review-input {\n    min-height: 80px;\n    font-size: 13px;\n    padding: 8px;\n  }\n}\n\n.review-input:focus {\n  outline: none;\n  border-color: var(--nexopurple);\n  box-shadow: 0 0 0 3px rgba(83, 84, 237, 0.15);\n  background-color: white;\n}\n\n.button-container {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.publish-button {\n  background-color: var(--nexopurple);\n  color: var(--nexowhite);\n  font-size: 15px;\n  border: 2px solid black;\n  padding: 10px 24px;\n  border-radius: 50px;\n  cursor: pointer;\n  outline: none;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 8px;\n  transition: all 0.2s ease-in-out;\n}\n\n.publish-button:hover {\n  filter: brightness(1.2);\n  transform: scale(1.05);\n  -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n  box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n}\n\n.publish-button:active {\n  transform: scale(0.95);\n  -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n  filter: brightness(0.8);\n}\n\n.publish-button svg {\n  width: 18px;\n  height: 18px;\n  fill: var(--nexowhite);\n}\n\n                </style>\n                <form id="review-form">\n                 <div class="review-form">\n                <h3 class="form-title">Leave your review:</h3>\n                <div class="star-rating">\n                    ${Array(5).fill(0).map((()=>'\n                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                        </svg>\n                    ')).join("")}\n                </div>\n                <textarea class="review-input" placeholder="Write something..."></textarea>\n                <div class="button-container">\n                    <button class="publish-button">\n                        Publish\n                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n                        </svg>\n                    </button>\n                </div>\n            </div>\n            </form>\n        `}}const wb=yb,xb={},_b={};class Sb extends HTMLElement{constructor(){super(),this.reviews=[],this.teacherName="",this.isLoading=!1,this.abortController=null,this.unsubscribeStore=null,this.attachShadow({mode:"open"})}static get observedAttributes(){return["teacher-name"]}shouldFetchFromNetwork(e){return!xb[e]||!_b[e]||Date.now()-_b[e]>3e5}async fetchFromNetwork(){this.abortController&&this.abortController.abort(),this.abortController=new AbortController;try{const e=(await Vv()).teachers.find((e=>e.name===this.teacherName));return e&&e.reviews?(xb[this.teacherName]=e.reviews,_b[this.teacherName]=Date.now(),e.reviews):[]}catch(e){return"AbortError"!==e.name&&console.error("Error fetching reviews:",e),[]}finally{this.abortController=null}}updateReviews(e){this.reviews=e,this.render()}async fetchReviews(){if(this.teacherName&&!this.isLoading){this.isLoading=!0;try{const e=Jm.getState().teacherRatings[this.teacherName]||[];this.reviews=e.map((e=>({rating:e.rating,text:e.comment,date:new Date(e.timestamp).toLocaleDateString(),author:e.author||"Anonymous",image:e.image||`https://i.pravatar.cc/150?img=${Math.floor(70*Math.random())}`}))),this.render()}catch(e){console.error("Error fetching reviews:",e),this.reviews=[],this.render()}finally{this.isLoading=!1}}}attributeChangedCallback(e,t,n){"teacher-name"===e&&t!==n&&(this.teacherName=n,this.fetchReviews())}connectedCallback(){this.fetchReviews(),this.setupEventListeners(),this.unsubscribeStore=Jm.subscribe(this.handleStoreChange.bind(this))}disconnectedCallback(){this.abortController&&(this.abortController.abort(),this.abortController=null),this.unsubscribeStore&&this.unsubscribeStore()}setupEventListeners(){}handleStoreChange(e){if(!this.isConnected||!this.teacherName)return;const t=e.teacherRatings[this.teacherName]||[];this.reviews=t.map((e=>({rating:e.rating,text:e.comment,date:new Date(e.timestamp).toLocaleDateString(),author:e.author||"Anonymous",image:e.image||`https://i.pravatar.cc/150?img=${Math.floor(70*Math.random())}`}))),this.render()}addReview(e){console.warn("addReview method in TeacherReviewList called. Consider using the store for updates."),Jm.saveTeacherReview(this.teacherName,e),this.reviews=Jm.getTeacherReviews(this.teacherName),this.render()}render(){if(!this.shadowRoot)return;const e=this.reviews.map((e=>{const t=Array(5).fill(0).map(((t,n)=>`\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" \n                    fill="${n<e.rating?"#5354ED":"#e0e0fe"}" class="star-icon">\n                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                </svg>\n            `)).join(""),n=`data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%22150%22%20height%3D%22150%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22150%22%20height%3D%22150%22%20fill%3D%22%23f0f2fa%22%2F%3E%3Ctext%20x%3D%2275%22%20y%3D%2275%22%20font-size%3D%2250%22%20alignment-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20fill%3D%22%235354ED%22%3E${e.author?.charAt(0)||"U"}%3C%2Ftext%3E%3C%2Fsvg%3E`;return`\n                <div class="review-item">\n                    <div class="review-header">\n                        <div class="user-info">\n                            <img src="${e.image||n}" alt="${e.author||"User"}" class="user-avatar" onerror="this.onerror=null; this.src='${n}';">\n                            <div>\n                                <h4 class="user-name">${e.author||"Anonymous"}</h4>\n                                <div class="review-date">${e.date||(new Date).toLocaleDateString()}</div>\n                            </div>\n                        </div>\n                        <div class="review-rating">\n                            ${t}\n                        </div>\n                    </div>\n                    <p class="review-text">${e.text}</p>\n                </div>\n            `})).join("");this.shadowRoot.innerHTML=`\n           <style>\n               \n\n.reviews-title {\n  top: -10;\n  font-size: 18px;\n  font-weight: 600;\n  margin-bottom: 20px;\n  color: #000;\n  position: relative;\n  padding-bottom: 1px;\n}\n\n.reviews-title::after {\n  content: "";\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 70px;\n  height: 3px;\n  background-color: var(--nexopurple);\n  border-radius: 2px;\n}\n\n.review-item {\n  background-color: var(--nexolightwhite);\n  border-radius: 12px;\n  padding: 20px;\n  margin-bottom: 16px;\n  box-shadow: 0 3px 10px rgba(83, 84, 237, 0.06);\n  transition:\n    transform 0.3s ease,\n    box-shadow 0.3s ease;\n}\n\n.review-item:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 5px 12px rgba(83, 84, 237, 0.1);\n}\n\n.review-item:last-child {\n  margin-bottom: 0;\n}\n\n.review-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 14px;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.user-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  object-fit: cover;\n  border: 2px solid var(--nexowhite);\n  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);\n  background-color: var(--nexowhite);\n}\n\n.user-name {\n  margin: 0 0 4px 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--nexoblack);\n}\n\n.review-date {\n  font-size: 13px;\n  color: var(--nexopurple);\n}\n\n.review-rating {\n  display: flex;\n  gap: 4px;\n  padding: 5px 10px;\n  background-color: var(--nexowhite);\n  border-radius: 20px;\n  box-shadow: 0 2px 6px rgba(83, 84, 237, 0.06);\n}\n\n.review-text {\n  margin: 0;\n  font-size: 15px;\n  line-height: 1.5;\n  color: var(--nexogray);\n}\n\n.empty-state {\n  text-align: center;\n  padding: 30px 16px;\n  color: var(--nexogray);\n  font-size: 15px;\n  background-color: var(--nexowhite);\n  border-radius: 12px;\n}\n\n@media (min-width: 576px) {\n  .reviews-container {\n    padding: 0px 36px 36px 36px;\n  }\n\n  .review-item {\n    padding: 24px;\n  }\n}\n\n                </style> \n                <div class="reviews-container">\n                <h3 class="reviews-title">Reviews</h3>\n                ${e||'<div class="empty-state">No reviews yet. Be the first to leave one!</div>'}\n            </div>\n        `}}const Eb=Sb;class kb extends HTMLElement{static get observedAttributes(){return["teacher-name"]}constructor(){super(),this.teacherName="",this.attachShadow({mode:"open"})}attributeChangedCallback(e,t,n){"teacher-name"===e&&t!==n&&(this.teacherName=n,this.render())}connectedCallback(){this.teacherName||(this.teacherName=this.getAttribute("teacher-name")||""),this.render(),this.setupEventListeners()}setupEventListeners(){}render(){if(this.shadowRoot){this.shadowRoot.innerHTML=`\n        <style>\n          :host {\n            display: flex;\n            flex-direction: column;\n            padding: 2rem;\n            background-color: white;\n            border-radius: 16px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n          }\n          .divider {\n            width: 100%;\n            height: 1px;\n            background: linear-gradient(to right, transparent, rgba(83, 83, 237, 0.39), transparent);\n            margin: 1rem 0;\n          }\n          .reviews-container {\n            display: flex;\n            flex-direction: column;\n            gap: 1rem;\n            margin-top: 1rem;\n          }\n        </style>\n        <div id="form-container"></div>\n        <div class="divider"></div>\n        <div class="reviews-container">\n          <teacher-review-list teacher-name="${this.teacherName}"></teacher-review-list>\n        </div>\n      `;const e=this.shadowRoot.getElementById("form-container");if(e){const t=document.createElement("teacher-review-form");t.teacherName=this.teacherName,e.appendChild(t)}}}}const Tb=kb;class Ib extends HTMLElement{constructor(){super(),this.subjectName="",this.reviewForm=null,this.reviewList=null,this.attachShadow({mode:"open"}),this.handleReviewSubmitted=this.handleReviewSubmitted.bind(this)}static get observedAttributes(){return["subject-name"]}attributeChangedCallback(e,t,n){"subject-name"===e&&t!==n&&(this.subjectName=n,this.render())}handleReviewSubmitted(e){const t=e;this.reviewList&&this.reviewList.addReview(t.detail)}setupEventListeners(){this.reviewForm&&this.reviewForm.removeEventListener("review-submitted",this.handleReviewSubmitted),this.reviewForm&&this.reviewList&&this.reviewForm.addEventListener("review-submitted",this.handleReviewSubmitted)}connectedCallback(){this.subjectName=this.getAttribute("subject-name")||"",this.render()}disconnectedCallback(){this.reviewForm&&this.reviewForm.removeEventListener("review-submitted",this.handleReviewSubmitted)}render(){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n        <style>\n          :host {\n            display: flex;\n            flex-direction: column;\n            padding: 2rem;\n            background-color: white;\n            border-radius: 16px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n          }\n          .divider {\n            width: 100%;\n            height: 1px;\n            background: linear-gradient(to right, transparent, rgba(83, 83, 237, 0.39), transparent);\n            margin: 1rem 0;\n          }\n        </style>\n        <subject-review-form id="review-form" subject-name="${this.subjectName}"></subject-review-form>\n        <div class="divider"></div>\n        <subject-review-list id="review-list" subject-name="${this.subjectName}"></subject-review-list>\n      `,this.reviewForm=this.shadowRoot.querySelector("#review-form"),this.reviewList=this.shadowRoot.querySelector("#review-list"),this.setupEventListeners())}}const Cb=Ib;class Ab extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.setupEventListeners()}setupEventListeners(){const e=this.shadowRoot?.querySelector(".publish-button"),t=this.shadowRoot?.querySelector(".comment-input"),n=this.shadowRoot?.querySelector("#comment-form");e?.addEventListener("click",(()=>{const e=t?.value||"";if(!e.trim())return void alert("Please write a comment before publishing.");const n={message:e};Jm.addComment(n),t.value="",this.showNotification("¬°Comentario publicado con √©xito!")})),t?.addEventListener("keydown",this.handleKeydown.bind(this)),n?.addEventListener("submit",this.handleSubmit.bind(this))}handleSubmit(e){e.preventDefault(),console.log("CommentForm: Form submitted, preventDefault called.")}handleKeydown(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),console.log("CommentForm: Enter key pressed in comment input, preventDefault called."))}render(){this.shadowRoot.innerHTML='\n      <style>\n        .form-title {\n          font-size: 18px;\n          font-weight: 600;\n          margin-top: 10px;\n          color: #191919;\n          position: relative;\n          padding-bottom: 3px;\n          text-align: center;\n        }\n        \n        .form-title::after {\n          content: "";\n          position: absolute;\n          bottom: 0;\n          left: 50%;\n          transform: translateX(-50%);\n          width: 160px;\n          height: 3px;\n          background-color: #5354ed;\n          border-radius: 2px;\n        }\n        \n        .comment-input {\n          width: 100%;\n          min-height: 120px;\n          border: 1px solid #f0f2fa;\n          border-radius: 10px;\n          padding: 14px;\n          font-family: inherit;\n          font-size: 15px;\n          margin: 20px 0;\n          resize: vertical;\n          background-color: white;\n          transition: all 0.3s ease;\n          box-sizing: border-box;\n        }\n        \n        .comment-input:focus {\n          outline: none;\n          border-color: #5354ed;\n          box-shadow: 0 0 0 3px rgba(83, 84, 237, 0.15);\n        }\n        \n        .button-container {\n          display: flex;\n          justify-content: flex-end;\n        }\n        \n        .publish-button {\n          background-color: #5354ed;\n          color: white;\n          font-size: 14px;\n          border: 2px solid black;\n          padding: 10px 24px;\n          border-radius: 50px;\n          cursor: pointer;\n          outline: none;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          gap: 12px;\n          transition: all 0.3s ease;\n        }\n\n        .publish-button:hover {\n          filter: brightness(1.2);\n          transform: scale(1.05);\n          -webkit-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n          -moz-box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n          box-shadow: 0px 6px 0px -4px rgba(0, 0, 0, 1);\n        }\n\n        .publish-button:active {\n          transform: scale(0.95);\n          -webkit-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n          -moz-box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n          box-shadow: 0px 0px 0px 0px rgba(0, 0, 0, 1);\n          filter: brightness(0.8);\n        }\n        \n        .publish-button svg {\n          width: 16px;\n          height: 16px;\n          fill: currentColor;\n        }\n      </style>\n      \n      <form id="comment-form">\n      <h3 class="form-title">Write a comment</h3>\n      <textarea class="comment-input" placeholder="What do you think about this?"></textarea>\n      <div class="button-container">\n        <button class="publish-button">\n          Publish\n          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n          </svg>\n        </button>\n      </div>\n      </form>\n    '}showNotification(e){const t=document.createElement("div");t.className="comment-notification",t.textContent=e,t.style.position="fixed",t.style.bottom="20px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.backgroundColor="#5354ed",t.style.color="white",t.style.padding="10px 20px",t.style.borderRadius="5px",t.style.boxShadow="0 2px 10px rgba(0,0,0,0.2)",t.style.zIndex="1000",document.body.appendChild(t),setTimeout((()=>{t.style.opacity="0",t.style.transition="opacity 0.5s ease",setTimeout((()=>{document.body.removeChild(t)}),500)}),3e3)}}const Rb=Ab;class Pb extends HTMLElement{constructor(){super(),this.comments=[],this.attachShadow({mode:"open"})}static get observedAttributes(){return["comments"]}attributeChangedCallback(e,t,n){if("comments"===e&&n!==t)try{this.comments=JSON.parse(n),this.render()}catch(e){console.error("Error parsing comments:",e),this.comments=[]}}connectedCallback(){this.render()}render(){const e=this.comments.map((e=>{const t=e.name||"Usuario",n=e.photo||"https://picsum.photos/seed/default/200/300",s=e.date||(new Date).toLocaleDateString(),i=(e.career,e.message||""),r=`data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%22150%22%20height%3D%22150%22%3E%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22150%22%20height%3D%22150%22%20fill%3D%22%23f0f2fa%22%2F%3E%3Ctext%20x%3D%2275%22%20y%3D%2275%22%20font-size%3D%2250%22%20alignment-baseline%3D%22middle%22%20text-anchor%3D%22middle%22%20fill%3D%22%235354ED%22%3E${t.charAt(0)}%3C%2Ftext%3E%3C%2Fsvg%3E`;return`\n          <div class="comment-item">\n            <div class="comment-header">\n              <div class="user-info">\n                <img src="${n||r}" alt="${t}" class="user-avatar">\n                <div>\n                  <h4 class="user-name">${t}</h4>\n                  <div class="comment-date">${s}</div>\n                </div>\n              </div>\n            </div>\n            <p class="comment-text">${i}</p>\n          </div>\n        `})).join("");this.shadowRoot.innerHTML=`\n      <style>\n        .comments-title {\n          font-size: 18px;\n          font-weight: 600;\n          margin-bottom: 20px;\n          color: #191919;\n          position: relative;\n          padding-bottom: 1px;\n        }\n        \n        .comments-title::after {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 0;\n          width: 70px;\n          height: 3px;\n          background-color: #5354ed;\n          border-radius: 2px;\n        }\n        \n        .comment-item {\n          background-color: #f8f9fd;\n          border-radius: 12px;\n          padding: 20px;\n          margin-bottom: 16px;\n          box-shadow: 0 3px 10px rgba(83, 84, 237, 0.06);\n          transition: transform 0.3s ease, box-shadow 0.3s ease;\n        }\n        \n        .comment-item:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 5px 12px rgba(83, 84, 237, 0.1);\n        }\n        \n        .comment-item:last-child {\n          margin-bottom: 0;\n        }\n        \n        .comment-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: 14px;\n        }\n        \n        .user-info {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n        }\n        \n        .user-avatar {\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          object-fit: cover;\n          border: 2px solid white;\n          box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);\n          background-color: #f8f9fd;\n        }\n        \n        .user-name {\n          margin: 0 0 4px 0;\n          font-size: 16px;\n          font-weight: 600;\n          color: #191919;\n        }\n        \n        .comment-date {\n          font-size: 13px;\n          color: #5354ed;\n        }\n        \n        .comment-text {\n          margin: 0;\n          font-size: 15px;\n          line-height: 1.5;\n          color: #444;\n        }\n        \n        .empty-state {\n          text-align: center;\n          padding: 30px 16px;\n          color: #555;\n          font-size: 15px;\n          background-color: #f8f9fd;\n          border-radius: 12px;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          gap: 10px;\n        }\n        \n        .empty-state p:first-of-type {\n          font-weight: 600;\n          font-size: 16px;\n          margin: 10px 0 0 0;\n        }\n        \n        .empty-state p:last-of-type {\n          margin: 0;\n          color: #777;\n        }\n      </style>\n      <h3 class="comments-title">Comments</h3>\n      ${this.comments.length>0?e:'\n      <div class="empty-state">\n        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="#5354ed">\n          <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"/>\n        </svg>\n        <p>No comments yet</p>\n        <p>Be the first to comment!</p>\n      </div>\n    '}\n    `}}const Lb=Pb;class Db extends HTMLElement{constructor(){super(),this.postId="",this.commentSubmittedHandler=null,this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.handleStoreChange=this.handleStoreChange.bind(this)}static get observedAttributes(){return["post-id"]}attributeChangedCallback(e,t,n){"post-id"===e&&n!==t&&(this.postId=n)}connectedCallback(){this.render(),this.setupEventListeners(),this.subscribeToStore()}disconnectedCallback(){this.removeEventListeners(),this.unsubscribeStore&&this.unsubscribeStore()}subscribeToStore(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange)}handleStoreChange(e){const t=this.shadowRoot?.querySelector("comments-list");if(t&&this.postId){const n=e.comments[this.postId]||[];t.setAttribute("comments",this._escapeHTML(JSON.stringify(n))),console.log("CommentsContainer: Store change - Updated comments for postId:",this.postId,n)}}removeEventListeners(){this.commentSubmittedHandler&&(document.removeEventListener("comment-submitted",this.commentSubmittedHandler),this.shadowRoot?.removeEventListener("comment-submitted",this.commentSubmittedHandler),this.commentSubmittedHandler=null)}setupEventListeners(){this.removeEventListeners(),this.commentSubmittedHandler=e=>{if(this.postId){const t=Jm.getState().auth.user;if(t){const n=e.detail,s={photo:t.profilePic||"",name:t.username||"Anonymous",career:t.career||"",date:(new Date).toLocaleDateString(),message:n};zm.addComment(s)}else console.warn("User not logged in, cannot add comment.")}},document.addEventListener("comment-submitted",this.commentSubmittedHandler),this.shadowRoot?.addEventListener("comment-submitted",this.commentSubmittedHandler)}render(){if(this.shadowRoot){const e=Jm.getState().comments[this.postId]||[];this.shadowRoot.innerHTML=`\n        <style>\n          :host {\n            display: flex;\n            flex-direction: column;\n            padding: 2rem;\n            background-color: white;\n            border-radius: 16px;\n            box-shadow: 0 2px 4px rgba(83, 84, 237, 0.1);\n            max-width: 730px;\n            margin: 0 auto;\n          }\n          .divider {\n            width: 100%;\n            height: 1px;\n            background: linear-gradient(to right, transparent, rgba(83, 83, 237, 0.39), transparent);\n            margin: 1rem 0;\n          }\n        </style>\n        <comment-form></comment-form>\n        <div class="divider"></div>\n        <comments-list comments='${this._escapeHTML(JSON.stringify(e))}'></comments-list>\n      `}}_escapeHTML(e){const t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}}const Ob=Db;class Nb extends HTMLElement{constructor(){super(),this.liked=!1,this.postData=null,this.postId="",this.fromProfile=!1,this.unsubscribeStore=null,this.attachShadow({mode:"open"}),this.handleStoreChange=this.handleStoreChange.bind(this)}connectedCallback(){this.unsubscribeStore=Jm.subscribe(this.handleStoreChange),this.postId=Jm.getCurrentPostId(),this.fromProfile=Jm.getFromProfile(),this.loadPostData()}disconnectedCallback(){this.unsubscribeStore&&this.unsubscribeStore()}handleStoreChange(e){if(e.posts&&this.postData){const t=e.posts.find((e=>e.id===this.postData.id));t&&(this.postData=t,this.checkUserLikeStatus(),this.render(),requestAnimationFrame((()=>{const e=this.shadowRoot?.querySelector(".like-icon");e&&(this.liked?e.classList.add("liked"):e.classList.remove("liked"))})))}}checkUserLikeStatus(){const e=Jm.getState().auth.user;if(e&&this.postData&&this.postData.id){const t=e.username;this.liked=Jm.getUserLikeStatus(t,this.postData.id);const n=this.shadowRoot?.querySelector(".like-icon");n&&(this.liked?n.classList.add("liked"):n.classList.remove("liked"))}else this.liked=!1}async loadPostData(){try{if(this.postId&&(this.postData=Jm.getPostById(this.postId)),!this.postData)return void console.warn("Post not found with ID:",this.postId);this.postData&&this.postData.comments&&(this.postData.comments=Array.isArray(this.postData.comments)?this.postData.comments:JSON.parse(this.postData.comments)),this.render(),this.addEventListeners()}catch(e){console.error("Error loading post data:",e),this.render(),this.addEventListeners()}}addEventListeners(){const e=this.shadowRoot?.querySelector("back-button");e?.addEventListener("click",(()=>{Jm.setReturnToProfile(!0),u("/profile")}));const t=this.shadowRoot?.querySelector(".just-likes");t?.addEventListener("click",(()=>{const e=Jm.getState().auth.user;if(!e||!this.postData||!this.postData.id)return void console.warn("Cannot toggle like: user not logged in or post data missing.");const t=e.username,n=this.postData.id;Jm.getUserLikeStatus(t,n)?Ym.unlikePost(n,t):Ym.likePost(n,t)}))}render(){const e=this.postData||{id:"default-1",photo:"https://i.pravatar.cc/150?img=3",name:"Juan Tel√≥n",date:"16/03/25",career:"Multimedia Engineering",semestre:"Semester 6",message:"Did anyone else stumble against a guy using boots in the stairs???",tag:"Academic",likes:2,share:"0",comments:[]},t=Jm.getState(),n=t.posts?.find((t=>t.id===e.id)),s=n?n.likes:e.likes;this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block;\n          width: 100%;\n          max-width: 100vw;\n          overflow-x: hidden;\n          min-height: 100vh;\n          background-color: white;\n          --nexopurple: #5354ed;\n          --nexowhite: white;\n        }\n        \n        h1 {\n          color: #5354ed;\n          text-align: center;\n          margin: 2rem 0;\n          font-size: 2.2rem;\n          font-weight: 700;\n        }\n        \n        .container {\n          max-width: 850px;\n          width: calc(100% - 20px);\n          margin: 20px auto 40px auto;\n          padding: 25px 20px;\n          background-color: #f8f9fd;\n          border-radius: 20px;\n          box-sizing: border-box;\n        }\n        \n        .back-button-container {\n          margin: 1rem 0;\n        }\n        \n        .post-container {\n          background-color: white;\n          border-radius: 16px;\n          padding: 1.5rem;\n          margin-bottom: 2rem;\n          box-shadow: 0 4px 12px rgba(83, 84, 237, 0.1);\n          width: 100%;\n          max-width: 740px;\n          height: auto;\n          min-height: 240px;\n          margin-left: auto;\n          margin-right: auto;\n          box-sizing: border-box;\n        }\n        \n        .attributes-container {\n          display: flex;\n          flex-direction: column;\n          gap: 1rem;\n        }\n        \n        .user-container {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          width: 100%;\n          flex-wrap: wrap;\n          gap: 0.5rem;\n        }\n\n        .profile-container {\n          display: flex;\n          gap: 1rem;\n          align-items: center;\n        }\n\n        .name-container {\n          display: flex;\n          flex-direction: column;\n          gap: 0.2rem;\n        }\n\n        .profile-picture {\n          width: 50px;\n          height: 50px;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n\n        .name {\n          font-weight: 600;\n          margin: 0;\n        }\n\n        .date {\n          color: #5354ed;\n          font-size: 0.9rem;\n          margin: 0;\n        }\n\n        .the-career {\n          display: flex;\n          gap: 0.5rem;\n          margin-top: 0.2rem;\n        }\n\n        .career, .semestre {\n          font-size: 0.75rem;\n          color: black;\n          font-weight: bold;\n          align-items: flex-start;\n          padding: 0;\n          margin: 0;\n        }\n\n        .message-container {\n          margin-top: 1rem;\n        }\n        \n        .post-content {\n          font-size: 1.1rem;\n          line-height: 1.6;\n          margin: 0;\n          word-wrap: break-word;\n        }\n        \n        .footer {\n          display: flex;\n          justify-content: center;\n          padding-top: 0.75rem;\n          border-top: 1px solid #f0f0f0;\n        }\n        \n        .align-likes, .align-share {\n          display: flex;\n          align-items: center;\n        }\n        \n        .just-likes, .just-share {\n          background: none;\n          border: none;\n          display: flex;\n          align-items: center;\n          gap: 5px;\n          cursor: pointer;\n          padding: 5px 10px;\n          border-radius: 4px;\n          transition: all 0.2s ease;\n        }\n        \n        .just-likes:hover, .just-share:hover {\n          transform: scale(1.05);\n        }\n        \n        .like-icon {\n          stroke: #5354ed;\n          fill: none;\n          transition: all 0.2s ease;\n        }\n        \n        .like-icon.liked {\n          fill: #5354ed;\n          stroke: #5354ed;\n        }\n\n        .share-icon path {\n          transition: fill 0.3s ease;\n          fill: #5354ed;\n        }\n        \n        .likes-count, .share-count {\n          margin: 0;\n          font-size: 0.85rem;\n          font-weight: bold;\n          color: #6b7280;\n          cursor: pointer;\n        }\n\n        .tag {\n          display: inline-block;\n          padding: 4px 12px;\n          border-radius: 0.85rem;\n          font-size: 0.7rem;\n          font-weight: 500;\n          margin-bottom: 0.5rem;\n          background-color: rgb(255, 255, 255);\n          border: 2px solid rgba(31, 31, 241, 0.57);\n          color: rgba(31, 31, 241, 0.57);\n          text-align: center;\n          margin: 1rem 0;\n          position: relative;\n          z-index: 1;\n        }\n        \n        @media (max-width: 768px) {\n          .container {\n            width: calc(100% - 16px);\n            margin: 10px auto 30px auto;\n            padding: 15px 10px;\n            border-radius: 15px;\n          }\n          \n          .post-container {\n            padding: 1rem;\n          }\n          \n          .user-container {\n            flex-direction: column;\n            align-items: flex-start;\n          }\n          \n          .the-career {\n            margin-top: 0.5rem;\n            margin-left: 60px; /* Alinea con la imagen de perfil */\n          }\n          \n          h1 {\n            font-size: 1.8rem;\n            margin: 1.5rem 0;\n          }\n          \n          .post-content {\n            font-size: 1rem;\n          }\n        }\n        \n        @media (max-width: 480px) {\n          .container {\n            width: calc(100% - 10px);\n            margin: 5px auto 20px auto;\n            padding: 10px 8px;\n            border-radius: 12px;\n          }\n          \n          .post-container {\n            padding: 0.8rem;\n            min-height: 200px;\n          }\n          \n          .profile-picture {\n            width: 40px;\n            height: 40px;\n          }\n          \n          .name {\n            font-size: 0.9rem;\n          }\n          \n          .date {\n            font-size: 0.8rem;\n          }\n          \n          .the-career {\n            margin-left: 50px;\n          }\n          \n          .career, .semestre {\n            font-size: 0.7rem;\n          }\n          \n          .post-content {\n            font-size: 0.95rem;\n            line-height: 1.5;\n          }\n          \n          .likes-count, .share-count {\n            font-size: 0.75rem;\n          }\n          \n          .just-likes, .just-share {\n            padding: 3px 6px;\n          }\n          \n          .like-icon, .share-icon {\n            width: 18px;\n            height: 18px;\n          }\n          \n          .tag {\n            font-size: 0.65rem;\n            padding: 3px 10px;\n          }\n        }\n      </style>\n      \n      <nav-bar></nav-bar>\n      \n      <div class="container">\n        <div class="back-button-container">\n          <back-button target="/profile"></back-button>\n        </div>\n        \n        <div class="post-container">\n          <div class="attributes-container">\n            <div class="user-container">\n              <div class="profile-container">\n                <img class="profile-picture" src="${e.photo}" alt="${e.name}">\n                <div class="name-container">\n                  <p class="name">${e.name}</p>\n                  <p class="date">${e.date}</p>\n                </div>\n              </div>\n\n              <div class="the-career">\n                <p class="career">${e.career}</p>\n                <p class="semestre">${e.semestre}</p>\n              </div>\n            </div>\n\n            <div class="message-container">\n              <p class="post-content">${e.message}</p>\n            </div>\n          </div>\n\n          <p class="tag">${e.tag}</p>\n          <div class="footer">  \n            <div class="align-likes">\n              <button class="just-likes">\n                <svg class="like-icon ${this.liked?"liked":""}" viewBox="0 0 24 24" fill="none" stroke="currentColor" width="20" height="20">\n                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" stroke-width="2"/>\n                </svg>\n                <p class="likes-count">${s} Likes</p>\n              </button>\n            </div>  \n\n            <div class="align-share">\n              <button class="just-share">\n                 <svg class="share-icon" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">\n                  <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/>\n                </svg>\n                <p class="share-count">Share</p>\n              </button>\n            </div>\n          </div>\n        </div>\n        \n        <comments-container post-id="${this.postId}"></comments-container>\n      </div>\n    `}}const jb=Nb;class Mb extends HTMLElement{connectedCallback(){const e=this.getAttribute("title")||"",t=this.getAttribute("subtitle")||"";this.attachShadow({mode:"open"}).innerHTML=`\n      <style>\n        @font-face {\n          font-family: 'TTRounds';\n          src: url('/assets/ttround/TTRoundsNeue-Regular.woff2') format('woff2');\n          font-weight: normal;\n          font-style: normal;\n        }\n\n        @font-face {\n          font-family: 'TTRounds';\n          src: url('/assets/fonts/ttround/TT ROUNDS NEUE BOLD.TTF') format('woff2');\n          font-weight: bold;\n          font-style: normal;\n        }\n\n        @font-face {\n          font-family: 'TTRounds2';\n          src: url('/assets/fonts/ttround/TT ROUNDS NEUE BOLD ITALIC.TTF') format('woff2');\n          font-weight: bold;\n          font-style: normal;\n        }\n\n        .container {\n          text-align: center;\n        }\n\n        .text {\n          font-family: 'TTRounds', sans-serif;\n          font-size: 3rem; \n          margin-top: 1.563rem; \n          margin-bottom: 0.625rem; \n          color: #000;\n        }\n\n        .subtitle {\n          font-family: 'TTRounds2', sans-serif;\n          font-size: 1.125rem; \n          color: #666666;\n          margin-top: 0;\n          margin-bottom: 2.5rem; \n        }\n\n        @media (max-width: 430px) {\n          .text {\n            font-size: 3rem; \n            color: #5a48f3;\n            font-family: 'TTRounds2', sans-serif;\n          }\n\n          .subtitle {\n            display: none;\n          }\n\n          .container {\n            text-align: left;\n          }\n        }\n      </style>\n\n      <div class="container">\n        <h2 class="text">${e}</h2>\n        <p class="subtitle">${t}</p>\n      </div>\n    `}}customElements.define("header-title",Mb);class Ub extends HTMLElement{connectedCallback(){this.innerHTML='\n      <style>\n        input[type="text"],\n        input[type="password"] {\n          width: 16.56rem; \n          padding: 0.3125rem 1rem; \n          margin-bottom: 1.4375rem; \n          border: 0.125rem solid #5354ED; \n          border-radius: 1.875rem; \n          outline: none;\n          font-size: 0.875rem; \n          font-family: Roboto, sans-serif;\n          transition: border-color 0.3s ease;\n          color: black;\n        }\n\n        input:focus {\n          border-color: #BD02FF;\n        }\n\n        @media (max-width: 430px) {\n          input[type="text"],\n          input[type="password"] {\n            width: 100%;\n            font-size: 0.8125rem; \n            padding: 0.3125rem 0.75rem; \n          }\n        }\n      </style>\n\n      <form id="login-form" style="display: flex; flex-direction: column; gap: 0.75rem;">\n        <input type="text" placeholder="Username" />\n        <input type="password" placeholder="Password" />\n      </form>\n    '}}customElements.define("form-fields",Ub);class Fb extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const e=this.getAttribute("text")||"Submit";this.shadowRoot.innerHTML=`\n    <style>\n      .primary {\n        background-color: #5354ed;\n        color: white;\n        font-size: 0.875rem; \n        border: 0.125rem solid black; \n        padding: 0.4375rem 2.9375rem; \n        border-radius: 3.125rem;\n        cursor: pointer;\n        outline: none;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        margin-top: 1.563rem; \n        margin-bottom: 0.625rem; \n        transition: all 0.3s ease;\n      }\n\n      .primary:hover {\n        filter: brightness(1.2);\n        transform: scale(1.05);\n        box-shadow: 0rem 0.375rem 0rem -0.25rem rgba(0, 0, 0, 1); /* 0px 6px 0px -4px */\n      }\n\n      .primary:active {\n        transform: scale(0.95);\n        box-shadow: 0rem 0rem 0rem 0rem rgba(0, 0, 0, 1);\n        filter: brightness(0.8);\n      }\n\n      @media (max-width: 430px) { \n        .primary {\n          padding: 0.375rem 1.875rem; \n          font-size: 0.8125rem; \n          width: 100%;\n        }\n      }\n    </style>\n    <button class="primary" type="button">${e}</button>\n    `,this.shadowRoot.querySelector(".primary")?.addEventListener("click",(()=>{r.dispatch({type:"PRIMARY_BUTTON_CLICK"})}))}}customElements.define("primary-button",Fb);class $b extends HTMLElement{connectedCallback(){this.innerHTML="\n      <style>\n        .divider {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin: 1.3125rem 0; \n          width: 100%;\n        }\n\n        .divider hr {\n          flex-grow: 1;\n          min-width: 9.375rem; \n          border: none;\n          height: 0.09375rem; \n          background-color: rgb(77, 77, 77);\n        }\n\n        .divider span {\n          margin: 0 0.75rem; \n          font-family: 'TTRounds2', sans-serif !important;\n          color: #666666;\n          font-size: 1rem; \n        }\n\n        @font-face {\n          font-family: 'TTRounds2';\n          src: url('/assets/fonts/ttround/TT ROUNDS NEUE BOLD ITALIC.TTF') format('woff2');\n          font-weight: bold;\n          font-style: normal;\n        }\n\n        @media (max-width: 430px) {\n          .divider hr {\n            min-width: 5rem; \n          }\n\n          .divider span {\n            font-size: 0.875rem; \n          }\n        }\n      </style>\n\n      <div class=\"divider\">\n        <hr />\n        <span>or</span>\n        <hr />\n      </div>\n    "}}customElements.define("custom-divider",$b);class Vb extends HTMLElement{connectedCallback(){this.innerHTML='\n    <style>\n      .social-container {\n        display: flex; \n        justify-content: center; \n        gap: 2rem; /* 32px */\n        flex-wrap: wrap;\n      }  \n    \n      .social {\n        height: 3.33rem; \n        width: 3.33rem;\n        background-color: #5354ed;\n        color: white;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border: none;\n        cursor: pointer;\n        transition: background-color 0.3s ease-out;\n        transform: scale(1); \n      }\n\n      .social img {\n        width: 1.875rem; \n        height: 1.875rem;\n      }\n\n      .social-text {\n        margin-top: 1.563rem; \n        margin-bottom: 1.563rem;\n        text-align: center;\n        font-family: \'TTRounds2\', sans-serif !important;\n        font-size: 0.875rem; \n        color: #666666;\n      }\n\n      @font-face {\n        font-family: \'TTRounds2\';\n        src: url(\'/assets/fonts/ttround/TT ROUNDS NEUE BOLD ITALIC.TTF\') format(\'woff2\');\n        font-weight: bold;\n        font-style: normal;\n      }\n\n      .social:hover {\n        background-color: #BD02FF;\n        transform: scale(1.05);\n      }\n\n      .mobile-only {\n        display: none;\n      }\n\n      @media (max-width: 430px) {\n        .social-container {\n          gap: 1.25rem; \n        }\n\n        .social {\n          width: 2.188rem; \n          height: 2.188rem;\n        }\n\n        .social img {\n          width: 1.25rem; \n          height: 1.25rem;\n        }\n\n        .social-text {\n          font-size: 0.813rem; \n          margin-top: 2.188rem; \n        }\n\n        .mobile-only {\n          display: flex;\n        }\n      }\n    </style>\n    \n    <div class="social-container">\n      \x3c!-- Always visible --\x3e\n      <button class="social">\n        <img src="https://img.icons8.com/ios-filled/50/ffffff/new-post.png" alt="email icon" />\n      </button>\n      <button class="social">\n        <img src="https://img.icons8.com/ios-filled/50/ffffff/instagram-new.png" alt="instagram icon" />\n      </button>\n\n      \x3c!-- Visible only on mobile --\x3e\n      <button class="social mobile-only">\n        <img src="https://img.icons8.com/ios-filled/50/ffffff/twitterx--v2.png" alt="x icon" />\n      </button>\n      <button class="social mobile-only">\n        <img src="https://img.icons8.com/ios-filled/50/ffffff/linkedin.png" alt="linkedin icon" />\n      </button>\n      <button class="social mobile-only">\n        <img src="https://img.icons8.com/ios-filled/50/ffffff/tiktok.png" alt="tiktok icon" />\n      </button>\n    </div>\n\n    <p class="social-text">Link with any of these social media platforms</p>\n    '}}customElements.define("social-buttons",Vb);class zb extends HTMLElement{connectedCallback(){this.innerHTML='\n      <style>\n        .container {\n          width: 16.5625rem; \n          margin-top: -1.125rem; \n          margin-bottom: 1rem; \n          text-align: right;\n        }\n\n        a {\n          font-family: Roboto, sans-serif;\n          font-size: 0.875rem; \n          font-style: italic;\n          color: #535353;\n          text-decoration: underline;\n        }\n\n        @media (max-width: 430px) {\n          .container {\n            width: 100%;\n            text-align: left;\n            margin: 0;\n          }\n\n          a {\n            font-size: 0.8125rem; \n          }\n        }\n      </style>\n\n      <div class="container">\n        <a href="#">Forgot password?</a>\n      </div>\n    '}}customElements.define("forgot-password",zb);class Bb extends HTMLElement{constructor(){super(...arguments),this.degree="",this.semester=""}connectedCallback(){this.render(),this.setupEventListeners()}render(){this.innerHTML='\n      <style>\n        select {\n          appearance: none;\n          -webkit-appearance: none;\n          -moz-appearance: none;\n          background-color: white;\n          background-image: url("data:image/svg+xml,%3Csvg fill=\'%234F46E5\' height=\'0.75rem\' viewBox=\'0 0 24 24\' width=\'0.75rem\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M7 10l5 5 5-5z\'/%3E%3C/svg%3E");\n          background-repeat: no-repeat;\n          background-position: right 0.4375rem center; \n          background-size: 2.0625rem; \n          color: rgb(167, 167, 167);\n          width: 16.5625rem; \n          padding: 0.3125rem 1rem; \n          margin-bottom: 1.4375rem; \n          border: 0.125rem solid #5354ED; \n          border-radius: 1.875rem; \n          outline: none;\n          font-size: 0.875rem; \n          font-family: Roboto, sans-serif;\n          transition: border-color 0.3s ease;\n          cursor: pointer;\n        }\n\n        select:focus {\n          background-image: url("data:image/svg+xml,%3Csvg fill=\'%23BD02FF\' height=\'1rem\' viewBox=\'0 0 24 24\' width=\'1rem\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M7 10l5 5 5-5z\'/%3E%3C/svg%3E");\n          border-color: #BD02FF;\n          color: black;\n        }\n\n        input {\n          width: 16.5625rem;\n          padding: 0.3125rem 1rem;\n          margin-bottom: 1.4375rem;\n          border: 0.125rem solid #5354ED;\n          border-radius: 1.875rem;\n          outline: none;\n          font-size: 0.875rem;\n          font-family: Roboto, sans-serif;\n          transition: border-color 0.3s ease;\n          cursor: pointer;\n          color: black;\n        }\n\n        input:focus,\n        select:focus {\n          border-color: #BD02FF;\n        }\n\n        @media (max-width: 430px) {\n          input,\n          select {\n            width: 100%;\n            font-size: 0.8125rem;\n            padding: 0.3125rem 0.75rem;\n          }\n        }\n      </style>\n\n      <form id="signup-form" style="display: flex; flex-direction: column; gap: 0.75rem;">\n        <input type="text" placeholder="Username" name="username" />\n        <input type="email" placeholder="Email" name="email" />\n        <input type="tel" placeholder="Phone number" name="phone" />\n        <input type="password" placeholder="Password" name="password" />\n\n        <select id="career">\n          <option value="">Select a career</option>\n          <option value="Business Administration with an Emphasis in International Business">Business Administration with an Emphasis in International Business</option>\n          <option value="Anthropology">Anthropology</option>\n          <option value="Biology">Biology</option>\n          <option value="Political Science with an Emphasis in International Relations">Political Science with an Emphasis in International Relations</option>\n          <option value="Communication with a Digital Approach">Communication with a Digital Approach</option>\n          <option value="Public Accounting and International Finance">Public Accounting and International Finance</option>\n          <option value="Law">Law</option>\n          <option value="Interactive Media Design">Interactive Media Design</option>\n          <option value="Industrial Design">Industrial Design</option>\n          <option value="Economics">Economics</option>\n          <option value="Economics and International Business">Economics and International Business</option>\n          <option value="Finance">Finance</option>\n          <option value="Biochemical Engineering">Biochemical Engineering</option>\n          <option value="Systems Engineering">Systems Engineering</option>\n          <option value="Industrial Engineering">Industrial Engineering</option>\n          <option value="Telematics Engineering">Telematics Engineering</option>\n          <option value="Bachelor\'s Degree in Social Sciences">Bachelor\'s Degree in Social Sciences</option>\n          <option value="Bachelor\'s Degree in Foreign Languages with an Emphasis in English">Bachelor\'s Degree in Foreign Languages with an Emphasis in English</option>\n          <option value="Medicine">Medicine</option>\n          <option value="Music">Music</option>\n          <option value="International Marketing and Advertising">International Marketing and Advertising</option>\n          <option value="Psychology">Psychology</option>\n          <option value="Chemistry">Chemistry</option>\n          <option value="Pharmaceutical Chemistry">Pharmaceutical Chemistry</option>\n          <option value="Sociology">Sociology</option>\n        </select>\n\n        <select id="semester">\n          <option value="">Select a semester</option>\n          <option value="First semester">First semester</option>\n          <option value="Second semester">Second semester</option>\n          <option value="Third semester">Third semester</option>\n          <option value="Fourth semester">Fourth semester</option>\n          <option value="Fifth semester">Fifth semester</option>\n          <option value="Sixth semester">Sixth semester</option>\n          <option value="Seventh semester">Seventh semester</option>\n          <option value="Eighth semester">Eighth semester</option>\n          <option value="Ninth semester">Ninth semester</option>\n          <option value="Tenth semester">Tenth semester</option>\n          <option value="+Tenth semester">+Tenth semester</option>\n        </select>\n      </form>\n    '}setupEventListeners(){const e=this.querySelector("#career"),t=this.querySelector("#semester");e&&e.addEventListener("change",(e=>{const t=e.target;this.degree=t.value,t.style.color="black"})),t&&t.addEventListener("change",(e=>{const t=e.target;this.semester=t.value,t.style.color="black"}))}getDegree(){const e=this.querySelector("#career");return e?e.value:""}getSemester(){const e=this.querySelector("#semester");return e?e.value:""}}customElements.define("signup-form-fields",Bb);class qb extends HTMLElement{connectedCallback(){this.innerHTML='\n      <style>\n        .checkbox-container {\n          display: flex;\n          align-items: center;\n          font-family: Roboto, sans-serif;\n          font-size: 0.75rem; \n          color: #666666;\n          gap: 0.625rem; \n          margin-bottom: 0.3125rem; \n          margin-top: 0.5rem;\n          margin-left: 0.625rem;\n        }\n\n        input[type="checkbox"] {\n          all: unset;\n          width: 1.125rem;\n          aspect-ratio: 1;\n          box-sizing: border-box;\n          border: 1px solid #5a48f3;\n          border-radius: 50%;\n          cursor: pointer;\n          position: relative;\n          display: grid;\n          place-content: center;\n          transition: border-color 0.2s ease-in-out;\n        }\n\n        input[type="checkbox"]::before {\n          content: "";\n          width: 0.28125rem; \n          height: 0.5625rem; \n          border-right: 0.125rem solid white; \n          border-bottom: 0.125rem solid white;\n          transform: rotate(45deg) scale(0);\n          transition: transform 0.2s ease-in-out;\n          background-color: transparent;\n        }\n\n        input[type="checkbox"]:checked {\n          background-color: #5a48f3;\n          border-color: #5a48f3;\n        }\n\n        input[type="checkbox"]:checked::before {\n          transform: rotate(45deg) scale(1);\n        }\n\n        .checkbox-text {\n          text-decoration: underline;\n          cursor: pointer;\n        }\n\n        @media (max-width: 430px) {\n          .checkbox-container {\n            font-size: 0.6875rem; \n            gap: 0.5rem; \n          }\n\n          input[type="checkbox"] {\n            width: 1rem; \n          }\n        }\n      </style>\n\n      <label class="checkbox-container">\n        <input type="checkbox" name="terms" />\n        <span class="checkbox-text">I agree with terms of use</span>\n      </label>\n    '}}customElements.define("custom-checkbox",qb);class Hb extends HTMLElement{constructor(){super(),this.lastPath="",this.attachShadow({mode:"open"}),this.handleRouteChange=this.handleRouteChange.bind(this)}connectedCallback(){Jm.load(),this.updateView(window.location.pathname),function(e){pe(e).onAuthStateChanged((async e=>{if(e){const t=await Uh(Bl(Yp,"users",e.uid));if(t.exists()){const e=t.data();localStorage.setItem("loggedInUser",JSON.stringify(e)),M(e)}}else localStorage.removeItem("loggedInUser"),r.dispatch({type:j})}),void 0,void 0)}(Xp),r.dispatch({type:O}),d(window.location.pathname),this.lastPath=Jm.getState().currentPath,Jm.subscribe((e=>{e.currentPath!==this.lastPath&&(this.handleRouteChange(e),this.lastPath=e.currentPath)})),window.addEventListener("popstate",(()=>{d(window.location.pathname)})),document.addEventListener("navigate",(e=>{console.log("AppContainer: 'navigate' event received",e.detail);const t=e.detail;u(t)}))}render(){this.shadowRoot.innerHTML="\n      <div>Loading...</div>\n    "}handleRouteChange(e){console.log("AppContainer: handleRouteChange",e.currentPath);const t=e.currentPath;this.updateView(t),window.scrollTo(0,0)}updateView(e){console.log("AppContainer: updateView to",e),this.shadowRoot.innerHTML="";let t=null;switch(e){case"/feed":t=document.createElement("feed-page");break;case"/academic":t=document.createElement("academics-pages");break;case"/profile":t=document.createElement("profile-page");break;case"/profile-settings":t=document.createElement("profile-settings-page");break;case"/teacher-detail":t=document.createElement("teacher-detail-page");break;case"/subject-detail":t=document.createElement("subject-detail-page");break;case"/comments-detail":t=document.createElement("comments-detail-page");break;case"/comments-detail-profile":t=document.createElement("comments-detail-profile");break;case"/login":t=document.createElement("login-component");break;case"/signup":t=document.createElement("sign-up-component");break;case"/":t=document.createElement("landing-page");break;default:console.warn(`Unknown route: ${e}. Redirecting to landing page.`),t=document.createElement("landing-page")}t&&this.shadowRoot.appendChild(t),window.scrollTo(0,0)}}const Kb=Hb;customElements.define("nav-bar",i),customElements.define("nav-bar-login-signup",f),customElements.define("back-button",v),customElements.define("btn-feed",y),customElements.define("btn-academic",x),customElements.define("btn-profile",S),customElements.define("btn-login",k),customElements.define("btn-signup",I),customElements.define("feed-page",Zm),customElements.define("academics-pages",tv),customElements.define("profile-page",sv),customElements.define("profile-settings-page",rv),customElements.define("teacher-detail-page",av),customElements.define("subject-detail-page",lv),customElements.define("landing-page",uv),customElements.define("comments-detail-page",pv),customElements.define("login-component",fv),customElements.define("sign-up-component",yv),customElements.define("post-modal",xv),customElements.define("floating-btn",Sv),customElements.define("button-tags",Tv),customElements.define("tag-filters-bar",Pv),customElements.define("feed-post",Dv),customElements.define("profile-post",Nv),customElements.define("post-container",Cv),customElements.define("start-button",Mv),customElements.define("landing-cards",$v),customElements.define("subject-card",Kv),customElements.define("subjects-container",Wv),customElements.define("tabs-component",Qv),customElements.define("teacher-card",Xv),customElements.define("teachers-container",eb),customElements.define("profile-container",nb),customElements.define("profile-header",ib),customElements.define("delete-account-confirmation",ob),customElements.define("settings-profile-container",cb),customElements.define("settings-profile-header",hb),customElements.define("search-bar",qv),customElements.define("subject-detail-card",db),customElements.define("subject-review-form",gb),customElements.define("subject-review-list",mb),customElements.define("teacher-detail-card",bb),customElements.define("teacher-review-form",wb),customElements.define("teacher-review-list",Eb),customElements.define("teacher-comments-container",Tb),customElements.define("subject-comments-container",Cb),customElements.define("comment-form",Rb),customElements.define("comments-list",Lb),customElements.define("comments-container",Ob),customElements.define("comments-detail-profile",jb),customElements.define("app-container",Kb),document.addEventListener("post-published",(e=>{const t=e.detail;Ym.createPost(t)})),console.log("se carg√≥ este archivo")})();